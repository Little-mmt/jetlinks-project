import{d as C,k as _,ac as B,o as F,w as P,U as i,V as m,X as n,f as t,u as e,Y as f,E as T}from"./vue-1730252110824.js";import{I as E,v as K,a0 as X,a6 as Y,a7 as z,dD as A,aK as G,a9 as H,a1 as Q,F as W,aa as Z}from"./index-1730252110824.js";import"./index-1730252110824279.js";import{d as $,e as ee}from"./firmware-1730252110824.js";import ae from"./SelectDevices-1730252110824.js";const te=C({name:"TaskPage"}),ue=C({...te,props:{data:{type:Object,default:()=>{}},firmwareId:{type:String,default:""},productId:{type:String,default:""}},emits:["change"],setup(v,{emit:b}){const p=v,y=_();B();const g=_(!1),S=_([]),k=p.firmwareId,w=p.productId,d=p.data.view,a=_({name:"",mode:void 0,responseTimeoutSeconds:"",timeoutSeconds:"",releaseType:"all",deviceId:void 0,description:""}),x={name:[{required:!0,message:"请输入任务名称"},{max:64,message:"最多可输入64个字符"}],mode:[{required:!0,message:"请选择推送方式"}],responseTimeoutSeconds:[{required:!0,message:"请输入响应超时时间"}],timeoutSeconds:[{required:!0,message:"请输入升级超时时间"}],releaseType:[{required:!0}],deviceId:[{required:!0,message:"请选择设备"}],description:[{max:200,message:"最多可输入200个字符"}]},j=(l,o)=>o.label.toLowerCase().indexOf(l.toLowerCase())>=0,U=async()=>{var c;const l=await((c=y.value)==null?void 0:c.validate());g.value=!0,(await ee({...l,firmwareId:k,productId:w}).finally(()=>{g.value=!1})).success&&b("change",!0)},q=()=>d?b("change",!1):U(),V=()=>{b("change",!1)},O=()=>{a.value.deviceId=void 0};return F(()=>{$({paging:!1,terms:[{column:"state",value:1}],sorts:[{name:"createTime",order:"desc"}]}).then(l=>{S.value=l.result.map(o=>({value:o.id,label:o.name}))})}),P(()=>p.data,l=>{l.id&&(a.value={...l,mode:l.mode.value,releaseType:l!=null&&l.deviceId?"part":"all"})},{immediate:!0,deep:!0}),(l,o)=>{const c=E,u=K,r=X,R=Y,h=z,I=A,J=G,N=H,D=Q,L=W,M=Z;return i(),m(M,{title:v.data.id?"查看":"新增任务","ok-text":"确认","cancel-text":"取消",visible:!0,width:"700px","confirm-loading":e(g),maskClosable:!1,onCancel:V,onOk:q},{default:n(()=>[t(L,{class:"form",layout:"vertical",model:e(a),name:"basic",autocomplete:"off",ref_key:"formRef",ref:y,rules:x},{default:n(()=>[t(D,{gutter:[24,0]},{default:n(()=>[t(r,{span:24},{default:n(()=>[t(u,{label:"任务名称",name:"name"},{default:n(()=>[t(c,{placeholder:"请输入任务名称",value:e(a).name,"onUpdate:value":o[0]||(o[0]=s=>e(a).name=s),disabled:e(d)},null,8,["value","disabled"])]),_:1})]),_:1}),t(r,{span:24},{default:n(()=>[t(u,{label:"推送方式",name:"mode"},{default:n(()=>[t(R,{value:e(a).mode,"onUpdate:value":o[1]||(o[1]=s=>e(a).mode=s),options:[{label:"平台推送",value:"push"},{label:"设备拉取",value:"pull"}],placeholder:"请选择推送方式",allowClear:"","show-search":"","filter-option":j,onChange:l.changeMode,disabled:e(d)},null,8,["value","onChange","disabled"])]),_:1})]),_:1}),e(a).mode==="push"?(i(),m(r,{key:0,span:12},{default:n(()=>[t(u,{label:"响应超时时间",name:"responseTimeoutSeconds"},{default:n(()=>[t(h,{placeholder:"请输入响应超时时间(秒)",style:{width:"100%"},min:1,max:99999,disabled:e(d),value:e(a).responseTimeoutSeconds,"onUpdate:value":o[2]||(o[2]=s=>e(a).responseTimeoutSeconds=s)},null,8,["disabled","value"])]),_:1})]),_:1})):f("",!0),e(a).mode==="push"||e(a).mode==="pull"?(i(),m(r,{key:1,span:e(a).mode==="push"?12:24},{default:n(()=>[t(u,{label:"升级超时时间",name:"timeoutSeconds"},{default:n(()=>[t(h,{placeholder:"请输入升级超时时间(秒)",style:{width:"100%"},min:1,max:99999,disabled:e(d),value:e(a).timeoutSeconds,"onUpdate:value":o[3]||(o[3]=s=>e(a).timeoutSeconds=s)},null,8,["disabled","value"])]),_:1})]),_:1},8,["span"])):f("",!0),e(a).mode?(i(),m(r,{key:2,span:12},{default:n(()=>[t(u,{label:"升级设备",name:"releaseType"},{default:n(()=>[t(J,{value:e(a).releaseType,"onUpdate:value":o[4]||(o[4]=s=>e(a).releaseType=s),"button-style":"solid",onChange:O,disabled:e(d)},{default:n(()=>[t(I,{value:"all"},{default:n(()=>[T("所有设备")]),_:1}),t(I,{value:"part"},{default:n(()=>[T("选择设备")]),_:1})]),_:1},8,["value","disabled"])]),_:1})]),_:1})):f("",!0),e(a).releaseType==="part"?(i(),m(r,{key:3,span:12},{default:n(()=>[t(u,{label:"选择设备",name:"deviceId"},{default:n(()=>[t(ae,{modelValue:e(a).deviceId,"onUpdate:modelValue":o[5]||(o[5]=s=>e(a).deviceId=s),data:v.data,productId:e(w)},null,8,["modelValue","data","productId"])]),_:1})]),_:1})):f("",!0),t(r,{span:24},{default:n(()=>[t(u,{label:"说明",name:"description"},{default:n(()=>[t(N,{placeholder:"请输入说明",value:e(a).description,"onUpdate:value":o[6]||(o[6]=s=>e(a).description=s),maxlength:200,rows:3,showCount:"",disabled:e(d)},null,8,["value","disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["title","confirm-loading"])}}});export{ue as _};
