import{a4 as ae,ay as te,I as oe,d as se,v as ne,Z as le,aT as pe,F as ue,aD as R,a6 as ce,ea as re,dd as ie,ec as de,g as me}from"./index-1731638920964.js";import"./index-1731638920964282.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import{s as _e}from"./index-1731638920964285.js";import ge from"./InputCard-1731638920964.js";import{f as ve,g as P}from"./utils-17316389209642.js";import{t as fe}from"./toLower-1731638920964.js";import{d as he,k as m,r as ye,e as J,ab as be,U as r,Z as x,_ as d,$ as q,f as o,X as p,E as S,u as a,V as f,Y as T,F as L,a1 as ke,G as xe,af as Se,ag as Ne}from"./vue-1731638920964.js";const F=h=>(Se("data-v-c4fb6db7"),h=h(),Ne(),h),Te={class:"api-test-container"},Ce={class:"top"},Ae={class:"input"},je={class:"api-card"},Ie=F(()=>d("h5",null,"请求参数",-1)),Be={class:"content"},ze={key:0,class:"table"},Ve={key:0,class:"pager"},we={class:"api-card"},Ue=F(()=>d("h5",null,"响应参数",-1)),De={class:"content"},Oe=he({__name:"ApiTest",props:{selectApi:{},schemas:{}},setup(h){var w;const l=h,z=m({}),v=m(),C=m(),M=m(),E=m(!!((w=l.selectApi)!=null&&w.requestBody)),_=m("text"),A=m(!1),e=ye({tableColumns:[{title:"参数名称",dataIndex:"name",key:"name",scopedSlots:!0},{title:"参数值",dataIndex:"value",key:"value",scopedSlots:!0},{title:"操作",dataIndex:"action",key:"action",width:"80px",scopedSlots:!0}],pageSize:10,pageNum:1,params:{paramsTable:ae(l.selectApi.parameters||[])},code:"",addRow:()=>{y.value.length===10&&(e.pageNum=e.pageNum+1),e.params.paramsTable.push({name:"",value:""})},clickDel:s=>{y.value.length===1&&e.pageNum>1&&(e.pageNum=e.pageNum-1),e.params.paramsTable.splice(s,1)}}),y=J(()=>{const s=(e.pageNum-1)*e.pageSize,t=e.pageNum*e.pageSize;return e.params.paramsTable.slice(s,t)});let $={};const j=m("");(()=>{M.value=l.selectApi.method})();const Z=()=>{var s;console.log(v.value),(s=v.value)==null||s.setModelLanguage(v.value.getModel(),_.value)},G=()=>{y.value.length?C.value&&C.value.validate().then(()=>{V()}):V()},V=()=>{var k;const s=fe(l.selectApi.method),t={get:"get",post:"post",patch:"patch",put:"put",delete:"remove"};let u=(k=l.selectApi)==null?void 0:k.url,c;const b={};e.params.paramsTable.forEach(i=>{b[i.name]=i.value,u.includes(`{${i.name}}`)&&(u=u.replace(`{${i.name}}`,i.value))}),s==="get"?c={...JSON.parse(e.code||"{}"),...b}:_.value=="text"?c=e.code:c=JSON.parse(e.code||"{}"),A.value=!0,te[t[s]](u,c,{},_.value==="text"?{headers:{"Content-Type":"text/plain"}}:{}).then(i=>{var N;Object.keys(c).length===0&&j.value&&(e.code=JSON.stringify(X()),(N=v.value)==null||N.editorFormat()),z.value=i}).finally(()=>{A.value=!1})};function X(){var c;if(!l.selectApi.requestBody)return{};if(!j.value)return"";const s=(c=j.value)==null?void 0:c.split("/").pop(),t=$.type||"",u=ve(l.schemas,s);return t==="array"?[P(l.schemas,u,3)]:P(l.schemas,u,3)}const Y=J(()=>{const s=Math.ceil(e.params.paramsTable.length/e.pageSize);return new Array(s).fill(1)});return(s,t)=>{var O;const u=oe,c=se,b=ne,k=be("AIcon"),i=le,N=pe,H=ue,K=R,Q=ce,W=re,U=R,ee=ie,D=de;return r(),x("div",Te,[d("div",Ce,[d("h5",null,q(l.selectApi.summary),1),d("div",Ae,[o(ge,{value:l.selectApi.method},null,8,["value"]),o(u,{value:(O=l.selectApi)==null?void 0:O.url,disabled:""},null,8,["value"]),o(c,{type:"primary",onClick:G,loading:a(A)},{default:p(()=>[S("发送")]),_:1},8,["loading"])])]),d("div",je,[Ie,d("div",Be,[a(y).length?(r(),x("div",ze,[o(H,{model:a(e).params,ref_key:"formRef",ref:C},{default:p(()=>[o(N,{columns:a(e).tableColumns,dataSource:a(y),pagination:!1,size:"small",bordered:""},{bodyCell:p(({column:n,record:g,index:I})=>[n.key==="name"?(r(),f(b,{key:0,name:["paramsTable",I+(a(e).pageNum-1)*a(e).pageSize,"name"],rules:[{required:!0,message:"该字段是必填字段"}]},{default:p(()=>[o(u,{value:g.name,"onUpdate:value":B=>g.name=B},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):n.key==="value"?(r(),f(b,{key:1,name:["paramsTable",I+(a(e).pageNum-1)*a(e).pageSize,"value"]},{default:p(()=>[o(u,{value:g.value,"onUpdate:value":B=>g.value=B},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):n.key==="action"?(r(),f(i,{key:2,type:"text",popConfirm:{title:"确认删除",onConfirm:()=>a(e).clickDel(I)}},{default:p(()=>[o(k,{type:"DeleteOutlined"})]),_:2},1032,["popConfirm"])):T("",!0)]),_:1},8,["columns","dataSource"])]),_:1},8,["model"]),a(e).params.paramsTable.length>10&&a(e).pageSize?(r(),x("div",Ve,[o(Q,{value:a(e).pageNum,"onUpdate:value":t[0]||(t[0]=n=>a(e).pageNum=n),style:{width:"60px"}},{default:p(()=>[(r(!0),x(L,null,ke(a(Y),(n,g)=>(r(),f(K,{value:g+1},{default:p(()=>[S(q(g+1),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),o(W,{pageSize:a(e).pageSize,current:a(e).pageNum,"onUpdate:current":t[1]||(t[1]=n=>a(e).pageNum=n),total:a(e).params.paramsTable.length,hideOnSinglePage:"",style:{"text-align":"center"}},null,8,["pageSize","current","total"])])):T("",!0),o(c,{type:"dashed",onClick:a(e).addRow,style:{width:"100%","text-align":"center","margin-top":"5px"}},{default:p(()=>[o(k,{type:"PlusOutlined"}),S("新增 ")]),_:1},8,["onClick"])])):T("",!0),o(ee,{value:a(_),"onUpdate:value":t[2]||(t[2]=n=>xe(_)?_.value=n:null),onChange:Z},{default:p(()=>[o(U,{value:"json"},{default:p(()=>[S("Json")]),_:1}),o(U,{value:"text"},{default:p(()=>[S("Text")]),_:1})]),_:1},8,["value"]),a(E)?(r(),x(L,{key:1},[a(_)==="json"?(r(),f(D,{key:0,ref_key:"editorRef",ref:v,language:"json",style:{height:"100%","min-height":"200px"},theme:"vs",modelValue:a(e).code,"onUpdate:modelValue":t[3]||(t[3]=n=>a(e).code=n)},null,8,["modelValue"])):(r(),f(D,{key:1,ref_key:"editorRef",ref:v,language:"text",style:{height:"100%","min-height":"200px"},theme:"vs",modelValue:a(e).code,"onUpdate:modelValue":t[4]||(t[4]=n=>a(e).code=n)},null,8,["modelValue"]))],64)):T("",!0)])]),d("div",we,[Ue,d("div",De,[o(a(_e),{value:a(z),copyable:""},null,8,["value"])])])])}}});const Xe=me(Oe,[["__scopeId","data-v-c4fb6db7"]]);export{Xe as default};
