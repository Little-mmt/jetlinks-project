import{X as H,h as X,ax as Z,au as L,o as S,a0 as U,a1 as G,Z as K,a2 as Q,e as W,a3 as ee}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{a as N,_ as te,b as se,c as ae}from"./resource-1730252110824.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-173025211082426.js";import{_ as ne}from"./index.vue_vue_type_style_index_0_lang-17302521108243.js";import{d as le,k,ab as b,U as p,V as x,X as s,f as o,u as d,_ as y,$ as m,E as T,Z as R,F as V,a1 as re,Y as P}from"./vue-1730252110824.js";import"./index-1730252110824305.js";import"./Result.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./product-17302521108244.js";const ie=["src"],ce={style:{"font-size":"16px","font-weight":"600"}},de=y("div",{class:"card-item-content-text"}," 通讯协议 ",-1),ue=y("div",{class:"card-item-content-text"}," 所属边缘网关 ",-1),Te=le({__name:"index",setup(pe){const j=H(),J={sorts:[{name:"createTime",order:"desc"}]},B=new Map;B.set("enabled","processing"),B.set("disabled","error");const D=k({}),C=k({}),M=k(!1),h=k(!1),w=k({}),E=[{title:"ID",dataIndex:"id",key:"id"},{title:"名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string"}},{dataIndex:"category",title:"通信协议",valueType:"select",scopedSlots:!0,key:"category",search:{type:"select",options:()=>new Promise(e=>{N({paging:!1,sorts:[{name:"createTime",order:"desc"}]}).then(i=>{const c=new Map;i.result.data.forEach(n=>{c.set(n.category,{label:n.category,value:n.category})}),e([...c.values()])})})}},{title:"所属边缘网关",dataIndex:"sourceId",key:"sourceId",scopedSlots:!0,search:{type:"select",options:()=>new Promise(e=>{N({paging:!1,sorts:[{name:"createTime",order:"desc"}]}).then(i=>{const c=new Map;i.result.data.forEach(n=>{c.set(n.sourceId,{label:n.sourceName,value:n.sourceId})}),e([...c.values()])})})}},{title:"创建时间",dataIndex:"createTime",key:"createTime",scopedSlots:!0,search:{type:"date"}},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"禁用",value:"disabled"},{label:"正常",value:"enabled"}]}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],$=(e,i)=>{var n,v,I,_;if(!e)return[];const c=[{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{O(e)}},{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{h.value=!0,w.value=e}},{key:"setting",text:"下发",disabled:((n=e.state)==null?void 0:n.value)==="disabled",tooltip:{title:e.state.value==="disabled"?"请先启用，再下发":"下发"},icon:"DownSquareOutlined",onClick:()=>{M.value=!0,w.value=e}},{key:"action",text:((v=e.state)==null?void 0:v.value)!=="disabled"?"禁用":"启用",tooltip:{title:((I=e.state)==null?void 0:I.value)!=="disabled"?"禁用":"启用"},icon:e.state.value!=="disabled"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${e.state.value!=="disabled"?"禁用":"启用"}?`,onConfirm:()=>{let l;return e.state.value!=="disabled"?l=te([e.id]):l=se([e.id]),l.then(f=>{var u;f&&f.status===200?(S("操作成功！"),(u=C.value)==null||u.reload()):S("操作失败！","error")}),l}}},{key:"delete",text:"删除",disabled:((_=e.state)==null?void 0:_.value)!=="disabled",tooltip:{title:e.state.value!=="disabled"?"请先禁用，再删除。":"删除"},popConfirm:{title:"确认删除?",onConfirm:()=>{const l=ae(e.id);return l.then(f=>{var u;f.status===200?(S("操作成功！"),(u=C.value)==null||u.reload()):S("操作失败！","error")}),l}},icon:"DeleteOutlined"}];return i==="card"?c.filter(l=>l.key!=="view"):c},Y=e=>{D.value=e},O=e=>{j.jumpPage("device/Instance/Detail",{id:e==null?void 0:e.sourceId})},q=()=>{var e;h.value=!1,(e=C.value)==null||e.reload()};return(e,i)=>{const c=b("pro-search"),n=b("Ellipsis"),v=U,I=G,_=b("AIcon"),l=K,f=Q,u=W,F=ee,A=b("FullPage"),z=b("page-container");return p(),x(z,null,{default:s(()=>[o(c,{columns:E,target:"edge-resource",onSearch:Y}),o(A,null,{default:s(()=>[o(F,{ref_key:"edgeResourceRef",ref:C,columns:E,request:d(N),defaultParams:J,params:d(D)},{card:s(t=>{var a,g;return[o(f,{value:t,onClick:r=>O(t),actions:$(t,"card"),status:(a=t.state)==null?void 0:a.value,statusText:(g=t.state)==null?void 0:g.text,statusNames:{enabled:"processing",disabled:"error"}},{img:s(()=>[y("img",{src:d(X)("/device/instance/device-card.png")},null,8,ie)]),content:s(()=>[o(n,{style:{width:"calc(100% - 100px)"}},{default:s(()=>[y("span",ce,m(t.name),1)]),_:2},1024),o(I,{style:{"margin-top":"18px"}},{default:s(()=>[o(v,{span:12},{default:s(()=>[de,o(n,null,{default:s(()=>[T(m(t.category),1)]),_:2},1024)]),_:2},1024),o(v,{span:12},{default:s(()=>[ue,o(n,{style:{width:"100%"}},{default:s(()=>[T(m(t.sourceName),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),actions:s(r=>[o(l,{disabled:r.disabled,popConfirm:r.popConfirm,tooltip:{...r.tooltip},onClick:r.onClick,hasPermission:"edge/Resource:"+r.key},{default:s(()=>[r.key==="delete"?(p(),x(_,{key:0,type:"DeleteOutlined"})):(p(),R(V,{key:1},[o(_,{type:r.icon},null,8,["type"]),y("span",null,m(r==null?void 0:r.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1032,["value","onClick","actions","status","statusText"])]}),state:s(t=>{var a,g;return[o(Z,{status:(a=t.state)==null?void 0:a.value,text:(g=t.state)==null?void 0:g.text,statusNames:{enabled:"processing",disabled:"error"}},null,8,["status","text"])]}),sourceId:s(t=>[T(m(t.sourceName),1)]),category:s(t=>[T(m(t.category),1)]),createTime:s(t=>[y("span",null,m(d(L)(t.createTime).format("YYYY-MM-DD HH:mm:ss")),1)]),action:s(t=>[o(u,{size:16},{default:s(()=>[(p(!0),R(V,null,re($(t,"table"),a=>(p(),x(l,{key:a.key,disabled:a.disabled,popConfirm:a.popConfirm,tooltip:{...a.tooltip},onClick:a.onClick,type:"link",style:{padding:"0 5px"},danger:a.key==="delete",hasPermission:a.key==="view"?!0:"edge/Resource:"+a.key},{icon:s(()=>[o(_,{type:a.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","danger","hasPermission"]))),128))]),_:2},1024)]),_:1},8,["request","params"])]),_:1}),d(h)?(p(),x(oe,{key:0,data:d(w),onClose:i[0]||(i[0]=t=>h.value=!1),onSave:q},null,8,["data"])):P("",!0),d(M)?(p(),x(ne,{key:1,data:d(w),onClose:i[1]||(i[1]=t=>M.value=!1)},null,8,["data"])):P("",!0)]),_:1})}}});export{Te as default};
