import{A as T,d as j,aa as S,L,g as O}from"./index-1730252110824.js";import{c as U,d as V,e as E,f as N}from"./notificationSubscription-1730252110824.js";import{_ as A}from"./Wechat.vue_vue_type_script_setup_true_lang-1730252110824.js";import{d as $,k as m,e as q,w as J,U as f,V as p,X as d,f as C,E as R,u as l,_ as w,Z as W,Y as x,q as z}from"./vue-1730252110824.js";const D={class:"code",style:{height:"450px"}},H={class:"code",style:{height:"600px"}},M=["src"],X=$({__name:"Bind",props:{data:{type:Object,default:()=>{}},current:{type:Object,default:()=>{}}},emits:["close","save"],setup(B,{emit:_}){const a=B,h=m(""),s=m(!1),g=q(()=>{var e;return(e=a.current)==null?void 0:e.channelProvider}),v=m({}),k=(e,n)=>{var i;U(e==="notifier-dingTalk"?"dingtalk":"wechat",{authCode:n,configId:(i=a.current)==null?void 0:i.channelConfiguration.notifierId}).then(o=>{var r;if(o.status===200){const t=(o==null?void 0:o.result)||"";t&&V(e,(r=a.current)==null?void 0:r.channelConfiguration.notifierId,t).then(c=>{c.status===200&&_("save",a.current)}).finally(()=>{s.value=!1})}}).catch(()=>{s.value=!1})},b=()=>{const e=document.querySelector("#notifier_iframe");e.onload=()=>{var t,c,u,y;const n=((c=(t=e==null?void 0:e.contentWindow)==null?void 0:t.location)==null?void 0:c.search)||"",i=new URLSearchParams(n),o=Object.fromEntries(i==null?void 0:i.entries());let r="";((u=a.current)==null?void 0:u.channelProvider)==="notifier-dingTalk"&&(r=o==null?void 0:o.authCode),r&&(s.value=!0,k((y=a.current)==null?void 0:y.channelProvider,r))}},I=async()=>{var e,n,i,o,r;if(L.remove("wexin_code"),((e=a.current)==null?void 0:e.channelProvider)==="notifier-weixin"){s.value=!0;const t=await E((n=a.current)==null?void 0:n.channelConfiguration.notifierId,(i=a.current)==null?void 0:i.channelConfiguration.templateId,location.href).finally(()=>{s.value=!1});if(t.status===200){const c=new URLSearchParams(t==null?void 0:t.result),u=Object.fromEntries(c==null?void 0:c.entries());v.value=u,h.value=t.result}}if(((o=a.current)==null?void 0:o.channelProvider)==="notifier-dingTalk"){s.value=!0;const t=await N((r=a.current)==null?void 0:r.channelConfiguration.notifierId,location.href).finally(()=>{s.value=!1});t.status===200&&(h.value=t.result,z(()=>{b()}))}},P=e=>{var n;k((n=a.current)==null?void 0:n.channelProvider,e)};return J(()=>a.current,()=>{I()},{immediate:!0,deep:!0}),(e,n)=>{const i=T,o=j,r=S;return f(),p(r,{maskClosable:!1,width:"900px",visible:"",onCancel:n[1]||(n[1]=t=>_("close")),zIndex:1100},{footer:d(()=>[C(o,{onClick:n[0]||(n[0]=t=>_("close"))},{default:d(()=>[R("关闭")]),_:1})]),default:d(()=>[l(g)==="notifier-weixin"?(f(),p(i,{key:0,spinning:l(s)},{default:d(()=>[w("div",D,[C(A,{data:l(v),onSuccess:P},null,8,["data"])])]),_:1},8,["spinning"])):l(g)==="notifier-dingTalk"?(f(),p(i,{key:1,spinning:l(s)},{default:d(()=>[w("div",H,[l(s)?x("",!0):(f(),W("iframe",{key:0,id:"notifier_iframe",class:"code-item",width:"100%",height:"100%",src:l(h)},null,8,M))])]),_:1},8,["spinning"])):x("",!0)]),_:1})}}});const K=O(X,[["__scopeId","data-v-e297a065"]]);export{K as default};
