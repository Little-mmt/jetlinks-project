import{I as O,v as E,cU as G,a6 as R,a7 as M,dw as Q,z as B,d as L,g as q,dr as X,dj as Y,C as H,$ as K,e as ee}from"./index-1731638920964.js";import{u as te}from"./metadata-1731638920964.js";import{P as ae,a as le}from"./data-17316389209644.js";import{d as T,o as N,k as V,e as J,U as c,Z as g,v as ne,A as ue,f as a,X as i,F as U,u as d,Y as I,ab as A,V as j,_ as x,$ as S,a1 as _,E as z,w as P,s as D,af as oe,ag as se,G as ie}from"./vue-1731638920964.js";import"./index-1731638920964291.js";import{F as de}from"./index-1731638920964304.js";import{k as ce}from"./product-17316389209644.js";import"./index-1731638920964280.js";const re=T({name:"VirtualRuleParam"}),me=T({...re,props:{value:{type:Object,default:()=>({})},name:{type:Array,default:()=>[]},id:String,showWindow:{type:Boolean,default:!1}},emits:["update:value"],setup(e,{emit:r}){const p=e;N(()=>{p.value.type||r("update:value",{...p.value,type:"script"})});const t=V();(async()=>{t.value=await ce().then(m=>m.result.map(u=>({label:`${u.value}(${u.text})`,value:u.value})))})();const o=m=>{m?(p.value.type="window",p.value.window||(p.value.window={})):p.value.type="script"},w=[{label:"时间窗口",value:"time"},{label:"次数窗口",value:"num"}],y=J(()=>{switch(p.value.windowType){case"time":return"窗口长度（秒）";case"num":return"窗口长度（次）";default:return"窗口长度"}}),s=J(()=>{switch(p.value.windowType){case"time":return"步长（秒）";case"num":return"步长（次）";default:return"步长"}});return(m,u)=>{const l=O,n=E,h=G,b=R,$=M;return c(),g(U,null,[ne(a(n,{name:e.name.concat(["type"])},{default:i(()=>[a(l,{value:e.value.type,"onUpdate:value":u[0]||(u[0]=f=>e.value.type=f),disabled:""},null,8,["value"])]),_:1},8,["name"]),[[ue,!1]]),a(n,{name:e.name.concat(["script"])},{default:i(()=>[a(de,{value:e.value.script,"onUpdate:value":u[1]||(u[1]=f=>e.value.script=f),id:e.id,virtualRule:e.value},null,8,["value","id","virtualRule"])]),_:1},8,["name"]),e.showWindow?(c(),g(U,{key:0},[a(n,{label:"规则配置",name:e.name.concat(["isVirtualRule"])},{default:i(()=>[a(h,{checked:e.value.isVirtualRule,"onUpdate:checked":u[2]||(u[2]=f=>e.value.isVirtualRule=f),"checked-value":!0,"un-checked-value":!1,onChange:o},null,8,["checked"])]),_:1},8,["name"]),e.value.isVirtualRule?(c(),g(U,{key:0},[a(n,{label:"窗口",name:e.name.concat(["windowType"]),rules:[{required:!0,message:"请选择窗口"}]},{default:i(()=>[a(b,{value:e.value.windowType,"onUpdate:value":u[3]||(u[3]=f=>e.value.windowType=f),options:w,size:"small","allow-clear":""},null,8,["value"])]),_:1},8,["name"]),a(n,{label:"聚合函数",name:e.name.concat(["aggType"]),rules:[{required:!0,message:"请选择聚合函数"}]},{default:i(()=>[a(b,{value:e.value.aggType,"onUpdate:value":u[4]||(u[4]=f=>e.value.aggType=f),options:d(t),size:"small","allow-clear":""},null,8,["value","options"])]),_:1},8,["name"]),a(n,{label:d(y),name:e.name.concat(["window","span"]),rules:[{required:!0,message:"请输入窗口长度"}]},{default:i(()=>[a($,{stringMode:"",value:e.value.window.span,"onUpdate:value":u[5]||(u[5]=f=>e.value.window.span=f),size:"small",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label","name"]),a(n,{label:d(s),name:e.name.concat(["window","every"]),rules:[{required:!0,message:"请输入步长"}]},{default:i(()=>[a($,{stringMode:"",maxlength:10,value:e.value.window.every,"onUpdate:value":u[6]||(u[6]=f=>e.value.window.every=f),size:"small",style:{width:"100%"}},null,8,["value"])]),_:1},8,["label","name"])],64)):I("",!0)],64)):I("",!0)],64)}}}),ve={class:"edit-title",style:{display:"flex","justify-content":"space-between","align-items":"center"}},ye={style:{width:"150px"}},pe={style:{"max-width":"400px"},class:"ant-form-vertical"},fe=T({name:"ConfigParam"}),ge=T({...fe,props:{value:{type:Object,default:()=>({})},name:{type:Array,default:()=>[],required:!0},config:{type:Array,default:()=>({properties:[]})}},setup(e){return(r,p)=>{const t=Q,v=E,o=A("AIcon"),w=B,y=L;return c(),j(y,{type:"dashed",block:""},{default:i(()=>[a(w,{placement:"left",trigger:"click"},{title:i(()=>[x("div",ve,[x("div",ye,S(e.config.name),1)])]),content:i(()=>[x("div",pe,[(c(!0),g(U,null,_(e.config.properties,s=>(c(),j(v,{key:s.property,name:e.name.concat([s.property]),label:s.name},{default:i(()=>{var m,u,l,n;return[a(t,{modelValue:e.value[s.property],"onUpdate:modelValue":h=>e.value[s.property]=h,itemType:(m=s.type)==null?void 0:m.type,mode:(u=s==null?void 0:s.type)!=null&&u.multi?"multiple":"",options:(n=(l=s.type)==null?void 0:l.elements)==null?void 0:n.map(h=>({label:h.text,value:h.value}))},null,8,["modelValue","onUpdate:modelValue","itemType","mode","options"])]}),_:2},1032,["name","label"]))),128))])]),default:i(()=>[z(" "+S(e.config.name||"存储配置")+" ",1),a(o,{type:"EditOutlined",class:"item-icon"})]),_:1})]),_:1})}}});const we=q(ge,[["__scopeId","data-v-f5ec3e13"]]),be={class:"indicator-box"},ke={key:5},he=T({name:"JIndicators"}),je=T({...he,props:{type:{type:String,required:!0},range:{type:Boolean,default:!1},value:{type:[String,Number,Array]},enum:{type:Object,default:()=>({})}},setup(e){const r=e,p=v=>{v.target.checked?r.value.value=[]:delete r.value.value},t=V([]);return P(()=>r.enum,()=>{var o,w,y,s,m,u,l,n;const v=[];(o=r.enum)!=null&&o.falseText&&((w=r.enum)==null?void 0:w.falseValue)!==void 0&&v.push({label:(y=r.enum)==null?void 0:y.falseText,value:(s=r.enum)==null?void 0:s.falseValue}),(m=r.enum)!=null&&m.trueText&&((u=r.enum)==null?void 0:u.trueValue)!==void 0&&v.push({label:(l=r.enum)==null?void 0:l.trueText,value:(n=r.enum)==null?void 0:n.trueValue}),t.value=v},{immediate:!0,deep:!0}),P(()=>r.type,v=>{v==="boolean"&&(r.value.value||(r.value.value=[]))},{immediate:!0}),(v,o)=>{const w=M,y=X,s=Y,m=R,u=O,l=H;return c(),g("div",be,[["int","long","double","float"].includes(e.type)?(c(),g(U,{key:0},[e.value.range?(c(),g(U,{key:0},[a(w,{value:e.value.value[0],"onUpdate:value":o[0]||(o[0]=n=>e.value.value[0]=n),max:e.value.value[1],size:"small",style:{width:"100%"},placeholder:"请输入"},null,8,["value","max"]),z(" ~ "),a(w,{value:e.value.value[1],"onUpdate:value":o[1]||(o[1]=n=>e.value.value[1]=n),min:e.value.value[0],size:"small",style:{width:"100%"},placeholder:"请输入"},null,8,["value","min"])],64)):(c(),j(w,{key:1,value:e.value.value,"onUpdate:value":o[2]||(o[2]=n=>e.value.value=n),size:"small",style:{width:"100%"},placeholder:"请输入"},null,8,["value"]))],64)):e.type==="date"?(c(),g(U,{key:1},[e.value.range?(c(),j(y,{key:0,"show-time":"",value:e.value.value,"onUpdate:value":o[3]||(o[3]=n=>e.value.value=n),size:"small",placeholder:"请输入"},null,8,["value"])):(c(),j(s,{key:1,"show-time":"",value:e.value.value,"onUpdate:value":o[4]||(o[4]=n=>e.value.value=n),size:"small",placeholder:"请输入"},null,8,["value"]))],64)):e.type==="boolean"?(c(),j(m,{key:2,value:e.value.value[0],"onUpdate:value":o[5]||(o[5]=n=>e.value.value[0]=n),options:d(t),size:"small",placeholder:"请选择"},null,8,["value","options"])):e.type==="string"?(c(),j(u,{key:3,value:e.value.value,"onUpdate:value":o[6]||(o[6]=n=>e.value.value=n),size:"small",placeholder:"请输入"},null,8,["value"])):(c(),g(U,{key:4},[e.value.range?(c(),g(U,{key:0},[a(u,{value:e.value.value[0],"onUpdate:value":o[7]||(o[7]=n=>e.value.value[0]=n),max:e.value.value[1],size:"small",placeholder:"请输入"},null,8,["value","max"]),z(" ~ "),a(u,{value:e.value.value[1],"onUpdate:value":o[8]||(o[8]=n=>e.value.value[1]=n),min:e.value.value[0],size:"small",placeholder:"请输入"},null,8,["value","min"])],64)):(c(),j(w,{key:1,value:e.value.value,"onUpdate:value":o[9]||(o[9]=n=>e.value.value=n),size:"small",placeholder:"请输入"},null,8,["value"]))],64)),e.type!=="boolean"&&e.type!=="string"?(c(),g("div",ke,[a(l,{style:{"min-width":"60px","margin-left":"5px"},checked:e.value.range,"onUpdate:checked":o[10]||(o[10]=n=>e.value.range=n),onChange:p},{default:i(()=>[z(" 范围 ")]),_:1},8,["checked"])])):I("",!0)])}}});const Ue=q(je,[["__scopeId","data-v-60d64474"]]),xe=e=>(oe("data-v-568eeeb7"),e=e(),se(),e),Te={class:"json-param"},$e={class:"item-left"},ze={class:"item-middle item-editable"},Ce={class:"edit-title",style:{display:"flex","justify-content":"space-between","align-items":"center"}},Ie=xe(()=>x("div",{style:{width:"150px"}},"配置参数",-1)),Ve={class:"ant-form-vertical"},Ae=["onClick"],Se={class:"item-right"},Pe=T({name:"MetricsParam"}),Ee=T({...Pe,props:{value:{type:Object,default:()=>[]},type:{type:String,default:""},enum:{type:Object,default:()=>({})},name:{type:Array,default:()=>[]}},emits:["update:value"],setup(e,{emit:r}){const p=e,t=V([]);D(()=>{t.value=p.value}),P(t,()=>{r("update:value",t.value)},{deep:!0});const v=V(-1),o=l=>{v.value=l},w=l=>{v.value=-1,t.value.splice(l,1)},y=()=>{v.value=-1},s=()=>{t.value.push({}),r("update:value",t.value)},m=l=>{if(l!=null&&l.range){if(!(l!=null&&l.value)||!(l!=null&&l.value[0])&&(l==null?void 0:l.value[0])!==0||!(l!=null&&l.value[1])&&(l==null?void 0:l.value[1])!==0)return Promise.reject(new Error("请输入指标值"))}else if(!(l!=null&&l.value)&&(l==null?void 0:l.value)!==0)return Promise.reject(new Error("请输入指标值"));return Promise.resolve()},u=l=>{l||(v.value=-1)};return(l,n)=>{const h=A("AIcon"),b=O,$=E,f=A("Ellipsis"),F=B,W=L;return c(),g("div",Te,[(c(!0),g(U,null,_(d(t),(Z,k)=>(c(),g("div",{class:"list-item",key:`object_${k}`},[x("div",$e,[a(h,{type:"MenuOutlined",class:"item-drag item-icon"}),z(" "+S(`#${k+1}.`),1)]),x("div",ze,[a(F,{visible:d(v)===k,placement:"left",onVisibleChange:u,trigger:"click"},{title:i(()=>[x("div",Ce,[Ie,a(h,{type:"CloseOutlined",onClick:y})])]),content:i(()=>[x("div",null,[x("div",Ve,[a($,{label:"标识",name:e.name.concat([k,"id"]),rules:[{required:!0,message:"请输入标识"},{max:64,message:"最多可输入64个字符"},{pattern:/^[a-zA-Z0-9_\-]+$/,message:"标识只能由数字、字母、下划线、中划线组成"}]},{default:i(()=>[a(b,{value:d(t)[k].id,"onUpdate:value":C=>d(t)[k].id=C,size:"small",placeholder:"请输入标识"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),a($,{label:"名称",name:e.name.concat([k,"name"]),rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"}]},{default:i(()=>[a(b,{value:d(t)[k].name,"onUpdate:value":C=>d(t)[k].name=C,size:"small",placeholder:"请输入名称"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),a($,{label:"指标值",name:e.name.concat([k,"value"]),rules:[{required:!0,validator:()=>m(d(t)[k]),message:"请输入指标值"}]},{default:i(()=>[a(Ue,{value:d(t)[k],"onUpdate:value":C=>d(t)[k]=C,type:e.type,size:"small",enum:e.enum},null,8,["value","onUpdate:value","type","enum"])]),_:2},1032,["name","rules"])])])]),default:i(()=>[x("div",{class:"item-edit",onClick:C=>o(k)},[a(f,null,{default:i(()=>[z(S(Z.name||"配置参数"),1)]),_:2},1024),a(h,{type:"EditOutlined",class:"item-icon"})],8,Ae)]),_:2},1032,["visible"])]),x("div",Se,[a(h,{type:"DeleteOutlined",onClick:C=>w(k)},null,8,["onClick"])])]))),128)),a(W,{type:"dashed",block:"",onClick:s},{icon:i(()=>[a(h,{type:"PlusOutlined",class:"item-icon"})]),default:i(()=>[z(" 添加指标 ")]),_:1})])}}});const Oe=q(Ee,[["__scopeId","data-v-568eeeb7"]]),Re=T({name:"ExpandsForm"}),Fe=T({...Re,props:{value:{type:Object},type:{type:String},name:{type:Array,default:()=>[],required:!0},id:{type:String},config:{type:Array,default:()=>[]},valueType:{type:Object,default:()=>({})}},emits:["update:value"],setup(e,{emit:r}){const p=e,t=V({});D(()=>{t.value=p.value||{}}),P(t,()=>{r("update:value",t.value)},{deep:!0,immediate:!0});const v=te();N(()=>{var y;(p.type==="product"||!((y=p.value)!=null&&y.source))&&r("update:value",{source:"device",...p.value})});const o=y=>y.every(m=>m.id&&m.name&&m.value)?Promise.resolve():Promise.reject(new Error("请输入指标配置")),w=y=>{y==="manual"?t.value.type=["write"]:y==="rule"?t.value.type=["report"]:t.value.type=[]};return(y,s)=>{const m=R,u=E,l=A("AIcon"),n=K,h=ee;return c(),g(U,null,[e.type==="product"?(c(),j(u,{key:0,label:"来源",name:e.name.concat(["source"]),rules:[{required:!0,message:"请选择来源"}]},{default:i(()=>[a(m,{value:d(t).source,"onUpdate:value":s[0]||(s[0]=b=>d(t).source=b),options:d(ae),size:"small",disabled:d(v).model.action==="edit",onChange:w},null,8,["value","options","disabled"])]),_:1},8,["name"])):I("",!0),e.type==="product"&&d(t).source==="rule"?(c(),j(me,{key:1,value:d(t).virtualRule,"onUpdate:value":s[1]||(s[1]=b=>d(t).virtualRule=b),name:e.name.concat(["virtualRule"]),id:e.id,showWindow:d(t).source==="rule"},null,8,["value","name","id","showWindow"])):I("",!0),a(u,{label:"读写类型",name:e.name.concat(["type"]),rules:[{required:!0,message:"请选择读写类型"}]},{default:i(()=>[a(m,{value:d(t).type,"onUpdate:value":s[2]||(s[2]=b=>d(t).type=b),options:d(le),mode:"multiple",size:"small",disabled:["manual","rule"].includes(d(t).source)},null,8,["value","options","disabled"])]),_:1},8,["name"]),e.config.length>0?(c(),j(u,{key:2,label:"其它配置"},{default:i(()=>[(c(!0),g(U,null,_(e.config,(b,$)=>(c(),j(u,{key:$},{default:i(()=>[a(we,{value:d(t),"onUpdate:value":s[3]||(s[3]=f=>ie(t)?t.value=f:null),config:b,name:e.name},null,8,["value","config","name"])]),_:2},1024))),128))]),_:1})):I("",!0),e.type==="product"&&["int","float","double","long","date","string","boolean"].includes(e.valueType.type)?(c(),j(u,{key:3,name:e.name.concat(["metrics"]),rules:[{validator:()=>o(d(t).metrics),message:"请输入指标配置"}]},{label:i(()=>[a(h,null,{default:i(()=>[z(" 指标配置 "),a(n,{title:"场景联动页面可引用指标配置作为触发条件"},{default:i(()=>[a(l,{type:"QuestionCircleOutlined",style:{color:"rgb(136, 136, 136)","font-size":"12px"}})]),_:1})]),_:1})]),default:i(()=>[a(Oe,{value:d(t).metrics,"onUpdate:value":s[4]||(s[4]=b=>d(t).metrics=b),type:e.valueType.type,enum:e.valueType,name:e.name.concat(["metrics"])},null,8,["value","type","enum","name"])]),_:1},8,["name","rules"])):I("",!0)],64)}}});export{Fe as _};
