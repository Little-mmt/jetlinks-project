import{o as S,aD as $,a6 as B,v as E,dw as O,aT as q,F as M,aa as A,g as G}from"./index-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import{C as T}from"./config-17302521108242.js";import{_ as J}from"./ToUser.vue_vue_type_script_setup_true_lang-1730252110824.js";import{_ as X}from"./ToOrg.vue_vue_type_script_setup_true_lang-1730252110824.js";import{_ as Y}from"./ToTag.vue_vue_type_script_setup_true_lang-1730252110824.js";import{p as Z}from"./validate-1730252110824.js";import{d as z,e as H,k as v,w as K,U as o,V as u,X as p,f as y,u as m,Z as k,F as I,a1 as Q,E as W,$ as V,Y as ee,G as ae}from"./vue-1730252110824.js";import"./template-1730252110824.js";import"./regular-1730252110824.js";const te={key:0},le=z({__name:"index",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},emits:["update:visible"],setup(s,{emit:w}){const r=s,c=H({get:()=>r.visible,set:t=>w("update:visible",t)}),x=v([]),C=async()=>{var n;const t={terms:[{column:"type",value:r.data.type},{column:"provider",value:r.data.provider}]},{result:a}=await T.getTemplate(t,r.data.id);x.value=a,a.length&&(l.value.templateId=(n=a[0])==null?void 0:n.id,h())};K(()=>c.value,t=>{t&&C()});const h=async()=>{const{result:t}=await T.getTemplateDetail(l.value.templateId);l.value.templateDetailTable=t.variableDefinitions.map(a=>({...a,type:a.expands?a.expands.businessType:a.type,value:void 0,otherRules:a.id==="calledNumber"||a.id==="phoneNumber"?[{max:64,message:"最多可输入64个字符",trigger:"change"},{trigger:"change",validator(n,f){return f?Z(f)?Promise.resolve():Promise.reject("请输入有效号码"):Promise.resolve()}}]:[]}))},R=[{title:"变量",dataIndex:"id",width:100,ellipsis:!0,scopedSlots:{customRender:"id"}},{title:"名称",dataIndex:"name",scopedSlots:{customRender:"name"}},{title:"值",dataIndex:"type",width:160,scopedSlots:{customRender:"type"}}],l=v({templateId:"",variableDefinitions:"",templateDetailTable:[]}),_=v(),g=v(!1),j=()=>{_.value.validate().then(async()=>{var a;const t={};(a=l.value.templateDetailTable)==null||a.forEach(n=>{t[n.id]=n.value}),g.value=!0,T.debug(t,r.data.id,l.value.templateId).then(n=>{n.success&&(S("操作成功"),U())}).finally(()=>{g.value=!1})}).catch(t=>{console.log("err: ",t)})},U=()=>{c.value=!1,_.value.resetFields(),l.value.templateDetailTable=[]};return(t,a)=>{const n=$,f=B,b=E,D=O,L=q,P=M,F=A;return o(),u(F,{visible:m(c),"onUpdate:visible":a[1]||(a[1]=i=>ae(c)?c.value=i:null),title:"调试",cancelText:"取消",okText:"确定",onOk:j,onCancel:U,confirmLoading:m(g)},{default:p(()=>[y(P,{ref_key:"formRef",ref:_,layout:"vertical",model:m(l)},{default:p(()=>[y(b,{label:"通知模板",name:"templateId",rules:{required:!0,message:"该字段为必填字段"}},{default:p(()=>[y(f,{value:m(l).templateId,"onUpdate:value":a[0]||(a[0]=i=>m(l).templateId=i),placeholder:"请选择通知模板",onChange:h},{default:p(()=>[(o(!0),k(I,null,Q(m(x),(i,e)=>(o(),u(n,{key:e,value:i.id},{default:p(()=>[W(V(i.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),m(l).templateDetailTable&&m(l).templateDetailTable.length?(o(),u(b,{key:0,label:"变量"},{default:p(()=>[y(L,{"row-key":"id",columns:R,"data-source":m(l).templateDetailTable,pagination:!1,bordered:""},{bodyCell:p(({column:i,record:e,index:N})=>[["id","name"].includes(i.dataIndex)?(o(),k("span",te,V(e[i.dataIndex]),1)):(o(),u(b,{key:1,name:["templateDetailTable",N,"value"],rules:[{required:e.required,message:"该字段为必填字段"},...e.otherRules]},{default:p(()=>[s.data.type==="dingTalk"||s.data.type==="weixin"?(o(),k(I,{key:0},[e.type==="user"?(o(),u(J,{key:0,toUser:e.value,"onUpdate:toUser":d=>e.value=d,type:s.data.type,"config-id":s.data.id},null,8,["toUser","onUpdate:toUser","type","config-id"])):e.type==="org"?(o(),u(X,{key:1,type:s.data.type,"config-id":s.data.id,toParty:e.value,"onUpdate:toParty":d=>e.value=d},null,8,["type","config-id","toParty","onUpdate:toParty"])):e.type==="tag"?(o(),u(Y,{key:2,type:s.data.type,"config-id":s.data.id,toTag:e.value,"onUpdate:toTag":d=>e.value=d},null,8,["type","config-id","toTag","onUpdate:toTag"])):(o(),u(D,{key:3,modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,itemType:e.type},null,8,["modelValue","onUpdate:modelValue","itemType"]))],64)):(o(),u(D,{key:1,modelValue:e.value,"onUpdate:modelValue":d=>e.value=d,itemType:e.type},null,8,["modelValue","onUpdate:modelValue","itemType"]))]),_:2},1032,["name","rules"]))]),_:1},8,["data-source"])]),_:1})):ee("",!0)]),_:1},8,["model"])]),_:1},8,["visible","confirmLoading"])}}});const _e=G(le,[["__scopeId","data-v-9a0a144b"]]);export{_e as default};
