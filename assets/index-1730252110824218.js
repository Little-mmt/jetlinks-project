import{o as R,an as B,ao as F,x as A,d as L,aa as Y,g as $}from"./index-1730252110824.js";import"./index-1730252110824287.js";import"./index-1730252110824286.js";import G from"./Product-17302521108243.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_name_Device_lang-1730252110824.js";import{_ as X}from"./index.vue_vue_type_script_setup_true_name_ActionDeviceActions_lang-1730252110824.js";import{u as q}from"./scene-17302521108242.js";import{d as K,ai as z,k as N,r as H,w as Q,U as p,V as u,X as l,_ as j,u as s,E as d,f as g,G as Z,Y as ee}from"./vue-1730252110824.js";import{i as te}from"./util-17302521108242.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import"./product-17302521108244.js";import"./category-1730252110824.js";import"./department-17302521108242.js";import"./setting-17302521108242.js";import"./TopCard-17302521108246.js";import"./config-17302521108242.js";import"./Device-1730252110824.js";import"./Tag-1730252110824.js";import"./RelationSelect.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./util-17302521108245.js";import"./lodash.default-1730252110824.js";import"./throttle-1730252110824.js";import"./min-1730252110824.js";import"./isNil-1730252110824.js";import"./isUndefined-1730252110824.js";import"./difference-1730252110824.js";import"./flattenDeep-1730252110824.js";import"./sortBy-1730252110824.js";import"./unionBy-1730252110824.js";import"./uniqBy-1730252110824.js";import"./toLower-1730252110824.js";import"./EditTable.vue_vue_type_script_setup_true_lang-17302521108242.js";import"./FunctionItem.vue_vue_type_script_setup_true_name_FunctionItem_lang-1730252110824.js";import"./index-1730252110824223.js";import"./typings-1730252110824.js";import"./DropdownButton.vue_vue_type_style_index_0_scoped_011bae6b_lang-1730252110824.js";import"./Menus-1730252110824.js";import"./util-17302521108243.js";import"./Time.vue_vue_type_style_index_0_lang-1730252110824.js";import"./Array.vue_vue_type_style_index_0_scoped_59b5dd9b_lang-1730252110824.js";import"./Double.vue_vue_type_script_setup_true_name_DoubleParamsDropdown_lang-1730252110824.js";import"./index-1730252110824310.js";import"./WriteProperty.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./scene-1730252110824.js";const oe={class:"steps-content"},ae={class:"steps-action"},se=K({name:"ActionDeviceModal"}),re=K({...se,props:{value:{type:Object,default:()=>{}},name:{type:Number,default:0},thenName:{type:Number,default:0},branchesName:{type:Number,default:0},parallel:{type:Boolean},options:{type:Object,default:()=>({})}},emits:["cancel","save"],setup(c,{emit:k}){var x;const O=c,T=q(),{data:D}=z(T),r=N(0),C=N(),h=N(),f=N({}),e=H({productId:"",deviceId:"",selector:"fixed",selectorValues:[],upperKey:"",source:"fixed",message:{messageType:"INVOKE_FUNCTION"}}),v=N({}),I=N(((x=O.options)==null?void 0:x.otherColumn)||[]),V=()=>{k("cancel")},w=(t,a={})=>{var i,y;const n={selector:e.selector,source:e.source,selectorValues:e.selectorValues,productId:e.productId,upperKey:e.upperKey,message:t.message};e.selector==="relation"&&(n.upperKey="scene.deviceId");const o={selector:e.selector,triggerName:((y=(i=D.value.options)==null?void 0:i.trigger)==null?void 0:y.name)||"触发设备",...v.value,otherColumns:[],columnMap:a},m=t.message.messageType;m==="INVOKE_FUNCTION"&&(o.type="执行"),m==="READ_PROPERTY"&&(o.type="读取"),m==="WRITE_PROPERTY"&&(o.type="设置",o.propertiesValue=typeof(o==null?void 0:o.propertiesValue)=="object"?JSON.stringify(o==null?void 0:o.propertiesValue):o==null?void 0:o.propertiesValue,o.otherColumns=I.value),k("save",n,JSON.parse(JSON.stringify(o)))},E=(t,a)=>{a||(e.selectorValues=void 0,e.deviceId="",e.selector="fixed",e.upperKey="",e.source="fixed",te(JSON.parse(t.metadata||"{}"),e==null?void 0:e.message)||(e.message={messageType:"INVOKE_FUNCTION"})),f.value=t,v.value.productName=t==null?void 0:t.name},M=(t,a)=>{Object.assign(e,{...t}),v.value={...s(v),...a}},J=(t,a)=>{I.value=a;const n={...v.value,...t};v.value=n},b=async t=>{var n,o,m,i;let a=t!==void 0?t:r.value;if(a===0)e.productId?r.value=1:R("请选择产品","error");else if(a===1)C.value?(await((n=C.value)==null?void 0:n.onFormSave()),r.value=2):(o=e.selectorValues)!=null&&o.length?r.value=2:R("请选择设备","error");else if(h.value){const y=await((m=h.value)==null?void 0:m.onFormSave()),_=(i=h.value)==null?void 0:i.getColumnMap();w(y,_)}},P=t=>{t!==0?b(t-1):r.value=0},U=()=>{r.value-=1},S=()=>b();return Q(()=>O.value,t=>{Object.assign(e,t)},{immediate:!0}),(t,a)=>{const n=B,o=F,m=A,i=L,y=Y;return p(),u(y,{title:"执行动作",visible:"",width:860,onCancel:V,onOk:b,maskClosable:!1},{footer:l(()=>[j("div",ae,[s(r)===0?(p(),u(i,{key:0,onClick:V},{default:l(()=>[d("取消")]),_:1})):(p(),u(i,{key:1,onClick:U},{default:l(()=>[d("上一步")]),_:1})),s(r)<2?(p(),u(i,{key:2,type:"primary",onClick:S},{default:l(()=>[d("下一步")]),_:1})):(p(),u(i,{key:3,type:"primary",onClick:S},{default:l(()=>[d("确定")]),_:1}))])]),default:l(()=>[g(o,{current:s(r),onChange:P},{default:l(()=>[g(n,null,{title:l(()=>[d("选择产品")]),_:1}),g(n,null,{title:l(()=>[d("选择设备")]),_:1}),g(n,null,{title:l(()=>[d("执行动作")]),_:1})]),_:1},8,["current"]),g(m,{style:{"margin-bottom":"10px"}}),j("div",oe,[s(r)===0?(p(),u(G,{key:0,rowKey:s(e).productId,"onUpdate:rowKey":a[0]||(a[0]=_=>s(e).productId=_),detail:s(f),"onUpdate:detail":a[1]||(a[1]=_=>Z(f)?f.value=_:null),onChange:E},null,8,["rowKey","detail"])):s(r)===1?(p(),u(W,{key:1,name:c.name,parallel:c.parallel,branchesName:c.branchesName,thenName:c.thenName,values:s(e),onSave:M,productDetail:s(f),ref_key:"deviceRef",ref:C},null,8,["name","parallel","branchesName","thenName","values","productDetail"])):s(r)===2?(p(),u(X,{key:2,name:c.name,branchesName:c.branchesName,thenName:c.thenName,values:s(e),productDetail:s(f),columnMap:c.options.columnMap,ref_key:"actionRef",ref:h,onChange:J},null,8,["name","branchesName","thenName","values","productDetail","columnMap"])):ee("",!0)])]),_:1})}}});const tt=$(re,[["__scopeId","data-v-359b6aff"]]);export{tt as default};
