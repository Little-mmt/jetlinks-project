import{d as F,ai as H,ad as K,k as d,o as L,ab as D,u as a,U as u,V as g,Z as b,f as l,X as i,E as h,Y as I,$ as U,F as B,a1 as X}from"./vue-1731638920964.js";import{a as Z,au as z,ab as W,dV as G,dW as M,o as S,dX as Q,Z as ee,e as te,ds as ae,a3 as se}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{u as ne}from"./instance-1731638920964.js";import{_ as ie}from"./index.vue_vue_type_script_setup_true_name_BindChildDevice_lang-1731638920964.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-17316389209649.js";const re={key:1},ke=F({__name:"index",setup(le){const f=ne(),{detail:o}=H(f),R=K(),y=d(!1);Z();const v=new Map;v.set("online","success"),v.set("offline","error"),v.set("notActive","warning");const _=d({}),w=d({}),r=d([]),k=d(!1),C=d({}),A=d([f.detail.id]),P=[{title:"ID",dataIndex:"id",key:"id",ellipsis:!0,search:{type:"string",defaultTermType:"eq"}},{title:"设备名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string"}},{title:"所属产品",dataIndex:"productName",key:"productName",search:{type:"string"}},{title:"注册时间",dataIndex:"registryTime",key:"registryTime",scopedSlots:!0,search:{type:"date"}},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"禁用",value:"notActive"},{label:"离线",value:"offline"},{label:"在线",value:"online"}]}},{title:"说明",dataIndex:"describe",key:"describe",ellipsis:!0,search:{type:"string"}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],E=e=>e?[{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{R.push("/iot/device/instance/detail/"+e.id)}},{key:"action",text:"解绑",tooltip:{title:"解绑"},icon:"DisconnectOutlined",popConfirm:{title:"确认解绑吗？",okText:"确定",cancelText:"取消",onConfirm:async()=>{const t=G(o.value.id,e.id,{});return f.current.accessProvider==="official-edge-gateway"&&await M(o.value.id,{ids:[e.id]}),t.then(p=>{var c;p.status===200&&(r.value.find((m,x)=>(m===e.id&&r.value.splice(x,1),m===e.id)),(c=_.value)==null||c.reload(),S("操作成功！"))}),t}}},{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{C.value=e,y.value=!0}}]:[],V=e=>{w.value=e},q=e=>{r.value=[...e]},N=()=>{r.value=[]},Y=async()=>{if(r.value.length){const e=Q(o.value.id,r.value);return f.current.accessProvider==="official-edge-gateway"&&await M(o.value.id,{ids:[r.value]}),e.then(t=>{var p;t.status===200&&(S("操作成功！"),N(),(p=_.value)==null||p.reload())}),e}else S("请勾选需要解绑的数据","warning")},$=e=>{var t;k.value=!1,e&&((t=_.value)==null||t.reload())},j=()=>{y.value=!1};return L(()=>{console.log(o.value.accessProvider)}),(e,t)=>{var T;const p=D("pro-search"),c=ee,m=te,x=ae,J=D("AIcon"),O=se;return a(y)?(u(),g(oe,{key:0,onCloseChildSave:j,childData:a(C)},null,8,["childData"])):(u(),b("div",re,[l(p,{columns:P,target:"child-device",onSearch:V,class:"device-child-device-search"}),l(O,{ref_key:"childDeviceRef",ref:_,columns:P,request:a(W),bodyStyle:{padding:0},defaultParams:{terms:[{column:"parentId",value:((T=a(o))==null?void 0:T.id)||"",termType:"eq"}]},rowSelection:{selectedRowKeys:a(r),onChange:q},params:a(w),model:"TABLE"},{rightExtraRender:i(()=>[l(m,null,{default:i(()=>{var s;return[((s=a(o))==null?void 0:s.accessProvider)==="official-edge-gateway"?(u(),g(c,{key:0,type:"primary",hasPermission:"device/Instance:update",onClick:t[0]||(t[0]=n=>{C.value={},y.value=!0})},{default:i(()=>[h("新增并绑定")]),_:1})):I("",!0),l(c,{type:"primary",onClick:t[1]||(t[1]=n=>k.value=!0),hasPermission:"device/Instance:update"},{default:i(()=>[h(" 绑定")]),_:1}),l(c,{type:"primary",hasPermission:"device/Instance:update",popConfirm:{title:"确认解绑吗？",onConfirm:Y}},{default:i(()=>[h("批量解除")]),_:1},8,["popConfirm"])]}),_:1})]),registryTime:i(s=>[h(U(s.registryTime?a(z)(s.registryTime).format("YYYY-MM-DD HH:mm:ss"):""),1)]),state:i(s=>[l(x,{text:s.state.text,status:a(v).get(s.state.value)},null,8,["text","status"])]),action:i(s=>[l(m,{size:16},{default:i(()=>[(u(!0),b(B,null,X(E(s,"table"),n=>(u(),b(B,{key:n.key},[n.key!=="update"||a(o).accessProvider==="official-edge-gateway"?(u(),g(c,{key:0,disabled:n.disabled,popConfirm:n.popConfirm,tooltip:{...n.tooltip},onClick:n.onClick,type:"link",style:{padding:"0px"},hasPermission:"device/Instance:"+n.key},{icon:i(()=>[l(J,{type:n.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])):I("",!0)],64))),128))]),_:2},1024)]),_:1},8,["request","defaultParams","rowSelection","params"]),a(k)?(u(),g(ie,{key:0,parentIds:a(A),onChange:$},null,8,["parentIds"])):I("",!0)]))}}});export{ke as _};
