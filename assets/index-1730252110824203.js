import{X as K,h as ee,i as te,o as E,d3 as le,Z as ae,e as se,fQ as ne,a0 as oe,a2 as ie,ax as re,a3 as ce,g as ue}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{e as R,f as de,h as pe,r as me}from"./configuration-1730252110824.js";import{f as _e}from"./log-17302521108243.js";import{q as fe}from"./config-1730252110824.js";import ve from"./index-1730252110824198.js";import{u as ge}from"./useAlarmLevel-1730252110824.js";import{d as ye,k as m,ab as y,U as h,Z as L,f as l,X as t,_ as u,u as _,E as N,W as he,R as be,$ as b,V as D,F as M,a1 as ke,Y as Ce,af as xe,ag as Se}from"./vue-1730252110824.js";import"./scene-1730252110824.js";import"./CardBox-1730252110824.js";import"./BranchesTabs-1730252110824.js";import"./Actions-1730252110824.js";import"./util-1730252110824.js";import"./config-17302521108242.js";import"./util-17302521108242.js";import"./scene-17302521108242.js";import"./util-17302521108243.js";import"./utils-17302521108243.js";import"./useRequest-1730252110824.js";const z=w=>(xe("data-v-37b11337"),w=w(),Se(),w),we=["src"],Te={style:{"font-weight":"600","font-size":"16px"}},Ie=z(()=>u("div",{class:"card-item-content-text"}," 说明 ",-1)),Ae={style:{height:"22px",width:"100%"}},Be=z(()=>u("div",{class:"card-item-content-text"}," 告警级别 ",-1)),Ee={style:{display:"flex"}},Ne={style:{display:"flex"}},Oe=ye({__name:"index",setup(w){const P=m({}),T=m({}),O=K(),{levelMap:$}=ge(),j=m(!1),X=m(),I=m(!1),q=m(0),V=[{title:"配置名称",dataIndex:"name",key:"name",search:{type:"string"},width:300,ellipsis:!0},{title:"类型",dataIndex:"targetType",key:"targetType",scopedSlots:!0,search:{type:"select",options:te?[{label:"产品",value:"product"},{label:"设备",value:"device"},{label:"组织",value:"org"},{label:"其他",value:"other"}]:[{label:"产品",value:"product"},{label:"设备",value:"device"},{label:"其他",value:"other"}]},width:150},{title:"关联场景联动",dataIndex:"id",hideInTable:!0,key:"id",search:{type:"select",termOptions:["in"],options:async()=>{var s;const e=await R({paging:!1,sorts:[{name:"createTime",order:"desc"}]}),o=(s=e.result)==null?void 0:s.data;if(e.success&&o&&o.length){const i=new Map;return o.forEach(p=>{p.scene.forEach(d=>{i.set(d.id,{label:d.name,value:d.id})})}),[...i.values()]}return[]}},width:220,ellipsis:!0},{title:"告警级别",dataIndex:"level",key:"level",scopedSlots:!0,search:{type:"select",options:async()=>{var o;const e=await fe();return e.status===200?(((o=e==null?void 0:e.result)==null?void 0:o.levels)||[]).filter(s=>(s==null?void 0:s.level)&&(s==null?void 0:s.title)).map(s=>({label:s.title,value:s.level})):[]}},width:150},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"正常",value:"enabled"},{label:"禁用",value:"disabled"}]},width:120},{title:"说明",dataIndex:"description",key:"description",search:{type:"string"},ellipsis:!0},{title:"操作",key:"action",fixed:"right",width:170,scopedSlots:!0}],A=m(!1),F=m({}),Z={product:"产品",device:"设备",org:"组织",other:"其他"},H=e=>{e.terms.map(o=>{o.terms.forEach(s=>{s.column==="id"&&(s.termType="rule-bind-alarm")})}),console.log(e,"e"),P.value=e},J=(e,o)=>{var i,p,d,f,k,C,x,B;return e?[{key:"tigger",text:"手动触发",disabled:((i=e==null?void 0:e.state)==null?void 0:i.value)==="disabled",tooltip:{title:((p=e==null?void 0:e.state)==null?void 0:p.value)==="disabled"?"未启用,不能手动触发":"手动触发"},onClick:()=>{A.value=!0,F.value=e},icon:"icon-shoudongchufa"},{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{O.jumpPage("rule-engine/Alarm/Configuration/Save",{},{id:e.id})}},{key:"action",text:((d=e.state)==null?void 0:d.value)!=="disabled"?"禁用":"启用",tooltip:{title:((f=e.state)==null?void 0:f.value)!=="disabled"?"禁用":"启用"},icon:((k=e.state)==null?void 0:k.value)!=="disabled"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`${((C=e.state)==null?void 0:C.value)!=="disabled"?"禁用告警不会影响关联的场景状态，确定要禁用吗":"确认启用"}?`,onConfirm:async()=>{var v,g;let r;((v=e.state)==null?void 0:v.value)==="disabled"?r=await de(e.id):r=await pe(e.id),r&&r.status===200?(E("操作成功！"),(g=T.value)==null||g.reload()):E("操作失败！","error")}}},{key:"delete",text:"删除",disabled:((x=e==null?void 0:e.state)==null?void 0:x.value)!=="disabled",tooltip:{title:((B=e==null?void 0:e.state)==null?void 0:B.value)!=="disabled"?"请先禁用该告警，再删除":"删除",placement:"topLeft"},onClick:async()=>{var g;if(I.value)return;I.value=!0;const r={paging:!1,terms:[{termType:"eq",column:"alarmConfigId",value:e.id,type:"and"}]},v=await _e(r);v.success&&(q.value=((g=v.result)==null?void 0:g.total)||0),le.confirm({title:q.value?`删除告警配置将同步删除相关联的${q.value}条告警记录,确认删除？`:"确认删除？",onOk(){return W(e.id)},onCancel(){I.value=!1}}),j.value=!0,X.value=e.id},icon:"DeleteOutlined"}].filter(r=>r.key!="tigger"||e.sceneTriggerType=="manual"):[]},Q=()=>{var e;A.value=!1,(e=T.value)==null||e.reload()},U=()=>{O.jumpPage("rule-engine/Alarm/Configuration/Save")},W=async e=>{(await me(e)).success?(E("操作成功！"),Y()):E("操作失败！","error"),I.value=!1},Y=()=>{j.value=!1,T.value.reload()};return(e,o)=>{const s=y("pro-search"),i=y("AIcon"),p=ae,d=se,f=y("Ellipsis"),k=ne,C=oe,x=y("LevelIcon"),B=ie,r=re,v=ce,g=y("FullPage"),G=y("page-container");return h(),L(M,null,[l(G,null,{default:t(()=>[u("div",null,[l(s,{columns:V,target:"search-configuration",onSearch:H}),l(g,null,{default:t(()=>[l(v,{columns:V,request:_(R),gridColumn:3,gridColumns:[1,2,3],ref_key:"tableRef",ref:T,defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:_(P)},{headerTitle:t(()=>[l(d,null,{default:t(()=>[l(p,{type:"primary",onClick:U,hasPermission:"rule-engine/Alarm/Configuration:add"},{icon:t(()=>[l(i,{type:"PlusOutlined"})]),default:t(()=>[N(" 新增 ")]),_:1})]),_:1})]),card:t(a=>{var n,S;return[l(B,he({value:a,actions:J(a,"card")},a,{status:(n=a.state)==null?void 0:n.value,statusText:(S=a.state)==null?void 0:S.text,statusNames:{enabled:"processing",disabled:"error"},onClick:()=>{_(O).jumpPage("rule-engine/Alarm/Configuration/Save",{},{id:a.id})}}),{img:t(()=>[be(e.$slots,"img",{},()=>[u("img",{src:_(ee)("/alarm/alarm-config.png")},null,8,we)],!0)]),content:t(()=>[l(k,null,{default:t(()=>[l(f,{style:{"max-width":"calc(100% - 120px)"}},{default:t(()=>[u("span",Te,b(a.name),1)]),_:2},1024)]),_:2},1024),l(k,null,{default:t(()=>[l(C,{span:12},{default:t(()=>[Ie,u("div",Ae,[l(f,{style:{"max-width":"100%"}},{default:t(()=>[N(b(a.description),1)]),_:2},1024)])]),_:2},1024),l(C,{span:12},{default:t(()=>[Be,u("div",Ee,[l(x,{level:a.level},null,8,["level"]),l(f,null,{default:t(()=>[N(b(_($)[a.level]),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024)]),actions:t(c=>[l(p,{disabled:c.disabled,popConfirm:c.popConfirm,tooltip:{...c.tooltip},onClick:c.onClick,hasPermission:"rule-engine/Alarm/Configuration:"+c.key},{default:t(()=>[c.key==="delete"?(h(),D(i,{key:0,type:"DeleteOutlined"})):(h(),L(M,{key:1},[l(i,{type:c.icon},null,8,["type"]),u("span",null,b(c==null?void 0:c.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["value","actions","status","statusText","onClick"])]}),targetType:t(a=>[u("span",null,b(Z[a.targetType]),1)]),state:t(a=>{var n,S;return[l(r,{text:((n=a.state)==null?void 0:n.value)==="enabled"?"正常":"禁用",status:(S=a.state)==null?void 0:S.value,statusNames:{enabled:"processing",disabled:"error"}},null,8,["text","status"])]}),level:t(a=>[u("div",Ne,[l(x,{level:a.level},null,8,["level"]),l(f,null,{default:t(()=>[N(b(_($)[a.level]),1)]),_:2},1024)])]),action:t(a=>[l(d,{size:16},{default:t(()=>[(h(!0),L(M,null,ke(J(a,"table"),n=>(h(),D(p,{key:n.key,disabled:n.disabled,popConfirm:n.popConfirm,tooltip:{...n.tooltip},onClick:n.onClick,type:"link",style:{padding:"0px"},hasPermission:"rule-engine/Alarm/Configuration:"+n.key,danger:n.key==="delete"},{icon:t(()=>[l(i,{type:n.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission","danger"]))),128))]),_:2},1024)]),_:3},8,["request","params"])]),_:3})])]),_:3}),_(A)?(h(),D(ve,{key:0,onSave:Q,onClose:o[0]||(o[0]=a=>A.value=!1),data:_(F)},null,8,["data"])):Ce("",!0)],64)}}});const at=ue(Oe,[["__scopeId","data-v-37b11337"]]);export{at as default};
