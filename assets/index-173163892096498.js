import{X as Q,a as Y,i as ee,h as te,aC as se,eX as ae,o as u,a4 as oe,Z as ne,as as ie,e as re,a0 as ce,a1 as le,a2 as de,ax as ue,a3 as pe,g as me}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{n as ye,o as _e,t as fe,p as ve,l as he,E as ge,_ as ke,G as xe,B as we}from"./product-17316389209644.js";import Ce from"./index-173163892096497.js";import{u as Ie}from"./useParams-1731638920964.js";import{a as Te}from"./setting-17316389209642.js";import{d as Se,k as p,r as be,o as Ne,ab as v,U as h,V as S,X as n,f as i,u as m,E as q,_ as y,$ as g,W as Pe,R as Oe,Z as D,F as j,a1 as Ae,q as B,af as qe,ag as De}from"./vue-1731638920964.js";import"./index-1731638920964290.js";import"./index-173163892096496.js";import"./product-17316389209645.js";import"./encodeQuery-1731638920964.js";import"./regular-1731638920964.js";const E=k=>(qe("data-v-4dcc743b"),k=k(),De(),k),je=["src"],Be={style:{"font-weight":"600","font-size":"16px"}},Ee=E(()=>y("div",{class:"card-item-content-text"}," 设备类型 ",-1)),Re=E(()=>y("div",{class:"card-item-content-text"}," 接入方式 ",-1)),Je=Se({__name:"index",setup(k){const R=Q(),x=p(0),w=p(""),b=p({}),J=[{title:"ID",dataIndex:"id",key:"id",scopedSlots:!0,width:200,ellipsis:!0},{title:"产品名称",dataIndex:"name",key:"name",width:220,ellipsis:!0},{title:"接入方式",dataIndex:"accessName",key:"accessName",width:220,ellipsis:!0},{title:"设备类型",dataIndex:"deviceType",key:"deviceType",scopedSlots:!0,ellipsis:!0,width:120},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,ellipsis:!0,width:90},{title:"说明",dataIndex:"describe",key:"describe",ellipsis:!0},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0,ellipsis:!0}],$=Y().hasPermission("device/Product:import"),F=p([]),V=p({}),N=(t,r)=>{if(!t)return[];const c=[{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{O(t.id)}},{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{w.value="编辑",x.value=2,B(()=>{T.value.show(t)})}},{key:"export",text:"导出",tooltip:{title:"导出"},icon:"icon-xiazai",onClick:()=>{console.log(t);const s=se(t,["transportProtocol","protocolName","accessId","accessName","accessProvider","messageProtocol"]);ae(s,t.name+"产品")}},{key:"action",text:t.state!==0?"禁用":"启用",tooltip:{title:t.state!==0?"禁用":"启用"},icon:t.state!==0?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${t.state!==0?"禁用":"启用"}?`,onConfirm:()=>{let s;return t.state!==0?s=ge(t.id):s=ke(t.id),s.then(e=>{var l;e&&e.status===200?(u("操作成功！"),(l=_.value)==null||l.reload()):u("操作失败！","error")}),s}}},{key:"delete",text:"删除",disabled:t.state!==0,tooltip:{title:t.state!==0?"已启用的产品不能删除":"删除"},popConfirm:{title:"确认删除?",onConfirm:()=>{const s=xe(t.id);return s.then(e=>{var l;e.status===200?(u("操作成功！"),(l=_.value)==null||l.reload()):u("操作失败！","error")}),s}},icon:"DeleteOutlined"}];return r==="card"?c.filter(s=>s.key!=="view"):c},P=()=>{x.value=1,w.value="新增",B(()=>{T.value.show(V.value)})},L=t=>{const r=new FileReader;return r.readAsText(t),r.onload=async c=>{var d,f;const s=(d=c.target)==null?void 0:d.result;if(console.log(s),!t.type.includes("json"))return u("请上传json格式文件","error"),!1;if(!s)return u("文件内容不能为空","error"),!1;const e=JSON.parse(s);return e.state=0,Array.isArray(e)?(u("请上传正确格式文件","error"),!1):(delete e.state,e!=null&&e.name||(e.name="产品"+Date.now()),!(e!=null&&e.deviceType)||JSON.stringify(e==null?void 0:e.deviceType)==="{}"?(u("缺少deviceType字段或对应的值","error"),!1):((await we(e)).status===200&&(u("操作成功"),(f=_.value)==null||f.reload()),!0))},!1},O=t=>{R.jumpPage("device/Product/Detail",{id:t})},U=()=>{var t;(t=_.value)==null||t.reload()};p([]);const C=p([]),_=p({}),I=be({columns:[{title:"名称",dataIndex:"name",key:"name",search:{first:!0,type:"string"}},{title:"ID",dataIndex:"id",key:"id",search:{type:"string",defaultTermType:"eq"}},{title:"网关类型",key:"accessProvider",dataIndex:"accessProvider",search:{type:"select",options:async()=>new Promise(t=>{ye().then(r=>{const c=r.result||[];t(Te(c).filter(s=>s.id!=="modbus-tcp"&&s.id!=="opc-ua"))})})}},{title:"接入方式",key:"accessId",dataIndex:"accessId",search:{type:"select",options:async()=>new Promise(t=>{_e({paging:!1}).then(r=>{C.value=[],C.value=r.result.map(c=>({label:c.name,value:c.id})),t(C.value)})})}},{title:"设备类型",key:"deviceType",dataIndex:"deviceType",search:{type:"select",options:[{label:"直连设备",value:"device"},{label:"网关子设备",value:"childrenDevice"},{label:"网关设备",value:"gateway"}]}},{title:"状态",key:"state",dataIndex:"state",search:{type:"select",options:[{label:"正常",value:1},{label:"禁用",value:0}]}},{title:"产品分类",key:"classified",dataIndex:"classifiedId",search:{type:"treeSelect",options:async()=>new Promise(t=>{fe({paging:!1}).then(r=>{t(r.result)})})}},{title:"说明",key:"describe",dataIndex:"describe",search:{type:"string"}}]}),T=p(),z=t=>{var c;const r=oe(t);(c=r.terms)!=null&&c.length&&r.terms.forEach(s=>{s.terms=s.terms.map(e=>(e.column==="id$dim-assets"&&(e={column:"id",termType:"dim-assets",value:{assetType:"product",targets:[{type:"org",id:e.value}]}}),e.column==="accessProvider"&&(e.value==="collector-gateway"?(e.termType=e.termType==="eq"?"in":"nin",e.value=["opc-ua","modbus-tcp","collector-gateway"]):Array.isArray(e.value)&&e.value.includes("collector-gateway")&&(e.value=["opc-ua","modbus-tcp",...e.value])),e))}),b.value=r},M=Ie();return Ne(()=>{var t;(t=M.params)!=null&&t.value.save&&P(),ee&&I.columns.splice(I.columns.length-2,0,{title:"所属组织",key:"id$dim-assets",dataIndex:"id$dim-assets",search:{first:!0,type:"treeSelect",termOptions:["eq"],options:async()=>new Promise(r=>{ve({paging:!1}).then(c=>{const s=e=>{const l=[];return e.forEach(d=>{d.children&&(d.children=s(d.children)),l.push({...d,value:JSON.stringify({assetType:"product",targets:[{type:"org",id:d.id}]})})}),l};r(s(c.result))})})}})}),(t,r)=>{const c=v("pro-search"),s=v("AIcon"),e=ne,l=ie,d=re,f=v("Ellipsis"),A=ce,X=le,G=de,Z=ue,K=pe,W=v("FullPage"),H=v("page-container");return h(),S(H,null,{default:n(()=>[i(c,{columns:m(I).columns,target:"product-manage",onSearch:z},null,8,["columns"]),i(W,null,{default:n(()=>[i(K,{columns:J,request:m(he),ref_key:"tableRef",ref:_,defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:m(b)},{headerTitle:n(()=>[i(d,null,{default:n(()=>[i(e,{type:"primary",onClick:P,hasPermission:"device/Product:add"},{icon:n(()=>[i(s,{type:"PlusOutlined"})]),default:n(()=>[q(" 新增 ")]),_:1}),i(l,{name:"file",accept:".json",showUploadList:!1,"before-upload":L,disabled:!m($)},{default:n(()=>[i(e,{hasPermission:"device/Product:import"},{default:n(()=>[q("导入")]),_:1})]),_:1},8,["disabled"])]),_:1})]),deviceType:n(a=>[y("div",null,g(a.deviceType.text),1)]),card:n(a=>[i(G,Pe({value:a,actions:N(a,"card")},a,{active:m(F).includes(a.id),status:a.state,onClick:o=>O(a.id),statusText:a.state===1?"正常":"禁用",statusNames:{1:"processing",0:"error"}}),{img:n(()=>[Oe(t.$slots,"img",{},()=>[y("img",{src:a.photoUrl||m(te)("/device-product.png"),class:"productImg"},null,8,je)],!0)]),content:n(()=>[i(f,{style:{width:"calc(100% - 100px)","margin-bottom":"18px"}},{default:n(()=>[y("span",Be,g(a.name),1)]),_:2},1024),i(X,null,{default:n(()=>[i(A,{span:12},{default:n(()=>{var o;return[Ee,y("div",null,g((o=a==null?void 0:a.deviceType)==null?void 0:o.text),1)]}),_:2},1024),i(A,{span:12},{default:n(()=>[Re,i(f,null,{default:n(()=>[y("div",null,g(a!=null&&a.accessName?a==null?void 0:a.accessName:"未接入"),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),actions:n(o=>[i(e,{disabled:o.disabled,popConfirm:o.popConfirm,tooltip:{...o.tooltip},onClick:o.onClick,hasPermission:o.key==="view"?!0:"device/Product:"+o.key},{default:n(()=>[o.key==="delete"?(h(),S(s,{key:0,type:"DeleteOutlined"})):(h(),D(j,{key:1},[i(s,{type:o.icon},null,8,["type"]),y("span",null,g(o==null?void 0:o.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["value","actions","active","status","onClick","statusText"])]),state:n(a=>[i(Z,{text:a.state===1?"正常":"禁用",status:a.state,statusNames:{1:"processing",0:"error"}},null,8,["text","status"])]),action:n(a=>[i(d,{size:16},{default:n(()=>[(h(!0),D(j,null,Ae(N(a,"table"),o=>(h(),S(e,{key:o.key,disabled:o.disabled,popConfirm:o.popConfirm,hasPermission:o.key==="view"?!0:"device/Product:"+o.key,tooltip:{...o.tooltip},onClick:o.onClick,type:"link",style:{padding:"0px"},danger:o.key==="delete"},{icon:n(()=>[i(s,{type:o.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","hasPermission","tooltip","onClick","danger"]))),128))]),_:2},1024)]),_:3},8,["request","params"])]),_:3}),i(Ce,{ref_key:"saveRef",ref:T,isAdd:m(x),title:m(w),onSuccess:U},null,8,["isAdd","title"])]),_:3})}}});const st=me(Je,[["__scopeId","data-v-4dcc743b"]]);export{st as default};
