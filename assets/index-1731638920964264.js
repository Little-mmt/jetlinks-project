import{cA as W,a4 as P,at as ee,o as se,I as ne,d as oe,J as te,$ as le,Z as ae,e as re,gB as ce,af as ue,g as ie}from"./index-1731638920964.js";import{d as de,k as d,w as pe,o as ve,ab as he,U as b,Z as V,f as l,X as i,u as D,_ as I,E as L,V as O,$,B as z,Y as fe,F as _e}from"./vue-1731638920964.js";import{_ as ge}from"./index.vue_vue_type_script_setup_true_name_Save_lang-1731638920964.js";import{u as ye,a as me,d as xe,g as Ie,b as k}from"./util-17316389209646.js";import"./BuildIn.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./index-1731638920964280.js";import"./RadioButton-1731638920964.js";import"./GeoJsonModal-1731638920964.js";import"./useRequest-1731638920964.js";const ke={style:{display:"flex",gap:"8px",margin:"18px 0"}},Ce={class:"tree-content"},Se={style:{height:"100%",width:"100%"}},Te={class:"tree-box"},Ne={class:"name"},be={class:"actions"},we={key:1,class:"tree-empty"},Be=de({__name:"index",emits:["select","close"],setup(Ke,{expose:F,emit:C}){const w=ye(),v=d([]),h=d([]),g=d(!1),S=d({}),B=d("add"),T=d(),y=d([]),N=d([]),E=d(550);d(void 0);const{areaTree:M}=me(),j=(e,n)=>e.filter(s=>s!=null&&s.name&&s.name.includes(n)||s!=null&&s.code&&s.code.includes(n)?!0:s.children?(s.children=j(s.children,n),!!s.children.length):!1),R=(e,n)=>{e.forEach(s=>{s.children&&(n==null||n(s.id),R(s.children,n))})},A=W(e=>{h.value=e?j(P(v.value),e):P(v.value),y.value=[],e&&(R(h.value,n=>{y.value.push(n)}),y.value=[...y.value])},300),U=()=>{g.value=!1,K()},Z=()=>{g.value=!1,C("close")},G=({height:e})=>{setTimeout(()=>{E.value=e},300)},X=e=>{B.value="edit",S.value=e,g.value=!0,N.value=[e.id],C("select",e==null?void 0:e.code,e)},Y=e=>{const n=xe(e);return n.then(s=>{s.success&&(se("操作成功！"),K())}),n},J=e=>{B.value="add";const n=e?e.children||[]:h.value,s=n.length?n[n.length-1]:null,f=s?s.sortIndex+1:1;S.value=e?{parentId:e.id,parentFullName:e.fullName,sortIndex:f}:{parentId:"",parentFullName:"",sortIndex:f},g.value=!0},q=e=>{const n=e.node.key,s=e.dragNode.key,f=e.node.pos.split("-"),m=e.dropPosition-Number(f[f.length-1]),_=(t,a,r,o)=>{t.forEach((u,x)=>{if(u.id===a)return r(u,x,t,o);if(u.children)return _(u.children,a,r,u)})},p=[...v.value];let c;_(p,s,(t,a,r)=>{r.splice(a,1),c=t}),e.dropToGap?(e.node.children||[]).length>0&&e.node.expanded&&m===1?_(p,n,(t,a,r,o)=>{t.children=t.children||[],c.parentId=t.parentId,t.children=t.children.map((u,x)=>(u.sortIndex=x+1,u)),r.splice(a+1,0,c),k(t),k(c)}):_(p,n,(t,a,r,o)=>{c.parentId=o?o.id:"",c.sortIndex=m===-1?a:a+1,r.splice(c.sortIndex,0,c);const u=r.map((x,Q)=>(x.sortIndex=Q+1,x));o?(o.children=u,k(o)):k(r)}):_(p,n,t=>{t.children=t.children||[],c.parentId=t.id,t.children.unshift(c),t.children=t.children.map((a,r)=>(a.sortIndex=r+1,a)),k(c)}),v.value=p};pe(()=>v.value,()=>{T.value?A(T.value):h.value=v.value},{deep:!0,immediate:!0});const H=(e,{node:n})=>{e.length&&(N.value=e,C("select",n==null?void 0:n.code,n))},K=async()=>{var n;const e=await Ie({paging:!1,sorts:[{name:"sortIndex",order:"asc"}]});if(e.success){v.value=(e==null?void 0:e.result)||[];const s=(n=v.value)==null?void 0:n[0];s&&(N.value=s!=null&&s.id?[s==null?void 0:s.id]:[],C("select",s==null?void 0:s.code,s))}};return F({openSave:e=>{e&&(w.saveCache.geoJson=e),S.value=w.saveCache,g.value=!0,w.treeMask=!1}}),ve(()=>{K()}),(e,n)=>{const s=he("AIcon"),f=ne,m=oe,_=te,p=le,c=ae,t=re,a=ce,r=ue;return b(),V(_e,null,[l(f,{placeholder:"请输入区域名称或行政区划代码",class:"search-input",value:T.value,"onUpdate:value":n[0]||(n[0]=o=>T.value=o),onChange:n[1]||(n[1]=o=>D(A)(o.target.value))},{prefix:i(()=>[l(s,{type:"SearchOutlined",style:{color:"rgba(0, 0, 0, 0.45)"}})]),_:1},8,["value"]),I("div",ke,[l(m,{type:"primary",class:"btn",onClick:n[2]||(n[2]=()=>J())},{default:i(()=>[L("新增区域")]),_:1})]),I("div",Ce,[h.value.length?(b(),O(D(ee),{key:0,onResize:G},{default:i(()=>[I("div",Se,[l(a,{class:"draggable-tree",draggable:"","block-node":"",expandedKeys:y.value,"onUpdate:expandedKeys":n[3]||(n[3]=o=>y.value=o),selectedKeys:N.value,"tree-data":h.value,"show-line":{showLeafIcon:!1},"show-icon":!0,"field-names":{key:"id"},virtual:!0,height:E.value,onDrop:q,onSelect:H},{title:i(o=>[I("div",Te,[I("div",Ne,[l(_,null,{default:i(()=>[L($(o==null?void 0:o.name)+" ("+$(o.code)+")",1)]),_:2},1024)]),I("div",be,[l(t,{size:8},{default:i(()=>[l(p,{title:"编辑"},{default:i(()=>[l(m,{onClick:z(u=>X(o==null?void 0:o.data),["stop"]),class:"actions-btn",type:"link"},{default:i(()=>[l(s,{type:"EditOutlined"})]),_:2},1032,["onClick"])]),_:2},1024),l(p,{title:"新增子区域"},{default:i(()=>[l(m,{onClick:z(u=>J(o==null?void 0:o.data),["stop"]),class:"actions-btn",type:"link"},{default:i(()=>[l(s,{type:"PlusCircleOutlined"})]),_:2},1032,["onClick"])]),_:2},1024),l(p,{title:"删除"},{default:i(()=>[l(c,{type:"link",style:{margin:"0",padding:"0"},danger:"",popConfirm:{title:"确认删除？",onConfirm:()=>Y(o==null?void 0:o.id)}},{default:i(()=>[l(s,{type:"DeleteOutlined"})]),_:2},1032,["popConfirm"])]),_:2},1024)]),_:2},1024)])])]),_:1},8,["expandedKeys","selectedKeys","tree-data","height"])])]),_:1})):(b(),V("div",we,[l(r)]))]),g.value?(b(),O(ge,{key:0,mode:B.value,data:S.value,treeData:h.value,areaTree:D(M),onSave:U,onClose:Z},null,8,["mode","data","treeData","areaTree"])):fe("",!0)],64)}}});const $e=ie(Be,[["__scopeId","data-v-d11c8e79"]]);export{$e as default};
