import{aC as M,a4 as q,o as G,fz as L,v as E,I as A,a7 as Y,cY as z,aR as X,F as Z,aa as H}from"./index-1731638920964.js";import{_ as K}from"./BuildIn.vue_vue_type_script_setup_true_lang-1731638920964.js";import{u as P,s as Q,b as W}from"./util-17316389209646.js";import{R as x}from"./RadioButton-1731638920964.js";import ee from"./GeoJsonModal-1731638920964.js";import{d as D,k as _,r as te,w as R,U as d,V as m,X as s,_ as C,f as r,Z as N,F as ae,E as g,Y as U}from"./vue-1731638920964.js";const ne={style:{"margin-top":"10px"}},oe={key:0},le=C("span",null,"区域已圈定完成",-1),se={key:1},re=C("span",null,"已上传",-1),ie=D({name:"Save"}),ve=D({...ie,props:{data:{type:Object,default:()=>{}},treeData:{type:Array,default:()=>[]},areaTree:{type:Array,default:()=>[]},mode:{type:String,default:"add"}},emits:["close","save"],setup(b,{emit:k}){const n=b,S=_([]),J=_(!1),c=_(!1),O=_(),p=P(),h={parentId:void 0,id:void 0,name:void 0,code:void 0,features:void 0,children:[],properties:{type:"builtin",partition:"none",sync:!0},sortIndex:n.data.sortIndex||1,geoJson:void 0},t=te({parentId:void 0,id:void 0,name:void 0,code:void 0,features:void 0,children:[],properties:{type:"builtin",partition:"none",sync:!0},sortIndex:n.data.sortIndex||1,geoJson:void 0}),T=o=>{t.geoJson=o,c.value=!1},F=o=>{t.properties.type==="custom"&&(n.mode==="add"?p.mapInit():p.mapReadOnly(t.geoJson)),k("close",o)},w=o=>{t.geoJson=void 0,t.children=[],t.properties.sync=!1},j=o=>{p.treeMask=!0,p.saveCache=t,p.showTool(),o?p.layerSetData(t.geoJson):p.type=void 0,p.editType=n.mode,k("close")},B=(o,e,u)=>{var f;let l;u?l=((f=u==null?void 0:u.triggerNode)==null?void 0:f.props.children)||[]:l=n.treeData;const v=l.length?l[l.length-1]:{};t.sortIndex=v.sortIndex?v.sortIndex+1:1},V=()=>{O.value.validate().then(async o=>{const e={...M(n.data,["parentFullName","parentId"]),...t};if(e.fullName=n.data.parentFullName?n.data.parentFullName+t.name:t.name,e.parentId=e.parentId||"",n.mode==="edit"&&(e.fullName=n.data.fullName),e.properties.sync){const l=q(n.areaTree),f=Q(e.code,l).filter(i=>e.children&&e.children.some(y=>y.code===i.code)?!1:(i.fullName||(i.fullName=e.fullName+i.name),!0));e.children=[...e.children||[],...f].map(i=>{const{id:y,...I}=i;return I})}J.value=!0,console.log("props====",n.data),console.log("newData====",e),(await W(e).finally(()=>{J.value=!1})).status===200&&(p.stateInit(),G("操作成功！"),k("save"))}).catch(o=>{console.log("error",o)})};return R(()=>JSON.stringify(n.data),o=>{n.mode==="add"?Object.assign(t,h,JSON.parse(o||"{}")):n.mode==="edit"?Object.assign(t,JSON.parse(o||"{}")):Object.assign(t,h)},{immediate:!0}),R(()=>JSON.stringify(n.treeData),()=>{S.value=JSON.parse(JSON.stringify(n.treeData))},{immediate:!0}),(o,e)=>{const u=L,l=E,v=A,f=Y,i=z,y=X,I=Z,$=H;return d(),m($,{maskClosable:!1,width:"650px",visible:!0,title:b.mode==="edit"?"编辑区域":"新增区域",confirmLoading:J.value,onOk:V,onCancel:e[13]||(e[13]=()=>{F()})},{default:s(()=>[C("div",ne,[r(I,{layout:"vertical",ref_key:"formRef",ref:O,model:t},{default:s(()=>[r(l,{name:"parentId",label:"上级区域"},{default:s(()=>[r(u,{showSearch:"",allowClear:"",value:t.parentId,"onUpdate:value":e[0]||(e[0]=a=>t.parentId=a),placeholder:"1级区域不需要选择","tree-data":S.value,"field-names":{children:"children",label:"name",value:"id"},"tree-node-filter-prop":"name",onChange:B},null,8,["value","tree-data"])]),_:1}),r(l,{label:"添加方式"},{default:s(()=>[r(x,{value:t.properties.type,"onUpdate:value":e[1]||(e[1]=a=>t.properties.type=a),options:[{label:"内置行政区",value:"builtin"},{label:"自定义数据",value:"custom"}],onSelect:w},null,8,["value"])]),_:1}),t.properties.type==="builtin"?(d(),m(l,{key:0},{default:s(()=>[r(K,{value:t.code,"onUpdate:value":e[2]||(e[2]=a=>t.code=a),name:t.name,"onUpdate:name":e[3]||(e[3]=a=>t.name=a),sync:t.properties.sync,"onUpdate:sync":e[4]||(e[4]=a=>t.properties.sync=a),areaTree:b.areaTree},null,8,["value","name","sync","areaTree"])]),_:1})):(d(),N(ae,{key:1},[r(l,{label:"区域名称",name:"name",required:"",rules:[{required:!0,message:"请输入区域名称"},{max:64,message:"最多输入64个字符"}]},{default:s(()=>[r(v,{value:t.name,"onUpdate:value":e[5]||(e[5]=a=>t.name=a),placeholder:"请输入区域名称"},null,8,["value"])]),_:1}),r(l,{label:"区划代码",name:"code",required:"",rules:[{required:!0,message:"请输入区划代码"}]},{default:s(()=>[r(f,{value:t.code,"onUpdate:value":e[6]||(e[6]=a=>t.code=a),style:{width:"100%"},placeholder:"请输入区划代码"},null,8,["value"])]),_:1}),r(l,{label:"区域划分"},{default:s(()=>[r(x,{value:t.properties.partition,"onUpdate:value":e[7]||(e[7]=a=>t.properties.partition=a),options:[{label:"无",value:"none"},{label:"手动描点",value:"manual"},{label:"GeoJson",value:"geoJson"}],onSelect:w},null,8,["value"])]),_:1}),t.properties.partition==="manual"?(d(),N("div",oe,[t.geoJson?(d(),m(y,{key:1},{default:s(()=>[le,r(i,{type:"link",style:{padding:"0"},onClick:e[9]||(e[9]=a=>j(!0))},{default:s(()=>[g("编辑")]),_:1})]),_:1})):(d(),m(i,{key:0,type:"link",style:{padding:"0"},onClick:e[8]||(e[8]=a=>j(!1))},{default:s(()=>[g("请在地图上描点")]),_:1}))])):t.properties.partition==="geoJson"?(d(),N("div",se,[t.geoJson?(d(),m(y,{key:1},{default:s(()=>[re,r(i,{type:"link",style:{padding:"0"},onClick:e[11]||(e[11]=a=>c.value=!0)},{default:s(()=>[g("编辑")]),_:1})]),_:1})):(d(),m(i,{key:0,type:"link",style:{padding:"0"},onClick:e[10]||(e[10]=a=>c.value=!0)},{default:s(()=>[g("点击上传GeoJson")]),_:1}))])):U("",!0)],64))]),_:1},8,["model"]),c.value?(d(),m(ee,{key:0,value:t.geoJson,onCancel:e[12]||(e[12]=a=>c.value=!1),onOk:T},null,8,["value"])):U("",!0)])]),_:1},8,["title","confirmLoading"])}}});export{ve as _};
