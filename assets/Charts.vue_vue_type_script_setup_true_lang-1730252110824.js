import{au as f,a6 as S,aD as B,e as U,af as q,A as I,eK as G,eL as J}from"./index-1730252110824.js";import{u as P}from"./instance-1730252110824.js";import X from"./Chart-1730252110824.js";import{f as Z}from"./index-1730252110824297.js";import{d as K,k as _,e as R,w as W,s as $,U as Y,V as w,X as d,_ as T,f as v,E as h,u as r,G as N,Z as z,Y as F}from"./vue-1730252110824.js";const Q={key:0},ee={style:{width:"100%",height:"500px"}},ue=K({__name:"Charts",props:{data:{type:Object,default:()=>{}},time:{type:Array,default:()=>[]}},setup(k){const e=k,n=_(""),b=_("AVG"),g=_(!1),u=_([]),D=P(),M=_([]),E=_({}),V=["int","float","double","long"],m=R(()=>{var a,t;return V.includes(((t=(a=e.data)==null?void 0:a.valueType)==null?void 0:t.type)||"")}),j=async()=>{var a,t,o,i,p,c;g.value=!0;const s=await G(D.current.id,{columns:[{property:e.data.id,alias:e.data.id,agg:m.value?b.value:"COUNT"}],query:{interval:n.value,format:n.value==="1d"?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss",from:e.time[0],to:e.time[1]}}).finally(()=>{g.value=!1});if(s.status===200){let l,y;n.value==="1d"?(l=f(e.time[0]).format("YYYY-MM-DD"),y=f(e.time[1]).format("YYYY-MM-DD")):(l=f(e.time[0]).format("YYYY-MM-DD HH:mm:ss"),y=f(e.time[1]).format("YYYY-MM-DD HH:mm:ss"));const A=[];s.result.forEach(C=>{var L;A.push({...C,year:C.time,value:Number(C[e.data.id||""]),type:((L=e.data)==null?void 0:L.name)||""})}),u.value=(A||[]).reverse(),(!((t=(a=u.value)==null?void 0:a[0])!=null&&t.year)||u.value[0].year!==l)&&u.value.unshift({year:e.time[0],value:void 0,type:((o=e.data)==null?void 0:o.name)||""}),(!((p=(i=u.value)==null?void 0:i[u.value.length-1])!=null&&p.year)||u.value[u.value.length-1].year!==y)&&u.value.push({year:e.time[1],value:void 0,type:((c=e.data)==null?void 0:c.name)||""})}},H=async()=>{var a,t,o;g.value=!0;const s=await J(D.current.id,e.data.id,{paging:!1,terms:[{column:"timestamp$BTW",value:e.time[0]&&e.time[1]?[e.time[0],e.time[1]]:[],type:"and"}],sorts:[{name:"timestamp",order:"asc"}]}).finally(()=>{g.value=!1});if(s.status===200){const i=[];(a=s.result)==null||a.forEach(l=>{var y;i.push({...l,year:l.timestamp,value:l.value,type:((y=e.data)==null?void 0:y.name)||""})});const p=i.find(l=>l.year===e.time[0]),c=i.find(l=>l.year===e.time[1]);p||i.unshift({year:e.time[0],value:void 0,type:((t=e.data)==null?void 0:t.name)||""}),c||(i.push({year:e.time[1],value:void 0,type:((o=e.data)==null?void 0:o.name)||""}),u.value=i||[])}},O=s=>{var a;E.value={xAxis:{type:"category",data:s.map(t=>Z(n.value==="1d"?"yyyy-MM-dd":`yyyy-MM-dd
hh:mm:ss`,t.year,!1)),name:"时间"},yAxis:{type:"value",name:(a=s[0])==null?void 0:a.type},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],tooltip:{trigger:"axis",position:function(t){return[t[0]-80,"10%"]}},series:[{data:s.map(t=>t.value),type:"line",areaStyle:{}}]}},x=()=>{n.value==="*"&&m.value?H():j()};return W(()=>e.time,s=>{const a=f(s[1]).diff(f(s[0]),"minute");a<60?(M.value=m.value?[{label:"实际值",value:"*"},{label:"按分钟统计",value:"1m"}]:[{label:"按分钟统计",value:"1m"}],n.value=m.value?"*":"1m"):a<1440?(M.value=m.value?[{label:"实际值",value:"*"},{label:"按分钟统计",value:"1m"},{label:"按小时统计",value:"1h"}]:[{label:"按分钟统计",value:"1m"},{label:"按小时统计",value:"1h"}],n.value=m.value?"*":"1m"):a<43200?(M.value=[{label:"按小时统计",value:"1h"},{label:"按天统计",value:"1d"}],n.value="1h"):(M.value=[{label:"按天统计",value:"1d"},{label:"按周统计",value:"1w"}],n.value="1d"),x()},{deep:!0,immediate:!0}),$(()=>{u.value.length&&O(u.value)}),(s,a)=>{const t=S,o=B,i=U,p=q,c=I;return Y(),w(c,{spinning:r(g)},{default:d(()=>[T("div",null,[v(i,null,{default:d(()=>[T("div",null,[h(" 统计周期： "),v(t,{value:r(n),"onUpdate:value":a[0]||(a[0]=l=>N(n)?n.value=l:null),style:{width:"120px"},options:r(M),onChange:x},null,8,["value","options"])]),r(n)!=="*"&&r(m)?(Y(),z("div",Q,[h(" 统计规则： "),v(t,{value:r(b),"onUpdate:value":a[1]||(a[1]=l=>N(b)?b.value=l:null),style:{width:"120px"},onChange:x},{default:d(()=>[v(o,{value:"AVG"},{default:d(()=>[h("平均值")]),_:1}),v(o,{value:"MAX"},{default:d(()=>[h("最大值")]),_:1}),v(o,{value:"MIN"},{default:d(()=>[h("最小值")]),_:1}),v(o,{value:"COUNT"},{default:d(()=>[h("总数")]),_:1})]),_:1},8,["value"])])):F("",!0)]),_:1})]),T("div",ee,[r(u).length?(Y(),w(X,{key:0,options:r(E)},null,8,["options"])):(Y(),w(p,{key:1}))])]),_:1},8,["spinning"])}}});export{ue as _};
