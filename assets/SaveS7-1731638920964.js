import{d as K,k as p,e as Z,o as z,w as U,U as m,V as y,X as s,f as o,E as g,u as t,Z as B,F as M,a1 as T,$ as D,v as X,A as W,Y as N,af as ee,ag as ae,_ as h}from"./vue-1731638920964.js";import{aF as te,I as ne,v as oe,aD as le,a6 as se,a7 as re,a8 as ie,e as ue,C as de,aG as ce,a9 as fe,F as pe,d as me,Z as ge,aa as _e,g as ve}from"./index-1731638920964.js";import"./index-1731638920964280.js";import"./index-1731638920964290.js";import{d as ye,e as be,s as he,u as Se}from"./collector-1731638920964.js";import xe from"./DeathArea-1731638920964.js";import"./index-1731638920964279.js";import"./index-1731638920964291.js";const w=c=>(ee("data-v-5ea6349c"),c=c(),ae(),c),we=w(()=>h("span",null,"点位死区",-1)),Ae=w(()=>h("span",{class:"explain"},"点位死区范围内的异常数据将被过滤（请勿配置非数值类型）",-1)),Ce=w(()=>h("p",null,[g(" 采集频率"),h("span",{style:{"margin-left":"5px",color:"#9d9ea1","font-size":"12px"}},"采集频率为0时不执行轮询任务")],-1)),Ie=K({__name:"SaveS7",props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(c,{emit:A}){const u=c,j={S200:["RELAY","HIGH_SPEED","SYSTEM_FLAGS","ANALOG_INPUTS","ANALOG_OUTPUTS","I","Q","M","IEC_COUNTERS","IEC_TIMERS"],S1200:["I","Q","M","DB"],S1500:["I","Q","M","DB"],S300:["I","Q","M","DB","C","T"],S400:["I","Q","M","DB","C","T"]},S=p(!1),C=p(),x=p(u.data.deviceType),_=p([]),I=p([]),a=p({name:u.data.name||"",configuration:u.data.configuration||{type:void 0,interval:3e3,areaNumber:void 0,bytes:void 0,terms:[]},accessModes:[],features:[],description:u.data.description||""}),b=p(!0),L=l=>{const e=_.value.find(i=>i.id==l);a.value.configuration.bytes=e.length,b.value=e.length!=0},E=l=>{l==="DB"?a.value.configuration.areaNumber=1:a.value.configuration.areaNumber=0};(async()=>{const l=await ye();l.success&&(I.value=l.result)})(),(async()=>{const l=await be();_.value=l.result})();const F=Z(()=>{let l=I.value.filter(e=>{var i;return(i=j[x.value])==null?void 0:i.includes(e.id)});return x.value=="S200"&&l.push({id:"DB",name:"变量存储区（V）",address:""}),l}),P=async()=>{var r;const l=await((r=C.value)==null?void 0:r.validate()),e={...l,configuration:{...l.configuration,bytes:l.configuration.bytes||a.value.configuration.bytes},inheritBreaker:!0,pointKey:u.data.pointKey||te(9),provider:u.data.provider,collectorId:u.data.collectorId,accessModes:l==null?void 0:l.accessModes.filter(d=>d)};S.value=!0;const i=u.data.id?await Se(u.data.id,{...u.data,...e}).catch(()=>{}):await he(e).catch(()=>{});A("change",(i==null?void 0:i.status)===200),S.value=!1},k=()=>{A("change",!1)},V=(l,e)=>new Promise(async(i,r)=>{if(!e||(e==null?void 0:e.length)===0)return i("");if((e==null?void 0:e.length)===1)return e[0].value&&e[0].termType?i(""):r("请配置点位死区");if((e==null?void 0:e[0].column)==="currentValue")return e.every(v=>v.termType&&v.value)?i(""):r("请配置点位死区");e.forEach(d=>d.column==="this['currentValue'] - this['lastValue']*init/100"?r("请配置点位死区"):i(""))});return z(()=>{var l,e,i,r;a.value.features=(l=u.data.features)==null?void 0:l.map(d=>d.value),a.value.configuration.bytes=(e=u.data.configuration)==null?void 0:e.bytes,((i=u.data.accessModes)==null?void 0:i.length)!==0&&(a.value.accessModes=(r=u.data.accessModes)==null?void 0:r.map(d=>d.value)),console.log(u.data.configuration,123)}),U(()=>_.value,l=>{if(l){const e=_.value.find(i=>i.id==a.value.configuration.type);e&&(b.value=e&&e.length!==0)}}),U(()=>a.value.configuration.type,l=>{l!=="Bool"&&(a.value.configuration.bits=0)},{deep:!0}),(l,e)=>{const i=ne,r=oe,d=le,v=se,f=re,O=ie,q=ue,G=de,Q=ce,R=fe,J=pe,Y=me,$=ge,H=_e;return m(),y(H,{title:c.data.id?"编辑":"新增",visible:!0,width:"700px",onCancel:k},{footer:s(()=>[o(Y,{key:"back",onClick:k},{default:s(()=>[g("取消")]),_:1}),o($,{key:"submit",type:"primary",loading:t(S),onClick:P,style:{"margin-left":"8px"},hasPermission:`DataCollect/Collector:${c.data.id?"update":"add"}`},{default:s(()=>[g(" 确认 ")]),_:1},8,["loading","hasPermission"])]),default:s(()=>[o(J,{model:t(a),layout:"vertical",ref_key:"formRef",ref:C},{default:s(()=>[o(r,{label:"点位名称",name:"name"},{default:s(()=>[o(i,{placeholder:"请输入点位名称",value:t(a).name,"onUpdate:value":e[0]||(e[0]=n=>t(a).name=n)},null,8,["value"])]),_:1}),o(r,{label:"地址区域",name:["configuration","daveArea"],rules:{required:!0,message:"请选择地址区域",trigger:"change"}},{default:s(()=>[o(v,{value:t(a).configuration.daveArea,"onUpdate:value":e[1]||(e[1]=n=>t(a).configuration.daveArea=n),"show-search":"",placeholder:"请选择地址区域",onChange:E},{default:s(()=>[(m(!0),B(M,null,T(t(F),n=>(m(),y(d,{key:n.id,value:n.id},{default:s(()=>[g(D(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),X(o(r,{label:"地址编号",name:["configuration","areaNumber"],rules:{required:!0,message:"请输入地址编号",trigger:"blur"}},{default:s(()=>[o(f,{value:t(a).configuration.areaNumber,"onUpdate:value":e[2]||(e[2]=n=>t(a).configuration.areaNumber=n),maxlength:64,style:{width:"100%"},max:65535,autocomplete:"off",disabled:t(a).configuration.daveArea=="DB"&&t(x)=="S200",placeholder:"请输入地址编号"},null,8,["value","disabled"])]),_:1},512),[[W,t(a).configuration.daveArea=="DB"]]),o(r,{label:"数据类型",name:["configuration","type"],rules:{required:!0,message:"请选择数据类型",trigger:"change"}},{default:s(()=>[o(v,{value:t(a).configuration.type,"onUpdate:value":e[3]||(e[3]=n=>t(a).configuration.type=n),"show-search":"",placeholder:"请选择数据类型",onChange:L},{default:s(()=>[(m(!0),B(M,null,T(t(_),n=>(m(),y(d,{key:n.id,value:n.id},{default:s(()=>[g(D(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(b)?N("",!0):(m(),y(r,{key:0,label:"字符串长度（byte）",name:["configuration","bytes"],rules:{required:!0,message:"请输入0~65535之间的正整数",trigger:"blur"}},{default:s(()=>[o(f,{type:"number",style:{width:"100%"},"addon-after":"字节",value:t(a).configuration.bytes,"onUpdate:value":e[4]||(e[4]=n=>t(a).configuration.bytes=n),placeholder:"请输入字符串长度",precision:0,controls:!1,disabled:t(b),max:65535,min:0},null,8,["value","disabled"])]),_:1})),t(a).configuration.type=="Bool"?(m(),y(r,{key:1,label:"位偏移量（bit）",name:["configuration","bits"],rules:{required:!0,message:"请输入0~7之间的正整数",trigger:"blur"}},{default:s(()=>[o(f,{type:"number",style:{width:"100%"},"addon-after":"位",value:t(a).configuration.bits,"onUpdate:value":e[5]||(e[5]=n=>t(a).configuration.bits=n),placeholder:"请输入位偏移量",precision:0,min:0,max:7,controls:!1,maxlength:2},null,8,["value"])]),_:1})):N("",!0),o(r,{label:"偏移量",name:["configuration","offset"],rules:{required:!0,message:"请输入0~65535之间的正整数",trigger:"blur"}},{default:s(()=>[o(f,{type:"number",style:{width:"100%"},value:t(a).configuration.offset,"onUpdate:value":e[6]||(e[6]=n=>t(a).configuration.offset=n),placeholder:"请输入偏移量",precision:0,min:0,max:65535,controls:!1,maxlength:64},null,8,["value"])]),_:1}),o(r,{label:"缩放因子",name:["configuration","scaleFactor"]},{default:s(()=>[o(f,{type:"number",style:{width:"100%"},value:t(a).configuration.scaleFactor,"onUpdate:value":e[7]||(e[7]=n=>t(a).configuration.scaleFactor=n),placeholder:"缩放因子",min:0,max:65535,controls:!1,maxlength:64},null,8,["value"])]),_:1}),o(r,{label:"小数保留位数",name:["configuration","scale"]},{default:s(()=>[o(f,{type:"number",style:{width:"100%"},value:t(a).configuration.scale,"onUpdate:value":e[8]||(e[8]=n=>t(a).configuration.scale=n),placeholder:"缩放因子",precision:0,min:1,max:65535,controls:!1,maxlength:64},null,8,["value"])]),_:1}),o(r,{label:"访问类型",name:"accessModes",rules:{required:!0,message:"请选择访问类型"}},{default:s(()=>[o(O,{multiple:"",showImage:!1,value:t(a).accessModes,"onUpdate:value":e[9]||(e[9]=n=>t(a).accessModes=n),options:[{label:"读",value:"read"},{label:"写",value:"write"}],column:2},null,8,["value"])]),_:1}),o(r,{name:["configuration","terms"],rules:[{validator:V,trigger:"change"}]},{label:s(()=>[o(q,null,{default:s(()=>[we,Ae]),_:1})]),default:s(()=>[o(xe,{value:t(a).configuration.terms,"onUpdate:value":e[10]||(e[10]=n=>t(a).configuration.terms=n)},null,8,["value"])]),_:1},8,["rules"]),o(r,{label:"轮询任务",name:["configuration","interval"]},{default:s(()=>[Ce,o(f,{style:{width:"100%"},placeholder:"请输入采集频率",value:t(a).configuration.interval,"onUpdate:value":e[11]||(e[11]=n=>t(a).configuration.interval=n),"addon-after":"ms",max:2147483648,min:0},null,8,["value"])]),_:1}),o(r,{name:"features"},{default:s(()=>[o(Q,{value:t(a).features,"onUpdate:value":e[12]||(e[12]=n=>t(a).features=n)},{default:s(()=>[o(G,{value:"changedOnly"},{default:s(()=>[g("只推送变化的数据")]),_:1})]),_:1},8,["value"])]),_:1}),o(r,{label:"说明",name:"description"},{default:s(()=>[o(R,{placeholder:"请输入说明",value:t(a).description,"onUpdate:value":e[13]||(e[13]=n=>t(a).description=n),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])}}});const Fe=ve(Ie,[["__scopeId","data-v-5ea6349c"]]);export{Fe as default};
