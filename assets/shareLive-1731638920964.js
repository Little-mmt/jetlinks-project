import{d as ne,ac as le,e as C,k as u,w as de,ab as V,U as d,Z as r,_ as s,f as t,X as o,E as v,u as l,G as ie,Y as h,a4 as ce,V as $,B as z,F as ue,a1 as re,$ as D,af as _e,ag as pe}from"./vue-1731638920964.js";import{o as ve,aJ as me,aK as fe,d as he,$ as ye,aL as ke,aM as ge,aN as Ce,aO as Ie,g as be}from"./index-1731638920964.js";import"./index-1731638920964279.js";import{L as we}from"./index-1731638920964289.js";import{M as Se}from"./mediaTool-1731638920964.js";import{c as _}from"./channel-17316389209642.js";import{_ as Me}from"./Preset.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./index-1731638920964282.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./unionBy-1731638920964.js";const y=i=>(_e("data-v-709d7d2c"),i=i(),pe(),i),Le={style:{width:"95%",margin:"0 auto"}},xe={class:"media-live-tool"},Oe={key:0,class:"media-live-share"},Te={class:"media-live"},je={class:"media-live-video"},Be={key:0,class:"tool-item"},Re=y(()=>s("div",null,"开始录像",-1)),Ve=y(()=>s("span",{style:{"padding-right":"12px"}},"本地存储",-1)),$e=y(()=>s("span",{style:{"padding-right":"12px"}},"云端存储",-1)),ze={key:1},De=["onClick"],Ne=["onClick"],Ae=y(()=>s("div",{class:"tool-item"},"重置",-1)),Ue={key:0,class:"media-live-actions"},Fe={class:"actions-tool"},Je={class:"center"},Ee=y(()=>s("div",null,"转速控制",-1)),Pe={class:"media-preset"},Qe=ne({__name:"shareLive",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>({})},type:{type:String,default:"normal"},readOnly:{type:Boolean,default:!1}},emits:["update:visible","refresh"],setup(i,{emit:M}){const a=i,N=le(),A=C({get:()=>a.visible,set:e=>M("update:visible",e)}),U=u(),k=u(""),m=u("mp4"),f=u(!1),I=u(!1),F=u(!1),L=C(()=>N.query.type!=="fixed-media"),x=[{label:"高",value:180},{label:"中",value:90},{label:"低",value:45}],b=u(90),J=C(()=>{var e;return(e=x.find(n=>n.value===b.value))==null?void 0:e.label}),E=e=>{b.value=e.key},P=()=>{I.value||(f.value=!1)},Q=e=>{f.value=e},q=C(()=>({"media-tool":!0,"media-tool-show":f.value})),w=()=>{k.value=_.ptzStart(a.data.deviceId,a.data.channelId,m.value)},c=u(0),G=async()=>{const{result:e}=await _.ptzIsRecord(a.data.deviceId,a.data.channelId);c.value=e?2:0},H=async({key:e})=>{I.value=!1,f.value=!1,c.value=1;const n=e==="true";(await _.recordStart(a.data.deviceId,a.data.channelId,{local:n}).catch(()=>({success:!1}))).success?c.value=2:c.value=0},K=async()=>{(await _.recordStop(a.data.deviceId,a.data.channelId)).success&&(c.value=0)},X=()=>{k.value="",setTimeout(()=>{w()},500)},Y=()=>{const e=_.mediaStop(a.data.deviceId,a.data.channelId);return e.then(n=>{ve("操作成功!")}),e},Z=e=>{_.ptzTool(a.data.deviceId,a.data.channelId,e,b.value)},W=()=>{_.ptzStop(a.data.deviceId,a.data.channelId)},ee=()=>{F.value=!0},te=()=>{M("refresh")};return de(()=>A.value,e=>{e?(w(),G()):k.value=""},{immediate:!0}),(e,n)=>{const g=me,oe=fe,O=V("AIcon"),ae=he,T=V("a-icon"),j=ye,S=ke,B=ge,R=Ce,se=Ie;return d(),r("div",Le,[s("div",xe,[t(oe,{value:l(m),"onUpdate:value":n[0]||(n[0]=p=>ie(m)?m.value=p:null),"button-style":"solid",onChange:w},{default:o(()=>[t(g,{value:"mp4"},{default:o(()=>[v("MP4")]),_:1}),t(g,{value:"flv"},{default:o(()=>[v("FLV")]),_:1}),t(g,{value:"m3u8"},{default:o(()=>[v("HLS")]),_:1})]),_:1},8,["value"]),i.type!=="share"?(d(),r("div",Oe,[t(ae,{type:"link",onClick:ee},{default:o(()=>[t(O,{type:"ShareAltOutlined"}),v(" 分享视频 ")]),_:1})])):h("",!0)]),s("div",Te,[s("div",je,[s("div",{class:ce(l(q)),onMouseleave:P,onMouseenter:n[2]||(n[2]=p=>f.value=!0)},[i.type!=="share"?(d(),r("div",Be,[l(c)===0?(d(),$(R,{key:0,trigger:"click",onVisibleChange:Q,onClick:n[1]||(n[1]=p=>I.value=!0)},{overlay:o(()=>[t(B,{onClick:H},{default:o(()=>[l(L)?(d(),$(S,{key:"true"},{default:o(()=>[Ve,t(j,{title:"存储在设备本地"},{default:o(()=>[t(T,{type:"QuestionCircleOutlined"})]),_:1})]),_:1})):h("",!0),t(S,{key:"false"},{default:o(()=>[$e,t(j,{title:"存储在服务器中"},{default:o(()=>[t(T,{type:"QuestionCircleOutlined"})]),_:1})]),_:1})]),_:1})]),default:o(()=>[Re]),_:1})):l(c)===1?(d(),r("div",ze,"请求录像中")):l(c)===2?(d(),r("div",{key:2,onClick:z(K,["stop"])}," 停止录像 ",8,De)):h("",!0)])):h("",!0),s("div",{class:"tool-item",onClick:z(X,["stop"])}," 刷新 ",8,Ne),t(se,{title:"重置将断开直播, 可能会影响其他播放者",onConfirm:Y},{default:o(()=>[Ae]),_:1})],34),t(we,{ref_key:"player",ref:U,live:!0,url:l(k),protocol:l(m),autoplay:""},null,8,["url","protocol"])]),l(L)?(d(),r("div",Ue,[s("div",Fe,[t(Se,{onOnMouseDown:Z,onOnMouseUp:W},{center:o(()=>[s("div",Je,[Ee,t(R,null,{overlay:o(()=>[t(B,{onClick:E},{default:o(()=>[(d(),r(ue,null,re(x,p=>t(S,{key:p.value},{default:o(()=>[v(D(p.label),1)]),_:2},1024)),64))]),_:1})]),default:o(()=>[s("span",null,[v(D(l(J)),1),t(O,{type:"DownOutlined"})])]),_:1})])]),_:1})]),s("div",Pe,[t(Me,{data:i.data,onRefresh:te,share:!0},null,8,["data"])])])):h("",!0)])])}}});const at=be(Qe,[["__scopeId","data-v-709d7d2c"]]);export{at as default};
