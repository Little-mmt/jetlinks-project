import{u as M,aF as Z,o as h,I as $,d as O,Z as X,dg as Y,af as z,g as H}from"./index-1731638920964.js";import"./index-1731638920964281.js";import{q as Q,s as W,e as ee}from"./role-1731638920964.js";import{d as se,ai as te,e as oe,k as i,o as ae,ab as G,U as a,Z as u,f as r,X as c,u as n,G as R,E as m,Y as T,_ as D,V as x,F as ne,$ as E,q as L}from"./vue-1731638920964.js";const le={class:"left-contain"},re={key:0,class:"controls"},ce={class:"listBox"},de={key:0},ie=["onClick"],ue={class:"itemText"},pe=se({__name:"index",emits:["selectData"],setup(_e,{emit:C}){const N=M(),{userInfos:P}=te(N),I=oe(()=>{var e;return((e=P.value)==null?void 0:e.username)==="admin"}),d=i([{name:"全局角色",id:"global_role",children:[]}]),g=i(["global_role"]),p=i(),k=i(),l=i(),_=i(),f=async(e,s)=>{const v=s?{sorts:[{name:"createTime",order:"desc"}],terms:[{terms:[{value:"%"+s+"%",termType:"like",column:"name"}]}]}:{sorts:[{name:"createTime",order:"desc"}]},o=await Q(v);o.status===200&&(d.value[0].children=o.result,o.result[o.result.length-1].id==="default_group"&&(o.result.unshift(o.result[o.result.length-1]),o.result.pop()))},V=()=>{l.value="";const e=Z();d.value[0].children.splice(1,0,{name:"",id:e}),_.value=e,L(()=>{k.value.focus()})},q=async e=>{if(l.value==="")e.name===""&&d.value[0].children.splice(1,1);else{const s={name:l.value,id:e.id};(await W(s)).status===200?(h("操作成功!"),f()):h("操作失败!")}setTimeout(()=>{_.value=""},300)},b=()=>{f(!0,p.value)},U=()=>{p.value===""&&f()},j=e=>{g.value=[e],e==="global_role"?C("selectData",""):C("selectData",g.value)},S=async e=>{(await ee(e)).status===200?(h("操作成功!"),f()):h("操作失败!")},F=e=>{_.value||(_.value=e.id,l.value=e.name,d.value[0].children.forEach(s=>{s.id===e.id&&(s.edit=!0)}),L(()=>{k.value.focus()}))};return ae(()=>{f()}),(e,s)=>{const v=G("AIcon"),o=$,J=O,w=G("Ellipsis"),B=X,K=Y,A=z;return a(),u("div",le,[r(o,{placeholder:"分组名称",value:n(p),"onUpdate:value":s[0]||(s[0]=t=>R(p)?p.value=t:null),onPressEnter:b,onChange:U},{suffix:c(()=>[r(v,{type:"SearchOutlined",onClick:b})]),_:1},8,["value"]),n(I)?(a(),u("div",re,[r(J,{type:"primary",onClick:V,style:{width:"100%"}},{default:c(()=>[m(" 新增分组 ")]),_:1})])):T("",!0),D("div",ce,[n(d).length?(a(),x(K,{key:0,"tree-data":n(d),fieldNames:{title:"name",key:"id",children:"children"},blockNode:"",selectedKeys:n(g),"default-expanded-keys":["global_role"],showLine:{showLeafIcon:!1}},{title:c(t=>[n(_)===t.data.id?(a(),u("div",de,[r(o,{value:n(l),"onUpdate:value":s[1]||(s[1]=y=>R(l)?l.value=y:null),onBlur:()=>q(t.data),ref_key:"inputRef",ref:k,maxlength:64},null,8,["value","onBlur"])])):(a(),u("div",{key:1,class:"treeItem",onClick:()=>j(t.data.id)},[t!=null&&t.children?(a(),x(w,{key:1,style:{width:"calc(100%-100px)"}},{default:c(()=>[m(E(t.name),1)]),_:2},1024)):(a(),u(ne,{key:0},[D("div",ue,[r(w,{style:{width:"calc(100%-100px)"}},{default:c(()=>[m(E(t.name),1)]),_:2},1024)]),t.id!=="default_group"&&n(I)?(a(),u("div",{key:0,onClick:s[2]||(s[2]=y=>y.stopPropagation())},[r(B,{type:"text",style:{padding:"0"},hasPermission:"system/Role:groupDelete",popConfirm:{title:"确认删除？",onConfirm:()=>S(t.id)},disabled:t.id==="default_group"},{default:c(()=>[m(" 删除 ")]),_:2},1032,["popConfirm","disabled"]),r(B,{type:"text",hasPermission:"system/Role:groupUpdate",onClick:y=>F(t.data),disabled:t.id==="default_group"},{default:c(()=>[m(" 编辑 ")]),_:2},1032,["onClick","disabled"])])):T("",!0)],64))],8,ie))]),_:1},8,["tree-data","selectedKeys"])):(a(),x(A,{key:1,style:{"margin-top":"100px"}}))])])}}});const he=H(pe,[["__scopeId","data-v-cdcce81a"]]);export{he as default};
