import{d as x,ad as R,k as f,r as T,ab as u,U as b,V as v,X as l,_ as q,f as s,u as d,E as k,$ as B,Y as N}from"./vue-1730252110824.js";import{o as C,Z as p,ax as V,e as L,a3 as A,g as E}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{_ as j}from"./EditDialog.vue_vue_type_script_setup_true_lang-1730252110824.js";import{b as S,e as z,f as F,h as J}from"./dataSource-1730252110824.js";const M={class:"data-source-container"},U=x({name:"DataSource"}),X=x({...U,setup(Y){const c="system/DataSource",I=R(),y=[{title:"名称",dataIndex:"name",key:"name",search:{type:"string"},width:"250px"},{title:"类型",dataIndex:"typeId",key:"typeId",search:{type:"select",options:()=>new Promise(n=>{if(t.typeOptions.value.length>0)return n(t.typeOptions.value);S().then(a=>{const i=a.result;n(i.map(o=>({label:o.name,value:o.id})))})})},scopedSlots:!0},{title:"说明",dataIndex:"description",key:"description",search:{type:"string"},ellipsis:!0},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",options:[{label:"正常",value:"enabled"},{label:"禁用",value:"disabled"}]},scopedSlots:!0,width:"120px"},{title:"操作",dataIndex:"action",key:"action",scopedSlots:!0,width:"160px",fixed:"right"}],g=f({}),m=f({}),t={typeOptions:f([]),getTypeOption:()=>{S().then(n=>{const a=n.result;t.typeOptions.value=a.map(i=>({label:i.name,value:i.id}))})},getTypeLabel:n=>{var i;const a=t.typeOptions.value;return a.length<1||n===""?"":((i=a.find(o=>o.value===n))==null?void 0:i.label)||""},getRowStatus:n=>{var a;return((a=n.state)==null?void 0:a.value)==="enabled"},openDialog:n=>{r.selectItem={shareConfig:{},...n},r.visible=!0},clickDel:n=>{const a=z(n.id);return a.then(i=>{var o;i.status===200&&((o=m.value)==null||o.reload(),C("操作成功!"))}),a},clickChangeStatus:n=>{const a=n.state.value==="enabled"?"_disable":"_enable",i=F(n.id,a);return i.then(()=>{C("操作成功"),t.refresh()}),i},refresh:()=>{m.value.reload(),r.visible=!1,r.selectItem={}},cancel:()=>{r.visible=!1,r.selectItem={}}};t.getTypeOption();const r=T({visible:!1,selectItem:{}});return(n,a)=>{const i=u("pro-search"),o=u("AIcon"),D=L,O=A,w=u("FullPage"),$=u("page-container");return b(),v($,null,{default:l(()=>[q("div",M,[s(i,{columns:y,target:"system-data-source",onSearch:a[0]||(a[0]=e=>g.value={...e})}),s(w,null,{default:l(()=>[s(O,{ref_key:"tableRef",ref:m,columns:y,request:d(J),model:"TABLE",params:d(g),defaultParams:{sorts:[{name:"createTime",order:"desc"}]}},{headerTitle:l(()=>[s(p,{type:"primary",hasPermission:`${c}:add`,onClick:a[1]||(a[1]=e=>t.openDialog({}))},{default:l(()=>[s(o,{type:"PlusOutlined"}),k("新增 ")]),_:1},8,["hasPermission"])]),state:l(e=>{var _,h;return[s(V,{status:(_=e.state)==null?void 0:_.value,text:(h=e.state)==null?void 0:h.text,statusNames:{enabled:"processing",disabled:"error"}},null,8,["status","text"])]}),typeId:l(e=>[k(B(t.typeOptions.value.length&&t.getTypeLabel(e.typeId)||""),1)]),action:l(e=>[s(D,{size:16},{default:l(()=>[s(p,{hasPermission:`${c}:update`,type:"link",tooltip:{title:"编辑"},onClick:_=>t.openDialog(e)},{default:l(()=>[s(o,{type:"EditOutlined"})]),_:2},1032,["hasPermission","onClick"]),s(p,{hasPermission:`${c}:manage`,type:"link",tooltip:{title:(e==null?void 0:e.typeId)==="rabbitmq"?"暂不支持管理功能":t.getRowStatus(e)?"管理":"请先启用数据源"},onClick:()=>d(I).push(`/system/DataSource/Management?id=${e.id}`),disabled:(e==null?void 0:e.typeId)==="rabbitmq"||!t.getRowStatus(e)},{default:l(()=>[s(o,{type:"icon-ziyuankuguanli"})]),_:2},1032,["hasPermission","tooltip","onClick","disabled"]),s(p,{hasPermission:`${c}:action`,type:"link",popConfirm:{title:`确认${t.getRowStatus(e)?"禁用":"启用"}？`,onConfirm:()=>t.clickChangeStatus(e)},tooltip:{title:t.getRowStatus(e)?"禁用":"启用"}},{default:l(()=>[s(o,{type:t.getRowStatus(e)?"StopOutlined":"PlayCircleOutlined"},null,8,["type"])]),_:2},1032,["hasPermission","popConfirm","tooltip"]),s(p,{hasPermission:`${c}:delete`,type:"link",tooltip:{title:t.getRowStatus(e)?"请先禁用，再删除":"删除"},danger:!0,popConfirm:{title:"确认删除",onConfirm:()=>t.clickDel(e)},disabled:t.getRowStatus(e)},{default:l(()=>[s(o,{type:"DeleteOutlined"})]),_:2},1032,["hasPermission","tooltip","popConfirm","disabled"])]),_:2},1024)]),_:1},8,["request","params"])]),_:1}),d(r).visible?(b(),v(j,{key:0,onCancel:t.cancel,data:d(r).selectItem,onConfirm:t.refresh},null,8,["onCancel","data","onConfirm"])):N("",!0)])]),_:1})}}});const ne=E(X,[["__scopeId","data-v-c499eadf"]]);export{ne as default};
