import{d as P,k as m,w,e as F,U as c,Z as T,_ as u,F as C,a1 as x,$ as Y,a0 as h,u as y,v as D,A as k}from"./vue-1730252110824.js";import{au as l,fL as O,o as L,g as $}from"./index-1730252110824.js";const b={class:"time-line-warp"},z={class:"time-line-clock"},N={class:"time-line-progress"},j=["onClick"],R=P({__name:"timeLine",props:{onChange:{type:Function},data:{},dateTime:{},type:{},playStatus:{},playTime:{},server:{},localToServer:{},getPlayList:{type:Function}},setup(E,{expose:H}){const i=E,d=m(new Date(l(i.dateTime).startOf("day").format("YYYY-MM-DD HH:mm:ss")).getTime());m(new Date(l(i.dateTime).endOf("day").format("YYYY-MM-DD HH:mm:ss")).getTime());const v=m([]),p=m(0),f=m(),_=O(f);w(()=>i.dateTime,a=>{d.value=new Date(l(a).startOf("day").format("YYYY-MM-DD HH:mm:ss")).getTime()});const o=(a,e,t,n)=>{p.value=a,i.onChange({startTime:l(a),endTime:l(e),deviceId:t,channelId:n})},g=a=>{const e=i.data.find(t=>(t.startTime||t.mediaStartTime)===a);if(e){const t=e.startTime||e.mediaStartTime,n=e.endTime||e.mediaEndTime,s=i.type==="local"?e.deviceId:e.id;o(t,n,s,e.channelId)}};g(0);const S=()=>{if(p.value){const a=i.data.findIndex(e=>(e.startTime||e.mediaStartTime)===p.value);if(a!==i.data.length-1){const e=i.data[a+1],t=e.startTime||e.mediaStartTime,n=e.endTime||e.mediaEndTime,s=i.type==="local"?e.deviceId:e.id;o(t,n,s,e.channelId)}}};S(),w(()=>i.data,a=>{const{data:e,localToServer:t,type:n}=i;if(e&&Array.isArray(e)&&e.length>0){if(v.value=[...e],n==="local")o(e[0].startTime,e[0].endTime,e[0].deviceId,e[0].channelId);else if(n==="cloud")if(t&&Object.keys(t).length>0){const s=e.find(r=>r.mediaEndTime<=t.endTime&&r.mediaStartTime>=t.startTime);s?o(s.mediaStartTime,s.mediaEndTime,s.id,s.channelId):(i.onChange(void 0),L("没有可播放的视频资源","error"))}else o(e[0].mediaStartTime,e[0].mediaEndTime,e[0].id,e[0].channelId)}else t&&t.startTime?(i.onChange(void 0),L("没有可播放的视频资源","error"),v.value=[]):(v.value=[],i.onChange(void 0))});const M=(a,e)=>{const t=a-d.value>0?a-d.value:0,n=_.width.value,s=(e-a)/(24*36e5)*n;return{left:`${t/(24*36e5)*n}px`,width:`${s<1?1:s}px`}},I=F(()=>{const a=(i.playTime-d.value)/36e5/24*_.width.value;return i.playTime>d.value?a:0}),A=(a,e)=>{var n;const t=(n=f.value)==null?void 0:n.getBoundingClientRect();if(t&&e.endTime){const r=(a.clientX-t.x)/t.width*24*36e5+d.value,B=r<e.startTime?e.startTime:r;o(B,e.endTime,e.deviceId,e.channelId)}};return H({playByStartTime:g,onNextPlay:S}),(a,e)=>(c(),T("div",b,[u("div",z,[(c(!0),T(C,null,x(Array.from(Array(25),(t,n)=>n),t=>(c(),T("div",{key:t,style:{width:"12px"}},Y(t),1))),128))]),u("div",{class:"time-line-content",ref_key:"LineContent",ref:f},[u("div",N,[(c(!0),T(C,null,x(y(v),(t,n)=>(c(),T("div",{key:`time_${n}`,onClick:s=>A(s,t),style:h(M(t.startTime||t.mediaStartTime,t.endTime||t.mediaEndTime))},null,12,j))),128))]),D(u("div",{id:"btn",class:"time-line-btn",style:h({left:y(I)+"px"})},null,4),[[k,a.playTime]]),D(u("div",{id:"time",class:"time-line",style:h({left:y(I)-15+"px"})},Y(y(l)(a.playTime||0).format("HH:mm:ss")),5),[[k,a.playTime]])],512)]))}});const W=$(R,[["__scopeId","data-v-e5052899"]]);export{W as default};
