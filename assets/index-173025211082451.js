import{g as P,X,au as b,Z,e as U,a3 as z}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{c as q,d as G}from"./log-17302521108243.js";import{u as K}from"./instance-1730252110824.js";import{u as O}from"./product-17302521108245.js";import Q from"./Duration-1730252110824.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-17302521108247.js";import ee from"./AlarmLog-1730252110824.js";import{k as i,ab as w,U as m,Z as A,f as p,u as a,X as s,E as c,$ as d,_ as te,F as Y,a1 as ae,V as _,Y as B}from"./vue-1730252110824.js";import"./product-17302521108244.js";import"./encodeQuery-1730252110824.js";import"./index-1730252110824299.js";import"./Log-1730252110824.js";import"./LogDetail-1730252110824.js";import"./index-1730252110824284.js";import"./vue-json-viewer-1730252110824.js";import"./useAlarmLevel-1730252110824.js";import"./useRequest-1730252110824.js";import"./config-1730252110824.js";const oe=["onClick"],le={__name:"index",props:{goal:{type:String,default:"device"}},setup(g){const h=g,N=X(),{current:T}=h.goal==="device"?K():O(),x=h.goal==="device"?[{title:"告警时间",dataIndex:"alarmTime",key:"alarmTime",search:{type:"date"},scopedSlots:!0},{title:"告警持续时长",dataIndex:"duration",key:"duration",scopedSlots:!0},{title:"触发条件",dataIndex:"triggerDesc",key:"triggerDesc"},{title:"告警原因",dataIndex:"actualDesc",key:"actualDesc"},{title:"处理时间",dataIndex:"handleTime",key:"handleTime",search:{type:"date"},scopedSlots:!0},{title:"处理类型",dataIndex:"handleType",key:"handleType",search:{type:"select",options:[{label:"人工",value:"user"},{label:"系统",value:"system"}]},scopedSlots:!0},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",options:[{label:"已处理",value:"normal"},{label:"告警中",value:"warning"}]},scopedSlots:!0},{title:"操作",dataIndex:"actions",key:"actions",scopedSlots:!0}]:[{title:"告警时间",dataIndex:"alarmTime",key:"alarmTime",search:{type:"date"},scopedSlots:!0},{title:"告警持续时长",dataIndex:"duration",key:"duration",scopedSlots:!0},{title:"触发条件",dataIndex:"triggerDesc",key:"triggerDesc"},{title:"告警源",dataIndex:"sourceName",key:"sourceName",scopedSlots:!0,search:{type:"string"}},{title:"告警原因",dataIndex:"actualDesc",key:"actualDesc"},{title:"处理时间",dataIndex:"handleTime",key:"handleTime",search:{type:"date"},scopedSlots:!0},{title:"处理类型",dataIndex:"handleType",key:"handleType",search:{type:"select",options:[{label:"人工",value:"user"},{label:"系统",value:"system"}]},scopedSlots:!0},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",options:[{label:"已处理",value:"normal"},{label:"告警中",value:"warning"}]},scopedSlots:!0},{title:"操作",dataIndex:"actions",key:"actions",scopedSlots:!0}],S=i(),I=i(),D=i(),u=i(!1),k=i("handle"),r=i(),y=i(!1),H=h.goal==="device"?{sorts:[{name:"alarmTime",order:"desc"}],terms:[{terms:[{column:"targetId",value:T.id,termType:"eq"},{column:"alarmConfigSource",value:"device-property-preprocessor",termType:"eq"}],type:"and"}]}:{sorts:[{name:"alarmTime",order:"desc"}],terms:[{terms:[{column:"targetId$dev-instance",value:[{column:"product_id",value:T.id,termType:"eq"}]},{column:"alarmConfigSource",value:"device-property-preprocessor",termType:"eq"}],type:"and"}]},V=e=>{S.value=e},E=async e=>{var n,v,f;const l=await G(e,{sorts:[{name:"handleTime",order:"desc"}]});l.status===200&&((n=l.result)!=null&&n.data.length)&&(I.value=(f=(v=l.result.data)==null?void 0:v[0])==null?void 0:f.description)},L=e=>e?e.state.value==="normal"?[{key:"view",text:"查看详情",tooltip:{title:"查看详情"},onClick:async()=>{k.value="view",await E(e.id),u.value=!0}},{key:"log",text:"查看日志",tooltip:{title:"查看日志"},onClick:()=>{y.value=!0,r.value=e}}]:[{key:"solve",text:"处理",tooltip:{title:"处理"},onClick:()=>{u.value=!0,k.value="handle",r.value=e}},{key:"log",text:"查看日志",tooltip:{title:"查看日志"},onClick:()=>{y.value=!0,r.value=e}}]:[],M=()=>{u.value=!1},R=async()=>{var l,n;const e=await q({terms:[{column:"id",termType:"eq",value:r.value.id},{column:"alarmConfigSource",value:"device-property-preprocessor",termType:"eq"}]});e.success&&((n=(l=e.result)==null?void 0:l.data)!=null&&n.length)&&(r.value=e.result.data[0])},$=e=>{N.jumpPage("device/Instance/Detail",{id:e,tab:"Running"})},C=()=>{var e;(e=D.value)==null||e.reload(),R()},j=()=>{u.value=!1,C()};return(e,l)=>{const n=w("pro-search"),v=w("Ellipsis"),f=Z,J=U,F=z;return m(),A(Y,null,[p(n,{columns:a(x),target:"device-instance",type:"simple",onSearch:V},null,8,["columns"]),p(F,{ref_key:"deviceAlarm",ref:D,columns:a(x),model:"TABLE",request:a(q),defaultParams:a(H),params:a(S)},{alarmTime:s(t=>[c(d(a(b)(t.alarmTime).format("YYYY-MM-DD HH:mm:ss")),1)]),duration:s(t=>[p(Q,{data:t},null,8,["data"])]),handleTime:s(t=>[c(d(t.handleTime?a(b)(t.handleTime).format("YYYY-MM-DD HH:mm:ss"):"--"),1)]),sourceName:s(t=>[p(v,null,{default:s(()=>[c(" 设备名称： "),te("span",{class:"deviceId",onClick:()=>$(t.sourceId)},d(t.sourceName),9,oe)]),_:2},1024)]),handleType:s(t=>{var o;return[c(d(((o=t==null?void 0:t.handleType)==null?void 0:o.text)||"--"),1)]}),state:s(t=>{var o;return[c(d(((o=t==null?void 0:t.state)==null?void 0:o.value)==="normal"?"已处理":"告警中"),1)]}),actions:s(t=>[p(J,null,{default:s(()=>[(m(!0),A(Y,null,ae(L(t),o=>(m(),_(f,{key:o.key,popConfirm:o.popConfirm,tooltip:{...o.tooltip},onClick:o.onClick,type:"link",style:{padding:"0 5px"},hasPermission:o.key=="solve"?"rule-engine/Alarm/Log:action":"rule-engine/Alarm/Log:view"},{default:s(()=>[c(d(o.text),1)]),_:2},1032,["popConfirm","tooltip","onClick","hasPermission"]))),128))]),_:2},1024)]),_:1},8,["columns","request","defaultParams","params"]),a(u)?(m(),_(W,{key:0,data:a(r),solveType:a(k),goal:g.goal,handleDes:a(I),onCloseSolve:M,onRefresh:j},null,8,["data","solveType","goal","handleDes"])):B("",!0),a(y)?(m(),_(ee,{key:1,data:a(r),goal:g.goal,onCloseDrawer:l[0]||(l[0]=t=>y.value=!1),onRefreshTable:C},null,8,["data","goal"])):B("",!0)],64)}}},we=P(le,[["__scopeId","data-v-105a4f55"]]);export{we as default};
