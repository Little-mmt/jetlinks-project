import{E as se,G as te,F as T,k as oe,h as u,l as ae,o as D,q as ne,H as ie,J as le,d as ce,L as J,T as O,t as re,n as de,I as pe,v as ue,w as _e,g as me}from"./index-1730252110824.js";import{e as fe}from"./encrypt-1730252110824.js";import{d as $,e as ve,k as C,r as ge,o as ye,U as L,Z as F,_ as t,u as s,F as be,f as i,X as l,$ as x,af as he,ag as we,E as w,W as P,V as ke,Y as Ce}from"./vue-1730252110824.js";const xe=_=>se(`/application/sso/bind-code/${_}`),Ie=_=>te(`/application/sso/me/bind/${_}`),I=_=>(he("data-v-34b7b9c4"),_=_(),we(),_),Ue={class:"page-container"},Ne={class:"content-bind"},Le=I(()=>t("div",{class:"title"},"第三方账户绑定",-1)),je={class:"info"},Ae={class:"info-body"},Be={class:"info-body-item"},Fe=I(()=>t("span",null,"账号：",-1)),Pe={class:"info-body-item"},Se=I(()=>t("span",null,"用户名：",-1)),Ve=["src"],Ke={class:"info-body"},qe={class:"info-body-item"},Ee=I(()=>t("span",null,"账号：",-1)),Me={class:"info-body-item"},Re=I(()=>t("span",null,"用户名：",-1)),Te={class:"btn"},De={key:1,class:"not-login"},Je={class:"logo"},Oe=["src"],$e=["src"],ze=["src"],Ye={class:"desc"},Ge={class:"login-form"},He=["src"],Qe=$({name:"AccountBind"}),We=$({...Qe,setup(_){const z=T.useForm,Y=oe(),g=new Map;g.set("dingtalk-ent-app",u("/notice/dingtalk.png")),g.set("wechat-webapp",u("/notice/wechat.png")),g.set("internal-standalone",u("/apply/internal-standalone.png")),g.set("third-party",u("/apply/third-party.png"));const S=ve(()=>J.get(O)),U=C(),G=()=>{S.value&&ae().then(o=>{U.value=o==null?void 0:o.result})},j=()=>new URLSearchParams(window.location.href).get("code"),c=C({appName:""}),H=async()=>{const o=j(),{result:e,success:a}=await xe(o);c.value=e||{},a&&((e==null?void 0:e.applicationProvider)==="dingtalk-ent-app"?c.value.appName="钉钉":(e==null?void 0:e.applicationProvider)==="wechat-webapp"?c.value.appName="微信":c.value.appName=e==null?void 0:e.applicationName)},Q=async()=>{const o=j(),e=await Ie(o);console.log("bindAccount: ",e),D("绑定成功"),V(),setTimeout(()=>window.close(),1e3)},m=C({username:"",password:"",verifyCode:""}),W=C({username:[{required:!0,message:"请输入账户"}],password:[{required:!0,message:"请输入密码"}]}),{resetFields:Xe,validate:X,validateInfos:A}=z(m.value,W.value),y=C({base64:"",key:""}),B=async()=>{var e,a;const o=await ne();y.value.base64=(e=o.result)==null?void 0:e.base64,y.value.key=(a=o.result)==null?void 0:a.key},v=ge({enabled:!1,publicKey:"",id:""}),Z=()=>{X().then(async()=>{var f,r,b,h;const o=j(),e={...m.value,bindCode:o,expires:36e5},a=await re();a.status===200&&(f=a.result)!=null&&f.encrypt&&(v.enabled=(r=a.result)==null?void 0:r.encrypt.enabled,v.publicKey=(b=a.result)==null?void 0:b.encrypt.publicKey,v.id=(h=a.result)==null?void 0:h.encrypt.id),y.value.base64?e.verifyKey=y.value.key:delete e.verifyCode;const d={...e,password:v.enabled?fe(e.password,v.publicKey):e.password,encryptId:v.enabled?v.id:void 0},p=await de(d);console.log("res: ",p),p.success&&(D("登录成功"),J.set(O,p.result.token),V())}).catch(o=>{console.log(o),B()})},ee=()=>{var f;const o=window.location.href.indexOf("?"),d=(((f=window.location.href.substr(o+1).split("#"))==null?void 0:f[0])||"").split("&"),p=new Map;for(let r=0;r<d.length;r++){const b=d[r].split("="),[h,N]=b;p.set(h,N)}return p},V=()=>{var a;const e=ee().get("redirect")||((a=window.location.href.split("redirect="))==null?void 0:a[1]);console.log("redirectUrl: ",e),e&&e.indexOf("account/center/bind")===-1?window.location.href=decodeURIComponent(e):(window.location.href="/",setTimeout(()=>window.close(),1e3))};return ye(()=>{H(),B(),G(),Y.getFront()}),(o,e)=>{var N,K,q,E,M,R;const a=ie,d=le,p=ce,f=pe,r=ue,b=_e,h=T;return L(),F("div",Ue,[t("div",Ne,[Le,s(S)?(L(),F(be,{key:0},[t("div",je,[t("div",Ae,[i(a,{size:86,style:{"margin-bottom":"16px"},src:((N=s(U))==null?void 0:N.avatar)||s(u)("/bind/jetlinksLogo.png")},null,8,["src"]),t("div",Be,[Fe,i(d,{lineClamp:2},{default:l(()=>{var n;return[w(x(((n=s(U))==null?void 0:n.username)||"-"),1)]}),_:1})]),t("div",Pe,[Se,i(d,{lineClamp:2},{default:l(()=>{var n;return[w(x(((n=s(U))==null?void 0:n.name)||"-"),1)]}),_:1})])]),t("img",{src:s(u)("/bind/Vector.png")},null,8,Ve),t("div",Ke,[i(a,{size:86,shape:"square",style:{"margin-bottom":"16px"},src:((K=s(c).result)==null?void 0:K.avatar)||s(g).get((q=s(c))==null?void 0:q.applicationProvider)||s(u)("/apply/internal-standalone.png")},null,8,["src"]),t("div",qe,[Ee,i(d,{lineClamp:2},{default:l(()=>{var n,k;return[w(x(((k=(n=s(c))==null?void 0:n.result)==null?void 0:k.userId)||""),1)]}),_:1})]),t("div",Me,[Re,i(d,{lineClamp:2},{default:l(()=>{var n,k;return[w(x(((k=(n=s(c))==null?void 0:n.result)==null?void 0:k.name)||""),1)]}),_:1})])])]),t("div",Te,[i(p,{type:"primary",onClick:Q},{default:l(()=>[w("立即绑定 ")]),_:1})])],64)):(L(),F("div",De,[t("div",Je,[t("img",{src:s(u)("/bind/jetlinksLogo.png")},null,8,Oe),t("img",{class:"arrow",src:s(u)("/bind/Vector.png")},null,8,$e),t("img",{src:((E=s(c))==null?void 0:E.avatar)||s(g).get((M=s(c))==null?void 0:M.applicationProvider)},null,8,ze)]),t("div",Ye," 你已通过 "+x((R=s(c))==null?void 0:R.appName)+" 授权,完善以下登录信息即可以完成绑定 ",1),t("div",Ge,[i(h,{layout:"vertical"},{default:l(()=>[i(r,P({label:"账户"},s(A).username),{default:l(()=>[i(f,{value:s(m).username,"onUpdate:value":e[0]||(e[0]=n=>s(m).username=n),placeholder:"请输入账户"},null,8,["value"])]),_:1},16),i(r,P({label:"密码"},s(A).password),{default:l(()=>[i(b,{value:s(m).password,"onUpdate:value":e[1]||(e[1]=n=>s(m).password=n),placeholder:"请输入密码"},null,8,["value"])]),_:1},16),s(y).base64?(L(),ke(r,P({key:0,label:"验证码"},s(A).verifyCode,{rules:[{required:!0,message:"请输入验证码"}]}),{default:l(()=>[i(f,{value:s(m).verifyCode,"onUpdate:value":e[2]||(e[2]=n=>s(m).verifyCode=n),placeholder:"请输入验证码"},{addonAfter:l(()=>[t("img",{src:s(y).base64,onClick:B,style:{cursor:"pointer"}},null,8,He)]),_:1},8,["value"])]),_:1},16)):Ce("",!0),i(r,null,{default:l(()=>[i(p,{type:"primary",onClick:Z,style:{width:"100%"}},{default:l(()=>[w(" 登录并绑定账户 ")]),_:1})]),_:1})]),_:1})])]))])])}}});const ts=me(We,[["__scopeId","data-v-34b7b9c4"]]);export{ts as default};
