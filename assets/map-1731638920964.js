import{gC as De,gD as Ae,gE as $e,dx as te,dy as oe,gF as L,gG as N,gH as W,gI as Fe,cK as we,g as Me,d2 as I,o as Be,$ as xe}from"./index-1731638920964.js";import{u as Se,c as je,M}from"./util-17316389209646.js";import{d as H,M as re,U as D,Z as G,c as Te,t as fe,w as ye,k as w,e as z,ab as pe,f as E,X as x,u as y,V as R,Y as S,_ as F,a4 as se}from"./vue-1731638920964.js";import{m as ce,d as de}from"./min-1731638920964.js";import"./useRequest-1731638920964.js";function me(i){return new AMap.LngLat(i[0],i[1])}function le(i,g){if(!i)return;const u=["addnode","adjust","removenode","end","move","add"],m={};Object.keys(g).forEach(p=>{if(De.test(p)){const e=Ae(p);u.indexOf(e)!==-1&&(m[e]=g[p])}}),Object.keys(m).forEach(p=>{$e(i,p,m[p])})}const Pe=te({center:{type:Array,required:!0},radius:{type:Number,required:!0},bubble:{type:Boolean,default:!1},cursor:{type:String},strokeColor:{type:String},strokeOpacity:{type:Number},strokeWeight:{type:Number},fillColor:{type:String},fillOpacity:{type:Number},draggable:{type:Boolean,default:!1},extData:{type:Object,default:()=>null},strokeStyle:{type:String,validator:i=>["solid","dashed"].indexOf(i)!==-1},strokeDasharray:{type:Array},editable:{type:Boolean,default:!1},editOptions:{type:Object}});var Z=H({name:"ElAmapCircle",inheritAttrs:!1,__name:"Circle",props:Pe,emits:["init","update:center","update:radius"],setup(i,{expose:g,emit:u}){const m=i,p=u;let e;const{$$getInstance:v,parentInstance:o}=oe((t,r)=>new Promise(h=>{e=new AMap.Circle(t),L(r)?r.add(e):N(r)?r.addOverlay(e):W(r)&&r.add(e),f(),h(e)}),{emits:p,watchRedirectFn:{__zIndex(t){e&&e.setOptions({zIndex:t})},__strokeColor(t){e&&e.setOptions({strokeColor:t})},__strokeOpacity(t){e&&e.setOptions({strokeOpacity:t})},__strokeWeight(t){e&&e.setOptions({strokeWeight:t})},__fillColor(t){e&&e.setOptions({fillColor:t})},__fillOpacity(t){e&&e.setOptions({fillOpacity:t})},__strokeStyle(t){e&&e.setOptions({strokeStyle:t})},__strokeDasharray(t){e&&e.setOptions({strokeDasharray:t})},__editable(t){c().then(()=>{t?n.open():n.close()})}},destroyComponent(){e&&(o!=null&&o.$amapComponent)&&(n&&(o.isDestroy||n.close(),n=null),o.isDestroy||(L(o.$amapComponent)?o.$amapComponent.remove(e):N(o.$amapComponent)?o.$amapComponent.removeOverlay(e):W(o.$amapComponent)&&o.$amapComponent.remove(e)),e.destroy&&e.destroy(),e=null)}}),f=()=>{e.on("dragend",()=>{a(e)}),e.on("touchend",()=>{a(e)})},a=t=>{p("update:center",t.getCenter().toArray()),p("update:radius",t.getRadius())};let n;const s=re(),c=()=>new Promise(t=>{n?t():AMap.plugin(["AMap.CircleEditor"],()=>{n=new AMap.CircleEditor(o==null?void 0:o.$amapComponent,e,m.editOptions),le(n,s),C(),t()})}),C=()=>{n.on("addnode",t=>{a(t.target)}),n.on("adjust",t=>{a(t.target)}),n.on("removenode",t=>{a(t.target)}),n.on("add",t=>{a(t.target)}),n.on("end",t=>{a(t.target)}),n.on("move",t=>{a(t.target)})};return g({$$getInstance:v}),(t,r)=>(D(),G("div"))}});Z.__file="src/vue-amap/packages/vector/Circle/Circle.vue";Z.install=i=>(i.component(Z.name,Z),i);const Ie=Z,Re=te({path:{type:Array,required:!0},bubble:{type:Boolean,default:!1},cursor:{type:String},strokeColor:{type:String},strokeOpacity:{type:Number},strokeWeight:{type:Number},fillColor:{type:String},fillOpacity:{type:Number},draggable:{type:Boolean,default:!1},extData:{type:Object,default:()=>null},strokeStyle:{type:String,validator:i=>["solid","dashed"].indexOf(i)!==-1},strokeDasharray:{type:Array},editable:{type:Boolean,default:!1},editOptions:{type:Object}});var q=H({name:"ElAmapPolygon",inheritAttrs:!1,__name:"Polygon",props:Re,emits:["init","update:path"],setup(i,{expose:g,emit:u}){const m=i,p=u;let e;const{$$getInstance:v,parentInstance:o}=oe((t,r)=>new Promise(h=>{e=new AMap.Polygon(t),L(r)?r.add(e):N(r)?r.addOverlay(e):W(r)&&r.add(e),f(),h(e)}),{emits:p,watchRedirectFn:{__zIndex(t){e&&e.setOptions({zIndex:t})},__strokeColor(t){e&&e.setOptions({strokeColor:t})},__strokeOpacity(t){e&&e.setOptions({strokeOpacity:t})},__strokeWeight(t){e&&e.setOptions({strokeWeight:t})},__fillColor(t){e&&e.setOptions({fillColor:t})},__fillOpacity(t){e&&e.setOptions({fillOpacity:t})},__strokeStyle(t){e&&e.setOptions({strokeStyle:t})},__strokeDasharray(t){e&&e.setOptions({strokeDasharray:t})},__editable(t){c().then(()=>{t?n.open():n.close()})}},destroyComponent(){e&&(o!=null&&o.$amapComponent)&&(n&&(o.isDestroy||n.close(),n=null),o.isDestroy||(L(o.$amapComponent)?o.$amapComponent.remove(e):N(o.$amapComponent)?o.$amapComponent.removeOverlay(e):W(o.$amapComponent)&&o.$amapComponent.remove(e)),e.destroy&&e.destroy(),e=null)}}),f=()=>{e.on("dragend",()=>{a(e)}),e.on("touchend",()=>{a(e)})},a=t=>{const r=t.getPath(),h=r==null?void 0:r.map(Fe);p("update:path",h)};let n;const s=re(),c=()=>new Promise(t=>{n?t():AMap.plugin(["AMap.PolygonEditor"],()=>{n=new AMap.PolygonEditor(o==null?void 0:o.$amapComponent,e,m.editOptions),le(n,s),C(),t()})}),C=()=>{n.on("addnode",t=>{a(t.target)}),n.on("adjust",t=>{a(t.target)}),n.on("removenode",t=>{a(t.target)}),n.on("add",t=>{a(t.target)}),n.on("end",t=>{a(t.target)})};return g({$$getInstance:v}),(t,r)=>(D(),G("div"))}});q.__file="src/vue-amap/packages/vector/Polygon/Polygon.vue";q.install=i=>(i.component(q.name,q),i);const Le=q,Ne=te({bounds:{type:Array,required:!0},bubble:{type:Boolean,default:!1},cursor:{type:String},strokeColor:{type:String},strokeOpacity:{type:Number},strokeWeight:{type:Number},fillColor:{type:String},fillOpacity:{type:Number},draggable:{type:Boolean,default:!1},extData:{type:Object,default:()=>null},strokeStyle:{type:String,validator:i=>["solid","dashed"].indexOf(i)!==-1},strokeDasharray:{type:Array},editable:{type:Boolean,default:!1},editOptions:{type:Object}});var V=H({name:"ElAmapRectangle",inheritAttrs:!1,__name:"Rectangle",props:Ne,emits:["init","update:bounds"],setup(i,{expose:g,emit:u}){const m=i,p=u;let e;const{$$getInstance:v,parentInstance:o}=oe((t,r)=>new Promise(h=>{e=new AMap.Rectangle(t),L(r)?r.add(e):N(r)?r.addOverlay(e):W(r)&&r.add(e),f(),h(e)}),{emits:p,converts:{bounds:t=>new AMap.Bounds(me(t[0]),me(t[1]))},watchRedirectFn:{__zIndex(t){e&&e.setOptions({zIndex:t})},__strokeColor(t){e&&e.setOptions({strokeColor:t})},__strokeOpacity(t){e&&e.setOptions({strokeOpacity:t})},__strokeWeight(t){e&&e.setOptions({strokeWeight:t})},__fillColor(t){e&&e.setOptions({fillColor:t})},__fillOpacity(t){e&&e.setOptions({fillOpacity:t})},__strokeStyle(t){e&&e.setOptions({strokeStyle:t})},__strokeDasharray(t){e&&e.setOptions({strokeDasharray:t})},__editable(t){c().then(()=>{t?n.open():n.close()})}},destroyComponent(){e&&(o!=null&&o.$amapComponent)&&(n&&(o.isDestroy||n.close(),n=null),o.isDestroy||(L(o.$amapComponent)?o.$amapComponent.remove(e):N(o.$amapComponent)?o.$amapComponent.removeOverlay(e):W(o.$amapComponent)&&o.$amapComponent.remove(e)),e.destroy&&e.destroy(),e=null)}}),f=()=>{e.on("dragend",()=>{a(e)}),e.on("touchend",()=>{a(e)})},a=t=>{const r=t.getBounds(),h=r.getSouthWest(),j=r.getNorthEast(),J=[h.toArray(),j.toArray()];p("update:bounds",J)};let n;const s=re(),c=()=>new Promise(t=>{n?t():AMap.plugin(["AMap.RectangleEditor"],()=>{n=new AMap.RectangleEditor(o==null?void 0:o.$amapComponent,e,m.editOptions),le(n,s),C(),t()})}),C=()=>{n.on("addnode",t=>{a(t.target)}),n.on("adjust",t=>{a(t.target)}),n.on("removenode",t=>{a(t.target)}),n.on("add",t=>{a(t.target)}),n.on("end",t=>{a(t.target)})};return g({$$getInstance:v}),(t,r)=>(D(),G("div"))}});V.__file="src/vue-amap/packages/vector/Rectangle/Rectangle.vue";V.install=i=>(i.component(V.name,V),i);const We=V;var U=H({name:"ElAmapMouseTool",inheritAttrs:!1,__name:"MouseTool",props:te({type:{type:String,required:!0,default:"marker",validator:i=>["marker","circle","rectangle","polyline","polygon","measureArea","rule","rectZoomIn","rectZoomOut"].includes(i)},drawOptions:{type:Object,default:()=>null},autoClear:{type:Boolean,default:!0},showTooltip:{type:Boolean,default:!0},tooltipTextMap:{type:Object,default:()=>null},textOptions:{type:Object,default:()=>null},drawCursor:{type:String,default:"crosshair"}}),emits:["init","draw"],setup(i,{expose:g,emit:u}){const m=i,p=u;let e,v="";const o={marker:"单击地图选择点位",circle:"按住鼠标左键拖拽绘制圆",rectangle:"按住鼠标左键拖拽绘制矩形",polyline:"单击地图选择拐点，双击地图完成折线绘制",polygon:"单击地图选择拐点，双击地图完成多边形绘制",measureArea:"单击地图选择拐点，双击地图完成绘制并计算面积",rule:"单击地图选择拐点，右击地图完成绘制并计算距离",rectZoomIn:"按住鼠标左键拖拽绘制矩形，松开左键放大地图",rectZoomOut:"按住鼠标左键拖拽绘制矩形，松开左键放大地图"};let f=!0;const a=()=>{if(!f)return;const d=m.type;if(e[d]){const _=m.drawOptions||{};e[d](_),r(o[d])}},{$$getInstance:n,parentInstance:s}=oe((d,_)=>new Promise(O=>{AMap.plugin(["AMap.MouseTool"],()=>{m.tooltipTextMap&&Object.assign(o,m.tooltipTextMap),e=new AMap.MouseTool(_),v=_.getDefaultCursor(),C(),a(),h(),X(),O(e)})}),{emits:p,watchRedirectFn:{__type:a},destroyComponent(){e&&(s!=null&&s.$amapComponent)&&(s!=null&&s.isDestroy||(e.close(!0),k(),c&&(s.$amapComponent.off("mousemove",t),s.$amapComponent.remove(c),c=null)),e=null)}});let c;const C=()=>{if(m.showTooltip){const d=m.textOptions||{};d.anchor="top-left",d.clickable=!1,d.bubble=!0,d.offset=[10,10],c=new AMap.Text(d),s==null||s.$amapComponent.add(c),s==null||s.$amapComponent.on("mousemove",t)}},t=d=>{const _=d.lnglat;c.setPosition([_.lng,_.lat])},r=d=>{c&&c.setText(d)},h=()=>{e.on("draw",d=>{const _=m.type;let O;if(_==="marker")O=d.obj.getPosition().toArray();else if(_==="circle")O={center:d.obj.getCenter().toArray(),radius:d.obj.getRadius()};else if(_==="rectangle"){const $=d.obj.getBounds(),A=$.getSouthWest(),ae=$.getNorthEast();O=[A.toArray(),ae.toArray()]}else if(_==="polyline")O=d.obj.getPath().map(A=>A.toArray());else if(_==="polygon")O=d.obj.getPath().map(A=>A.toArray());else if(_==="measureArea"){const $=d.obj.getPath().map(A=>A.toArray());O=AMap.GeometryUtil.ringArea($)}else if(_==="rule"){const $=d.obj.getPath().map(A=>A.toArray());O=AMap.GeometryUtil.distanceOfLine($)}else(_==="rectZoomIn"||_==="rectZoomOut")&&(O=!0);p("draw",O,d.obj),m.autoClear&&(K(),a())})},j=(d=!0)=>{e.close(d)},J=(d=!0)=>{f=!1,e&&(j(d),k(),c&&c.hide())},ne=()=>{f=!0,X(),a(),c&&c.show()},K=()=>{j(!0)},X=()=>{s==null||s.$amapComponent.setDefaultCursor(m.drawCursor)},k=()=>{v&&(s==null||s.$amapComponent.setDefaultCursor(v))};return g({$$getInstance:n,$$open:ne,$$close:J,$$clear:K}),(d,_)=>(D(),G("div"))}});U.__file="src/vue-amap/packages/util/MouseTool/MouseTool.vue";U.install=i=>(i.component(U.name,U),i);const Ge=U,ge=()=>Te("parentInstance"),Je=Object.assign({name:"DistrictSearch"},{__name:"DistrictSearch",props:{subdistrict:{type:Number,default:0},extensions:{type:String,default:"all"},level:{type:String,default:"district"},view:{type:Boolean,default:!0},styles:{type:Object,default:()=>({})},adcode:{type:String,default:void 0}},setup(i){const g=i,u=ge();let m,p;const e=()=>{p&&u.$amapComponent&&(u.$amapComponent.getLayers().length&&u.$amapComponent.remove(p),p=null)},v=f=>{var s;p&&((s=u.$amapComponent)!=null&&s.remove)&&(u.$amapComponent.remove(p),p=null);for(var a=0;a<f.length;a+=1)f[a]=[f[a]];const n=Object.assign({strokeWeight:1,path:f,fillOpacity:.25,fillColor:"#80d8ff",strokeColor:"#0091ea"},g.styles);p=new AMap.Polygon(n),u.$amapComponent.add(p),g.view&&u.$amapComponent.setFitView(p)},o=f=>{const n=Object.assign({subdistrict:0,extensions:"all",level:"district"},we(g,["subdistrict","extensions","level"]));m||(m=new AMap.DistrictSearch(n)),f&&m.search(f,(s,c)=>{if(!c||!c.districtList||!c.districtList[0]){console.warn("请正确填写名称或更新其他名称");return}const C=c.districtList[0].boundaries;v(C)})};return fe(()=>{e()}),ye(()=>g.adcode,()=>{o(g.adcode)},{immediate:!0}),(f,a)=>null}}),ze=Object.assign({name:"GeoJson"},{__name:"GeoJson",props:{geo:{type:Object,default:void 0},view:{type:Boolean,default:!0}},setup(i){const g=i,u=ge();let m;const p=()=>{m&&u.$amapComponent&&(u.$amapComponent.getLayers().length&&u.$amapComponent.remove(m),m=null)},e=()=>{if(p(),!!g.geo&&(m=new AMap.GeoJSON({geoJSON:g.geo,getPolygon:(v,o)=>new AMap.Polygon({path:o,fillOpacity:.25,strokeColor:"#0091ea",fillColor:"#80d8ff"})}),u.$amapComponent.add(m),g.view)){const v=g.geo.features.reduce((o,f)=>{const a=f.geometry.coordinates;return o.push(...a[0]),o},[]);if(v.length){const o=v.map(h=>h[0]),f=v.map(h=>h[1]),a=ce(o),n=ce(f),s=de(o),c=de(f),C=new AMap.LngLat(a,n),t=new AMap.LngLat(s,c),r=new AMap.Bounds(C,t);u.$amapComponent.setBounds(r)}}};return fe(()=>{p()}),ye(()=>JSON.stringify(g.geo),()=>{e()},{immediate:!0}),(v,o)=>null}});const Ze={class:"region-map"},qe={key:0,class:"map-tool"},Ve={class:"map-tool-content"},Ue={class:"tool-item-group"},He={class:"tool-item-group"},Ke={class:"tool-item-group"},Xe=H({name:"RegionMap"}),Ye=Object.assign(Xe,{setup(i,{expose:g}){const u=Se(),{revoke:m,addRecord:p,reset:e,hasHistory:v}=je(),o=w(),f=w(!1),a=w(!1),n=w(),s=w(),c=w(!1),C=w("layer"),t=w(),r=w(),h=z(()=>u.type===M.polygon),j=z(()=>u.type===M.rectangle),J=z(()=>u.type===M.circle),ne=z(()=>u.type===M.district),K=z(()=>u.type===M.geoJson),X=l=>{u.type=o.value,c.value=!0,s.value=l,d(o.value,l),f.value=!1,o.value=void 0,v.value||p(null),p({isEdit:c.value,pathData:l,toolType:o.value,id:I()})},k=l=>{var B;let b=[];if(l.getPath?b=l.getPath():(B=l.target)!=null&&B.getPath&&(b=l.target.getPath()),l.bounds){const{northEast:Y,southWest:Q}=l.bounds;b=[[Y.lng,Y.lat],[Q.lng,Q.lat]]}p({isEdit:c.value,pathData:b,toolType:u.type,id:I()}),d(u.type,b)},d=(l,b)=>{r.value={type:"Feature",toolType:l,features:[{type:"FeatureCollection",properties:{type:l},geometry:{type:"Polygon",coordinates:l===M.polygon?[b]:b}}]}},_=l=>{f.value=!0,o.value=l,c.value=!1,u.type=void 0},O=l=>{r.value=l,a.value=!0},$=()=>{r.value?u.openSave(r.value):Be("请绘制区域范围","warning")},A=()=>{f.value=!1,o.value=void 0,u.openSave()},ae=l=>{n.value=l.toString().padEnd(6,"0")},_e=l=>{s.value=l,p({isEdit:!0,pathData:l,toolType:u.type,id:I()})},ve=()=>{c.value=!0,C.value=I()},he=()=>{c.value=!1,u.type=void 0,o.value=void 0,s.value=void 0,r.value=void 0,p({isEdit:!1,pathData:[],toolType:"",id:I()})},Ce=()=>{c.value=!1,a.value=!1},be=()=>{const l=m();c.value=(l==null?void 0:l.isEdit)||!1,s.value=(l==null?void 0:l.pathData)||[],u.type=l==null?void 0:l.toolType,C.value=(l==null?void 0:l.id)||I()},Oe=()=>{c.value=!1,f.value=!1,a.value=!1,n.value=void 0,o.value=void 0,s.value=void 0},ie=l=>{var B;const b=l.getBounds();(B=t.value)==null||B.setBounds(b)};return g({showTool:O,showDistrict:ae,showGeoJson:_e,openEdit:ve,init:()=>{Oe(),e()},readOnly:Ce}),(l,b)=>{const B=Le,Y=Ie,Q=We,Ee=Ge,ke=pe("AMapComponent"),T=pe("AIcon"),P=xe;return D(),G("div",Ze,[E(ke,{ref_key:"mapRef",ref:t},{default:x(()=>{var ee,ue;return[y(h)&&((ee=y(s))!=null&&ee.length)?(D(),R(B,{path:y(s),editable:y(c),key:y(C),onDragend:k,onAdjust:k,onRemovenode:k,onAddnode:k,onInit:ie},null,8,["path","editable"])):S("",!0),y(J)?(D(),R(Y,{key:1,radius:y(s).radius,center:y(s).center,editable:y(c),onDragend:k},null,8,["radius","center","editable"])):S("",!0),y(j)&&((ue=y(s))!=null&&ue.length)?(D(),R(Q,{bounds:y(s),editable:y(c),key:y(C),onDragend:k,onAdjust:k,onRemovenode:k,onAddnode:k,onInit:ie},null,8,["bounds","editable"])):S("",!0),y(ne)?(D(),R(y(Je),{key:3,adcode:y(n),styles:{"stroke-width":2,fill:"rgba(0,176,255, 0.2)"}},null,8,["adcode","styles"])):S("",!0),y(K)?(D(),R(y(ze),{key:4,geo:y(s)},null,8,["geo"])):S("",!0),y(f)?(D(),R(Ee,{key:5,type:y(o),onDraw:X},null,8,["type"])):S("",!0)]}),_:1},512),y(a)?(D(),G("div",qe,[F("div",Ve,[F("div",Ue,[F("div",{class:"tool-item",onClick:$},[E(P,{title:"保存描点"},{default:x(()=>[E(T,{type:"SaveOutlined"})]),_:1})]),F("div",{class:"tool-item",onClick:A},[E(P,{title:"取消操作"},{default:x(()=>[E(T,{type:"CloseOutlined"})]),_:1})])]),F("div",He,[F("div",{class:se({"tool-item":!0,active:y(o)==="rectangle"}),onClick:b[0]||(b[0]=ee=>_(y(M).rectangle))},[E(P,{title:"矩形"},{default:x(()=>[E(T,{type:"icon-huajuxing"})]),_:1})],2),F("div",{class:se({"tool-item":!0,active:y(o)==="polygon"}),onClick:b[1]||(b[1]=ee=>_(y(M).polygon))},[E(P,{title:"多边形"},{default:x(()=>[E(T,{type:"icon-huaduobianxing"})]),_:1})],2)]),F("div",Ke,[F("div",{class:se({"tool-item":!0,disabled:!y(v)}),onClick:be},[E(P,{title:"撤销"},{default:x(()=>[E(T,{type:"RollbackOutlined"})]),_:1})],2),F("div",{class:"tool-item",onClick:he},[E(P,{title:"删除"},{default:x(()=>[E(T,{type:"DeleteOutlined"})]),_:1})])])])])):S("",!0)])}}}),st=Me(Ye,[["__scopeId","data-v-f747f19e"]]);export{st as default};
