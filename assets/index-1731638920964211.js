import{h as z,o as h,S as L,Z as M,e as Z,a0 as U,a1 as W,a2 as X,ax as Y,a3 as G}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{q as H,_ as K,s as Q,a as ee,d as te}from"./index.vue_vue_type_script_setup_true_lang-173163892096429.js";import{u as se}from"./useParams-1731638920964.js";import{d as ne,k as b,o as oe,ab as _,U as u,V as S,X as t,_ as f,f as s,u as y,E as ae,W as le,R as ie,$ as I,Z as T,F as $,a1 as re,Y as ce}from"./vue-1731638920964.js";const ue=["src"],pe={style:{"font-weight":"600","font-size":"16px"}},be=ne({__name:"index",setup(de){const B=b({});let k=b(!1);const g=b({});se();const N={columns:[{title:"名称",dataIndex:"name",key:"name",search:{type:"string"}},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",options:[{label:"正常",value:"started"},{label:"禁用",value:"disable"}]}},{title:"说明",key:"description",dataIndex:"description",search:{type:"string"}}]},q=[{title:"名称",dataIndex:"name",key:"name",ellipsis:!0},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0},{title:"说明",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",fixed:"right",width:150,scopedSlots:!0}],w=b(),P=(e,O)=>{var i,c,p,d,C;if(!e)return[];const v=[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{w.value=e,k.value=!0}},{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{E(e)}},{key:"action",text:((i=e.state)==null?void 0:i.value)!=="disable"?"禁用":"启用",tooltip:{title:((c=e.state)==null?void 0:c.value)!=="disable"?"禁用":"启用"},icon:((p=e.state)==null?void 0:p.value)!=="disable"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${e.state.value!=="disable"?"禁用":"启用"}?`,onConfirm:async()=>{var r,x;let l;((r=e.state)==null?void 0:r.value)!=="started"?l=await Q(e.id):l=await ee(e.id),l&&l.status===200?(h("操作成功！"),(x=g.value)==null||x.reload()):h("操作失败！","error")}}},{key:"delete",text:"删除",disabled:((d=e==null?void 0:e.state)==null?void 0:d.value)!=="disable",tooltip:{title:((C=e==null?void 0:e.state)==null?void 0:C.value)!=="disable"?"请先禁用再删除":"删除"},popConfirm:{title:"确认删除?",onConfirm:async()=>{var r;(await te(e.id)).status===200?(h("操作成功！"),(r=g.value)==null||r.reload()):h("操作失败！","error")}},icon:"DeleteOutlined"}];return O==="card"?v.filter(l=>l.key!=="view"):v},R=()=>{w.value={name:"",description:""},k.value=!0},A=()=>{var e;(e=g.value)==null||e.reload()},J=e=>{B.value=e},E=e=>{window.open(`/${L.API_BASE}/rule-editor/index.html#flow/${e.id}`)},V=()=>{k.value=!1};return oe(()=>{var e;(e=history.state)!=null&&e.params&&R()}),(e,O)=>{const v=_("pro-search"),i=_("AIcon"),c=M,p=Z,d=_("Ellipsis"),C=U,l=W,r=X,x=Y,F=G,j=_("FullPage"),D=_("page-container");return u(),S(D,null,{default:t(()=>[f("div",null,[s(v,{columns:N.columns,target:"rule-engine-instance",onSearch:J},null,8,["columns"]),s(j,null,{default:t(()=>[s(F,{columns:q,request:y(H),ref_key:"tableRef",ref:g,defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:y(B)},{headerTitle:t(()=>[s(p,null,{default:t(()=>[s(c,{type:"primary",onClick:R,hasPermission:"rule-engine/Instance:add"},{icon:t(()=>[s(i,{type:"PlusOutlined"})]),default:t(()=>[ae(" 新增 ")]),_:1})]),_:1})]),card:t(o=>{var n,m;return[s(r,le({value:o,actions:P(o,"card")},o,{status:(n=o.state)==null?void 0:n.value,statusText:(m=o.state)==null?void 0:m.text,onClick:E,statusNames:{started:"processing",disable:"error"}}),{img:t(()=>[ie(e.$slots,"img",{},()=>[f("img",{src:y(z)("/scene/trigger-type/scene.png")},null,8,ue)])]),content:t(()=>[s(d,{style:{width:"calc(100% - 100px)","margin-bottom":"18px"}},{default:t(()=>[f("span",pe,I(o.name),1)]),_:2},1024),s(l,null,{default:t(()=>[s(C,{span:12},{default:t(()=>[s(d,null,{default:t(()=>[f("div",null,I(o.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),actions:t(a=>[s(c,{disabled:a.disabled,popConfirm:a.popConfirm,tooltip:{...a.tooltip},hasPermission:"rule-engine/Instance:"+a.key,onClick:a.onClick},{default:t(()=>[a.key==="delete"?(u(),S(i,{key:0,type:"DeleteOutlined"})):(u(),T($,{key:1},[s(i,{type:a.icon},null,8,["type"]),f("span",null,I(a==null?void 0:a.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","hasPermission","onClick"])]),_:2},1040,["value","actions","status","statusText"])]}),state:t(o=>{var n,m;return[s(x,{text:((n=o.state)==null?void 0:n.value)==="started"?"正常":"禁用",status:(m=o.state)==null?void 0:m.value,statusNames:{started:"processing",disable:"error"}},null,8,["text","status"])]}),action:t(o=>[s(p,{size:16},{default:t(()=>[(u(!0),T($,null,re(P(o,"table"),n=>(u(),S(c,{key:n.key,disabled:n.disabled,popConfirm:n.popConfirm,tooltip:{...n.tooltip},onClick:n.onClick,type:"link",style:{padding:"0px"},hasPermission:"rule-engine/Instance:"+n.key,danger:n.key==="delete"},{icon:t(()=>[s(i,{type:n.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission","danger"]))),128))]),_:2},1024)]),_:3},8,["request","params"])]),_:3}),y(k)?(u(),S(K,{key:0,data:y(w),onSuccess:A,onCloseSave:V},null,8,["data"])):ce("",!0)])]),_:3})}}});export{be as default};
