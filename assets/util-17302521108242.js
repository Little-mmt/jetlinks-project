import{q as p}from"./scene-1730252110824.js";import{u as s}from"./scene-17302521108242.js";const e=(t,n)=>new Promise(r=>{const i=n.branches.filter(o=>!!o);p({...n,branches:i},t).then(o=>{o.success&&r(o.result)}).catch(()=>r([]))}),b="device_rules",y=t=>{const n=`branches_${t.branch}`,r=`then_${t.branchGroup}`,i=`then_${t.action}`;return`${n}_${r}_${i}`},d=t=>{var i,o;const n=s();let r=[];t.action===0&&r.push(b);for(let u=0;u<=t.action-1;u++){let c=(o=(i=n.data.branches)==null?void 0:i[t.branch].then[t.branchGroup].actions[u])==null?void 0:o.key;if(!c){const f=`branches_${t.branch}`,l=`then_${t.branchGroup}`,h=`then_${u}`;c=`${f}_${l}_${h}`}r.push(c)}return r},T={list:{},subscribe:function(t,n){const r=this.list;return t.forEach(i=>{(r[i]||(r[i]=[])).push(n)}),this},emit:function(t,n){const r=this.list,i=r[t]?[...r[t]]:[];return i.length?(i.forEach(o=>{o(n)}),this):!1},unSubscribe:function(t,n){const r=this.list;return t.forEach(i=>{if(i in r){const o=r[i];for(let u=0;u<o.length;u++)if(o[u]===n){o.splice(u,1);break}}}),this}},v=(t,n)=>{var o,u;const r=(t==null?void 0:t.properties)||[],i=(t==null?void 0:t.functions)||[];if((n==null?void 0:n.messageType)==="READ_PROPERTY"&&((o=n==null?void 0:n.properties)!=null&&o[0])){const c=r.find(f=>{var l;return f.id===((l=n==null?void 0:n.properties)==null?void 0:l[0])});return c==null?void 0:c.id}else if((n==null?void 0:n.messageType)==="INVOKE_FUNCTION"&&(n!=null&&n.functionId)){const c=i.find(f=>f.id===(n==null?void 0:n.functionId));return c==null?void 0:c.id}else if((n==null?void 0:n.messageType)==="WRITE_PROPERTY"){const c=(u=Object.keys(n==null?void 0:n.properties))==null?void 0:u[0];if(c){const f=r.find(l=>l.id===c);return f==null?void 0:f.id}return!1}return!1},P=t=>{let n=new Set;return t.forEach(r=>{r!=null&&r.then&&r.then.forEach(i=>{i.actions.forEach(o=>{var l;o.executor==="alarm"&&n.add(((l=o.alarm)==null?void 0:l.mode)==="trigger"?"alarmTrigger":"alarmReliever");const u=o.options||{},c=Object.values(u.columnMap||{}),f=new Set([...u.columns||[],...c]);o.options.columns=[...f.values()]})})}),n.size===0?["none"]:[...n.values()]};export{b as D,T as E,y as a,d as b,e as g,P as h,v as i};
