import{d as M,ac as Y,e as g,r as C,w as Z,U as n,Z as I,f,X as a,E as r,$ as s,u as m,V as p,Y as d,F as $}from"./vue-1730252110824.js";import{aC as D,f8 as G,ah as H,J as K,aT as Q,ai as W,d as ee,d3 as te}from"./index-1730252110824.js";import"./index-1730252110824284.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824300.js";import ae from"./JsonView-1730252110824.js";import{T as le}from"./columns-1730252110824.js";import{u as ne}from"./utils-1730252110824.js";import{f as ue}from"./data-17302521108243.js";import de from"./DetailModal-1730252110824.js";import{h as oe}from"./product-17302521108244.js";import{u as ie}from"./instance-1730252110824.js";import{u as se}from"./product-17302521108245.js";const re=[{title:"参数标识",dataIndex:"id"},{title:"参数名称",dataIndex:"name"},{title:"参数类型",dataIndex:"valueType"}],ce=[{title:"Value",dataIndex:"value"},{title:"Text",dataIndex:"text"}],pe={key:0},ye={key:1},me=M({name:"PropertiesModal"}),De=M({...me,props:{data:{type:Object,default:()=>({})},getPopupContainer:{type:Function,default:void 0},unitOptions:{type:Array,default:()=>[]},type:{type:String,default:void 0}},emits:["cancel"],setup(t,{emit:R}){const c=t;Y();const h=ie(),O=se(),{settingData:B}=ne(c.type),J={device:"设备",manual:"手动",rule:"规则"},L=g(()=>{var i,e,u,y;const o={read:"读",write:"写",report:"上报"};return(y=(u=(e=(i=c.data)==null?void 0:i.expands)==null?void 0:e.type)==null?void 0:u.map)==null?void 0:y.call(u,T=>o[T]).join("、")}),x=C({visible:!1,value:void 0}),E=g(()=>{var e,u;let o=(e=c.data.valueType)==null?void 0:e.unit;const i=(u=c.unitOptions)==null?void 0:u.find(y=>y.value===o);return i&&(o=i.label),o}),b=C({columns:[],dataSource:[]}),S=C({columns:[{title:"序号",dataIndex:"serial",width:60},{title:"指标标识",dataIndex:"id"},{title:"指标名称",dataIndex:"name"},{title:"指标值",dataIndex:"value"}],dataSource:[]}),w=g(()=>{var i,e,u,y,T;const o=(u=(e=(i=c.data)==null?void 0:i.expands)==null?void 0:e.metrics)==null?void 0:u.length;return o&&(S.dataSource=(T=(y=c.data)==null?void 0:y.expands)==null?void 0:T.metrics),o}),F=g(()=>{var i;const o=D(((i=c.data)==null?void 0:i.expands)||{},["type","source"]);return Object.values(o).length}),N=o=>{var i,e;switch(o){case"enum":b.columns=[{title:"Value",dataIndex:"value"},{title:"Text",dataIndex:"text"}],b.dataSource=(i=c.data.valueType)==null?void 0:i.elements;break;case"object":b.columns=[{title:"标识",dataIndex:"id",width:50},{title:"名称",dataIndex:"name"},{title:"名称",dataIndex:"name"}],b.dataSource=(e=c.data.valueType)==null?void 0:e.properties;break;case"boolean":b.dataSource={...D(c.data.valueType,["type"])};break;case"array":b.dataSource=c.data.valueType.elementType;break}},j=()=>{R("cancel")},_=()=>{j()},q=()=>{x.visible=!0},z=()=>{x.visible=!1,x.value=void 0},A=async()=>{var o,i,e,u;if(c.data.expands.source==="rule"){let y;c.type==="product"?y=await oe((o=O.current)==null?void 0:o.id,c.data.id):y=await G((i=h.current)==null?void 0:i.productId,(e=h.current)==null?void 0:e.id,c.data.id),y.success&&(x.value=(u=y.result.rule)==null?void 0:u.script)}};return Z(()=>c.data.valueType.type,o=>{A(),N(o)},{immediate:!0}),(o,i)=>{const e=H,u=K,y=Q,T=W,U=ee,X=te;return n(),I($,null,[f(X,{visible:"",maskClosable:!1,title:"属性详情",getContainer:t.getPopupContainer,onCancel:j,onOk:_},{footer:a(()=>[f(U,{type:"primary",onClick:_},{default:a(()=>[r("确认")]),_:1})]),default:a(()=>[f(T,{column:1,labelStyle:{width:"72px",textAlign:"right",justifyContent:"end"}},{default:a(()=>{var P;return[f(e,{label:"属性标识"},{default:a(()=>[r(s(t.data.id),1)]),_:1}),f(e,{label:"属性名称"},{default:a(()=>[r(s(t.data.name),1)]),_:1}),f(e,{label:"属性类型"},{default:a(()=>[r(s(m(le)[t.data.valueType.type]),1)]),_:1}),["int","long","float","double"].includes(t.data.valueType.type)?(n(),p(e,{key:0,label:"单位"},{default:a(()=>[r(s(m(E)),1)]),_:1})):d("",!0),["float","double"].includes(t.data.valueType.type)?(n(),p(e,{key:1,label:"精度"},{default:a(()=>{var l;return[r(s(((l=t.data.valueType)==null?void 0:l.scal)||0),1)]}),_:1})):d("",!0),["string","password"].includes(t.data.valueType.type)?(n(),p(e,{key:2,label:"最大长度"},{default:a(()=>{var l;return[r(s((l=t.data.valueType)==null?void 0:l.maxLength),1)]}),_:1})):d("",!0),t.data.valueType.type==="file"?(n(),p(e,{key:3,label:"文件类型"},{default:a(()=>{var l;return[r(s((l=t.data.valueType)==null?void 0:l.bodyType),1)]}),_:1})):d("",!0),t.data.valueType.type==="date"?(n(),p(e,{key:4,label:"格式"},{default:a(()=>{var l;return[r(s((l=t.data.valueType)==null?void 0:l.format),1)]}),_:1})):d("",!0),["boolean","array"].includes(t.data.valueType.type)?(n(),p(e,{key:5},{default:a(()=>[f(ae,{value:m(b).dataSource},null,8,["value"])]),_:1})):d("",!0),["enum","object"].includes(t.data.valueType.type)?(n(),p(e,{key:6,scroll:{y:130}},{default:a(()=>[f(y,{columns:t.data.valueType.type==="object"?m(re):m(ce),dataSource:t.data.valueType.type==="object"?t.data.valueType.properties:t.data.valueType.elements,pagination:!1,size:"small"},{bodyCell:a(({column:l,record:v,index:V})=>[l.dataIndex==="id"?(n(),p(u,{key:0},{default:a(()=>[r(s(v.id),1)]),_:2},1024)):d("",!0),l.dataIndex==="name"?(n(),p(u,{key:1},{default:a(()=>[r(s(v.name),1)]),_:2},1024)):d("",!0),l.dataIndex==="value"?(n(),p(u,{key:2},{default:a(()=>[r(s(v.value),1)]),_:2},1024)):d("",!0),l.dataIndex==="text"?(n(),p(u,{key:3},{default:a(()=>[r(s(v.text),1)]),_:2},1024)):d("",!0),l.dataIndex==="valueType"?(n(),p(u,{key:4},{default:a(()=>{var k;return[r(s(m(ue)((k=v.valueType)==null?void 0:k.type).label),1)]}),_:2},1024)):d("",!0)]),_:1},8,["columns","dataSource"])]),_:1})):d("",!0),f(e,{label:"属性来源"},{default:a(()=>[r(s(J[t.data.expands.source])+" ",1),t.data.expands.source==="rule"?(n(),I("a",{key:0,type:"link",style:{padding:"0 12px"},onClick:q},"查看")):d("",!0)]),_:1}),f(e,{label:"读写类型"},{default:a(()=>[r(s(m(L)),1)]),_:1}),m(F)&&((P=t.data.expands)!=null&&P.storageType)?(n(),p(e,{key:7,label:"存储方式"},{default:a(()=>{var l;return[r(s(m(B)[(l=t.data.expands)==null?void 0:l.storageType]),1)]}),_:1})):d("",!0),m(w)?(n(),p(e,{key:8,label:"指标配置"})):d("",!0),m(w)?(n(),p(e,{key:9},{default:a(()=>[f(y,{columns:m(S).columns,dataSource:m(S).dataSource,pagination:!1,size:"small"},{bodyCell:a(({column:l,record:v,index:V})=>{var k;return[l.dataIndex==="serial"?(n(),I("span",pe,s(V+1),1)):d("",!0),l.dataIndex==="value"?(n(),I("span",ye,s(v.range===!0?(k=v.value)==null?void 0:k.join("-"):v.value),1)):d("",!0)]}),_:1},8,["columns","dataSource"])]),_:1})):d("",!0)]}),_:1})]),_:1},8,["getContainer"]),m(x).visible?(n(),p(de,{key:0,value:m(x).value,getPopupContainer:t.getPopupContainer,onCancel:z},null,8,["value","getPopupContainer"])):d("",!0)],64)}}});export{De as _};
