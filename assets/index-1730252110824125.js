import{X as S,a as V,h,o as G,au as _,a0 as J,a1 as Q,g as X}from"./index-1730252110824.js";import y from"./Guide-17302521108242.js";import{q as T,l as W}from"./home-17302521108242.js";import{i as D}from"./index-1730252110824297.js";import{d as O,g as Z,k as f,w as K,ab as Y,U as p,V as ee,X as n,f as i,_ as e,a0 as te,Z as C,F,a1 as I,$ as c,u as x,a4 as se,q as ae,af as oe,ag as ie}from"./vue-1730252110824.js";const A=d=>(oe("data-v-9206a457"),d=d(),ie(),d),ne={class:"home-guide"},re=["onClick"],ce={class:"item-english"},de={class:"item-title"},le={class:"item-index"},me=["src"],ue={class:"home-statistics"},he={class:"home-statistics-body"},_e={class:"home-guide-item"},pe=A(()=>e("div",{class:"item-english"},"昨日流量统计",-1)),ve={class:"item-title"},ge={class:"item-index-echarts",style:{height:"75px",width:"110px"}},ye={class:"chart",ref:"todayFlowChart"},fe={class:"home-guide-item"},Ce=A(()=>e("div",{class:"item-english"},"物联卡",-1)),xe={class:"item-content"},be={class:"item-node-text"},we={class:"item-index-echarts",style:{height:"75px",width:"110px"}},Pe={class:"chart",ref:"iotCardChart"},ke={class:"home-body"},Ee={class:"home-body-img"},Se=["src"],Te=O({name:"IotCardHome"}),De=O({...Te,setup(d){const{proxy:b}=Z(),v=S(),l=S().hasPermission,w=V().hasPermission;l("iot-card/Dashboard"),l("iot-card/Platform/Detail");const M=l("iot-card/Record");l("iot-card/CardManagement");const N=w("iot-card/Platform:add"),B=w("iot-card/CardManagement:add"),R={1:h("/home/1.png"),2:h("/home/2.png"),3:h("/home/3.png")},g=[{key:"EQUIPMENT",name:"平台对接",english:"STEP1",auth:N,url:"iot-card/Platform/Detail"},{key:"SCREEN",name:"物联卡管理",english:"STEP2",auth:!!B,url:"iot-card/CardManagement",param:{save:!0}},{key:"CASCADE",name:"操作记录",english:"STEP3",auth:!!M,url:"iot-card/Record"}],P=f(0),m=f([]),u=f([{key:"using",name:"激活",value:0,className:"normal"},{key:"toBeActivated",name:"未激活",value:0,className:"notActive"},{key:"deactivate",name:"停用",value:0,className:"stopped"}]),j=t=>{if(!t.auth){G("暂无权限，请联系管理员","warning");return}if(t.key==="EQUIPMENT")v.jumpPage(t.url,{id:":id"});else{let s;t.key==="SCREEN"&&(s={type:"add"}),v.jumpPage(t.url,s)}},z=()=>{v.jumpPage("iot-card/Dashboard")},L=async()=>{const t=_().subtract(1,"days").startOf("day").valueOf(),s=_().subtract(1,"days").endOf("day").valueOf();(await T(t,s,{orderBy:"date"})).result.map(r=>{P.value+=parseFloat(r.value.toFixed(2))})},$=async()=>{const t=_().subtract(15,"days").startOf("day").valueOf(),s=_().subtract(1,"days").endOf("day").valueOf(),a=await T(t,s,{orderBy:"date"});m.value=a.result.map(r=>({...r})).reverse(),k()},U=async()=>{Promise.all(u.value.map(t=>{const s={terms:[{terms:[{column:"cardStateType",termType:"eq",value:t.key}]}]};return W(s)})).then(t=>{t.forEach((s,a)=>{s.success&&(u.value[a].value=s.result.total)}),q()}).catch(t=>{console.log(t)})},k=()=>{const t=D(b.$refs.todayFlowChart),s={tooltip:{},xAxis:{show:!1,data:m.value.map(a=>a.date)},yAxis:{show:!1},series:[{name:"流量消耗",type:"bar",color:"#FACD89",showBackground:!0,data:m.value.map(a=>parseFloat(a.value.toFixed(2)))}]};t.setOption(s),window.addEventListener("resize",function(){t.resize()})},q=()=>{ae(()=>{const t=D(b.$refs.iotCardChart),s={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},color:["#85a5ff","#f29b55","#c4c4c4"],series:[{name:"",type:"pie",avoidLabelOverlap:!0,radius:["50%","90%"],center:["50%","50%"],itemStyle:{borderColor:"rgba(255,255,255,1)",borderWidth:2},label:{normal:{show:!1}},data:u.value}]};t.setOption(s),window.addEventListener("resize",function(){t.resize()})})};return K(m.value,()=>{k()},{deep:!0}),L(),$(),U(),(t,s)=>{const a=J,r=Q,H=Y("page-container");return p(),ee(H,null,{default:n(()=>[i(r,{gutter:[24,24]},{default:n(()=>[i(a,{xxl:14,xl:24},{default:n(()=>[e("div",ne,[i(y,{title:"物联卡引导"}),e("div",{class:"home-guide-items",style:te(`grid-template-columns: repeat(${g?g.length:1}, 1fr);`)},[(p(),C(F,null,I(g,(o,E)=>e("div",{key:E,class:"home-guide-item step-bar arrow-2 pointer",onClick:Fe=>j(o)},[e("div",ce,c(o.english),1),e("div",de,c(o.name),1),e("div",le,[e("img",{src:R[E+1]},null,8,me)])],8,re)),64))],4)])]),_:1}),i(a,{xxl:10,xl:24},{default:n(()=>[e("div",ue,[i(y,{title:"基础统计"},{extra:n(()=>[e("span",{class:"extra-text",onClick:z},"详情")]),_:1}),e("div",he,[e("div",_e,[pe,e("div",ve,c(x(P))+" M",1),e("div",ge,[e("div",ye,null,512)])]),e("div",fe,[Ce,e("div",xe,[(p(!0),C(F,null,I(x(u),o=>(p(),C("div",{key:o.key,class:"item-node"},[e("div",be,c(o.value),1),e("div",{class:se(`state ${o.className}`)},c(o.name),3)]))),128))]),e("div",we,[e("div",Pe,null,512)])])])])]),_:1}),i(a,{span:24},{default:n(()=>[e("div",ke,[i(y,{title:"平台架构图",english:"PLATFORM ARCHITECTURE DIAGRAM"}),e("div",Ee,[e("img",{src:x(h)("/iot-card/iotcard-home.png")},null,8,Se)])])]),_:1})]),_:1})]),_:1})}}});const Be=X(De,[["__scopeId","data-v-9206a457"]]);export{Be as default};
