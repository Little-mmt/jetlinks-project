import{u as N,o as u,$ as U,g as V}from"./index-1731638920964.js";import{M}from"./index-1731638920964277.js";import O from"./Unsubscribe-1731638920964.js";import $ from"./Card-17316389209642.js";import{s as _,b as A}from"./notificationSubscription-1731638920964.js";import{d as E,k as p,e as F,ab as T,U as v,Z as k,_ as f,$ as z,f as d,X as x,Y as P,u as h,V as D,F as J}from"./vue-1731638920964.js";import"./index.vue_vue_type_script_setup_true_lang-17316389209642.js";import"./Bind-1731638920964.js";import"./Wechat.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./Detail-1731638920964.js";const X={class:"child-item"},Y={class:"child-item-left"},Z={style:{color:"#333333"}},q={key:0,class:"child-item-left-auth"},G={class:"child-item-right"},H=E({__name:"Item",props:{data:{type:Object,default:()=>{}},subscribe:{type:Object,default:()=>{}}},emits:["refresh"],setup(l,{emit:b}){const t=l,y=p({}),m=p(!1),C=p(!1),I=N(),S=F(()=>{var e;return((e=t.subscribe)==null?void 0:e.notifyChannels)||[]}),g=async e=>{var i,s;const n={subscribeName:e.name,topicProvider:(i=t.data)==null?void 0:i.provider,providerId:e.providerId,...t.subscribe,notifyChannels:[...((s=t.subscribe)==null?void 0:s.notifyChannels)||[],e==null?void 0:e.id]};(await _(n)).status===200?(u("操作成功"),b("refresh"),C.value=!1):u("操作失败","error")},w=async e=>{var s,o;const n=new Set(((s=t.subscribe)==null?void 0:s.notifyChannels)||[]);n.delete(e==null?void 0:e.id);const r={subscribeName:e.name,topicProvider:(o=t.data)==null?void 0:o.provider,providerId:e.providerId,...t.subscribe,notifyChannels:[...n.values()]};(await _(r)).status===200?(C.value=!1,u("操作成功"),b("refresh")):u("操作失败","error")},B=async e=>{var r,i;let n=!1;if((e==null?void 0:e.channelProvider)!=="inside-mail")if(["notifier-voice","notifier-sms"].includes(e==null?void 0:e.channelProvider))(r=I.userInfos)!=null&&r.telephone&&(n=!0);else if((e==null?void 0:e.channelProvider)==="notifier-email")(i=I.userInfos)!=null&&i.email&&(n=!0);else{const s=await A();s.status===200&&((s==null?void 0:s.result)||[]).find(c=>{var a;return((a=e==null?void 0:e.channelConfiguration)==null?void 0:a.notifierId)===(c==null?void 0:c.provider)})&&(n=!0)}(e==null?void 0:e.channelProvider)==="inside-mail"||n?g(e):(m.value=!0,y.value=e)};return(e,n)=>{var s,o,c;const r=T("AIcon"),i=U;return v(),k(J,null,[f("div",X,[f("div",Y,[f("div",Z,z((s=l.data)==null?void 0:s.name),1),(o=l.data)!=null&&o.description?(v(),k("div",q,[d(i,{title:l.data.description},{default:x(()=>[d(r,{style:{"font-size":"16px",color:"rgba(0, 0, 0, 0.3)"},type:"ExclamationCircleOutlined"})]),_:1},8,["title"])])):P("",!0)]),f("div",G,[d(M,{data:(c=l.data)==null?void 0:c.channels},{card:x(a=>[d($,{onSave:B,onUnsubscribe:w,notifyChannels:h(S),data:t.data,current:a},null,8,["notifyChannels","data","current"])]),_:1},8,["data"])])]),h(m)?(v(),D(O,{key:0,onSave:g,data:t.data,current:h(y),onClose:n[0]||(n[0]=a=>m.value=!1)},null,8,["data","current"])):P("",!0)],64)}}});const ie=V(H,[["__scopeId","data-v-53d6d90b"]]);export{ie as default};
