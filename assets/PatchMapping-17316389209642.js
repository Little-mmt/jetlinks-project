import{dM as V,dK as J,dL as O,e9 as b,dN as T,dg as E,aI as U,d as $,aO as q,dP as z,dQ as G,A as Q,aa as X,g as F}from"./index-1731638920964.js";import"./index-1731638920964301.js";import"./index-1731638920964288.js";import"./index-1731638920964281.js";import{u as H}from"./instance-1731638920964.js";import{d as W,k as p,o as Y,ab as Z,U as N,V as ee,X as c,_ as k,f as d,u as i,G as te,E as L,$ as ae,af as ne,ag as se}from"./vue-1731638920964.js";const oe=u=>(ne("data-v-264ecbd0"),u=u(),se(),u),ce={class:"map-tree"},de=oe(()=>k("div",{class:"map-tree-top"}," 采集器的点位名称与属性名称一致时将自动映射绑定；有多个采集器点位名称与属性名称一致时以第1个采集器的点位数据进行绑定 ",-1)),le={class:"map-tree-content"},re={style:{width:"100px"}},pe=W({__name:"PatchMapping",props:{metaData:{type:Array,default:()=>[]},deviceId:{type:String,default:""},edgeId:{type:String,default:""}},emits:["close","save"],setup(u,{emit:w}){const h=u,C=p([]),_=H(),v=p([]),o=p([]);p([]);const x=p(!1),y=p([]),K=(e,t)=>{y.value.push(t.node.id),C.value=[...e],v.value=(t==null?void 0:t.checkedNodes)||[]},M=()=>{o.value=v.value},m=p([]),S=async()=>{var e,t,a;if((e=_.current)!=null&&e.parentId){x.value=!0;const n=await V(_.current.parentId);x.value=!1,n.status===200&&(m.value=(a=(t=n.result)==null?void 0:t[0])==null?void 0:a.map(s=>({...s,title:s.name,key:s.id,checkable:!1,type:"channel",parentId:"",provider:s.provider})))}},j=e=>new Promise(async t=>{var s,l;if((s=e.dataRef)!=null&&s.children){t();return}const a={terms:[{terms:[{column:e.type==="channel"?"channelId":"collectorId",value:e.key}]}]},n=e.type==="channel"?await J(_.current.parentId,a):await O(_.current.parentId,a);e.dataRef.children=(l=n.result)==null?void 0:l[0].map(r=>({...r,title:r.name,key:r.id,type:e.type==="channel"?"collector":"point",parentId:e.key,checkable:e.type==="channel",isLeaf:e.type!=="channel"})),m.value=[...m.value],t()}),P=e=>{const t=o.value.findIndex(a=>a.key===e);o.value.splice(t,1),C.value=o.value.map(a=>a.key),v.value=o.value},A=async()=>{var e;if(!o.value.length)b.warning("请选择采集器");else{const t=[];o.value.map(n=>{const s=(n.children||[]).map(l=>{var r,g;return{channelId:n.parentId,collectorId:l.collectorId,pointId:l.id,metadataType:"property",metadataId:(r=h.metaData.find(f=>f.name===l.name))==null?void 0:r.id,provider:(g=m.value.find(f=>f.id===n.parentId))==null?void 0:g.provider,state:_.current.state.value==="notActive"?"disabled":null}});t.push(...s)}),console.log(t);const a=t.filter(n=>!!n.metadataId);a&&a.length!==0?(await T(h.edgeId,{deviceId:h.deviceId,provider:(e=a[0])==null?void 0:e.provider,requestList:a})).status===200&&(b.success("操作成功"),w("save")):b.error("暂无对应属性的映射")}},D=()=>{w("close")};return Y(()=>{h.edgeId&&S()}),(e,t)=>{const a=E,n=U,s=$,l=Z("AIcon"),r=q,g=z,f=G,B=Q,R=X;return N(),ee(R,{width:"900px",title:"批量映射",visible:"",onOk:A,onCancel:D},{default:c(()=>[k("div",ce,[de,d(B,{spinning:i(x)},{default:c(()=>[k("div",le,[d(n,{class:"map-tree-content-card",title:"源数据"},{default:c(()=>[d(a,{checkable:"",height:300,"tree-data":i(m),checkedKeys:i(C),"load-data":j,onCheck:K,expandedKeys:i(y),"onUpdate:expandedKeys":t[0]||(t[0]=I=>te(y)?y.value=I:null)},null,8,["tree-data","checkedKeys","expandedKeys"])]),_:1}),k("div",re,[d(s,{disabled:i(o).length>=i(v).length,onClick:M},{default:c(()=>[L("加入右侧")]),_:1},8,["disabled"])]),d(n,{class:"map-tree-content-card",title:"采集器"},{default:c(()=>[d(f,{size:"small","data-source":i(o),class:"map-tree-content-card-list"},{renderItem:c(({item:I})=>[d(g,null,{actions:c(()=>[d(r,{title:"确认删除？",onConfirm:()=>P(I.key)},{default:c(()=>[d(l,{type:"DeleteOutlined"})]),_:2},1032,["onConfirm"])]),default:c(()=>[L(ae(I.title)+" ",1)]),_:2},1024)]),_:1},8,["data-source"])]),_:1})])]),_:1},8,["spinning"])])]),_:1})}}});const ve=F(pe,[["__scopeId","data-v-264ecbd0"]]);export{ve as default};
