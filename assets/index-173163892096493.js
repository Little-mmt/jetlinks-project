import{h as sa,ez as da,eA as ca,o as ua,a4 as pa,aD as ra,a6 as ia,d as _a,e as ga,$ as fa,dq as va,aL as ha,aM as ya,aN as ma,J as Ia,aT as wa,y as ba,eB as Ma,g as xa}from"./index-1731638920964.js";import"./index-1731638920964282.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import{d as R,ai as Sa,k as h,e as E,o as Ca,b as ka,ab as ja,U as _,Z as M,_ as l,f as r,X as o,F,a1 as K,u as v,V as y,E as i,$ as m,Y as J,af as Ba,ag as Da}from"./vue-1731638920964.js";import{u as Pa}from"./product-17316389209645.js";import"./product-17316389209644.js";import"./encodeQuery-1731638920964.js";const x=S=>(Ba("data-v-d33e1d8f"),S=S(),Da(),S),Ta={class:"metadata-map"},Ja={class:"left"},Oa={class:"box"},Va={key:0,style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},Na={key:0,class:"metadata-title"},Aa={class:"right"},La=x(()=>l("div",{class:"title"},"功能说明",-1)),Ua=x(()=>l("p",null,[i(" 该功能用于将插件/协议包中的 "),l("b",null,"物模型属性标识"),i("与 "),l("b",null,"平台物模型属性标识"),i("进行映射,当两方属性标识不一致时，可在当前页面直接修改映射管理，系统将以 "),l("b",null,"映射后"),i("的"),l("b",null,"物模型属性"),i("进行数据处理。 ")],-1)),Ea=x(()=>l("p",null," 未完成映射的属性标识“目标属性”列数据为空，代表该属性值来源以在平台配置的来源为准。 ",-1)),Fa=x(()=>l("p",null,[i(" 数据条背景亮起代表"),l("b",null,"标识一致"),i("或"),l("b",null,"已完成映射"),i("的属性。 ")],-1)),Ka=x(()=>l("div",{class:"title"},"功能图示",-1)),Ra=["src"],$a=R({name:"MetadataMap"}),qa=R({...$a,setup(S){const $=Pa(),{current:I}=Sa($),w=h([]),f=h([]),O=h([]),C=h(void 0),V=h([]),D=h(void 0),N=h(!1),q=[{title:"序号",dataIndex:"index",width:100},{title:"平台属性",dataIndex:"name"},{title:"目标属性",dataIndex:"plugin",width:250}],P=h(void 0),z=E(()=>{var e;return((e=f.value)==null?void 0:e.filter(a=>!!(a!=null&&a.plugin)).map(a=>a.id))||[]}),A=E(()=>{var e;return((e=f.value)==null?void 0:e.filter(a=>!!(a!=null&&a.plugin)).map(a=>a.plugin))||[]}),Q=()=>new Promise(e=>{var a;Ma("product",(a=I.value)==null?void 0:a.id).then(t=>{var s,p;t.success&&e(((p=(s=t.result)==null?void 0:s.filter(c=>c.customMapping))==null?void 0:p.map(c=>({id:c.metadataId,pluginId:c.originalId,customMapping:c==null?void 0:c.customMapping})))||[])})}),W=e=>({id:e.id,class:P.value===(e==null?void 0:e.name)?"metadata-search-row":""}),X=(e,a)=>{D.value=a==null?void 0:a.label},Y=()=>{var e;if(D.value){const a=w.value.find(t=>D.value===(t==null?void 0:t.name));a&&(P.value=a==null?void 0:a.name,(e=document.getElementById(a==null?void 0:a.id))==null||e.scrollIntoView())}else P.value=void 0},Z=async()=>{var k;const a=JSON.parse(((k=I.value)==null?void 0:k.metadata)||"{}").properties,t=await G(),s=(t==null?void 0:t.properties)||[],p=await Q();O.value=s.map(d=>({...d,label:d==null?void 0:d.name,value:d.id}));const c=[...p];if(!c.length){N.value=!0;const d=c.map(n=>n.id),b=c.map(n=>n.pluginId);s.map(n=>{!d.includes(n.id)&&!b.includes(n.id)&&c.push({id:n.id,pluginId:n.id,customMapping:n==null?void 0:n.customMapping})})}f.value=(a==null?void 0:a.map((d,b)=>{var j;const n=c.find(T=>T.id===d.id);return{index:b+1,id:d.id,name:d==null?void 0:d.name,type:(j=d.valueType)==null?void 0:j.type,customMapping:n==null?void 0:n.customMapping,plugin:n==null?void 0:n.pluginId}}))||[],w.value=f.value},G=()=>new Promise(e=>{var t,s;const a=(t=I.value)==null?void 0:t.transportProtocol;da(((s=I.value)==null?void 0:s.messageProtocol)||"",a).then(p=>{p.success&&e(JSON.parse((p==null?void 0:p.result)||"{}")),e({properties:[]})})}),L=async(e,a)=>{var s;(await ca("product",(s=I.value)==null?void 0:s.id,e)).success&&a&&ua("操作成功")},H=async(e,a)=>{if(!a&&(e!=null&&e.customMapping)||a){const t=[{metadataType:"property",metadataId:e.id,originalId:a}];L(t,!0)}},aa=({key:e})=>{V.value=f.value;const a=pa(f.value).sort((t,s)=>e?(s.plugin?1:-1)-(t.plugin?1:-1):(t.plugin?1:-1)-(s.plugin?1:-1));f.value=a,C.value=e},ea=()=>{C.value=void 0,f.value=V.value};return Ca(()=>{Z()}),ka(()=>{if(N.value&&w.value.length){const e=w.value.map(a=>({metadataType:"property",metadataId:a.id,originalId:a.plugin||null}));L(e)}}),(e,a)=>{const t=ra,s=ia,p=ja("AIcon"),c=_a,k=ga,d=fa,b=va,n=ha,j=ya,T=ma,ta=Ia,na=wa,U=ba;return _(),M("div",Ta,[l("div",Ja,[r(k,{style:{"margin-bottom":"24px"}},{default:o(()=>[r(s,{onChange:X,"show-search":"","allow-clear":"",placeholder:"请选择属性名称",style:{width:"250px"}},{default:o(()=>[(_(!0),M(F,null,K(v(w),u=>(_(),y(t,{label:u.name,value:u==null?void 0:u.id,key:u==null?void 0:u.id},{default:o(()=>[i(m(u==null?void 0:u.name),1)]),_:2},1032,["label","value"]))),128))]),_:1}),r(c,{type:"primary",onClick:Y},{default:o(()=>[r(p,{type:"SearchOutlined"})]),_:1})]),_:1}),l("div",Oa,[r(U,{height:"100%"},{default:o(()=>[r(na,{columns:q,"data-source":v(f),pagination:!1,rowSelection:{selectedRowKeys:v(z),hideSelectAll:!0,columnWidth:0},rowKey:"id",customRow:W},{headerCell:o(({column:u})=>[u.dataIndex==="plugin"?(_(),M("div",Va,[l("span",null,[i(" 目标属性"),r(d,{title:"插件中物模型下的属性"},{default:o(()=>[r(p,{style:{"margin-left":"10px"},type:"QuestionCircleOutlined"})]),_:1})]),v(C)!==void 0?(_(),y(b,{key:0,color:"#87d068",closable:"",onClose:ea},{default:o(()=>[r(p,{type:"ArrowUpOutlined"}),l("span",null,m(v(C)?"已映射":"未映射"),1)]),_:1})):(_(),y(T,{key:1},{overlay:o(()=>[r(j,{onClick:aa},{default:o(()=>[(_(),y(n,{key:!0},{default:o(()=>[i("置顶已映射数据")]),_:1})),(_(),y(n,{key:!1},{default:o(()=>[i("置顶未映射数据")]),_:1}))]),_:1})]),default:o(()=>[r(p,{type:"FilterOutlined"})]),_:1}))])):J("",!0)]),bodyCell:o(({column:u,text:oa,record:B})=>[u.dataIndex==="name"?(_(),M("span",Na,[r(ta,null,{default:o(()=>[i(m(oa)+" ("+m(B.id)+") ",1)]),_:2},1024)])):J("",!0),u.dataIndex==="plugin"?(_(),y(s,{key:1,value:B.plugin,"onUpdate:value":g=>B.plugin=g,style:{width:"100%"},allowClear:"",onChange:g=>H(B,g)},{default:o(()=>[(_(!0),M(F,null,K(v(O),(g,la)=>(_(),y(t,{key:la+"_"+g.id,value:g.value,disabled:v(A).includes(g.id)},{default:o(()=>[r(d,{title:v(A).includes(g.id)?"该属性已绑定平台属性":""},{default:o(()=>[i(m(g.label)+" ("+m(g.id)+") ",1)]),_:2},1032,["title"])]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):J("",!0)]),_:1},8,["data-source","rowSelection"])]),_:1})])]),l("div",Aa,[r(U,null,{default:o(()=>[La,Ua,Ea,Fa,Ka,l("div",null,[l("img",{src:v(sa)("/device/matadataMap.png")},null,8,Ra)])]),_:1})])])}}});const ee=xa(qa,[["__scopeId","data-v-d33e1d8f"]]);export{ee as default};
