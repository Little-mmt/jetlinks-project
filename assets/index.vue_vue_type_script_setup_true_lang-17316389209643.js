import{a4 as G,a5 as J,Y as W,I as Z,v as H,a6 as Q,$ as X,a7 as K,a8 as ee,w as te,a9 as ae,F as oe,d as re,Z as ne,aa as se}from"./index-1731638920964.js";import"./index-1731638920964290.js";import{v as ie,s as ue,u as le,a as de,g as pe,b as ce}from"./channel-1731638920964.js";import fe from"./GateWayFormItem-1731638920964.js";import{t as me}from"./validate-1731638920964.js";import{d as ge,k as y,e as U,w as ve,ab as ye,U as l,V as d,X as i,f as n,E as P,u as e,Y as p,Z as _e,F as be}from"./vue-1731638920964.js";const we={name:"",provider:void 0,configuration:{host:"",port:"502",endpoint:"",securityPolicy:"None",securityMode:void 0,certId:void 0,authType:"anonymous",username:"",password:"",deviceId:void 0,deviceName:void 0,connect:!1,instanceNumber:void 0,overIp:{localBindAddress:"0.0.0.0",port:47808}},description:""},Ne={running:"success",disabled:"error",partialError:"processing",failed:"warning",stopped:"default"},qe={disabled:{state:"enabled",runningState:"running"},enabled:{state:"disabled",runningState:"stopped"}},Ae=new RegExp(/^\d+$/),Ce=new RegExp(/^([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.([0-9]|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])$/),Ie=new RegExp(/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/),Pe=new RegExp(/([0-9a-z-]{2,}\.[0-9a-z-]{2,3}\.[0-9a-z-]{2,3}|[0-9a-z-]{2,}\.[0-9a-z-]{2,3})$/i),he=(b,c)=>new Promise(async(m,g)=>{if(!c)return m("");const v=await ie(c);return v.result.passed?m(""):g(v.result.reason)}),ke=(b,c)=>new Promise(async(m,g)=>c?Ce.test(c)||Ie.test(c)||Pe.test(c)?m(""):g("请输入正确格式的Modbus主机IP地址"):m("")),f={name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64个字符"}],provider:[{required:!0,message:"请选择通讯协议"}],host:[{required:!0,message:"请输入Modbus主机IP"},{validator:ke,trigger:"blur"}],port:[{required:!0,message:"请输入端口"},{pattern:Ae,message:"请输入0-65535之间的正整数"}],endpoint:[{required:!0,message:"请输入端点url"},{validator:he,trigger:"blur"}],securityPolicy:[{required:!0,message:"请选择安全策略"}],securityMode:[{required:!0,message:"请选择安全模式"}],certId:[{required:!0,message:"请选择证书"}],authType:[{required:!0,message:"请选择权限认证"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"},{max:64,message:"最多可输入64个字符"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{max:64,message:"最多可输入64个字符"}],description:[{max:200,message:"最多可输入200个字符"}]},Ee=ge({__name:"index",props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(b,{emit:c}){const m=b,g=y(!1),v=m.data.id,w=y(),h=y([]),k=y([]),_=y({"auth-types":[],"security-modes":[],"security-policies":[]}),a=y(G(we)),O=async()=>{var u,s;const o=await((u=w.value)==null?void 0:u.validate());(o==null?void 0:o.provider)==="COLLECTOR_GATEWAY"&&(o.configuration.deviceName=a.value.configuration.deviceName),(o==null?void 0:o.provider)==="snap7"?o.configuration={connect:!1}:(o==null?void 0:o.provider)==="iec104"&&(o.configuration={}),o.circuitBreaker={type:"Ignore"},g.value=!0;const t=v?await le(v,{...m.data,...o}).catch(()=>{}):await ue(o).catch(()=>{});c("change",(t==null?void 0:t.status)===200),g.value=!1,(s=w.value)==null||s.resetFields()},L=async(o,t)=>t?!new RegExp(/^[0-9]*$/).test(t)||parseInt(t)<0?Promise.reject("请输入正确的BACnet实例号"):Promise.resolve():Promise.reject("请输入BACnet实例号"),T=async(o,t)=>t&&!me(t)?Promise.reject("请输入正确的子网地址"):Promise.resolve(),F=()=>{var o;c("change",!1),(o=w.value)==null||o.resetFields()},B=o=>{a.value.configuration.authType=o[0]},x=U(()=>{const{authType:o}=a.value.configuration;return J(o)?o[0]==="username"&&a.value.provider==="OPC_UA":o==="username"&&a.value.provider==="OPC_UA"}),N=U(()=>{const{securityMode:o}=a.value.configuration;return o==="SignAndEncrypt"||o==="Sign"}),A=(o,t)=>t.label.toLowerCase().indexOf(o.toLowerCase())>=0,q=async()=>{for(let o in _.value){const t=await ce(o);t.status===200&&(_.value[o]=t.result.map(u=>({label:(u==null?void 0:u.text)||u,value:(u==null?void 0:u.value)||u})))}},E=async()=>{const o=await de();o.status===200&&(h.value=o.result.map(t=>({label:t.name,value:t.id})))};return(async()=>{const o=await pe();if(o.status===200){const t=o.result.filter(s=>["GATEWAY","Modbus/TCP","opc-ua","snap7","IEC104","BACNet/IP"].includes(s.name)).map(s=>s.name),u=W.filter(s=>t.includes(s.alias));k.value=u,t.includes("opc-ua")&&q()}})(),E(),ve(()=>m.data,o=>{o.id&&(a.value=o)},{immediate:!0,deep:!0}),(o,t)=>{const u=Z,s=H,C=Q,M=ye("AIcon"),j=X,I=K,S=ee,R=te,$=ae,D=oe,z=re,V=ne,Y=se;return l(),d(Y,{title:b.data.id?"编辑":"新增",visible:!0,width:"700px",onCancel:F,maskClosable:!1},{footer:i(()=>[n(z,{key:"back",onClick:F},{default:i(()=>[P("取消")]),_:1}),n(V,{key:"submit",type:"primary",loading:e(g),onClick:O,style:{"margin-left":"8px"},hasPermission:`DataCollect/Channel:${e(v)?"update":"add"}`},{default:i(()=>[P(" 确认 ")]),_:1},8,["loading","hasPermission"])]),default:i(()=>[n(D,{class:"form",layout:"vertical",model:e(a),name:"basic",autocomplete:"off",rules:e(f),ref_key:"formRef",ref:w},{default:i(()=>[n(s,{label:"通道名称",name:"name"},{default:i(()=>[n(u,{placeholder:"请输入通道名称",value:e(a).name,"onUpdate:value":t[0]||(t[0]=r=>e(a).name=r)},null,8,["value"])]),_:1}),n(s,{label:"通讯协议",name:"provider"},{default:i(()=>[n(C,{style:{width:"100%"},value:e(a).provider,"onUpdate:value":t[1]||(t[1]=r=>e(a).provider=r),options:e(k),placeholder:"请选择通讯协议",allowClear:"","show-search":"","filter-option":A,disabled:!!e(v)},null,8,["value","options","disabled"])]),_:1}),e(a).provider==="MODBUS_TCP"?(l(),d(s,{key:0,name:["configuration","host"],rules:e(f).host},{label:i(()=>[P(" Modbus主机IP "),n(j,{title:"支持ipv4、ipv6、域名"},{default:i(()=>[n(M,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})]),default:i(()=>[n(u,{placeholder:"请输入Modbus主机IP",value:e(a).configuration.host,"onUpdate:value":t[2]||(t[2]=r=>e(a).configuration.host=r)},null,8,["value"])]),_:1},8,["rules"])):p("",!0),e(a).provider==="MODBUS_TCP"?(l(),d(s,{key:1,label:"端口",name:["configuration","port"],rules:e(f).port},{default:i(()=>[n(I,{style:{width:"100%"},placeholder:"请输入端口",value:e(a).configuration.port,"onUpdate:value":t[3]||(t[3]=r=>e(a).configuration.port=r),min:0,max:65535},null,8,["value"])]),_:1},8,["rules"])):p("",!0),e(a).provider==="OPC_UA"?(l(),d(s,{key:2,label:"端点url",name:["configuration","endpoint"],rules:e(f).endpoint},{default:i(()=>[n(u,{placeholder:"请输入端点url",value:e(a).configuration.endpoint,"onUpdate:value":t[4]||(t[4]=r=>e(a).configuration.endpoint=r)},null,8,["value"])]),_:1},8,["rules"])):p("",!0),e(a).provider==="OPC_UA"?(l(),d(s,{key:3,label:"安全策略",name:["configuration","securityPolicy"],rules:e(f).securityPolicy},{default:i(()=>[n(C,{style:{width:"100%"},value:e(a).configuration.securityPolicy,"onUpdate:value":t[5]||(t[5]=r=>e(a).configuration.securityPolicy=r),options:e(_)["security-policies"],placeholder:"请选择安全策略",allowClear:"","show-search":"","filter-option":A},null,8,["value","options"])]),_:1},8,["rules"])):p("",!0),e(a).provider==="COLLECTOR_GATEWAY"?(l(),d(s,{key:4,name:["configuration","deviceId"],rules:[{required:!0,message:"请选择网关设备"}],label:"选择网关设备"},{default:i(()=>[n(fe,{name:e(a).configuration.deviceName,"onUpdate:name":t[6]||(t[6]=r=>e(a).configuration.deviceName=r),value:e(a).configuration.deviceId,"onUpdate:value":t[7]||(t[7]=r=>e(a).configuration.deviceId=r)},null,8,["name","value"])]),_:1})):p("",!0),e(a).provider==="OPC_UA"?(l(),d(s,{key:5,label:"安全模式",name:["configuration","securityMode"],rules:e(f).securityMode},{default:i(()=>[n(C,{style:{width:"100%"},value:e(a).configuration.securityMode,"onUpdate:value":t[8]||(t[8]=r=>e(a).configuration.securityMode=r),options:e(_)["security-modes"],placeholder:"请选择安全模式",allowClear:"","show-search":"","filter-option":A},null,8,["value","options"])]),_:1},8,["rules"])):p("",!0),e(N)?(l(),d(s,{key:6,label:"证书",name:["configuration","certId"],rules:e(f).certId},{default:i(()=>[n(C,{style:{width:"100%"},value:e(a).configuration.certId,"onUpdate:value":t[9]||(t[9]=r=>e(a).configuration.certId=r),options:e(h),placeholder:"请选择证书",allowClear:"","show-search":"","filter-option":A},null,8,["value","options"])]),_:1},8,["rules"])):p("",!0),e(a).provider==="OPC_UA"?(l(),d(s,{key:7,label:"权限认证",name:["configuration","authType"],rules:e(f).authType},{default:i(()=>[n(S,{showImage:!1,value:e(a).configuration.authType,"onUpdate:value":t[10]||(t[10]=r=>e(a).configuration.authType=r),options:e(_)["auth-types"],onChange:B,column:2},null,8,["value","options"])]),_:1},8,["rules"])):p("",!0),e(x)?(l(),d(s,{key:8,label:"用户名",name:["configuration","username"],rules:e(f).username},{default:i(()=>[n(u,{placeholder:"请输入用户名",value:e(a).configuration.username,"onUpdate:value":t[11]||(t[11]=r=>e(a).configuration.username=r)},null,8,["value"])]),_:1},8,["rules"])):p("",!0),e(x)?(l(),d(s,{key:9,label:"密码",name:["configuration","password"],rules:e(f).password},{default:i(()=>[n(R,{placeholder:"请输入密码",value:e(a).configuration.password,"onUpdate:value":t[12]||(t[12]=r=>e(a).configuration.password=r)},null,8,["value"])]),_:1},8,["rules"])):p("",!0),e(a).provider==="BACNetIp"?(l(),_e(be,{key:10},[n(s,{label:"BACNet实例号",name:["configuration","instanceNumber"],rules:{required:!0,trigger:"blur",validator:L}},{default:i(()=>[n(I,{style:{width:"100%"},value:e(a).configuration.instanceNumber,"onUpdate:value":t[13]||(t[13]=r=>e(a).configuration.instanceNumber=r),min:0,precision:0,max:999999999999,placeholder:"请输入BACNet实例号"},null,8,["value"])]),_:1},8,["rules"]),n(s,{label:"网卡",name:["configuration","overIp","localBindAddress"],rules:{required:!0,trigger:"blur",message:"请选择网卡"}},{default:i(()=>[n(u,{value:e(a).configuration.overIp.localBindAddress,"onUpdate:value":t[14]||(t[14]=r=>e(a).configuration.overIp.localBindAddress=r)},null,8,["value"])]),_:1}),n(s,{label:"广播端口",name:["configuration","overIp","port"],rules:{required:!0,trigger:"blur",message:"请输入广播端口"}},{default:i(()=>[n(I,{value:e(a).configuration.overIp.port,"onUpdate:value":t[15]||(t[15]=r=>e(a).configuration.overIp.port=r),style:{width:"100%"},min:1,max:65535,precision:0,placeholder:"请输入广播端口"},null,8,["value"])]),_:1}),n(s,{label:"子网地址",name:["configuration","overIp","subnetAddress"],rules:{trigger:"change",validator:T}},{default:i(()=>[n(u,{value:e(a).configuration.overIp.subnetAddress,"onUpdate:value":t[16]||(t[16]=r=>e(a).configuration.overIp.subnetAddress=r),style:{width:"100%"},placeholder:"请输入子网地址"},null,8,["value"])]),_:1},8,["rules"]),n(s,{label:"网络前缀长度",name:["configuration","overIp","networkPrefixLength"]},{default:i(()=>[n(I,{value:e(a).configuration.overIp.networkPrefixLength,"onUpdate:value":t[17]||(t[17]=r=>e(a).configuration.overIp.networkPrefixLength=r),style:{width:"100%"},min:1,max:65535,precision:0,placeholder:"请输入网络前缀长度"},null,8,["value"])]),_:1})],64)):p("",!0),n(s,{label:"说明",name:"description"},{default:i(()=>[n($,{placeholder:"请输入说明",value:e(a).description,"onUpdate:value":t[18]||(t[18]=r=>e(a).description=r),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])}}});export{Ne as S,Ee as _,qe as u};
