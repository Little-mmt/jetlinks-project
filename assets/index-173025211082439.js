import{u as V,au as E,Z as h,av as U,aw as Y,o as j,ax as A,e as D,a3 as M,g as $}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import q from"./ViewDialog-1730252110824.js";import{u as H}from"./useParams-1730252110824.js";import{a as L}from"./notificationSubscription-1730252110824.js";import{d as T,e as Z,k as u,s as F,o as J,b as z,ab as x,U as I,Z as G,f as o,X as r,E as S,$ as b,u as l,V as O,G as X,Y as K}from"./vue-1730252110824.js";import"./index-1730252110824284.js";import"./index-1730252110824285.js";import"./config-1730252110824.js";const Q={class:"notification-record-container"},W=T({name:"NotificationRecord"}),ee=T({...W,props:{type:{type:String,default:""}},setup(d){const m=d,p=V(),v=Z(()=>m.type==="system-business"?["device-transparent-codec"]:m.type==="system-monitor"?["system-event"]:m.type==="workflow-notification"?["workflow-task-cc","workflow-task-todo","workflow-task-reject","workflow-process-finish","workflow-process-repealed","workflow-task-transfer-todo"]:["alarm","alarm-product","alarm-device","alarm-other","alarm-org"]),_=[{title:"类型",dataIndex:"topicProvider",key:"topicProvider",search:{type:"select",termFilter:["in","nin"],options:()=>L().then(a=>a.result.map(e=>({label:e.name,value:e.id})).filter(e=>[...v.value].includes(e==null?void 0:e.value)).sort((e,s)=>{var i,c;return((i=s==null?void 0:s.value)==null?void 0:i.length)-((c=e==null?void 0:e.value)==null?void 0:c.length)}))},scopedSlots:!0,ellipsis:!0},{title:"消息",dataIndex:"message",key:"message",search:{type:"string"},scopedSlots:!0,ellipsis:!0},{title:"通知时间",dataIndex:"notifyTime",key:"notifyTime",search:{type:"date"},scopedSlots:!0,ellipsis:!0},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",termFilter:["in","nin"],options:[{label:"未读",value:"unread"},{label:"已读",value:"read"}]},scopedSlots:!0,ellipsis:!0},{title:"操作",dataIndex:"action",key:"action",ellipsis:!0,scopedSlots:!0,width:"200px"}],n=u(!1),k=u({}),g=H(),C={sorts:[{name:"notifyTime",order:"desc"}],terms:[{terms:[{column:"topicProvider",value:v.value,termType:"in"}],type:"and"}]},w=u({}),f=u(),y=a=>{k.value=a,n.value=!0},N=()=>{f.value&&f.value.reload()},P=a=>{const e=a.state.value==="read"?"_unread":"_read",s=Y(e,[a.id]);return s.then(i=>{i.status===200&&(j("操作成功！"),N(),p.updateAlarm())}),s};return F(()=>{var a;(a=p.messageInfo)!=null&&a.id&&y(p.messageInfo)}),J(()=>{var a,e;(a=g.params)!=null&&a.value.row&&y((e=g.params)==null?void 0:e.value.row)}),z(()=>{p.messageInfo={},n.value=!1}),(a,e)=>{const s=x("pro-search"),i=A,c=x("AIcon"),B=D,R=M;return I(),G("div",Q,[o(s,{columns:_,target:d.type,style:{padding:"0"},onSearch:e[0]||(e[0]=t=>w.value=t)},null,8,["target"]),o(R,{ref_key:"tableRef",ref:f,columns:_,request:l(U),model:"TABLE",params:l(w),bodyStyle:{padding:0},defaultParams:C,scroll:{y:420}},{topicProvider:r(t=>[S(b(t.topicName),1)]),notifyTime:r(t=>[S(b(l(E)(t.notifyTime).format("YYYY-MM-DD HH:mm:ss")),1)]),state:r(t=>[o(i,{status:t.state.value,text:t.state.text,statusNames:{read:"success",unread:"error"}},null,8,["status","text"])]),action:r(t=>[o(B,{size:16},{default:r(()=>[o(h,{type:"link",popConfirm:{title:`确认标为${t.state.value==="read"?"未读":"已读"}`,onConfirm:()=>P(t)},tooltip:{title:t.state.value==="read"?"标为未读":"标为已读"}},{default:r(()=>[o(c,{type:"icon-a-PIZHU1"})]),_:2},1032,["popConfirm","tooltip"]),o(h,{type:"link",tooltip:{title:"查看"},onClick:te=>y(t)},{default:r(()=>[o(c,{type:"EyeOutlined"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["request","params"]),l(n)?(I(),O(q,{key:0,visible:l(n),"onUpdate:visible":e[1]||(e[1]=t=>X(n)?n.value=t:null),data:l(k),type:d.type},null,8,["visible","data","type"])):K("",!0)])}}});const ve=$(ee,[["__scopeId","data-v-f2c1dc12"]]);export{ve as default};
