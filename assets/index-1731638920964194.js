import{au as Y,aa as s,ds as j,e as w,a3 as H,g as O}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{T as V}from"./template-1731638920964.js";import{_ as $}from"./Record.vue_vue_type_script_setup_true_lang-1731638920964.js";import{d as D,e as J,k as N,w as B,ab as f,U as _,V as y,X as a,f as o,u as c,E,$ as M,Y as q,a4 as A,n as i}from"./vue-1731638920964.js";import"./vue-json-viewer-1731638920964.js";const L=D({__name:"index",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},emits:["update:visible","cancel"],setup(n,{emit:r}){const v=n,x=J({get:()=>v.visible,set:e=>r("update:visible",e)}),m=[{title:"ID",dataIndex:"id",key:"id",search:{type:"string"}},{title:"发送时间",dataIndex:"notifyTime",key:"notifyTime",scopedSlots:!0,search:{type:"date",handleValue:e=>e}},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"成功",value:"success"},{label:"失败",value:"error"}],handleValue:e=>e}},{title:"操作",key:"action",scopedSlots:!0}],l=N({}),d=e=>{l.value=e},h=e=>{s.info({title:"错误信息",content:i("p",{style:{maxHeight:"300px",overflowY:"auto"}},JSON.stringify(e))})},b=e=>{Object.keys(e.context).length==0?s.info({title:"详情信息",content:i("p",{style:{maxHeight:"300px",overflowY:"auto"}},"模板中不存在变量")}):s.info({title:"详情信息",content:i($,{data:e,style:{maxHeight:"300px",overflowY:"auto"}})})};return B(()=>x.value,e=>{e?d({terms:[]}):l.value={}}),(e,p)=>{const g=f("pro-search"),k=j,u=f("AIcon"),C=w,T=H,I=s;return _(),y(I,{visible:"",title:"通知记录",footer:null,width:"70%",onCancel:p[0]||(p[0]=t=>r("cancel"))},{default:a(()=>[o(g,{type:"simple",columns:m,onSearch:d}),o(T,{ref:"logRef",model:"table",columns:m,request:t=>c(V).getHistory(t,n.data.id),defaultParams:{sorts:[{name:"notifyTime",order:"desc"}],terms:[{column:"notifyType$IN",value:n.data.type}]},params:c(l)},{notifyTime:a(t=>[E(M(c(Y)(t.notifyTime).format("YYYY-MM-DD HH:mm:ss")),1)]),state:a(t=>[o(C,null,{default:a(()=>[o(k,{status:t.state.value,text:t.state.text},null,8,["status","text"]),t.state.value==="error"?(_(),y(u,{key:0,type:"ExclamationCircleOutlined",style:{color:"#1d39c4",cursor:"pointer"},onClick:S=>h(t.errorStack)},null,8,["onClick"])):q("",!0)]),_:2},1024)]),action:a(t=>[o(u,{type:"ExclamationCircleOutlined",class:A(Object.keys(t.context).length==0?"disableIcon":"Icon"),onClick:S=>b(t)},null,8,["class","onClick"])]),_:1},8,["request","defaultParams","params"])]),_:1})}}});const ee=O(L,[["__scopeId","data-v-59319472"]]);export{ee as default};
