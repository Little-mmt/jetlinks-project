import{F as j,o as f,I as w,v as B,a7 as J,a9 as R,aa as S}from"./index-1730252110824.js";import{s as W,u as X,q as Y}from"./category-1730252110824.js";import{d as A,k as l,w as $,u as n,U as z,V as E,X as p,f as i,W as G,Y as H}from"./vue-1730252110824.js";const K=A({name:"modifyModal"}),se=A({...K,props:{formData:{type:Object,default:()=>{}},title:{type:String,defult:""},isAdd:{type:Number,default:0},isChild:{type:Number,default:0}},emits:["refresh"],setup(T,{expose:N,emit:I}){const s=T,y=l(),F=j.useForm,b=l([]),u=l([]),o=l([]),d=l({}),_=l({}),v=l({}),g=l(!1),a=l({name:"",sortIndex:1,description:""}),C=l({name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64个字符"}],sortIndex:[{required:!0,message:"请输入排序",trigger:"blur"},{pattern:/^\d+$/,message:"请输入正整数",trigger:"change"}]}),r=l(!1),{resetFields:q,validate:Q,validateInfos:Z}=F(a.value,C.value),D=async()=>{y.value.validate().then(async()=>{if(g.value=!0,v.value={},s.isAdd===0)s.isChild===1?v.value={...a.value,parentId:_.value.id}:s.isChild===2?v.value={parentId:_.value.id,...a.value}:s.isChild===3&&(v.value={...a.value}),(await W(v.value).finally(()=>{g.value=!1})).status===200?(f("操作成功！"),r.value=!1,I("refresh")):f("操作失败！","error");else if(s.isAdd===2){const e=d.value.id,t={...a.value,id:d.value.id,key:d.value.key,parentId:d.value.parentId};(await X(e,t).finally(()=>{g.value=!1})).status===200?(f("操作成功！"),r.value=!1,I("refresh")):f("操作失败！","error")}})},M=async e=>{s.isAdd===0?s.isChild===1?(_.value=e,e.children&&e.children.length>0&&(u.value=e.children.sort(k("sortIndex")),a.value={name:"",sortIndex:u.value[u.value.length-1].sortIndex===9999?u.value[u.value.length-1].sortIndex:u.value[u.value.length-1].sortIndex+1,description:""},r.value=!0)):s.isChild===3?(await O(),o.value=b.value.sort(k("sortIndex")),o.value.length>0&&(a.value={name:"",sortIndex:o.value[o.value.length-1].sortIndex===9999?o.value[o.value.length-1].sortIndex:o.value[o.value.length-1].sortIndex+1,description:""}),r.value=!0):s.isChild===2&&(e.level===5?(f("树形结构最多添加5层","warning"),r.value=!1):(_.value=e,a.value={name:"",sortIndex:1,description:""},r.value=!0)):s.isAdd===2&&(d.value=e,a.value={name:e.name,sortIndex:e.sortIndex,description:e.description},r.value=!0)},k=e=>function(t,h){var m=t[e],x=h[e];return m-x},O=async()=>{const t=await Y({paging:!1,sorts:[{name:"sortIndex",order:"asc"},{name:"createTime",order:"desc"}]});t.status===200&&(b.value=t.result)},U=()=>{r.value=!1,q()};return $([()=>s.isAdd],()=>{},{immediate:!1,deep:!0}),N({show:M}),(e,t)=>{const h=w,m=B,x=J,L=R,P=j,V=S;return n(r)?(z(),E(V,G({key:0,title:s.title,maskClosable:!1,"destroy-on-close":"",visible:"",onOk:D,onCancel:U,confirmLoading:n(g),okText:"确定",cancelText:"取消"},e.layout),{default:p(()=>[i(P,{layout:"vertical",ref_key:"formRef",ref:y,rules:n(C),model:n(a)},{default:p(()=>[i(m,{label:"名称",name:"name"},{default:p(()=>[i(h,{value:n(a).name,"onUpdate:value":t[0]||(t[0]=c=>n(a).name=c),placeholder:"请输入名称"},null,8,["value"])]),_:1}),i(m,{label:"排序",name:"sortIndex"},{default:p(()=>[i(x,{style:{width:"100%"},id:"inputNumber",value:n(a).sortIndex,"onUpdate:value":t[1]||(t[1]=c=>n(a).sortIndex=c),min:1,max:9999,placeholder:"请输入排序"},null,8,["value"])]),_:1}),i(m,{label:"说明"},{default:p(()=>[i(L,{value:n(a).description,"onUpdate:value":t[2]||(t[2]=c=>n(a).description=c),"show-count":"",maxlength:200,placeholder:"请输入说明"},null,8,["value"])]),_:1})]),_:1},8,["rules","model"])]),_:1},16,["title","confirmLoading"])):H("",!0)}}});export{se as _};
