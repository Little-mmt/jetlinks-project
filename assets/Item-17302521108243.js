import{d as He,ai as ta,k as O,r as ea,e as aa,ab as Ae,U as m,Z as c,f as y,X as p,_ as n,W as Ke,u as l,F as E,E as o,B as Re,$ as i,Y as k,V as $,a4 as na,a1 as oa,af as ia,ag as sa}from"./vue-1730252110824.js";import{cC as Ue,aF as Ge,d as ma,aO as la,v as ca,g as da}from"./index-1730252110824.js";import ra from"./index-1730252110824219.js";import{_ as ha}from"./ActionTypeComponent.vue_vue_type_script_setup_true_lang-1730252110824.js";import ya from"./index-1730252110824221.js";import{u as ua}from"./scene-17302521108242.js";import{i as pa,a as T,t as M}from"./util-1730252110824.js";import{_ as fa}from"./FilterGroup.vue_vue_type_script_setup_true_name_FilterGroup_lang-1730252110824.js";import{a as ga,E as We}from"./util-17302521108242.js";import{_ as Na}from"./CheckItem.vue_vue_type_script_setup_true_name_ActionCheckItem_lang-1730252110824.js";import"./CardSelect-1730252110824.js";import"./index.vue_vue_type_script_setup_true_lang-173025211082430.js";import"./index-1730252110824220.js";import"./index-1730252110824286.js";import"./NotifyWay-1730252110824.js";import"./config-17302521108242.js";import"./NotifyConfig.vue_vue_type_style_index_0_lang-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import"./const-17302521108242.js";import"./NotifyTemplate.vue_vue_type_style_index_0_lang-1730252110824.js";import"./template-1730252110824.js";import"./VariableDefinitions.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./BuildIn.vue_vue_type_script_setup_true_name_NotifyBuildIn_lang-1730252110824.js";import"./scene-1730252110824.js";import"./Org.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./Tag.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./InputFile.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./User.vue_vue_type_script_setup_true_name_NotifyUser_lang-1730252110824.js";import"./unionBy-1730252110824.js";import"./index-1730252110824218.js";import"./index-1730252110824287.js";import"./Product-17302521108243.js";import"./product-17302521108244.js";import"./category-1730252110824.js";import"./department-17302521108242.js";import"./setting-17302521108242.js";import"./index.vue_vue_type_script_setup_true_name_Device_lang-1730252110824.js";import"./TopCard-17302521108246.js";import"./Device-1730252110824.js";import"./Tag-1730252110824.js";import"./RelationSelect.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./util-17302521108245.js";import"./lodash.default-1730252110824.js";import"./throttle-1730252110824.js";import"./min-1730252110824.js";import"./isNil-1730252110824.js";import"./isUndefined-1730252110824.js";import"./difference-1730252110824.js";import"./flattenDeep-1730252110824.js";import"./sortBy-1730252110824.js";import"./uniqBy-1730252110824.js";import"./toLower-1730252110824.js";import"./index.vue_vue_type_script_setup_true_name_ActionDeviceActions_lang-1730252110824.js";import"./EditTable.vue_vue_type_script_setup_true_lang-17302521108242.js";import"./FunctionItem.vue_vue_type_script_setup_true_name_FunctionItem_lang-1730252110824.js";import"./index-1730252110824223.js";import"./typings-1730252110824.js";import"./DropdownButton.vue_vue_type_style_index_0_scoped_011bae6b_lang-1730252110824.js";import"./Menus-1730252110824.js";import"./util-17302521108243.js";import"./Time.vue_vue_type_style_index_0_lang-1730252110824.js";import"./Array.vue_vue_type_style_index_0_scoped_59b5dd9b_lang-1730252110824.js";import"./Double.vue_vue_type_script_setup_true_name_DoubleParamsDropdown_lang-1730252110824.js";import"./index-1730252110824310.js";import"./WriteProperty.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./AlarmModal-1730252110824.js";import"./useRequest-1730252110824.js";import"./useAlarmLevel-1730252110824.js";import"./config-1730252110824.js";import"./configuration-1730252110824.js";import"./DropdownButton-1730252110824.js";import"./FilterCondition.vue_vue_type_script_setup_true_name_FilterCondition_lang-1730252110824.js";import"./CheckFilterItem-1730252110824.js";const A=t=>(ia("data-v-beb082a8"),t=t(),sa(),t),ba={class:"actions-item-warp"},va={class:"actions-item"},xa={class:"item-options-warp"},ka={key:0,class:"item-options-content"},Ta={key:0},Ia=A(()=>n("span",{class:"notify-text-highlight"},"群机器人消息",-1)),Ca={class:"notify-text-highlight"},wa={key:1},Va={class:"notify-text-highlight"},Oa=["src"],Ea={class:"notify-text-highlight"},$a={class:"notify-text-highlight"},Sa={class:"notify-text-highlight"},Ba={key:1},Fa={class:"notify-text-highlight"},Pa=["src"],ja={class:"notify-text-highlight"},Da={class:"notify-text-highlight"},La={class:"notify-text-highlight"},Ma={class:"notify-text-highlight"},Aa={key:2,style:{display:"flex"}},Ka={class:"notify-text-highlight"},Ra=["src"],Ua={class:"notify-text-highlight"},Ga={class:"notify-text-highlight"},Wa={key:3},Ha={class:"notify-text-highlight"},qa=["src"],za={class:"notify-text-highlight"},Ja={class:"notify-text-highlight"},Xa={key:4},Ya={class:"notify-text-highlight"},Za=["src"],Qa={class:"notify-text-highlight"},_a={class:"notify-text-highlight"},tn={key:5},en={class:"notify-text-highlight"},an=["src"],nn={key:0,style:{display:"flex","align-items":"center"}},on={style:{"padding-left":"4px"}},sn={key:0},mn={key:1},ln={key:2},cn={class:"item-number"},dn=A(()=>n("div",{class:"actions-item-filter-warp-tip"}," 满足此条件后执行后续动作 ",-1)),rn={class:"actions-item-filter-overflow"},hn=A(()=>n("span",null,"添加过滤条件",-1)),yn=He({name:"ActionItem"}),un=He({...yn,props:{branchesName:{type:Number,default:0},thenName:{type:Number,default:0},name:{type:Number,default:0},data:{type:Object},type:{type:Object},parallel:{type:Boolean},options:{type:Object},isLast:{type:Boolean}},emits:["delete","update"],setup(t,{emit:qe}){const e=t,ze=ua(),{data:d}=ta(ze),K=O(),S=O(!1),B=O(!1),I=O("");O(ga({branch:e.branchesName,branchGroup:e.thenName,action:e.name})),ea({visible:!1,actionId:void 0});const F=aa(()=>{var r,s;return e.parallel?[]:((s=(r=d.value.branches[e.branchesName].then)==null?void 0:r[e.thenName].actions)==null?void 0:s[e.name].terms)||[]}),Je=()=>{const r=d.value.branches[e.branchesName].then[e.thenName].actions[e.name].key;We.emit(r,{isDelete:!0}),e.name!==0&&!e.parallel&&(d.value.branches[e.branchesName].then[e.thenName].actions[e.name-1].options.termsColumns=[],d.value.branches[e.branchesName].then[e.thenName].actions[e.name-1].options.terms=[],d.value.branches[e.branchesName].then[e.thenName].actions[e.name-1].terms=[]),qe("delete")},Xe=()=>{S.value=!1},Ye=()=>{const r={type:"and",key:Ge(),terms:[{column:void 0,value:{type:"fixed",value:void 0},termType:void 0,type:"and",key:Ge()}]};d.value.branches[e.branchesName].then[e.thenName].actions[e.name].terms?d.value.branches[e.branchesName].then[e.thenName].actions[e.name].terms.push(r):d.value.branches[e.branchesName].then[e.thenName].actions[e.name].terms=[r],d.value.branches[e.branchesName].then[e.thenName].actions[e.name].options.terms=[{terms:[["","eq","","and"]],termType:"并且"}]},R=()=>{S.value=!0},j=r=>{I.value=r},U=(r,s)=>{var N,f,C,v,w,x,V;const{key:u,actionId:g,terms:a}=(f=(N=d.value.branches[e.branchesName].then)==null?void 0:N[e.thenName].actions)==null?void 0:f[e.name],D=new Set([...((C=e.options)==null?void 0:C.termsColumns)||[],...((w=(v=s==null?void 0:s.otherColumns)==null?void 0:v.filter)==null?void 0:w.call(v,P=>P))||[]]),L={...r,options:{...e.options,...s,columns:[...D.values()]},key:u,actionId:g,terms:a};d.value.branches[e.branchesName].then[e.thenName].actions.splice(e.name,1,L),(V=(x=K.value)==null?void 0:x.formTouchOff)==null||V.call(x),S.value=!1,We.emit(u,r)},Ze=(r,s)=>{U(r,s),I.value=""},Qe=()=>{I.value=""},_e=[{validator(r,s){var u,g;if((s==null?void 0:s.executor)==="device"){const a=s.device;if((a==null?void 0:a.selector)==="fixed"&&(!(a!=null&&a.productId)||!((u=a==null?void 0:a.selectorValues)!=null&&u.length))||(a==null?void 0:a.selector)==="context"&&!(a!=null&&a.upperKey)||(a==null?void 0:a.selector)==="relation"&&!((g=a==null?void 0:a.selectorValues)!=null&&g.length)||(a==null?void 0:a.changeData)===!0)return Promise.reject(new Error("该数据已发生变更，请重新配置"))}else if((s==null?void 0:s.executor)==="notify"){const a=s.notify;if(!(a!=null&&a.notifierId)||!(a!=null&&a.templateId)||(a==null?void 0:a.changeData)===!0)return Promise.reject(new Error("该数据已发生变更，请重新配置"))}return Promise.resolve()}}];return(r,s)=>{const u=Ae("AIcon"),g=ma,a=Ae("Ellipsis"),D=la,L=ca;return m(),c("div",ba,[y(L,{name:["branches",t.branchesName,"then",t.thenName,"actions",t.name],rules:_e},{default:p(()=>[n("div",va,[y(Na,Ke(e,{ref_key:"checkItemRef",ref:K}),{default:p(()=>{var N,f,C,v,w,x,V,P,G,W,H,q,z,J,X,Y,Z,Q,_,tt,et,at,nt,ot,it,st,mt,lt,ct,dt,rt,ht,yt,ut,pt,ft,gt,Nt,bt,vt,xt,kt,Tt,It,Ct,wt,Vt,Ot,Et,$t,St,Bt,Ft,Pt,jt,Dt,Lt,Mt,At,Kt,Rt,Ut,Gt,Wt,Ht,qt,zt,Jt,Xt,Yt,Zt,Qt,_t,te,ee,ae,ne,oe,ie,se,me,le,ce,de,re,he,ye,ue,pe,fe,ge,Ne,be,ve,xe,ke,Te,Ie,Ce,we,Ve,Oe,Ee,$e,Se,Be,Fe,Pe;return[n("div",xa,[n("div",{class:"item-options-type",onClick:R},[y(u,{type:l(pa).get(((N=t.data)==null?void 0:N.executor)==="alarm"?t.data.alarm.mode:t.data.executor)},null,8,["type"])]),((f=t.data)==null?void 0:f.executor)==="alarm"?(m(),c("div",ka,[((v=(C=t.data)==null?void 0:C.alarm)==null?void 0:v.mode)==="trigger"?(m(),c(E,{key:0},[o(" 满足条件后将触发"),y(g,{style:{padding:"0"},type:"link",onClick:s[0]||(s[0]=Re(h=>B.value=!0,["stop"]))},{default:p(()=>[o("关联告警")]),_:1})],64)):(m(),c(E,{key:1},[o(" 满足条件后将解除"),y(g,{style:{padding:"0"},type:"link",onClick:s[1]||(s[1]=Re(h=>B.value=!0,["stop"]))},{default:p(()=>[o("关联告警")]),_:1})],64))])):((w=t.data)==null?void 0:w.executor)==="notify"?(m(),c("div",{key:1,class:"item-options-content",onClick:s[2]||(s[2]=h=>j("notify"))},[((V=(x=t.data)==null?void 0:x.notify)==null?void 0:V.notifyType)==="dingTalk"?(m(),c(E,{key:0},[((P=t.options)==null?void 0:P.provider)==="dingTalkRobotWebHook"?(m(),c("div",Ta,[o(" 通过"),Ia,o(" 发送 "),n("span",Ca,i(((G=t.options)==null?void 0:G.templateName)||((H=(W=t.data)==null?void 0:W.notify)==null?void 0:H.templateId)),1)])):(m(),c("div",wa,[o(" 通过 "),n("span",Va,[n("img",{style:{width:"18px"},src:l(T).get((z=(q=t.data)==null?void 0:q.notify)==null?void 0:z.notifyType)},null,8,Oa),o(" 钉钉 ")]),o(" "+i((J=t.options)!=null&&J.sendTo||(X=t.options)!=null&&X.orgName?"向":""),1),n("span",Ea,i(((Y=t.options)==null?void 0:Y.sendTo)||""),1),n("span",$a,i(((Z=t.options)==null?void 0:Z.orgName)||""),1),o(" 发送 "),n("span",Sa,i(((Q=t.options)==null?void 0:Q.templateName)||((tt=(_=t.data)==null?void 0:_.notify)==null?void 0:tt.templateId)),1)]))],64)):((at=(et=t.data)==null?void 0:et.notify)==null?void 0:at.notifyType)==="weixin"?(m(),c("div",Ba,[o(" 通过 "),n("span",Fa,[n("img",{style:{width:"18px"},src:l(T).get((ot=(nt=t.data)==null?void 0:nt.notify)==null?void 0:ot.notifyType)},null,8,Pa),o(" 微信 ")]),o(" "+i((it=t.options)!=null&&it.sendTo||(st=t.options)!=null&&st.orgName||(mt=t.options)!=null&&mt.tagName?"向":""),1),n("span",ja,i(((lt=t.options)==null?void 0:lt.sendTo)||""),1),n("span",Da,i(((ct=t.options)==null?void 0:ct.orgName)||""),1),n("span",La,i(((dt=t.options)==null?void 0:dt.tagName)||""),1),o(" 发送 "),n("span",Ma,i(((rt=t.options)==null?void 0:rt.templateName)||((yt=(ht=t.data)==null?void 0:ht.notify)==null?void 0:yt.templateId)),1)])):((pt=(ut=t.data)==null?void 0:ut.notify)==null?void 0:pt.notifyType)==="email"?(m(),c("div",Aa,[o(" 通过 "),n("span",Ka,[n("img",{style:{width:"18px"},src:l(T).get((gt=(ft=t.data)==null?void 0:ft.notify)==null?void 0:gt.notifyType)},null,8,Ra),o(" 邮件 ")]),o(" "+i((Nt=t.options)!=null&&Nt.sendTo?"向":""),1),n("span",Ua,[y(a,{style:{"max-width":"400px"}},{default:p(()=>{var h;return[o(i(((h=t.options)==null?void 0:h.sendTo)||""),1)]}),_:1})]),o(" 发送 "),n("span",Ga,i(((bt=t.options)==null?void 0:bt.templateName)||((xt=(vt=t.data)==null?void 0:vt.notify)==null?void 0:xt.templateId)),1)])):((Tt=(kt=t.data)==null?void 0:kt.notify)==null?void 0:Tt.notifyType)==="voice"?(m(),c("div",Wa,[o(" 通过 "),n("span",Ha,[n("img",{style:{width:"18px"},src:l(T).get((Ct=(It=t.data)==null?void 0:It.notify)==null?void 0:Ct.notifyType)},null,8,qa),o(" 语音 ")]),o(" "+i((wt=t.options)!=null&&wt.sendTo?"向":""),1),n("span",za,i(((Vt=t.options)==null?void 0:Vt.sendTo)||""),1),o(" 发送 "),n("span",Ja,i(((Ot=t.options)==null?void 0:Ot.templateName)||(($t=(Et=t.data)==null?void 0:Et.notify)==null?void 0:$t.templateId)),1)])):((Bt=(St=t.data)==null?void 0:St.notify)==null?void 0:Bt.notifyType)==="sms"?(m(),c("div",Xa,[o(" 通过 "),n("span",Ya,[n("img",{style:{width:"18px"},src:l(T).get((Pt=(Ft=t.data)==null?void 0:Ft.notify)==null?void 0:Pt.notifyType)},null,8,Za),o(" 短信 ")]),o(" "+i((jt=t.options)!=null&&jt.sendTo?"向":""),1),n("span",Qa,i(((Dt=t.options)==null?void 0:Dt.sendTo)||""),1),o(" 发送 "),n("span",_a,i(((Lt=t.options)==null?void 0:Lt.templateName)||((At=(Mt=t.data)==null?void 0:Mt.notify)==null?void 0:At.templateId)),1)])):((Rt=(Kt=t.data)==null?void 0:Kt.notify)==null?void 0:Rt.notifyType)==="webhook"?(m(),c("div",tn,[o(" 通过 "),n("span",en,[n("img",{style:{width:"18px"},src:l(T).get((Gt=(Ut=t.data)==null?void 0:Ut.notify)==null?void 0:Gt.notifyType)},null,8,an),o(" WebHook ")]),o(" 发送 "),n("span",null,i(((Wt=t.options)==null?void 0:Wt.templateName)||((qt=(Ht=t.data)==null?void 0:Ht.notify)==null?void 0:qt.templateId)),1)])):k("",!0)])):((zt=t.data)==null?void 0:zt.executor)==="delay"?(m(),c("div",{key:2,class:"item-options-content",onClick:s[3]||(s[3]=h=>j("delay"))},i((Jt=t.options)==null?void 0:Jt.name),1)):((Xt=t.data)==null?void 0:Xt.executor)==="device"?(m(),c("div",{key:3,class:"item-options-content",onClick:s[4]||(s[4]=h=>j("device"))},[["fixed","context"].includes((Zt=(Yt=t.data)==null?void 0:Yt.device)==null?void 0:Zt.selector)?(m(),c("div",nn,[y(u,{type:l(M)[((te=(_t=(Qt=t.data)==null?void 0:Qt.device)==null?void 0:_t.message)==null?void 0:te.messageType)||"INVOKE_FUNCTION"]},null,8,["type"]),n("span",on,i((ae=(ee=t.data)==null?void 0:ee.options)==null?void 0:ae.type),1),y(u,{type:"icon-mubiao",style:{padding:"0 4px"}}),y(a,{style:{"max-width":"200px","margin-right":"12px"}},{default:p(()=>{var h,b;return[o(i((b=(h=t.data)==null?void 0:h.options)==null?void 0:b.name),1)]}),_:1}),y(a,{style:{"max-width":"400px"}},{default:p(()=>{var h,b;return[o(i((b=(h=t.data)==null?void 0:h.options)==null?void 0:b.propertiesName),1)]}),_:1}),!l(Ue)((oe=(ne=t.data)==null?void 0:ne.options)==null?void 0:oe.propertiesValue)&&((se=(ie=t.data)==null?void 0:ie.options)!=null&&se.propertiesValue)?(m(),c("span",sn,"为 ")):k("",!0),y(a,{style:{"max-width":"200px"}},{default:p(()=>{var h,b,je,De,Le,Me;return[o(i(`${l(Ue)((b=(h=t.data)==null?void 0:h.options)==null?void 0:b.propertiesValue)||(De=(je=t.data)==null?void 0:je.options)!=null&&De.propertiesValue?`${(Me=(Le=t.data)==null?void 0:Le.options)==null?void 0:Me.propertiesValue}`:""}`),1)]}),_:1})])):((le=(me=t.data)==null?void 0:me.device)==null?void 0:le.selector)==="tag"?(m(),c("div",mn,[y(u,{type:l(M)[((re=(de=(ce=t.data)==null?void 0:ce.device)==null?void 0:de.message)==null?void 0:re.messageType)||"INVOKE_FUNCTION"]},null,8,["type"]),o(" "+i((ye=(he=t.data)==null?void 0:he.options)==null?void 0:ye.type)+" ",1),n("span",null,i((pe=(ue=t.data)==null?void 0:ue.options)==null?void 0:pe.tagName),1),o(" 的"+i((ge=(fe=t.data)==null?void 0:fe.options)==null?void 0:ge.productName)+" "+i((be=(Ne=t.data)==null?void 0:Ne.options)==null?void 0:be.propertiesName),1)])):((xe=(ve=t.data)==null?void 0:ve.device)==null?void 0:xe.selector)==="relation"?(m(),c("div",ln,[y(u,{type:l(M)[((Ie=(Te=(ke=t.data)==null?void 0:ke.device)==null?void 0:Te.message)==null?void 0:Ie.messageType)||"INVOKE_FUNCTION"]},null,8,["type"]),o(" "+i((we=(Ce=t.data)==null?void 0:Ce.options)==null?void 0:we.type)+"与",1),n("span",null,i((Oe=(Ve=t.data)==null?void 0:Ve.options)==null?void 0:Oe.triggerName),1),o("具有相同 "+i(($e=(Ee=t.data)==null?void 0:Ee.options)==null?void 0:$e.relationName)+"的"+i((Be=(Se=t.data)==null?void 0:Se.options)==null?void 0:Be.productName)+"设备的 "+i((Pe=(Fe=t.data)==null?void 0:Fe.options)==null?void 0:Pe.propertiesName),1)])):k("",!0)])):(m(),$(g,{key:4,onClick:R},{default:p(()=>[o("点击配置执行动作")]),_:1}))]),n("div",cn,i(t.name+1),1),y(D,{title:"确认删除？",onConfirm:Je,className:"actions-item-delete"},{default:p(()=>[y(u,{type:"DeleteOutlined"})]),_:1})]}),_:1},16)])]),_:1},8,["name"]),!t.isLast&&t.type==="serial"?(m(),c("div",{key:0,class:na(["actions-item-filter-warp",l(F).length?"filter-border":""])},[l(F).length?(m(),c(E,{key:0},[dn,n("div",rn,[(m(!0),c(E,null,oa(l(F),(N,f)=>(m(),$(fa,{key:N.key,branchName:t.branchesName,thenName:t.thenName,actionName:t.name,name:f,isLast:f===l(F).length-1,isFirst:f===0},null,8,["branchName","thenName","actionName","name","isLast","isFirst"]))),128))])],64)):(m(),c("div",{key:1,class:"filter-add-button",onClick:Ye},[y(u,{type:"PlusOutlined",style:{"padding-right":"4px"}}),hn]))],2)):k("",!0),l(S)?(m(),$(ra,{key:1,name:t.name,branchGroup:t.thenName,branchesName:t.branchesName,data:t.data,options:l(d).branches[t.branchesName].then[t.thenName].actions[t.name].options,onCancel:Xe,onSave:U},null,8,["name","branchGroup","branchesName","data","options"])):k("",!0),n("template",null,[l(I)?(m(),$(ha,Ke({key:0},e,{actionType:l(I),options:l(d).branches[t.branchesName].then[t.thenName].actions[t.name].options,onSave:Ze,onCancel:Qe}),null,16,["actionType","options"])):k("",!0)]),l(B)?(m(),$(ya,{key:2,id:l(d).id,branchId:l(d).branches[t.branchesName].branchId,actionId:l(d).branches[t.branchesName].then[t.thenName].actions[t.name].actionId,targetType:l(d).triggerType,onClose:s[5]||(s[5]=N=>B.value=!1)},null,8,["id","branchId","actionId","targetType"])):k("",!0)])}}});const Ko=da(un,[["__scopeId","data-v-beb082a8"]]);export{Ko as default};
