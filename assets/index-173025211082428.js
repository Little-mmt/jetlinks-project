import{v as z,a0 as G,aD as H,a6 as M,dw as Q,a1 as V,F as w,g as ee}from"./index-1730252110824.js";import{_ as ae}from"./EditTable.vue_vue_type_script_setup_true_lang-1730252110824.js";import{_ as se}from"./index.vue_vue_type_script_setup_true_lang-17302521108246.js";import{d as te,k as b,r as oe,w as ne,U as i,V as _,X as l,f as m,u as s,Y as T,Z as A,F as S,a1 as $,E as K,$ as W}from"./vue-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";const ue=te({__name:"index",props:{actionType:{type:String,default:""},modelValue:{type:Object,default:()=>{}},metadata:{type:Object,default:()=>({properties:[],functions:[]})}},emits:["update:modelValue"],setup(f,{expose:J,emit:L}){const I=f,P=b(),C=b(),t=oe({messageType:"READ_PROPERTY",message:{properties:void 0,functionId:void 0,inputs:[],value:void 0}}),d=b({}),k=(e,a)=>{var n;if(e){const u=(n=I.metadata)==null?void 0:n.properties.find(c=>c.id===e);d.value=u||{}}a||(t.message.value=void 0)},X=[{id:"READ_PROPERTY",name:"读取属性"},{id:"WRITE_PROPERTY",name:"修改属性"},{id:"INVOKE_FUNCTION",name:"调用功能"}],Z=()=>{},x=(e,a)=>{var n,u;if(e){const g=(((u=(n=I.metadata)==null?void 0:n.functions.find(r=>r.id===e))==null?void 0:u.inputs)||[]).map(r=>{var R,v;const O=a==null?void 0:a.find(E=>E.id===r.id);return{id:r.id,name:r.name,value:void 0,valueType:(R=r==null?void 0:r.valueType)==null?void 0:R.type,...O,required:(v=r==null?void 0:r.expands)==null?void 0:v.required}});t.message.inputs=g}};return ne(()=>I.modelValue,e=>{var a,n,u,c,g;e&&(Object.assign(t,e),(a=e==null?void 0:e.message)!=null&&a.properties&&k((n=e==null?void 0:e.message)==null?void 0:n.properties,!0),(u=e==null?void 0:e.message)!=null&&u.functionId&&x((c=e==null?void 0:e.message)==null?void 0:c.functionId,(g=e==null?void 0:e.message)==null?void 0:g.inputs))},{immediate:!0}),J({saveBtn:()=>new Promise(e=>{P.value.validate().then(async a=>{var n,u;(n=t.message.inputs)!=null&&n.length&&await((u=C.value)==null?void 0:u.onSave().catch(()=>{e(!1)})),L("update:modelValue",a),e(a)}).catch(a=>{e(a)})})}),(e,a)=>{const n=z,u=G,c=H,g=M,r=Q,O=V,R=w;return i(),_(R,{layout:"vertical",ref_key:"formRef",ref:P,model:s(t)},{default:l(()=>[m(O,{gutter:24},{default:l(()=>{var v,E,N;return[f.actionType==="command"?(i(),_(u,{key:0,span:24},{default:l(()=>[m(n,{name:"messageType",label:"指令类型",rules:{required:!0,message:"请选择指令类型"}},{default:l(()=>[m(se,{value:s(t).messageType,"onUpdate:value":a[0]||(a[0]=o=>s(t).messageType=o),options:X,onChange:Z,type:"messageType"},null,8,["value"])]),_:1})]),_:1})):T("",!0),f.actionType==="command"&&["READ_PROPERTY","WRITE_PROPERTY"].includes(s(t).messageType)||f.actionType==="latestData"?(i(),_(u,{key:1,class:"inputs",span:s(t).messageType==="READ_PROPERTY"||f.actionType==="latestData"?24:12},{default:l(()=>[m(n,{name:["message","properties"],label:"属性",rules:{required:!0,message:"请选择属性"}},{default:l(()=>[m(g,{placeholder:"请选择属性",value:s(t).message.properties,"onUpdate:value":a[1]||(a[1]=o=>s(t).message.properties=o),"show-search":"",onChange:a[2]||(a[2]=o=>k(o,!1))},{default:l(()=>{var o;return[(i(!0),A(S,null,$(((o=f.metadata)==null?void 0:o.properties)||[],p=>(i(),_(c,{key:p.id,value:p.id,label:p.name},{default:l(()=>[K(W(p.name),1)]),_:2},1032,["value","label"]))),128))]}),_:1},8,["value"])]),_:1})]),_:1},8,["span"])):T("",!0),s(t).messageType==="WRITE_PROPERTY"&&f.actionType==="command"?(i(),_(u,{key:2,span:12,class:"inputs"},{default:l(()=>[m(n,{name:["message","value"],label:"值",rules:{required:!0,message:"请输入值"}},{default:l(()=>{var o,p,j,U,h,D,Y,q,F,B;return[m(r,{modelValue:s(t).message.value,"onUpdate:modelValue":a[3]||(a[3]=y=>s(t).message.value=y),itemType:((o=s(d).valueType)==null?void 0:o.type)||s(d).type||"int",placeholder:((p=s(d).valueType)==null?void 0:p.type)==="array"?"多个数据用英文,分割":"",options:((j=s(d).valueType)==null?void 0:j.type)==="enum"?(((h=(U=s(d))==null?void 0:U.valueType)==null?void 0:h.elements)||[]).map(y=>({label:y==null?void 0:y.text,value:y==null?void 0:y.value})):((D=s(d).valueType)==null?void 0:D.type)==="boolean"?[{label:(Y=s(d).valueType)==null?void 0:Y.trueText,value:(q=s(d).valueType)==null?void 0:q.trueValue},{label:(F=s(d).valueType)==null?void 0:F.falseText,value:(B=s(d).valueType)==null?void 0:B.falseValue}]:void 0},null,8,["modelValue","itemType","placeholder","options"])]}),_:1})]),_:1})):T("",!0),s(t).messageType==="INVOKE_FUNCTION"?(i(),_(u,{key:3,span:24,class:"inputs"},{default:l(()=>[m(n,{name:["message","functionId"],label:"功能",rules:{required:!0,message:"请选择功能"}},{default:l(()=>[m(g,{placeholder:"请选择功能",value:s(t).message.functionId,"onUpdate:value":a[4]||(a[4]=o=>s(t).message.functionId=o),"show-search":"",onChange:a[5]||(a[5]=o=>x(o))},{default:l(()=>{var o;return[(i(!0),A(S,null,$(((o=f.metadata)==null?void 0:o.functions)||[],p=>(i(),_(c,{key:p.id,value:p.id,label:p.name},{default:l(()=>[K(W(p.name),1)]),_:2},1032,["value","label"]))),128))]}),_:1},8,["value"])]),_:1})]),_:1})):T("",!0),s(t).messageType==="INVOKE_FUNCTION"&&((v=s(t).message)!=null&&v.functionId)&&((N=(E=s(t).message)==null?void 0:E.inputs)!=null&&N.length)?(i(),_(u,{key:4,span:24,class:"inputs"},{default:l(()=>[m(n,{name:["message","inputs"],label:"参数列表",rules:{required:!0,message:"请输入参数列表"}},{default:l(()=>[m(ae,{ref_key:"editRef",ref:C,modelValue:s(t).message.inputs,"onUpdate:modelValue":a[6]||(a[6]=o=>s(t).message.inputs=o)},null,8,["modelValue"])]),_:1})]),_:1})):T("",!0)]}),_:1})]),_:1},8,["model"])}}});const _e=ee(ue,[["__scopeId","data-v-1a6d816e"]]);export{_e as default};
