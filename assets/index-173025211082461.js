import{dk as J,aF as D,ds as V,a0 as $,a1 as H,aH as N,af as R,g as T}from"./index-1730252110824.js";import U from"./index-173025211082458.js";import z from"./index-173025211082459.js";import O from"./index-173025211082460.js";import{u as W}from"./instance-1730252110824.js";import{m as X}from"./map-17302521108242.js";import{l as B}from"./lodash.default-1730252110824.js";import{d as Z,r as q,k as x,e as G,c as K,s as P,b as Q,U as a,V as F,X as u,f as o,Z as v,F as L,a1 as j,u as c,_ as r,a0 as Y,$ as tt}from"./vue-1730252110824.js";import"./EditTable-17302521108242.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./throttle-1730252110824.js";import"./min-1730252110824.js";import"./isNil-1730252110824.js";import"./isUndefined-1730252110824.js";import"./difference-1730252110824.js";import"./flattenDeep-1730252110824.js";import"./sortBy-1730252110824.js";import"./unionBy-1730252110824.js";import"./uniqBy-1730252110824.js";import"./toLower-1730252110824.js";const y=new Map;y.set("loading",{background:"linear-gradient(0deg, rgba(30, 165, 241, 0.03), rgba(30, 165, 241, 0.03)), #FFFFFF",boxShadow:"-2px 0px 0px #1EA5F1"});y.set("error",{background:"linear-gradient(0deg, rgba(255, 77, 79, 0.03), rgba(255, 77, 79, 0.03)), #FFFFFF",boxShadow:"-2px 0px 0px #FF4D4F"});y.set("success",{background:"linear-gradient(0deg, rgba(50, 212, 164, 0.03), rgba(50, 212, 164, 0.03)), #FFFFFF",boxShadow:"-2px 0px 0px #32D4A4"});const h=new Map;h.set("loading","processing");h.set("error","error");h.set("success","success");const et={class:"content"},st={class:"dialog",id:"dialog"},at={class:"right-log"},ot={class:"right-log-box"},rt={key:1,class:"right-log-box-empty"},nt=Z({__name:"index",setup(ct){const p=q({up:{text:"上行消息诊断中",status:"loading"},down:{text:"下行消息诊断中",status:"loading"}}),E=W(),M=x([]),m=x([]),k=x([]),w=x(),C=G(()=>(Object.keys(p)||[]).map(l=>({...p[l],key:l}))),A=()=>{var _,n,d;const I=`device-debug-${(_=E.current)==null?void 0:_.id}`,l=`/debug/device/${(n=E.current)==null?void 0:n.id}/trace`;w.value=(d=J(I,l,{}))==null?void 0:d.pipe(X(s=>s.payload)).subscribe(s=>{if(s.type==="log")k.value.push({key:D(),...s});else{const t={key:D(),...s};M.value.push(t);const f=M.value.filter(e=>e.traceId===t.traceId&&(t.downstream===e.downstream||t.upstream===e.upstream)).every(e=>!e.error);t.upstream?p.up={text:f?"上行消息通信正常":"上行消息通信异常",status:f?"success":"error"}:p.down={text:f?"下行消息通信正常":"下行消息通信异常",status:f?"success":"error"};const b=B.cloneDeep(m.value);if(b.find(e=>e.traceId===t.traceId&&t.downstream===e.downstream&&t.upstream===e.upstream)){const e=b.map(S=>(S.traceId===t.traceId&&S.list.push(t),S));m.value=B.cloneDeep(e)}else b.push({key:D(),traceId:t.traceId,downstream:t.downstream,upstream:t.upstream,list:[t]}),m.value=B.cloneDeep(b)}const i=document.getElementById("dialog");i&&(i.scrollTop=i.scrollHeight)})},g=K("topState")||"";return P(()=>{g&&(g==null?void 0:g.value)==="success"&&A()}),Q(()=>{w.value&&w.value.unsubscribe()}),(I,l)=>{const _=V,n=$,d=H,s=N,i=R;return a(),F(d,{gutter:24},{default:u(()=>[o(n,{span:16},{default:u(()=>[o(d,{gutter:24,style:{"margin-bottom":"20px"}},{default:u(()=>[(a(!0),v(L,null,j(c(C),t=>(a(),F(n,{span:12,key:t},{default:u(()=>[r("div",{style:Y(c(y).get(t.status)),class:"message-status"},[o(_,{status:c(h).get(t.status),style:{"margin-right":"5px"}},null,8,["status"]),r("span",null,tt(t.text),1)],4)]),_:2},1024))),128))]),_:1}),r("div",null,[o(s,{data:"调试"}),r("div",et,[r("div",st,[(a(!0),v(L,null,j(c(m),t=>(a(),F(U,{key:t.key,data:t},null,8,["data"]))),128))])]),r("div",null,[o(z)])])]),_:1}),o(n,{span:8},{default:u(()=>[r("div",at,[o(s,{data:"日志"}),r("div",ot,[c(k).length?(a(!0),v(L,{key:0},j(c(k),t=>(a(),F(O,{data:t,key:t.key},null,8,["data"]))),128)):(a(),v("div",rt,[o(i)]))])])]),_:1})]),_:1})}}});const Mt=T(nt,[["__scopeId","data-v-89ca759b"]]);export{Mt as default};
