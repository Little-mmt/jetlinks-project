import{X as K,h as _,Y as S,o as D,Z as Q,$ as ee,a0 as te,J as ae,a1 as se,a2 as ne,a3 as oe,g as le}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{q as ie,g as ce,u as re,r as pe}from"./channel-1730252110824.js";import{S as de,_ as ue,u as me}from"./index.vue_vue_type_script_setup_true_lang-17302521108243.js";import{l as _e}from"./lodash.default-1730252110824.js";import{d as B,k as x,ab as f,U as b,V as E,X as a,_ as l,f as s,u as c,E as T,W as fe,R as ge,$ as g,Z as he,F as ve,Y as Ce,af as ye,ag as xe}from"./vue-1730252110824.js";import"./index-1730252110824290.js";import"./GateWayFormItem-1730252110824.js";import"./GateWayDeviceModal-1730252110824.js";import"./index-1730252110824287.js";import"./validate-1730252110824.js";import"./regular-1730252110824.js";import"./throttle-1730252110824.js";import"./min-1730252110824.js";import"./isNil-1730252110824.js";import"./isUndefined-1730252110824.js";import"./difference-1730252110824.js";import"./flattenDeep-1730252110824.js";import"./sortBy-1730252110824.js";import"./unionBy-1730252110824.js";import"./uniqBy-1730252110824.js";import"./toLower-1730252110824.js";const P=h=>(ye("data-v-5ce59321"),h=h(),xe(),h),be=["src"],ke={class:"card-item-content"},Ie={style:{"font-size":"18px","font-weight":"800","line-height":"22px"}},Se=P(()=>l("div",{class:"card-item-content-text"}," 协议 ",-1)),De={class:"card-item-content-text"},Ee=P(()=>l("div",{class:"card-item-content-text"}," 说明 ",-1)),Te={class:"explain"},we=B({name:"DataCollectPage"}),Ae=B({...we,setup(h){const N=K(),v=x({}),w=x({}),C=x(!1),y=x({}),R=_("/DataCollect/device-opcua.png"),j=_("/DataCollect/device-modbus.png"),J=_("/DataCollect/s7.png"),M=_("/DataCollect/gateway.png"),$=_("/DataCollect/IEC104.png"),p=new Map;p.set("OPC_UA",R),p.set("MODBUS_TCP",j),p.set("snap7",J),p.set("iec104",$),p.set("COLLECTOR_GATEWAY",M);const A=[{title:"通道名称",dataIndex:"name",key:"name",ellipsis:!0,fixed:"left",search:{type:"string"}},{title:"通讯协议",dataIndex:"provider",key:"provider",ellipsis:!0,search:{type:"select",options:async()=>{const e=await ce();if(e.status===200){const d=e.result.filter(n=>["GATEWAY","Modbus/TCP","opc-ua","snap7","IEC104","BACNet/IP"].includes(n.name)).map(n=>n.name);return S.filter(n=>d.includes(n.alias))}}}},{title:"状态",dataIndex:"state",key:"state",ellipsis:!0,scopedSlots:!0,search:{type:"select",options:[{label:"正常",value:"enabled"},{label:"禁用",value:"disabled"}]}},{title:"运行状态",dataIndex:"runningState",key:"runningState",ellipsis:!0,scopedSlots:!0,search:{type:"select",options:[{label:"运行中",value:"running"},{label:"已停止",value:"stopped"}]}},{title:"说明",dataIndex:"description",key:"description",ellipsis:!0,search:{type:"string"}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],V=(e,d)=>{if(!e)return[];const i=e.state.value,n=i==="enabled"?"禁用":"启用";return[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{F(e)}},{key:"action",text:n,tooltip:{title:n},icon:i==="enabled"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${n}?`,onConfirm:()=>{const r=re(e.id,me[i]);return r.then(u=>{var m;u.success&&(D("操作成功","success"),(m=v.value)==null||m.reload())}),r}}},{key:"delete",text:"删除",disabled:i==="enabled",tooltip:{title:i==="enabled"?"请先禁用该通道，再删除。":"删除"},popConfirm:{placement:"topRight",title:"该操作将会删除下属采集器与点位，确定删除?",onConfirm:()=>{const r=pe(e.id);return r.then(u=>{u.success&&(D("操作成功","success"),v.value.reload())}),r}},icon:"DeleteOutlined"}]},q=()=>{y.value={},C.value=!0},F=e=>{y.value=_e.cloneDeep(e),C.value=!0},L=e=>{N.jumpPage("DataCollect/Collector",{},{channelId:e})},Y=e=>{C.value=!1,y.value={},e&&(D("操作成功","success"),v.value.reload())},O=e=>{var d;return e?((d=e==null?void 0:e.state)==null?void 0:d.value)==="enabled"?{...e==null?void 0:e.runningState}:{text:"禁用",value:"disabled"}:{}},U=e=>{w.value=e};return(e,d)=>{const i=f("pro-search"),n=f("AIcon"),k=Q,r=f("Ellipsis"),u=ee,m=te,W=ae,G=se,X=ne,Z=oe,z=f("FullPage"),H=f("page-container");return b(),E(H,null,{default:a(()=>[l("div",null,[s(i,{columns:A,target:"search-datacollect-channel",onSearch:U}),s(z,null,{default:a(()=>[s(Z,{ref_key:"tableRef",ref:v,columns:A,model:"CARD",gridColumn:3,request:c(ie),defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:c(w)},{headerTitle:a(()=>[s(k,{type:"primary",onClick:q,hasPermission:"DataCollect/Channel:add"},{icon:a(()=>[s(n,{type:"PlusOutlined"})]),default:a(()=>[T(" 新增通道 ")]),_:1})]),card:a(o=>[s(X,fe({showStatus:!0,value:o,actions:V(o,"card")},o,{status:O(o).value,statusText:O(o).text,statusNames:c(de),onClick:t=>L(o.id)}),{img:a(()=>[ge(e.$slots,"img",{},()=>[l("img",{src:c(p).get(o.provider)},null,8,be)],!0)]),content:a(()=>[l("div",ke,[s(r,{style:{width:"calc(100% - 100px)"}},{default:a(()=>[l("span",Ie,g(o.name),1)]),_:2},1024),s(G,{class:"card-item-content-box"},{default:a(()=>[s(m,{span:12},{default:a(()=>[Se,l("div",De,[s(u,null,{title:a(()=>{var t;return[T(g((t=c(S).find(I=>I.value===o.provider))==null?void 0:t.label),1)]}),default:a(()=>{var t;return[T(" "+g((t=c(S).find(I=>I.value===o.provider))==null?void 0:t.label),1)]}),_:2},1024)])]),_:2},1024),s(m,{span:12},{default:a(()=>[Ee,s(W,null,{default:a(()=>[l("div",Te,g(o.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),actions:a(t=>[s(k,{disabled:t.disabled,popConfirm:t.popConfirm,tooltip:{...t.tooltip},onClick:t.onClick,hasPermission:"DataCollect/Channel:"+t.key},{default:a(()=>[t.key==="delete"?(b(),E(n,{key:0,type:"DeleteOutlined"})):(b(),he(ve,{key:1},[s(n,{type:t.icon},null,8,["type"]),l("span",null,g(t==null?void 0:t.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["value","actions","status","statusText","statusNames","onClick"])]),_:3},8,["request","params"])]),_:3}),c(C)?(b(),E(ue,{key:0,data:c(y),onChange:Y},null,8,["data"])):Ce("",!0)])]),_:3})}}});const nt=le(Ae,[["__scopeId","data-v-5ce59321"]]);export{nt as default};
