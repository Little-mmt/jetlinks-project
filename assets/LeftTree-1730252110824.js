import{d as O,ac as K,k as h,r as R,ab as Z,U as x,Z as G,f as l,X as c,u as o,G as D,_ as y,E as M,V as L,$ as X,Y,w as z}from"./vue-1730252110824.js";import{cA as F,gy as S,a4 as E,Z as C,aC as H,o as Q,I as W,J as ee,dg as te,af as se,A as ne,g as ae}from"./index-1730252110824.js";import"./index-1730252110824281.js";import{g as oe,h as ie}from"./department-17302521108242.js";import{_ as le}from"./EditDepartmentDialog.vue_vue_type_script_setup_true_lang-1730252110824.js";const re={class:"left-tree-container"},de={class:"add-btn"},ce={class:"tree"},ue={class:"department-tree-item-content"},pe={class:"title"},T="system/Department",fe=O({__name:"LeftTree",emits:["change"],setup(me,{emit:V}){const P=K(),j=K().query.save,p=h(""),b=h(!1),w=h([]),f=new Map,m=h([]),v=h([]),u=h([]);function B(s,e){let t=[];function a(n){if(n.id===e)return!0;if(n.children){for(let i of n.children)if(a(i))return t.push(n.id),!0}return!1}for(let n of s)if(a(n))break;return t.reverse(),t}function g(s){b.value=!0;const e={paging:!1,sorts:[{name:"sortIndex",order:"asc"}]};p.value&&(e.terms=[{column:"name$LIKE",value:`%${p.value}%`}]),f.clear(),oe(e).then(t=>{var a,n;w.value=t.result.sort((i,d)=>i.sortIndex===d.sortIndex?d.createTime-i.createTime:i.sortIndex-d.sortIndex),(a=P.query)!=null&&a.id?(u.value=B(w.value,P.query.id),v.value=[P.query.id]):v.value=[(n=t.result[0])==null?void 0:n.id],A(t.result),m.value=t.result,s&&s()}).finally(()=>{b.value=!1})}const N=F(()=>{const s=p.value,e=new Map;if(s){const a=[];f.forEach(n=>{n.name.includes(s)&&(a.push(n.parentId),e.set(n.id,n))}),u.value=[],t(a),m.value=S(E([...e.values()]))}else g(),m.value=S(E([...f.values()])),u.value=[];function t(a){const n=[];a.length&&a.forEach(i=>{if(f.has(i)){const d=f.get(i);n.push(d.parentId),e.set(i,d),u.value.push(d.id),n.length>0&&t(n)}})}},500);function A(s){s&&s.map(e=>{f.set(e.id,H(E(e),["children"])),e.children&&A(e.children)})}function U(s){const e=ie(s);return e.then(()=>{Q("操作成功"),g()}),e}function q(s){window!=null&&window.onTabSaveSuccess&&(window.onTabSaveSuccess(s),setTimeout(()=>window.close(),300)),g()}const _=R({visible:!1,selectItem:{}}),I=(s={})=>{let e=s.sortIndex||1;if(!s.id){let t=[];s.parentId?t=s.children:t=m.value;const a=(t==null?void 0:t.length)>0?t==null?void 0:t.map(n=>n.sortIndex):[0];e=Math.max(...a)+1}_.selectItem={...s,sortIndex:e},_.visible=!0};return(()=>{g(j?I:void 0),z(v,s=>{V("change",s[0])})})(),(s,e)=>{const t=Z("AIcon"),a=W,n=ee,i=te,d=se,J=ne;return x(),G("div",re,[l(a,{value:o(p),"onUpdate:value":e[0]||(e[0]=r=>D(p)?p.value=r:null),onChange:o(N),placeholder:"请输入组织名称",class:"search-input",allowClear:""},{suffix:c(()=>[l(t,{type:"SearchOutlined"})]),_:1},8,["value","onChange"]),y("div",de,[l(C,{type:"primary",hasPermission:`${T}:add`,onClick:e[1]||(e[1]=r=>I())},{default:c(()=>[M(" 新增 ")]),_:1},8,["hasPermission"])]),y("div",ce,[l(J,{spinning:o(b)},{default:c(()=>[o(m).length>0?(x(),L(i,{key:0,"tree-data":o(m),"selected-keys":o(v),"onUpdate:selectedKeys":e[3]||(e[3]=r=>D(v)?v.value=r:null),expandedKeys:o(u),"onUpdate:expandedKeys":e[4]||(e[4]=r=>D(u)?u.value=r:null),fieldNames:{key:"id"},showLine:{showLeafIcon:!1},"show-icon":!0},{title:c(({name:r,data:k})=>[y("div",ue,[y("span",pe,[l(n,null,{default:c(()=>[M(X(r),1)]),_:2},1024)]),y("span",{class:"func-btns",onClick:e[2]||(e[2]=$=>$.stopPropagation())},[l(C,{hasPermission:`${T}:update`,type:"link",tooltip:{title:"编辑"},onClick:$=>I(k)},{default:c(()=>[l(t,{type:"EditOutlined"})]),_:2},1032,["hasPermission","onClick"]),l(C,{hasPermission:`${T}:add`,type:"link",tooltip:{title:"新增子组织"},onClick:$=>I({...k,id:"",parentId:k.id})},{default:c(()=>[l(t,{type:"PlusCircleOutlined"})]),_:2},1032,["hasPermission","onClick"]),l(C,{type:"link",hasPermission:`${T}:delete`,tooltip:{title:"删除"},popConfirm:{title:"确认删除？",onConfirm:()=>U(k.id)}},{default:c(()=>[l(t,{type:"DeleteOutlined"})]),_:2},1032,["hasPermission","popConfirm"])])])]),_:1},8,["tree-data","selected-keys","expandedKeys"])):(x(),L(d,{key:1,description:"暂无数据"}))]),_:1},8,["spinning"])]),o(_).visible?(x(),L(le,{key:0,visible:o(_).visible,"onUpdate:visible":e[5]||(e[5]=r=>o(_).visible=r),"tree-data":o(w),data:o(_).selectItem,onRefresh:q},null,8,["visible","tree-data","data"])):Y("",!0)])}}});const ke=ae(fe,[["__scopeId","data-v-5e307570"]]);export{ke as default};
