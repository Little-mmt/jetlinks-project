import{aQ as X,cC as H,Z as A,eE as W,fA as Y,fB as tt,fC as et,o as w,aD as st,a6 as ot,ec as at,da as lt,I as it,a9 as nt,eI as rt,g as ut}from"./index-1730252110824.js";import"./index-1730252110824303.js";import{u as ct}from"./product-17302521108245.js";import{d as M,k as i,r as pt,e as T,o as dt,ab as vt,U as b,Z as j,_ as o,E as y,f as l,X as x,u as s,G as m,F as I,a0 as _t,af as mt,ag as ft}from"./vue-1730252110824.js";import"./product-17302521108244.js";import"./encodeQuery-1730252110824.js";const C=f=>(mt("data-v-9367f0a8"),f=f(),ft(),f),gt={class:"top"},yt={class:"bottom"},xt={style:{width:"49.5%"}},Ct={class:"bottom-title"},ht=C(()=>o("div",{class:"bottom-title-text"},"模拟输入",-1)),St={class:"bottom-title-topic"},wt=C(()=>o("div",{style:{"margin-right":"5px"}},"Topic:",-1)),Tt=C(()=>o("div",{style:{"margin-right":"5px"}},"URL:",-1)),bt={style:{width:"49.5%"}},jt=C(()=>o("div",{class:"bottom-title"},[o("div",{class:"bottom-title-text"},"运行结果")],-1)),It={style:{"margin-top":"10px","margin-left":"10px"}},Pt=M({name:"DataAnalysis"}),kt=M({...Pt,setup(f){const N=`//注册设备下行数据监听器,当平台下发指令给设备时,回调将被调用,用于构造下发给设备的报文
      codec.onDownstream(function(ctx){

      });

      //注册设备上行数据监听器,当设备上行数据时,回调将被调用,用于解析设备上报的数据.
      codec.onUpstream(function(ctx){

      });
    `,P=i(null),{toggle:O}=X(P),r=ct(),d=i(""),v=i(""),k=i([]),u=i(""),c=i({}),_=i(!1),g=i(!1),n=i(""),V=pt({typescript:""}),B=T(()=>H(c.value.success)?{"margin-top":"10px","border-color":c.value.success?"green":"red"}:{"margin-top":"10px"}),E=T(()=>u.value===""),h=T(()=>{var e;return c.value.success?JSON.stringify((e=c.value.outputs)==null?void 0:e[0]):c.value.reason}),R=(e,t)=>{t.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!1}),t.languages.typescript.javascriptDefaults.setCompilerOptions({allowJs:!0,checkJs:!0,allowNonTsExtensions:!0,target:t.languages.typescript.ScriptTarget.ESNext,strictNullChecks:!1,strictPropertyInitialization:!0,strictFunctionTypes:!0,strictBindCallApply:!0,useDefineForClassFields:!0,moduleResolution:t.languages.typescript.ModuleResolutionKind.NodeJs,module:t.languages.typescript.ModuleKind.CommonJS,typeRoots:["types"],lib:["esnext"]})},F=async()=>{var t;const e=await W(r.current.messageProtocol,r.current.transportProtocol);if(e.status===200){const p=(t=e.result.routes)==null?void 0:t.map(S=>({value:S.topic}));k.value=p}},L=()=>{Y(r.current.id).then(e=>{e.success&&(V.typescript=e.result)})},J=async()=>{var t,p;const e=await tt(r.current.id);e.status===200&&(e.result?n.value=(p=(t=e.result)==null?void 0:t.configuration)==null?void 0:p.script:n.value=N)},D=async e=>{_.value=!0;const t=await rt(e);t.status===200?(_.value=!1,c.value=t==null?void 0:t.result):_.value=!1},z=async()=>{const e={provider:"jsr223",configuration:{script:n.value,lang:"javascript"}};(await et(r.current.id,e)).status===200&&(w("保存成功"),J())},Q=()=>{r.current.transportProtocol==="MQTT"?v.value!==""?(D({headers:{topic:v.value},configuration:{script:n.value,lang:"javascript"},provider:"jsr223",payload:u.value}),g.value=!0):w("请输入topic","error"):d.value!==""?(D({headers:{url:d.value},provider:"jsr223",configuration:{script:n.value,lang:"javascript"},payload:u.value}),g.value=!0):w("请输入url","error")};return dt(()=>{J(),F(),L()}),(e,t)=>{const p=st,S=ot,q=vt("AIcon"),K=at,Z=lt,$=it,U=nt;return b(),j(I,null,[o("div",null,[o("div",gt,[o("div",null,[y(" 脚本语言: "),l(S,{defaultValue:"JavaScript",style:{width:"200","margin-left":"5px"}},{default:x(()=>[l(p,{value:"JavaScript"},{default:x(()=>[y("JavaScript(ECMAScript 5)")]),_:1})]),_:1}),l(q,{type:"ExpandOutlined",style:{"margin-left":"20px"},onClick:s(O)},null,8,["onClick"])])]),o("div",{class:"edit",ref_key:"el",ref:P},[l(K,{language:"javascript",style:{height:"100%"},theme:"vs",modelValue:s(n),"onUpdate:modelValue":t[0]||(t[0]=a=>m(n)?n.value=a:null),registrationTypescript:s(V),init:R},null,8,["modelValue","registrationTypescript"])],512),o("div",yt,[o("div",xt,[o("div",Ct,[ht,o("div",St,[s(r).current.transportProtocol==="MQTT"?(b(),j(I,{key:0},[wt,l(Z,{placeholder:"请输入Topic",style:{width:"300px"},options:s(k),allowClear:!0,filterOption:(a,G)=>G.value.indexOf(a)!==-1,value:s(v),"onUpdate:value":t[1]||(t[1]=a=>m(v)?v.value=a:null)},null,8,["options","filterOption","value"])],64)):(b(),j(I,{key:1},[Tt,l($,{placeholder:"请输入URL",value:s(d),"onUpdate:value":t[2]||(t[2]=a=>m(d)?d.value=a:null),style:{width:"300px"}},null,8,["value"])],64))])]),l(U,{rows:5,placeholder:"// 二进制数据以0x开头的十六进制输入，字符串数据输入原始字符串",style:{"margin-top":"10px"},value:s(u),"onUpdate:value":t[3]||(t[3]=a=>m(u)?u.value=a:null)},null,8,["value"])]),o("div",bt,[jt,l(U,{autoSize:{minRows:5},style:_t(s(B)),value:s(h),"onUpdate:value":t[4]||(t[4]=a=>m(h)?h.value=a:null)},null,8,["style","value"])])])]),o("div",It,[l(A,{type:"primary",hasPermission:"device/Instance:update",loading:s(_),disabled:s(E),onClick:t[5]||(t[5]=a=>Q()),tooltip:{title:"需输入脚本和模拟数据后再点击"}},{default:x(()=>[y(" 调试 ")]),_:1},8,["loading","disabled"]),l(A,{hasPermission:"device/Instance:update",loading:s(_),disabled:!s(g),onClick:t[6]||(t[6]=a=>z()),style:{marginLeft:"10px"},tooltip:{title:s(g)?"":"请先调试"}},{default:x(()=>[y(" 保存 ")]),_:1},8,["loading","disabled","tooltip"])])],64)}}});const Nt=ut(kt,[["__scopeId","data-v-9367f0a8"]]);export{Nt as default};
