import{d as U,ac as se,k,e as oe,w as L,ab as R,U as i,Z as c,_ as B,f as d,u as s,G as ne,X as u,E as _,V as O,Y as m,$ as y,F as g,a1 as ie}from"./vue-1731638920964.js";import{Z as P,o as S,dp as re,dq as de,e as pe,aT as le,g as ue}from"./index-1731638920964.js";import"./index-1731638920964282.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import{b as me}from"./columns-1731638920964.js";import{u as ce}from"./instance-1731638920964.js";import{u as _e}from"./product-17316389209645.js";import{u as ye}from"./metadata-1731638920964.js";import{r as fe,a as ve}from"./metadata-17316389209642.js";import he from"./index-1731638920964100.js";import"./product-17316389209644.js";import"./encodeQuery-1731638920964.js";import"./index-1731638920964302.js";import"./BaseForm-1731638920964.js";import"./ExpandsForm.vue_vue_type_script_setup_true_name_ExpandsForm_lang-1731638920964.js";import"./data-17316389209644.js";import"./index-1731638920964291.js";import"./index-1731638920964304.js";import"./index-1731638920964284.js";import"./context-1731638920964.js";import"./lodash.default-1731638920964.js";import"./throttle-1731638920964.js";import"./min-1731638920964.js";import"./isNil-1731638920964.js";import"./isUndefined-1731638920964.js";import"./difference-1731638920964.js";import"./flattenDeep-1731638920964.js";import"./sortBy-1731638920964.js";import"./unionBy-1731638920964.js";import"./uniqBy-1731638920964.js";import"./toLower-1731638920964.js";import"./ValueTypeForm-1731638920964.js";const ke={class:"table-header"},ge={key:0,style:{width:"100px"}},xe={key:1,style:{width:"200px"}},we={key:2,style:{width:"200px"}},Ie=U({name:"BaseMetadata"}),Me=U({...Ie,props:{type:{},target:{},permission:{}},setup(F){const $=F,V=se(),f=ce(),I=_e(),N=k(!1),M=k([]),{type:o,target:v="product"}=$,Z=k({ordinary:"普通",warn:"警告",urgent:"紧急"}),q=k({device:"设备",manual:"手动",rule:"规则"}),G=k({read:"读",write:"写",report:"上报"}),Q={showTotal:(e,t)=>`第 ${t[0]} - ${t[1]} 条/总共 ${e} 条`,showSizeChanger:!0,showQuickJumper:!1,defaultPageSize:10,size:"small"},{columns:X}=me(o),j=oe(()=>{var e;return JSON.parse((v==="product"?(e=I.current)==null?void 0:e.metadata:f.current.metadata)||"{}")}),b=k(),Y=e=>{if(e){const t=j.value[o].filter(n=>n.name.indexOf(e)>-1).sort((n,p)=>(p==null?void 0:p.sortsIndex)-(n==null?void 0:n.sortsIndex));M.value=t}else M.value=j.value[o]},E=()=>{var n,p;N.value=!0;const e=v==="product"?(n=I.current)==null?void 0:n.metadata:f.current.metadata,t=JSON.parse(e||"{}");console.log(t),M.value=(p=t[o])==null?void 0:p.sort((h,w)=>(w==null?void 0:w.sortsIndex)-(h==null?void 0:h.sortsIndex)),N.value=!1};L([V.params.id,o],E,{immediate:!0});const a=ye();L(()=>a.model.importMetadata,e=>{e&&(E(),a.set("importMetadata",!1))});const H=()=>{var e;a.set("edit",!0),a.set("item",void 0),a.set("type",o),a.set("action","add"),$.target==="device"&&!((e=f.detail)!=null&&e.independentMetadata)&&S("修改物模型后会脱离产品物模型","warning")},x=new Map;x.set("events-add","eventNotInsertable"),x.set("events-updata","eventNotModifiable"),x.set("properties-add","propertyNotInsertable"),x.set("properties-updata","propertyNotModifiable");const C=(e,t)=>v==="device"&&(f.detail.features||[]).find(n=>n.id===x.get(`${t}-${e}`)),K=e=>{var t;a.model.edit=!0,a.model.item=e,a.model.type=o,a.model.action="edit",$.target==="device"&&!((t=f.detail)!=null&&t.independentMetadata)&&S("修改物模型后会脱离产品物模型","warning")},W=async()=>{const{id:e}=V.params;v==="device"?await f.refresh(e):await I.getDetail(e),a.set("importMetadata",!0)},ee=async e=>{const t=fe(o,[e],v==="device"?f.current:I.detail);(await ve(v,t)).status===200?(S("操作成功！"),a.model.edit=!1,a.model.item={},W()):S("操作失败！","error")};return(e,t)=>{const n=re,p=R("AIcon"),h=R("Ellipsis"),w=de,te=pe,ae=le;return i(),c(g,null,[B("div",ke,[B("div",null,[d(n,{value:s(b),"onUpdate:value":t[0]||(t[0]=r=>ne(b)?b.value=r:null),placeholder:"请输入名称",onSearch:Y,allowClear:""},null,8,["value"])]),B("div",null,[d(P,{type:"primary",hasPermission:`${e.permission}:update`,key:"add",onClick:H,disabled:C("add",s(o)),tooltip:{title:C("add",s(o))?"当前的存储方式不支持新增":"新增"}},{icon:u(()=>[d(p,{type:"PlusOutlined"})]),default:u(()=>[_(" 新增 ")]),_:1},8,["hasPermission","disabled","tooltip"]),s(a).model.edit?(i(),O(he,{key:0,type:s(v),tabs:s(o),onRefresh:E},null,8,["type","tabs"])):m("",!0)])]),d(ae,{loading:s(N),"data-source":s(M),columns:s(X),"row-key":"id",model:"TABLE",size:"small",pagination:Q},{bodyCell:u(({column:r,record:l})=>{var z,A,D,J;return[r.dataIndex==="id"?(i(),c("div",ge,[d(h,null,{default:u(()=>[_(y(l.id||"-"),1)]),_:2},1024)])):m("",!0),r.dataIndex==="name"?(i(),c("div",xe,[d(h,null,{default:u(()=>[_(y(l.name||"-"),1)]),_:2},1024)])):m("",!0),r.dataIndex==="description"?(i(),c("div",we,[d(h,null,{default:u(()=>[_(y(l.description||"-"),1)]),_:2},1024)])):m("",!0),r.dataIndex==="level"?(i(),c(g,{key:3},[_(y(s(Z)[(z=l.expands)==null?void 0:z.level]||"-"),1)],64)):m("",!0),r.dataIndex==="async"?(i(),c(g,{key:4},[_(y(l.async?"是":"否"),1)],64)):m("",!0),r.dataIndex==="valueType"?(i(),c(g,{key:5},[_(y((A=l.valueType)==null?void 0:A.type),1)],64)):m("",!0),r.dataIndex==="source"?(i(),c(g,{key:6},[_(y(s(q)[(D=l.expands)==null?void 0:D.source]),1)],64)):m("",!0),r.dataIndex==="type"?(i(!0),c(g,{key:7},ie(((J=l.expands)==null?void 0:J.type)||[],T=>(i(),O(w,{key:T},{default:u(()=>[_(y(s(G)[T]),1)]),_:2},1024))),128)):m("",!0),r.dataIndex==="action"?(i(),O(te,{key:8},{default:u(()=>[d(P,{"has-permission":`${e.permission}:update`,type:"link",key:"edit",style:{padding:"0"},disabled:C("updata",s(o)),onClick:T=>K(l),tooltip:{title:C("updata",s(o))?"当前的存储方式不支持编辑":"编辑"}},{default:u(()=>[d(p,{type:"EditOutlined"})]),_:2},1032,["has-permission","disabled","onClick","tooltip"]),d(P,{"has-permission":`${e.permission}:delete`,type:"link",key:"delete",style:{padding:"0"},danger:"","pop-confirm":{title:"确认删除？",onConfirm:async()=>{await ee(l)}},tooltip:{title:"删除"}},{default:u(()=>[d(p,{type:"DeleteOutlined"})]),_:2},1032,["has-permission","pop-confirm"])]),_:2},1024)):m("",!0)]}),_:1},8,["loading","data-source","columns"])],64)}}});const nt=ue(Me,[["__scopeId","data-v-3f224012"]]);export{nt as default};
