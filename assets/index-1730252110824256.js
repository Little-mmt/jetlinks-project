import{a as oe,u as le,i as de,o as y,L as Z,aa as ce,C as re,cU as ue,$ as me,d as fe,Z as pe,aL as he,aM as _e,aN as ve,J as ye,A as ge,g as ke}from"./index-1730252110824.js";import"./index-1730252110824291.js";import{M as Ce}from"./index-1730252110824277.js";import be from"./index-1730252110824258.js";import xe from"./index-1730252110824255.js";import Se from"./index-1730252110824254.js";import{i as Le}from"./data-17302521108247.js";import{d as je,e as we,u as Ie,b as z,s as Ne}from"./noticeRule-1730252110824.js";import{d as Ae,k as f,s as Be,ab as Ve,U as m,Z as g,f as a,X as s,_ as u,$ as V,u as n,a4 as K,Y as j,a8 as $e,E as w,V as $,F as Me,n as X,af as Je,ag as Ee}from"./vue-1730252110824.js";import"./index-1730252110824286.js";import"./NotifyWay-17302521108242.js";import"./NotifyConfig-17302521108242.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import"./config-17302521108242.js";import"./const-17302521108242.js";import"./NotifyTemplate-17302521108242.js";import"./template-1730252110824.js";import"./VariableDefinitions.vue_vue_type_script_setup_true_lang-17302521108242.js";import"./BuildIn.vue_vue_type_script_setup_true_name_NotifyBuildIn_lang-17302521108242.js";import"./Tag.vue_vue_type_script_setup_true_lang-17302521108242.js";import"./InputFile.vue_vue_type_script_setup_true_lang-17302521108242.js";import"./index-1730252110824257.js";import"./user-17302521108242.js";const Re=l=>(Je("data-v-a7b02455"),l=l(),Ee(),l),Te={class:"child-item"},De={class:"child-item-left"},Oe={style:{color:"#333333"}},qe={key:0},Fe={key:1},Ue={key:0,class:"child-item-left-auth-lock"},Ze={key:1,class:"child-item-left-auth-key"},ze=Re(()=>u("span",{class:"child-item-left-auth-text"},"权限控制",-1)),Ke={class:"box-item"},Xe={class:"box-item-img"},Ye=["src"],Ge={class:"box-item-text"},He=Ae({__name:"index",props:{data:{type:Object,default:()=>{}},isLast:{type:Boolean,default:!1},provider:{type:String,default:""}},emits:["refresh"],setup(l,{emit:h}){const o=l,k=f(!1),I=f(!1),L=f(!1),C=f({}),b=f(!1),M=f([]),N=f(!1),p=f(!1),A=oe(),J=le(),E=A.hasPermission("system/NoticeRule:action"),R=A.hasPermission("system/NoticeRule:add"),T=A.hasPermission("system/NoticeRule:update");Be(()=>{var t,e,r,i,c;b.value=((e=(t=o.data)==null?void 0:t.state)==null?void 0:e.value)==="enabled",M.value=((c=(i=(r=o.data)==null?void 0:r.grant)==null?void 0:i.role)==null?void 0:c.idList)||[]});const Y=()=>{k.value=!0,C.value={providerId:o.data.id}},G=t=>{C.value=t,I.value=!0},H=t=>{C.value=t,k.value=!0},Q=async t=>{t&&(await je(t)).status===200&&(y("操作成功！"),h("refresh"))},W=()=>{L.value=!0},P=t=>{const e={grant:{role:{idList:t||[]},permissions:o.provider==="alarm"?[{id:"alarm-config",actions:["query"]}]:[]}};p.value=!0,we(o.data.id,e).then(r=>{r.status===200&&(y("操作成功！","success"),L.value=!1,h("refresh"))}).finally(()=>{p.value=!1})},B=t=>{var e,r;if(t)if(o.data.id&&((e=o.data.channels)!=null&&e.length)&&o.data.channels.find(i=>i.channelProvider==="inside-mail"))p.value=!0,z(o.data.id,"enable").then(i=>{i.status===200&&(y("操作成功！"),h("refresh"))}).finally(()=>{p.value=!1});else{const i={...o.data,state:"enabled",grant:!((r=o.data.grant)!=null&&r.role)&&o.provider==="alarm"?{role:{idList:[]},permissions:[{id:"alarm-config",actions:["query"]}]}:o.data.grant,channels:[{name:"站内信",channelProvider:"inside-mail",grant:{role:{idList:[]},permissions:o.provider==="alarm"?[{id:"alarm-config",actions:["query"]}]:[]}}]};p.value=!0,Ne([i]).then(c=>{c.status===200&&(y("操作成功！","success"),h("refresh"))}).finally(()=>{p.value=!1})}else z(o.data.id,"disable").then(i=>{i.status===200&&(y("操作成功！"),h("refresh"))})},ee=t=>{var i;const e=Z.get((i=J.userInfos)==null?void 0:i.username)||{};(t?e==null?void 0:e.open:e==null?void 0:e.close)||t?B(t):ce.confirm({title:t?"开启后默认平台所有用户都能接收到该通知":"关闭后平台所有用户都不能接收到该通知",cancelText:"取消",okText:t?"确认开启":"确认关闭",content:X("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:"20px"}},[X(re,{onChange:c=>{var x,_,v;Z.set((x=J.userInfos)==null?void 0:x.username,t?{...e,open:(_=c.target)==null?void 0:_.checked}:{...e,close:(v=c.target)==null?void 0:v.checked})}},"不再提示")]),onOk(){B(t)},onCancel(){}})},te=t=>{N.value=!0,Ie(o.data.id,[t]).then(e=>{e.status===200&&(y("操作成功！","success"),k.value=!1,h("refresh"))}).finally(()=>{N.value=!1})};return(t,e)=>{var D,O,q;const r=ue,i=me,c=Ve("AIcon"),x=fe,_=pe,v=he,ae=_e,ne=ve,se=ye,ie=ge;return m(),g(Me,null,[a(ie,{spinning:n(p)},{default:s(()=>{var S,F;return[u("div",Te,[u("div",De,[u("div",Oe,V((S=l.data)==null?void 0:S.name),1),u("div",null,[a(i,{title:n(E)?"":"暂无权限，请联系管理员"},{default:s(()=>[a(r,{disabled:!n(E),onChange:ee,checked:n(b)},null,8,["disabled","checked"])]),_:1},8,["title"])]),n(de)?(m(),g("div",{key:0,class:K(["child-item-left-auth",{disabled:!n(b)}])},[a(i,null,{title:s(()=>[n(T)?(m(),g("div",Fe," 通过角色控制【"+V(l.data.name)+"】的所有的通知方式可被哪些用户订阅。 ",1)):(m(),g("span",qe,"暂无权限，请联系管理员"))]),default:s(()=>[a(x,{disabled:!n(T)||!n(b),type:"text",onClick:W},{default:s(()=>[n(M).length?(m(),g("span",Ze,[a(c,{type:"KeyOutlined"})])):(m(),g("span",Ue,[a(c,{type:"LockFilled"})])),ze]),_:1},8,["disabled"])]),_:1})],2)):j("",!0)]),u("div",{class:K(["child-item-right",{disabled:!n(b)}])},[a(Ce,{data:(F=l.data)==null?void 0:F.channels},{card:s(d=>[u("div",Ke,[a(ne,null,$e({default:s(()=>[u("div",Xe,[u("img",{style:{width:"100%"},src:n(Le).get(d==null?void 0:d.channelProvider)},null,8,Ye)])]),_:2},[(d==null?void 0:d.channelProvider)!=="inside-mail"?{name:"overlay",fn:s(()=>[a(ae,{mode:""},{default:s(()=>[a(v,null,{default:s(()=>[a(_,{onClick:U=>G(d),type:"link",hasPermission:!0},{default:s(()=>[w(" 查看 ")]),_:2},1032,["onClick"])]),_:2},1024),a(v,null,{default:s(()=>[a(_,{onClick:U=>H(d),type:"link",hasPermission:["system/NoticeRule:update"]},{default:s(()=>[w(" 编辑 ")]),_:2},1032,["onClick"])]),_:2},1024),a(v,null,{default:s(()=>[a(_,{onClick:U=>Q(d.id),danger:"",type:"link",hasPermission:["system/NoticeRule:delete"]},{default:s(()=>[w(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),key:"0"}:void 0]),1024),u("div",Ge,[a(se,null,{default:s(()=>[w(V(d==null?void 0:d.name),1)]),_:2},1024)])])]),_:1},8,["data"]),a(i,{title:n(R)?"":"暂无权限，请联系管理员"},{default:s(()=>[a(x,{class:"box-item-add",disabled:!n(R),onClick:Y},{default:s(()=>[a(c,{type:"PlusOutlined"})]),_:1},8,["disabled"])]),_:1},8,["title"])],2)])]}),_:1},8,["spinning"]),n(k)?(m(),$(be,{key:0,data:n(C),onClose:e[0]||(e[0]=S=>k.value=!1),onSave:te,loading:n(N),provider:l.provider,name:l.data.name},null,8,["data","loading","provider","name"])):j("",!0),n(I)?(m(),$(xe,{key:1,data:n(C),onClose:e[1]||(e[1]=S=>I.value=!1)},null,8,["data"])):j("",!0),n(L)?(m(),$(Se,{key:2,data:(q=(O=(D=l.data)==null?void 0:D.grant)==null?void 0:O.role)==null?void 0:q.idList,onClose:e[2]||(e[2]=S=>L.value=!1),onSave:P,name:l.data.name},null,8,["data","name"])):j("",!0)],64)}}});const Lt=ke(He,[["__scopeId","data-v-a7b02455"]]);export{Lt as default};
