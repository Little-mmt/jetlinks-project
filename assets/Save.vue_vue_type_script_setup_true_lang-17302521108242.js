import{er as J,es as R,o as E,d as L,aD as U,a6 as V,v as D,F as I,el as A}from"./index-1730252110824.js";import"./index-1730252110824302.js";import{u as M}from"./instance-1730252110824.js";import{d as T,k as v,r as $,s as q,o as P,ab as X,U as i,V as y,X as n,_ as k,f as p,E as h,u,Z as S,F as j,a1 as N,$ as Z,J as z}from"./vue-1730252110824.js";const G={style:{display:"flex","justify-content":"space-between","align-items":"center"}},ee=T({__name:"Save",emits:["close","save"],setup(H,{emit:g}){const _=v(),o=$({}),b=v([]),d=M(),f=v([]);q(()=>{var e;const a=((e=d.current)==null?void 0:e.relations)||[];f.value=a,a.map(t=>{o[t.relation]=[...((t==null?void 0:t.related)||[]).map(s=>JSON.stringify(s))]})}),P(()=>{J().then(a=>{a.status===200&&(b.value=a.result.map(e=>({...e,label:e.name,value:JSON.stringify({id:e.id,name:e.name})})))})});const w=()=>{g("close"),_.value.resetFields()},C=()=>{_.value.validate().then(async()=>{const a=z(o);if(Object.keys(a).length>0){const e=[];Object.keys(a).forEach(t=>{const s=f.value.find(r=>r.relation===t),m=(a[t]||[]).map(r=>JSON.parse(r));s&&e.push({relatedType:"user",relation:s.relation,description:"",related:[...m]})}),e.length&&d.current.id&&(await R(d.current.id,e)).status===200&&(E("操作成功！"),g("save"),_.value.resetFields())}})};return(a,e)=>{const t=X("AIcon"),s=L,m=U,r=V,O=D,x=I,B=A;return i(),y(B,{placement:"right",closable:!1,visible:!0},{title:n(()=>[k("div",G,[k("span",null,[p(t,{type:"CloseOutlined",style:{"margin-right":"5px"},onClick:w}),h("编辑")]),p(s,{type:"primary",onClick:C},{default:n(()=>[h("保存")]),_:1})])]),default:n(()=>[p(x,{layout:"vertical",ref_key:"formRef",ref:_,model:u(o)},{default:n(()=>[(i(!0),S(j,null,N(u(f),(l,F)=>(i(),y(O,{name:l.relation,label:l.relationName,key:F},{default:n(()=>[p(r,{showSearch:"",mode:"multiple",value:u(o)[l.relation],"onUpdate:value":c=>u(o)[l.relation]=c,placeholder:`请选择${l.relationName}`},{default:n(()=>[(i(!0),S(j,null,N(u(b),c=>(i(),y(m,{value:c.value,key:c.id},{default:n(()=>[h(Z(c.name),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]),_:2},1032,["name","label"]))),128))]),_:1},8,["model"])]),_:1})}}});export{ee as _};
