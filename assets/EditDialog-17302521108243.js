import{ay as c,o as D,I,v as B,aD as F,a6 as $,a0 as V,a1 as J,a9 as M,F as z,aa as Z,g as A}from"./index-1730252110824.js";import{d as X,k as v,e as G,r as H,U as p,V as b,X as n,f as l,u as t,Z as x,F as k,a1 as q,E as L,$ as C,af as K,ag as Q,_ as U}from"./vue-1730252110824.js";const de=s=>c.post("/relation/_query/",s),W=()=>c.get("/relation/types"),Y=s=>c.post("/relation",s),ee=s=>c.patch("/relation",s),ie=s=>c.remove(`/relation/${s}`),ae=s=>c.get("/relation/_validate",s),N=s=>(K("data-v-d0bc897f"),s=s(),Q(),s),te=N(()=>U("span",{class:"example"},"正向关系示例：用户张三是001号视频设备的管理员",-1)),oe=N(()=>U("span",{class:"example"},"反向关系示例：001号视频设备是用户张三的管辖设备",-1)),le=X({__name:"EditDialog",props:{visible:{type:Boolean},data:{}},emits:["refresh","update:visible"],setup(s,{emit:m}){const _=s,g=v(!1),f=v([]),R=G(()=>_.data.id?"编辑":"新增"),w=()=>{var r;g.value=!0,(r=y.value)==null||r.validate().then(()=>e.submit()).then(a=>{a.status===200&&(D("操作成功"),m("refresh"),m("update:visible",!1))}).finally(()=>g.value=!1)},y=v(),e=H({data:_.data,rules:{checkRelation:async(r,a)=>{const i=new RegExp("^[0-9a-zA-Z_\\\\-]+$");return a?i.test(a)?e.rules.checkUnique():Promise.reject("标识只能由数字、字母、下划线、中划线组成"):Promise.reject("")},checkUnique:()=>{var r;if(!((r=_.data)!=null&&r.id||!e.data.relation||!e.data.objectType||!e.data.targetType))return new Promise(async(a,i)=>{const{result:d}=await ae({relation:e.data.relation,objectType:e.data.objectType,targetType:e.data.targetType});d.passed?a(""):i(d.reason)})}},handleObjectTypeChange:()=>{e.data.targetType=void 0,e.rules.checkUnique()},objectList:[],getObjectList:()=>{W().then(r=>{e.objectList=r.result,f.value=r.result})},submit:()=>{var i,d;const r={...e.data,objectTypeName:(i=e.objectList.find(u=>u.id===e.data.objectType))==null?void 0:i.name,targetTypeName:(d=f.value.find(u=>u.id===e.data.targetType))==null?void 0:d.name};return(_.data.id?ee:Y)(r)}}),j=async(r,a)=>a&&e.data.reverseName===e.data.name?Promise.reject("不能使用相同的关系名称"):Promise.resolve();return e.getObjectList(),(r,a)=>{const i=I,d=B,u=F,h=$,T=V,O=J,E=M,P=z,S=Z;return p(),b(S,{visible:"",title:t(R),maskClosable:!1,width:"675px",onOk:w,onCancel:a[6]||(a[6]=o=>m("update:visible",!1)),confirmLoading:t(g),class:"edit-dialog-container"},{default:n(()=>[l(P,{ref_key:"formRef",ref:y,model:t(e).data,layout:"vertical"},{default:n(()=>[l(d,{name:"relation",label:"关系标识",rules:[{required:!0,message:"请输入标识"},{max:64,message:"最多可输入64个字符"},{validator:t(e).rules.checkRelation,trigger:"change"}]},{default:n(()=>[l(i,{value:t(e).data.relation,"onUpdate:value":a[0]||(a[0]=o=>t(e).data.relation=o),placeholder:"请输入标识",disabled:!!t(e).data.id},null,8,["value","disabled"])]),_:1},8,["rules"]),l(O,{gutter:24},{default:n(()=>[l(T,{span:12},{default:n(()=>[l(d,{name:"objectType",label:"关联方",rules:[{required:!0,message:"请选择关联方"}]},{default:n(()=>[l(h,{value:t(e).data.objectType,"onUpdate:value":a[1]||(a[1]=o=>t(e).data.objectType=o),disabled:!!t(e).data.id,onChange:t(e).handleObjectTypeChange,placeholder:"请选择关联方"},{default:n(()=>[(p(!0),x(k,null,q(t(e).objectList,o=>(p(),b(u,{value:o.id},{default:n(()=>[L(C(o.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","disabled","onChange"])]),_:1})]),_:1}),l(T,{span:12},{default:n(()=>[l(d,{name:"targetType",label:"被关联方",rules:[{required:!0,message:"请选择被关联方"}]},{default:n(()=>[l(h,{value:t(e).data.targetType,"onUpdate:value":a[2]||(a[2]=o=>t(e).data.targetType=o),disabled:!!t(e).data.id,onChange:t(e).rules.checkUnique,placeholder:"请选择被关联方"},{default:n(()=>[(p(!0),x(k,null,q(t(f),o=>(p(),b(u,{value:o.id},{default:n(()=>[L(C(o.name),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value","disabled","onChange"])]),_:1})]),_:1})]),_:1}),l(d,{label:"正向关系名称",name:"name",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"},{required:!0,validator:j,trigger:"blur"}]},{default:n(()=>[l(i,{value:t(e).data.name,"onUpdate:value":a[3]||(a[3]=o=>t(e).data.name=o),placeholder:"请输入名称"},null,8,["value"]),te]),_:1},8,["rules"]),l(d,{label:"反向关系名称",name:"reverseName",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"},{required:!0,validator:j,trigger:"blur"}]},{default:n(()=>[l(i,{value:t(e).data.reverseName,"onUpdate:value":a[4]||(a[4]=o=>t(e).data.reverseName=o),placeholder:"请输入名称"},null,8,["value"]),oe]),_:1},8,["rules"]),l(d,{name:"description",label:"说明"},{default:n(()=>[l(E,{value:t(e).data.description,"onUpdate:value":a[5]||(a[5]=o=>t(e).data.description=o),placeholder:"请输入说明","show-count":"",maxlength:200},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","confirmLoading"])}}});const se=A(le,[["__scopeId","data-v-d0bc897f"]]),ue=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));export{se as E,W as a,ue as b,ie as d,de as g};
