import{F as U,d3 as E,aF as P,K as R,M as q,g as G}from"./index-1731638920964.js";import"./index-1731638920964276.js";import X from"./index-1731638920964224.js";import L from"./List-1731638920964.js";import"./Item-17316389209643.js";import{d as Y,ai as Z,k as I,w as z,U as K,Z as H,_ as m,V as J,u as s,Y as Q,f as h,X as f,G as W,af as tt,ag as et,E as O}from"./vue-1731638920964.js";import{u as ot}from"./scene-17316389209642.js";import{b as at}from"./scene-1731638920964.js";import{i as it}from"./configuration-1731638920964.js";import"./index-1731638920964279.js";import"./index-1731638920964291.js";import"./index-1731638920964219.js";import"./ActionTypeComponent.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./index.vue_vue_type_script_setup_true_lang-173163892096430.js";import"./index-1731638920964220.js";import"./index-1731638920964286.js";import"./NotifyWay-1731638920964.js";import"./config-17316389209642.js";import"./NotifyConfig.vue_vue_type_style_index_0_lang-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import"./const-17316389209642.js";import"./NotifyTemplate.vue_vue_type_style_index_0_lang-1731638920964.js";import"./template-1731638920964.js";import"./VariableDefinitions.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./BuildIn.vue_vue_type_script_setup_true_name_NotifyBuildIn_lang-1731638920964.js";import"./Org.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./Tag.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./InputFile.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./User.vue_vue_type_script_setup_true_name_NotifyUser_lang-1731638920964.js";import"./unionBy-1731638920964.js";import"./index-1731638920964218.js";import"./index-1731638920964287.js";import"./Product-17316389209643.js";import"./product-17316389209644.js";import"./category-1731638920964.js";import"./department-17316389209642.js";import"./setting-17316389209642.js";import"./index.vue_vue_type_script_setup_true_name_Device_lang-1731638920964.js";import"./TopCard-17316389209646.js";import"./Device-1731638920964.js";import"./Tag-1731638920964.js";import"./RelationSelect.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./util-17316389209642.js";import"./util-17316389209645.js";import"./lodash.default-1731638920964.js";import"./throttle-1731638920964.js";import"./min-1731638920964.js";import"./isNil-1731638920964.js";import"./isUndefined-1731638920964.js";import"./difference-1731638920964.js";import"./flattenDeep-1731638920964.js";import"./sortBy-1731638920964.js";import"./uniqBy-1731638920964.js";import"./toLower-1731638920964.js";import"./index.vue_vue_type_script_setup_true_name_ActionDeviceActions_lang-1731638920964.js";import"./EditTable.vue_vue_type_script_setup_true_lang-17316389209642.js";import"./FunctionItem.vue_vue_type_script_setup_true_name_FunctionItem_lang-1731638920964.js";import"./index-1731638920964223.js";import"./typings-1731638920964.js";import"./DropdownButton.vue_vue_type_style_index_0_scoped_011bae6b_lang-1731638920964.js";import"./Menus-1731638920964.js";import"./util-17316389209643.js";import"./Time.vue_vue_type_style_index_0_lang-1731638920964.js";import"./Array.vue_vue_type_style_index_0_scoped_59b5dd9b_lang-1731638920964.js";import"./Double.vue_vue_type_script_setup_true_name_DoubleParamsDropdown_lang-1731638920964.js";import"./index-1731638920964310.js";import"./WriteProperty.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./CardSelect-1731638920964.js";import"./index-1731638920964221.js";import"./AlarmModal-1731638920964.js";import"./useRequest-1731638920964.js";import"./useAlarmLevel-1731638920964.js";import"./config-1731638920964.js";import"./util-1731638920964.js";import"./FilterGroup.vue_vue_type_script_setup_true_name_FilterGroup_lang-1731638920964.js";import"./DropdownButton-1731638920964.js";import"./FilterCondition.vue_vue_type_script_setup_true_name_FilterCondition_lang-1731638920964.js";import"./CheckFilterItem-1731638920964.js";import"./CheckItem.vue_vue_type_script_setup_true_name_ActionCheckItem_lang-1731638920964.js";const x=r=>(tt("data-v-9cafebd0"),r=r(),et(),r),nt={class:"actions"},rt={class:"actions-title"},st=x(()=>m("span",null,"执行",-1)),mt={class:"actions-warp"},lt=x(()=>m("span",null,[O(" 串行 "),m("span",{class:"panel-tip"}," 按顺序依次执行动作，适用于基于动作输出参数，判断是否执行后续动作的场景 ")],-1)),pt={class:"actions-list"},ct=x(()=>m("span",null,[O(" 并行 "),m("span",{class:"panel-tip"}," 同时执行所有动作，适用于不需要关注执行动作先后顺序和结果的场景 ")],-1)),dt={class:"actions-list"},ut=Y({__name:"index",props:{name:{type:Number,default:0},thenOptions:{type:Array,default:()=>[]},openShakeLimit:{type:Boolean,default:!1},groupIndex:{type:Number,default:0}},emits:["update","add"],setup(r,{emit:ht}){const n=r,M=ot(),{data:a}=Z(M),v=U.useInjectFormItemContext(),_=I(["1"]),b=I([]),d=I([]),V=I(!1);z(()=>n.thenOptions,l=>{b.value=l.filter(o=>o.parallel),d.value=l.filter(o=>!o.parallel);const e=d.value.some(o=>!!o.actions.length),i=b.value.some(o=>{var t;return!!((t=o.actions)!=null&&t.length)});!V.value&&i&&(_.value=!d.value.length||!e?["2"]:["1","2"])},{deep:!0,immediate:!0});const g=async(l,e)=>{var t,u,c,N,A,S,C,F,$;const i=n.thenOptions.findIndex(p=>p.parallel===e),o=(u=(t=a.value.branches)==null?void 0:t[n.name].then)==null?void 0:u[i].actions.findIndex(p=>p.key===l);if(o!==-1){const p=(N=(c=a.value.branches)==null?void 0:c[n.name].then)==null?void 0:N[i].actions[o];if(p.executor==="alarm"){const j=(A=a.value.branches)==null?void 0:A[n.name].branchId,y=await at({terms:[{terms:[{column:"id$rule-bind-alarm",value:`${a.value.id}:${p.actionId||j}`},{column:"id$rule-bind-alarm",value:`${a.value.id}:-1`,type:"or"}]}]});y.success&&y.result.total?E.confirm({title:`已关联 ${y.result.total} 条告警，删除该执行动作会同步解除对应的关联告警，确认删除？`,onOk(){var w,B;const D=y.result.data.map(T=>({alarmId:T.id,ruleId:a.value.id,branchIndex:p.actionId}));it(D),(B=(w=a.value.branches)==null?void 0:w[n.name].then)==null||B[i].actions.splice(o,1),v.onFieldChange()}}):((C=(S=a.value.branches)==null?void 0:S[n.name].then)==null||C[i].actions.splice(o,1),v.onFieldChange())}else($=(F=a.value.branches)==null?void 0:F[n.name].then)==null||$[i].actions.splice(o,1),v.onFieldChange()}},k=(l,e)=>{var o,t,u;const i=n.thenOptions.findIndex(c=>c.parallel===e);if(i!==-1)(t=(o=a.value.branches)==null?void 0:o[n.name].then)==null||t[i].actions.push(l);else{const c={parallel:e,key:P(),actions:[l]};(u=a.value.branches)==null||u[n.name].then.push(c)}v.onFieldChange()};return(l,e)=>{const i=R,o=q;return K(),H("div",nt,[m("div",rt,[st,n.openShakeLimit?(K(),J(X,{key:0,value:s(a).branches[r.name].shakeLimit,"onUpdate:value":e[0]||(e[0]=t=>s(a).branches[r.name].shakeLimit=t)},null,8,["value"])):Q("",!0)]),m("div",mt,[h(o,{activeKey:s(_),"onUpdate:activeKey":e[5]||(e[5]=t=>W(_)?_.value=t:null)},{default:f(()=>[h(i,{key:"1"},{header:f(()=>[lt]),default:f(()=>[m("div",pt,[h(s(L),{type:"serial",branchesName:r.name,parallel:!1,actions:s(d).length?s(d)[0].actions:[],onAdd:e[1]||(e[1]=t=>k(t,!1)),onDelete:e[2]||(e[2]=t=>g(t,!1))},null,8,["branchesName","actions"])])]),_:1}),h(i,{key:"2"},{header:f(()=>[ct]),default:f(()=>[m("div",dt,[h(s(L),{type:"parallel",branchesName:r.name,parallel:!0,actions:s(b).length?s(b)[0].actions:[],onAdd:e[3]||(e[3]=t=>k(t,!0)),onDelete:e[4]||(e[4]=t=>g(t,!0))},null,8,["branchesName","actions"])])]),_:1})]),_:1},8,["activeKey"])])])}}});const qe=G(ut,[["__scopeId","data-v-9cafebd0"]]);export{qe as default};
