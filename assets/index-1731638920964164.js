import{X as L,h as z,o as I,Z as M,J as U,ds as X,a2 as Z,e as G,a3 as W}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{c as f}from"./cascade-1731638920964.js";import{_ as K}from"./index.vue_vue_type_script_setup_true_lang-173163892096428.js";import{d as Q,k as w,ab as y,U as b,V,X as a,f as n,u as P,E as h,W as Y,R as ee,_ as B,$ as r,Z as J,F as H,a1 as te,G as se}from"./vue-1731638920964.js";const ae=["src"],ne={style:{"font-size":"16px","font-weight":"700"}},ye=Q({__name:"index",setup(le){const O=L(),T=w({}),A=w({}),E=[{title:"名称",dataIndex:"name",key:"name",width:200,fixed:"left",ellipsis:!0,search:{type:"string"}},{title:"上级SIP ID",dataIndex:"sipId",key:"sipId",scopedSlots:!0,ellipsis:!0},{title:"上级SIP 地址",dataIndex:"publicHost",key:"publicHost",scopedSlots:!0,ellipsis:!0},{title:"通道数量",dataIndex:"count",key:"count",scopedSlots:!0,width:100},{title:"状态",dataIndex:"status",key:"status",scopedSlots:!0,width:100,search:{type:"select",options:[{label:"正常",value:"enabled"},{label:"禁用",value:"disabled"}],handleValue:t=>t}},{title:"级联状态",dataIndex:"onlineStatus",key:"onlineStatus",scopedSlots:!0,width:100,search:{type:"select",options:[{label:"已连接",value:"online"},{label:"未连接",value:"offline"}],handleValue:t=>t}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],N=t=>{A.value=t},R=t=>new Promise(async p=>{const m=await f.list(t);m.result.data.forEach(async o=>{const i=await f.queryBindChannel(o.id,{});o.count=i.result.total}),setTimeout(()=>{p(m)},1e3)}),q=()=>{O.jumpPage("media/Cascade/Save")},C=w(!1),j=w(),$=(t,p)=>{var o,i,k,g,d,x,v,S;return t?[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{O.jumpPage("media/Cascade/Save",{},{id:t.id})}},{key:"channel",text:"选择通道",tooltip:{title:"选择通道"},icon:"LinkOutlined",onClick:()=>{O.jumpPage("media/Cascade/Channel",{},{id:t.id})}},{key:"push",text:"推送",tooltip:{title:((o=t.status)==null?void 0:o.value)==="disabled"?"禁用状态下不可推送":"推送"},disabled:((i=t.status)==null?void 0:i.value)==="disabled",icon:"ShareAltOutlined",onClick:()=>{C.value=!0,j.value=t}},{key:"action",text:((k=t.status)==null?void 0:k.value)==="enabled"?"禁用":"启用",tooltip:{title:((g=t.status)==null?void 0:g.value)==="enabled"?"禁用":"启用"},icon:((d=t.status)==null?void 0:d.value)==="enabled"?"StopOutlined":"PlayCircleOutlined",popConfirm:{title:`确认${((x=t.status)==null?void 0:x.value)==="enabled"?"禁用":"启用"}?`,onConfirm:()=>{let c=t.status.value==="enabled"?f.disabled(t.id):f.enabled(t.id);return c.then(_=>{var e;_.success?(I("操作成功！"),(e=T.value)==null||e.reload()):I("操作失败！","error")}),c}}},{key:"delete",text:"删除",tooltip:{title:((v=t.status)==null?void 0:v.value)==="enabled"?"请先禁用, 再删除":"删除"},disabled:((S=t.status)==null?void 0:S.value)==="enabled",popConfirm:{title:"确认删除?",onConfirm:()=>{const c=f.del(t.id);return c.then(_=>{var e;_.status===200?(I("操作成功！"),(e=T.value)==null||e.reload()):I("操作失败！","error")}),c}},icon:"DeleteOutlined"}]:[]};return(t,p)=>{const m=y("pro-search"),o=y("AIcon"),i=M,k=y("Ellipsis"),g=U,d=X,x=Z,v=G,S=W,c=y("FullPage"),_=y("page-container");return b(),V(_,null,{default:a(()=>[n(m,{columns:E,target:"media-cascade",onSearch:N}),n(c,null,{default:a(()=>[n(S,{ref_key:"listRef",ref:T,columns:E,request:e=>R(e),defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:P(A),gridColumn:2},{headerTitle:a(()=>[n(i,{type:"primary",onClick:q,hasPermission:"media/Cascade:add"},{icon:a(()=>[n(o,{type:"PlusOutlined"}),h("新增")]),_:1})]),card:a(e=>{var s,u;return[n(x,Y({value:e,actions:$(e,"card")},e,{showStatus:!0,status:(s=e.status)==null?void 0:s.value,statusText:(u=e.status)==null?void 0:u.text,statusNames:{enabled:"success",disabled:"error"}}),{img:a(()=>[ee(t.$slots,"img",{},()=>[B("img",{src:P(z)("/cascade.png")},null,8,ae)])]),content:a(()=>{var l;return[n(k,{style:{width:"calc(100% - 100px)"}},{default:a(()=>[B("span",ne,r(e.name),1)]),_:2},1024),B("p",null,"通道数量："+r(e.count||0),1),n(d,{status:((l=e.status)==null?void 0:l.value)==="enabled"?"success":"error",style:{display:"flex","align-items":"center"}},{text:a(()=>[n(g,null,{default:a(()=>{var D,F;return[h(r(`sip:${(D=e.sipConfigs[0])==null?void 0:D.sipId}@${(F=e.sipConfigs[0])==null?void 0:F.hostAndPort}`),1)]}),_:2},1024)]),_:2},1032,["status"])]}),actions:a(l=>[n(i,{disabled:l.disabled,popConfirm:l.popConfirm,tooltip:{...l.tooltip},onClick:l.onClick,hasPermission:"media/Cascade:"+l.key},{default:a(()=>[l.key==="delete"?(b(),V(o,{key:0,type:"DeleteOutlined"})):(b(),J(H,{key:1},[n(o,{type:l.icon},null,8,["type"]),B("span",null,r(l==null?void 0:l.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["value","actions","status","statusText"])]}),sipId:a(e=>{var s;return[h(r((s=e.sipConfigs[0])==null?void 0:s.sipId),1)]}),publicHost:a(e=>{var s;return[h(r((s=e.sipConfigs[0])==null?void 0:s.publicHost),1)]}),count:a(e=>[h(r(e.count||0),1)]),status:a(e=>{var s,u;return[n(d,{text:(s=e.status)==null?void 0:s.text,status:((u=e.status)==null?void 0:u.value)==="enabled"?"success":"error"},null,8,["text","status"])]}),onlineStatus:a(e=>{var s,u;return[n(d,{text:(s=e.onlineStatus)==null?void 0:s.text,status:((u=e.onlineStatus)==null?void 0:u.value)==="online"?"success":"error"},null,8,["text","status"])]}),action:a(e=>[n(v,{size:16},{default:a(()=>[(b(!0),J(H,null,te($(e,"table"),s=>(b(),V(i,{key:s.key,danger:s.key==="delete",disabled:s.disabled,popConfirm:s.popConfirm,tooltip:{...s.tooltip},onClick:s.onClick,type:"link",style:{padding:"0px"},hasPermission:"media/Cascade:"+s.key},{icon:a(()=>[n(o,{type:s.icon},null,8,["type"])]),_:2},1032,["danger","disabled","popConfirm","tooltip","onClick","hasPermission"]))),128))]),_:2},1024)]),_:3},8,["request","params"])]),_:3}),n(K,{visible:P(C),"onUpdate:visible":p[0]||(p[0]=e=>se(C)?C.value=e:null),data:P(j)},null,8,["visible","data"])]),_:3})}}});export{ye as default};
