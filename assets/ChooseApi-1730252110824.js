import{d as w,ac as k,e as A,k as v,w as S,U as m,Z as C,_ as y,f as b,X as _,$ as x,u as R,V as B,E as P,Y as D}from"./vue-1730252110824.js";import{o as l,a3 as V,Z as I,g as N}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{d as T,e as E,u as O}from"./apiPage-1730252110824.js";import{u as q}from"./department-1730252110824.js";import{u as F}from"./uniqBy-1730252110824.js";const M={class:"choose-api-container"},Z={class:"table"},$=["onClick"],j=w({__name:"ChooseApi",props:{tableData:{},clickApi:{},selectedRowKeys:{},sourceKeys:{},mode:{},changedApis:{}},emits:["refresh","update:clickApi","update:selectedRowKeys","update:changedApis"],setup(f,{emit:i}){const s=f,d=q(),h=k().query.code,g=[{title:"API",dataIndex:"url",key:"url",scopedSlots:!0},{title:"说明",dataIndex:"summary",key:"summary"}],p=A(()=>F(s.tableData,"id")||[]),u={onChange:(c,r)=>{console.log(c,"keys");const a=r.map(e=>e.id),t=p.value.map(e=>e.id),o=t.filter(e=>s.sourceKeys.includes(e)),n=d.crossPageKeys.filter(e=>!t.includes(e));o.filter(e=>!a.includes(e)),a.filter(e=>!o.includes(e)),i("update:selectedRowKeys",[...n,...a])},selectedRowKeys:v([])},K=async()=>{const c=s.selectedRowKeys,r=s.sourceKeys.filter(t=>!c.includes(t)),a=c.filter(t=>!s.sourceKeys.includes(t));if(s.mode==="api")if(a.length||r.length)r.length&&await T(r),(await E(a)).success&&(l("操作成功"),i("refresh"));else{l("与上次勾选数据一致，未执行调用操作","error");return}else if(s.mode==="appManger"){const t=s.selectedRowKeys.map(o=>{var n,e;return{id:o,permissions:(n=d.changedApis[o])!=null&&n.security?(e=d.changedApis[o])==null?void 0:e.security:[]}});O(h,{operations:t}).then(o=>{o.status===200&&(l("操作成功"),i("refresh"))})}};return S(()=>s.selectedRowKeys,c=>{u.selectedRowKeys.value=c}),(c,r)=>{const a=V,t=I;return m(),C("div",M,[y("div",Z,[b(a,{columns:g,dataSource:R(p),rowSelection:s.mode!=="home"?u:void 0,style:{padding:0},noPagination:"",model:"TABLE"},{url:_(o=>[y("span",{style:{color:"#1677FF",cursor:"pointer"},onClick:n=>i("update:clickApi",o)},x(o.url),9,$)]),_:1},8,["dataSource","rowSelection"])]),s.mode!=="home"?(m(),B(t,{key:0,type:"primary",hasPermission:"system/Platforms/Setting:update",onClick:K,style:{"margin-left":"20px"}},{default:_(()=>[P(" 保存 ")]),_:1})):D("",!0)])}}});const se=N(j,[["__scopeId","data-v-2dbc263a"]]);export{se as default};
