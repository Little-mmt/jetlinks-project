import{X as W,h as Y,o as Z,Z as z,J as F,a0 as G,a1 as H,a2 as P,ds as ee,a3 as te,aa as ae}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{w as se,x as B}from"./product-17302521108244.js";import{a as ne}from"./plugin-17302521108242.js";import{b as ce}from"./accessConfig-1730252110824.js";import{d as M,k as _,ab as D,U as J,V as L,X as a,f as n,u as h,E as R,_ as i,$ as r,W as oe,R as ie,Y as le}from"./vue-1730252110824.js";const de=["src"],re={style:{height:"110px"}},ue={style:{"font-weight":"600"}},me={class:"card-item-content-text"},pe=i("div",{class:"card-item-content-text"},"协议",-1),_e={class:"context-access"},fe=M({name:"accessModal"}),Se=M({...fe,props:{productId:{type:String,default:void 0},accessId:{type:String,default:void 0},deviceType:{type:String,default:void 0},providersList:{type:Array,default:()=>[]}},emits:["submit","cancel"],setup(g,{emit:y}){var C;const u=g,N=W(),l=_(),w=_(),x=_(!1),p=_({terms:[]}),f=_(u.accessId?[u.accessId]:[]),j=e=>{var c,s;return e.description?e.description:(s=(c=u.providersList)==null?void 0:c.find(o=>o.id===e.provider))==null?void 0:s.description},A={...p.value,terms:u.deviceType==="childrenDevice"?[...p.value.terms,{terms:[{column:"provider",termType:"in",value:"child-device,edge-child-device"}]}]:[...(C=p.value)==null?void 0:C.terms]},V=async e=>{var o;const c=await se(e),s=(o=c.result)==null?void 0:o.data;if(s!=null&&s.length){const m=s.find(v=>v.id===f.value[0]);m&&(l.value=m)}return{...c}},I=[{title:"名称",dataIndex:"name",key:"name",search:{type:"string"}},{title:"网关类型",dataIndex:"provider",key:"provider",search:{type:"select",options:()=>new Promise(e=>{ce().then(c=>{var s;e(((s=c.result)==null?void 0:s.map(o=>({...o,label:o.name,value:o.id})))||[])})})}},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",options:[{label:"正常",value:"enabled"},{label:"禁用",value:"disabled"}]}},{title:"说明",key:"description",dataIndex:"description",search:{type:"string"}}],E=async()=>{if(f.value.length)if(l.value.channel==="plugin"){const e=await ne(l.value.channelId).catch(()=>({success:!1,result:[]})),c=await B(u.productId,l.value.id).catch(()=>({success:!1,result:{}}));y("submit",{access:{...l.value},productTypes:e.result,metadata:c.result})}else{x.value=!0;const e=await B(u.productId,l.value.id).catch(()=>({success:!1,result:{}}));x.value=!1,e.success&&y("submit",{access:{...l.value},metadata:e.result})}else Z("请选择接入方式","error")},$=()=>{y("cancel")},q=e=>{p.value.terms=e.terms},k=e=>{f.value=[e.id],l.value={...e}},X=()=>{const e=N.hasMenu("link/AccessConfig/Detail");if(e){const c=window.open(`${window.location.origin+window.location.pathname}#${e}?view=false`);c.onTabSaveSuccess=s=>{s.status===200&&(w.value.reload(),k(s.result))}}};return(e,c)=>{const s=D("pro-search"),o=z,m=D("Ellipsis"),v=F,b=G,T=H,K=P,O=ee,Q=te,U=ae;return J(),L(U,{title:"设备接入配置",visible:"",width:"1200px",okText:"确定",cancelText:"取消",confirmLoading:h(x),maskClosable:!1,onOk:E,onCancel:$},{default:a(()=>[n(s,{columns:I,target:"deviceModal",onSearch:q,type:"simple"}),n(Q,{columns:I,request:V,ref_key:"tableRef",ref:w,model:"CARD",defaultParams:{...A,sorts:g.accessId?[{name:"id",value:g.accessId},{name:"createTime",order:"desc"}]:[{name:"createTime",order:"desc"}]},params:h(p),gridColumn:2,gridColumns:[2]},{headerTitle:a(()=>[n(o,{type:"primary",onClick:X,hasPermission:"link/AccessConfig:add"},{default:a(()=>[R("新增")]),_:1})]),deviceType:a(t=>[i("div",null,r(t.deviceType.text),1)]),card:a(t=>[n(K,oe({value:t,onClick:k},t,{active:h(f).includes(t.id),status:t.state.value,statusText:t.state.text,statusNames:{enabled:"processing",disabled:"error"}}),{img:a(()=>[ie(e.$slots,"img",{},()=>[i("img",{src:h(Y)("/device-access.png")},null,8,de)])]),content:a(()=>[i("div",re,[n(m,{style:{width:"calc(100% - 100px)"}},{default:a(()=>[i("h3",ue,r(t.name),1)]),_:2},1024),n(T,null,{default:a(()=>[t.channelInfo?(J(),L(b,{key:0,span:12},{default:a(()=>[i("div",me,[n(v,null,{default:a(()=>{var d;return[R(r((d=t.channelInfo)==null?void 0:d.name),1)]}),_:2},1024)]),n(m,{style:{width:"calc(100% - 20px)"}},{default:a(()=>{var d,S;return[i("div",null,r((d=t.channelInfo)!=null&&d.addresses?(S=t.channelInfo)==null?void 0:S.addresses[0].address:""),1)]}),_:2},1024)]),_:2},1024)):le("",!0),n(b,{span:12},{default:a(()=>[pe,n(m,{style:{width:"calc(100%-20px)"}},{default:a(()=>{var d;return[i("div",null,r((d=t.protocolDetail)==null?void 0:d.name),1)]}),_:2},1024)]),_:2},1024)]),_:2},1024),n(T,null,{default:a(()=>[n(b,{span:24},{default:a(()=>[n(v,{style:{width:"calc(100% - 50px)"}},{default:a(()=>[i("div",_e,r(j(t)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),_:2},1040,["value","active","status","statusText"])]),state:a(t=>[n(O,{text:t.state.text,status:t.state,statusNames:{enabled:"processing",disabled:"error"}},null,8,["text","status"])]),id:a(t=>[i("a",null,r(t.id),1)]),_:3},8,["defaultParams","params"])]),_:3},8,["confirmLoading"])}}});export{Se as _};
