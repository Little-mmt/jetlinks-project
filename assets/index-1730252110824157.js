import{h as F,fM as L,a4 as z,o as O,dD as Q,aK as W,J as b,d5 as j,cY as ee,g as te}from"./index-1730252110824.js";import{_ as ae}from"./Setting.vue_vue_type_script_setup_true_name_Setting_lang-1730252110824.js";import{e as ne}from"./auto-1730252110824.js";import{d as U,k as y,w as D,U as u,Z as d,_,$ as w,f as h,X as v,E as k,Y as B,F as x,a1 as S,a0 as R,u as J,a4 as se,V as oe,af as le,ag as re}from"./vue-1730252110824.js";import"./Time-1730252110824.js";const ue=[{label:"星期一",value:1},{label:"星期二",value:2},{label:"星期三",value:3},{label:"星期四",value:4},{label:"星期五",value:5},{label:"星期六",value:6},{label:"星期天",value:7}],de=c=>(le("data-v-d6d33b43"),c=c(),re(),c),ce={class:"calendar"},ie={key:0,class:"header"},pe={class:"content"},fe={class:"top"},_e={class:"top-items"},ve={class:"top-item"},ge={class:"item"},he={class:"item-label"},me={class:"item-content"},ye={style:{width:"16px",height:"16px"}},we=["src"],ke=de(()=>_("div",{style:{width:"100%",height:"100%"}},null,-1)),xe={key:0,class:"item-setting"},Ce=U({name:"Calendar"}),Me=U({...Ce,props:{value:{type:Array,default:[]},type:{type:String,default:"auto"},trigger:{type:String,default:"week"},disabled:{type:Boolean,default:!1},view:{type:Boolean,default:!1}},emits:["update:value","update:trigger","change"],setup(c,{emit:T}){const m=c,C=y("week"),M=y(!1),I=y({}),p=y([]),$=y([]),i=e=>e.split(":").map(Number).reduce((n,s,a)=>{let t=a===2?s:s*60**(2-a);return n+=t,n},0),Y=e=>{var r,f;const n={from:"",to:""};e!=null&&e.from&&(e!=null&&e.to)&&(n.from=e.from,n.to=e.to),(e==null?void 0:e.mod)==="period"&&(e!=null&&e.period)&&((r=e.period)!=null&&r.from)&&(n.from=(f=e.period)==null?void 0:f.from,n.to=e.period.to);const s=i(n.from),t=i(n.to)-s,o=24*60*60,g=t/o*720,l=s/o*720+70;return{width:g+"px",left:l+"px",height:"20px"}},q=e=>{var n;if((e==null?void 0:e.mod)==="once"&&((n=e==null?void 0:e.once)!=null&&n.time)){const s=i(e.once.time);return{left:`${Math.floor(s/3600)*30+78}px`}}},A=(e,n)=>{const s=Math.floor(i(n)/3600);return e==null?void 0:e.filter(t=>Math.floor(i(t)/3600)===s)},H=e=>{I.value=e,M.value=!0},K=e=>{V(e.target.value),T("update:trigger",e.target.value)},N=e=>e.map(n=>{const s=p.value.find(a=>a.value===n.value);return{...n,...s}}),P=e=>z(e).reduce((s,a)=>{const t=s==null?void 0:s.find(o=>Math.max(a.start,o.start)<=Math.min(a.end,o.end));return t?(t.start=Math.min(t.start,a.start),t.end=Math.max(t.end,a.end)):s.push(a),s},[]),X=(e,n)=>{var t;const s=e==null?void 0:e.map(o=>{var g,l;return o.from?{start:i(o.from),end:i(o.to)}:{start:i(((g=o==null?void 0:o.period)==null?void 0:g.from)||"00:00:00"),end:i(((l=o==null?void 0:o.period)==null?void 0:l.to)||"00:00:00")}}).filter(o=>o),a=(t=P(s))==null?void 0:t.find(o=>Math.max(i(n.from),o.start)<=Math.min(i(n.to),o.end));return`${L(a.start*1e3)} - ${L(a.end*1e3)}周期执行`},V=async e=>{if(e==="week")p.value=N(z(ue));else{const n=await ne();n.success&&($.value=n.result.map(s=>({label:s.name,value:s.id}))),p.value=N($.value)}},Z=(e,n,s)=>{var a;p.value=(a=p.value)==null?void 0:a.map(t=>{var o;return n.includes(t.value)?(t.times=e.map(g=>({...g,when:t.when||[t.value]})),t.points=s):t.times=(o=t.times)!=null&&o.length?t.times:[],t}),T("change",p.value),T("update:value",p.value)},G=(e,n)=>{if(e==null?void 0:e.every(a=>!((a==null?void 0:a.mod)==="period"&&!a.period.from&&a.period.every||(a==null?void 0:a.mod)==="period"&&a.period.from&&!a.period.every))){const a=[];e.forEach(t=>{(t==null?void 0:t.mod)==="once"&&(t!=null&&t.once.time)&&a.push(t==null?void 0:t.once.time)}),Z(e,n,a),M.value=!1}else O("请检查配置项","warning")};return D(()=>m.value,e=>{e!=null&&e.length?p.value=m.value:V(m.trigger)},{deep:!0,immediate:!0}),D(()=>m.trigger,()=>{C.value=m.trigger},{immediate:!0}),(e,n)=>{const s=Q,a=W,t=b,o=j,g=ee;return u(),d(x,null,[_("div",ce,[c.view?B("",!0):(u(),d("div",ie,[_("span",null,w(c.type==="auto"?"录像时段":"抓拍时间")+": ",1),h(a,{value:C.value,"onUpdate:value":n[0]||(n[0]=l=>C.value=l),disabled:c.disabled,onChange:K},{default:v(()=>[h(s,{value:"week"},{default:v(()=>[k("按周")]),_:1}),h(s,{value:"calender"},{default:v(()=>[k("自定义日历")]),_:1})]),_:1},8,["value","disabled"])])),_("div",pe,[_("div",fe,[(u(!0),d(x,null,S(Array.from(Array(24),(l,r)=>r),l=>(u(),d("div",_e,[_("div",ve,w(l),1)]))),256))]),(u(!0),d(x,null,S(p.value,l=>(u(),d("div",ge,[_("div",he,[h(t,null,{default:v(()=>[k(w(l.label),1)]),_:2},1024)]),_("div",me,[(u(!0),d(x,null,S(l==null?void 0:l.times,r=>(u(),d("div",null,[(r==null?void 0:r.mod)==="once"&&r.once.time?(u(),d("div",{key:0,class:"item-content-point",style:R(q(r))},[h(o,null,{title:v(()=>[(u(!0),d(x,null,S(A(l==null?void 0:l.points,r.once.time),f=>(u(),d("div",null,w(f)+"执行一次 ",1))),256))]),default:v(()=>{var f;return[_("div",ye,[_("img",{src:((f=A(l==null?void 0:l.points,r.once.time))==null?void 0:f.length)>1?J(F)("/media/points.png"):J(F)("/media/point.png")},null,8,we)])]}),_:2},1024)],4)):(u(),d("div",{key:1,class:se({"item-content-box":!0,"item-content-box-bg":c.type!=="auto"}),style:R(Y(r))},[h(o,null,{title:v(()=>{var f,E;return[k(w(X(l==null?void 0:l.times,{from:r.from||((f=r==null?void 0:r.period)==null?void 0:f.from),to:r.to||((E=r==null?void 0:r.period)==null?void 0:E.to)})),1)]}),default:v(()=>[ke]),_:2},1024)],6))]))),256))]),c.disabled?B("",!0):(u(),d("div",xe,[h(g,{onClick:r=>H(l),size:"small"},{default:v(()=>[k("设置")]),_:2},1032,["onClick"])]))]))),256))])]),M.value?(u(),oe(ae,{key:0,onClose:n[1]||(n[1]=l=>M.value=!1),data:I.value,trigger:C.value,options:p.value,type:c.type,onSave:G},null,8,["data","trigger","options","type"])):B("",!0)],64)}}});const Ae=te(Me,[["__scopeId","data-v-d6d33b43"]]);export{Ae as default};
