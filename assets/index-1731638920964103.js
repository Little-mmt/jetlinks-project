import{d as V,ac as U,k as v,e as k,o as F,w as M,U as y,V as N,X as i,f as d,E as G,u as f,Z as X,F as $,a1 as A,_ as h,G as j,af as P,ag as Z}from"./vue-1731638920964.js";import{dG as w,eX as q,o as z,a4 as H,aC as K,d as Q,e as W,ec as ee,_ as te,f as ae,A as se,el as ne,g as oe}from"./index-1731638920964.js";import"./index-1731638920964302.js";import{u as le}from"./instance-1731638920964.js";import{u as ie}from"./product-17316389209645.js";import{d as ce,c as ue,a as re}from"./product-17316389209644.js";import"./encodeQuery-1731638920964.js";const de=u=>(P("data-v-e7d694b3"),u=u(),Z(),u),pe=de(()=>h("div",{class:"cat-content"},[h("p",{class:"cat-tip"}," 物模型是对设备在云端的功能描述，包括设备的属性、服务和事件。物联网平台通过定义一种物的描述语言来描述物模型，称之为 TSL（即 Thing Specification Language），采用 JSON 格式，您可以根据 TSL 组装上报设备的数据。您可以导出完整物模型，用于云端应用开发。 ")],-1)),_e={class:"cat-panel"},me=V({name:"Cat"}),ve=V({...me,props:{visible:{type:Boolean},type:{}},emits:["update:visible"],setup(u,{emit:S}){const s=u,x=U(),p=v(!1),b=k({get:()=>s.visible,set:t=>{S("update:visible",t)}}),O=()=>{S("update:visible",!1)},g=le(),C=ie(),n=k(()=>{var e,a;return{product:(e=C.detail)==null?void 0:e.metadata,device:(a=g.current)==null?void 0:a.metadata}[s.type]}),c=v(n.value),o=v(),B=async()=>{var t,e;try{q(JSON.parse(o.value),`${s.type==="device"?(t=g.current)==null?void 0:t.name:(e=C.current)==null?void 0:e.name}-物模型`,"YYYY/MM/DD")}catch{z("请先配置物模型","error")}},L=t=>{t==="alink"?(c.value="",o.value="",n&&ue("to","alink",JSON.parse(n.value)).then(e=>{e.status===200&&(c.value=JSON.stringify(e.result),o.value=JSON.stringify(e.result))})):(c.value=n.value,r(n.value))},J=v(),I=async t=>{const e=await re();e.status===200&&(J.value=[{id:"jetlinks",name:"标准物模型"}].concat(e.result)),s.type==="device"&&t&&w(t).then(a=>{var l;if(a.status===200){g.setCurrent(a.result);const _=(l=a.result)==null?void 0:l.metadata;c.value=_,r(_)}})},r=t=>{const e=JSON.parse(t||"{}");e.properties&&(e.properties=e.properties.map(a=>{var l;return(l=a.expands)!=null&&l.virtualRule&&(a.expands=H(K(a.expands,["virtualRule"]))),a})),o.value=JSON.stringify(e)};return F(()=>{I(x.params.id)}),M(()=>[s.visible,s.type],()=>{if(s.visible){p.value=!0;const{id:t}=x.params;s.type==="device"?w(t).then(e=>{p.value=!1,c.value=e.result.metadata,r(e.result.metadata)}):ce(t).then(e=>{p.value=!1,c.value=e.result.metadata,r(e.result.metadata)})}},{immediate:!0}),M(()=>n.value,()=>{r(n.value)},{immediate:!0}),(t,e)=>{const a=Q,l=W,_=ee,R=te,D=ae,E=se,T=ne;return y(),N(T,{"mask-closable":!1,title:"查看物模型",width:"700",visible:f(b),"onUpdate:visible":e[1]||(e[1]=m=>j(b)?b.value=m:null),"destroy-on-close":"",onClose:O},{extra:i(()=>[d(l,null,{default:i(()=>[d(a,{type:"primary",onClick:B},{default:i(()=>[G(" 导出 ")]),_:1})]),_:1})]),default:i(()=>[d(E,{spinning:f(p)},{default:i(()=>[pe,d(D,{onChange:L,"destroy-inactive-tab-pane":""},{default:i(()=>[(y(!0),X($,null,A(f(J),m=>(y(),N(R,{key:m.id,tab:m.name},{default:i(()=>[h("div",_e,[d(_,{modelValue:f(o),"onUpdate:modelValue":e[0]||(e[0]=Y=>j(o)?o.value=Y:null),lang:"javascript",style:{height:"100%"},theme:"vs"},null,8,["modelValue"])])]),_:2},1032,["tab"]))),128))]),_:1})]),_:1},8,["spinning"])]),_:1},8,["visible"])}}});const Ce=oe(ve,[["__scopeId","data-v-e7d694b3"]]);export{Ce as default};
