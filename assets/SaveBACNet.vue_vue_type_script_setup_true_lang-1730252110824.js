import{aF as F,I as O,v as S,aI as J,aD as L,a6 as $,a8 as E,e as K,a7 as R,C as Z,aG as z,a9 as G,F as X,d as H,Z as Q,aa as W}from"./index-1730252110824.js";import"./index-1730252110824280.js";import"./index-1730252110824290.js";import"./index-1730252110824288.js";import{g as Y,s as ee,u as ae}from"./collector-1730252110824.js";import te from"./DeathArea-1730252110824.js";import{d as ne,k as f,o as oe,U as b,V as x,X as o,f as a,E as p,u as s,Z as se,F as le,a1 as re,$ as ie,_}from"./vue-1730252110824.js";const ue=_("span",null,"点位死区",-1),de=_("span",{class:"explain"},"点位死区范围内的异常数据将被过滤（请勿配置非数值类型）",-1),ce=_("p",null,[p(" 采集频率"),_("span",{style:{"margin-left":"5px",color:"#9d9ea1","font-size":"12px"}},"采集频率为0时不执行轮询任务")],-1),Ie=ne({__name:"SaveBACNet",props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(g,{emit:y}){const i=g,v=f(!1),I=f(),t=f({name:i.data.name,configuration:i.data.configuration||{valueType:void 0,pointAddress:"",interval:3e3},accessModes:[],features:[],description:i.data.description||""}),m={name:[{required:!0,message:"请输入名称",trigger:"blur"}],configuration:{typeIdentifierName:[{required:!0,message:"请输入类型标识",trigger:"change"}],pointAddress:[{required:!0,message:"请输入地址",trigger:"blur"}],interval:[{required:!0,message:"请输入采集频率",trigger:"change"}]},accessModes:[{required:!0,message:"请选择访问类型",trigger:"change"}]},k=(u,e)=>new Promise(async(r,l)=>!e||(e==null?void 0:e.length)===0?r(""):(e==null?void 0:e.length)===1?e[0].value&&e[0].termType?r(""):l("请配置点位死区"):(e==null?void 0:e[0].column)==="currentValue"?e.every(d=>d.termType&&d.value)?r(""):l("请配置点位死区"):e.find(d=>{d.column})?l("请配置点位死区"):r("")),j=f([]);(async()=>{const u=await Y();u.success&&(j.value=u.result)})();const C=async()=>{var l,c;const u=await((l=I.value)==null?void 0:l.validate()),e={...u,configuration:{...u.configuration,objectId:(c=i.data.configuration)==null?void 0:c.objectId},inheritBreaker:!0,pointKey:i.data.pointKey||F(9),provider:i.data.provider,collectorId:i.data.collectorId,accessModes:u==null?void 0:u.accessModes.filter(d=>d)};v.value=!0;const r=i.data.id?await ae(i.data.id,{...i.data,...e}).catch(()=>{}):await ee(e).catch(()=>{});y("change",(r==null?void 0:r.status)===200),v.value=!1},h=()=>{y("change",!1)};return oe(()=>{var u,e,r;t.value.features=(u=i.data.features)==null?void 0:u.map(l=>l.value),((e=i.data.accessModes)==null?void 0:e.length)!==0&&(t.value.accessModes=(r=i.data.accessModes)==null?void 0:r.map(l=>l.value))}),(u,e)=>{const r=O,l=S,c=J,d=L,M=$,w=E,T=K,U=R,B=Z,V=z,A=G,N=X,D=H,P=Q,q=W;return b(),x(q,{title:g.data.id?"编辑":"新增",visible:"",onCancel:h},{footer:o(()=>[a(D,{onClick:h},{default:o(()=>[p("取消")]),_:1}),a(P,{key:"submit",type:"primary",loading:s(v),onClick:C,style:{"margin-left":"8px"},hasPermission:`DataCollect/Collector:${g.data.id?"update":"add"}`},{default:o(()=>[p(" 确认 ")]),_:1},8,["loading","hasPermission"])]),default:o(()=>[a(N,{model:s(t),layout:"vertical",ref_key:"formRef",ref:I},{default:o(()=>[a(l,{label:"点位名称",name:"name",rules:m.name},{default:o(()=>[a(r,{placeholder:"请输入点位名称",value:s(t).name,"onUpdate:value":e[0]||(e[0]=n=>s(t).name=n),maxlength:64},null,8,["value"])]),_:1},8,["rules"]),a(l,{label:"对象ID",name:["configuration","ObjectId"]},{default:o(()=>[a(c,null,{default:o(()=>[a(l,{label:"对象类型"},{default:o(()=>[a(r,{value:s(t).configuration.objectId.type,"onUpdate:value":e[1]||(e[1]=n=>s(t).configuration.objectId.type=n),disabled:""},null,8,["value"])]),_:1}),a(l,{label:"对象实例号"},{default:o(()=>[a(r,{value:s(t).configuration.objectId.instanceNumber,"onUpdate:value":e[2]||(e[2]=n=>s(t).configuration.objectId.instanceNumber=n),disabled:""},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(l,{label:"属性ID",name:["configuration","propertyId"],rules:m.configuration.pointAddress},{default:o(()=>[a(r,{value:s(t).configuration.propertyId,"onUpdate:value":e[3]||(e[3]=n=>s(t).configuration.propertyId=n),disabled:""},null,8,["value"])]),_:1},8,["rules"]),a(l,{label:"值类型",name:["configuration","valueType"]},{default:o(()=>[a(M,{value:s(t).configuration.valueType,"onUpdate:value":e[4]||(e[4]=n=>s(t).configuration.valueType=n)},{default:o(()=>[(b(!0),se(le,null,re(s(j),n=>(b(),x(d,{key:n,value:n},{default:o(()=>[p(ie(n),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),a(l,{label:"访问类型",name:"accessModes",rules:m.accessModes},{default:o(()=>[a(w,{multiple:"",showImage:!1,value:s(t).accessModes,"onUpdate:value":e[5]||(e[5]=n=>s(t).accessModes=n),options:[{label:"读",value:"read"},{label:"写",value:"write"},{label:"订阅",value:"subscribe"}],column:3},null,8,["value"])]),_:1},8,["rules"]),a(l,{name:["configuration","terms"],rules:[{validator:k,trigger:"change"}]},{label:o(()=>[a(T,null,{default:o(()=>[ue,de]),_:1})]),default:o(()=>[a(te,{value:s(t).configuration.terms,"onUpdate:value":e[6]||(e[6]=n=>s(t).configuration.terms=n)},null,8,["value"])]),_:1},8,["rules"]),a(l,{label:"轮询任务",name:["configuration","interval"],rules:m.configuration.interval},{default:o(()=>[ce,a(U,{style:{width:"100%"},placeholder:"请输入采集频率",value:s(t).configuration.interval,"onUpdate:value":e[7]||(e[7]=n=>s(t).configuration.interval=n),"addon-after":"ms",max:2147483648,min:0},null,8,["value"])]),_:1},8,["rules"]),a(l,{name:"features"},{default:o(()=>[a(V,{value:s(t).features,"onUpdate:value":e[8]||(e[8]=n=>s(t).features=n)},{default:o(()=>[a(B,{value:"changedOnly"},{default:o(()=>[p("只推送变化的数据")]),_:1})]),_:1},8,["value"])]),_:1}),a(l,{label:"说明",name:"description"},{default:o(()=>[a(A,{placeholder:"请输入说明",value:s(t).description,"onUpdate:value":e[9]||(e[9]=n=>s(t).description=n),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])}}});export{Ie as _};
