import{d as R,ad as J,k as m,U as d,V as i,X as t,u as r,E as f,Y as c,_ as h,f as u,Z as v,a1 as T,F as $,v as j,A as b}from"./vue-1731638920964.js";import{aj as z,ak as L,al as A,o as D,aa as S,am as X,an as Y,ao as Z,I as G,v as H,w as K,F as Q,d as W,g as ee}from"./index-1731638920964.js";import"./index-1731638920964286.js";const se={style:{"background-color":"#f8f9fc",padding:"24px"}},re={key:0},oe={key:1},te={key:2},ae={class:"content"},ne=R({__name:"index",emits:["close"],setup(le,{emit:w}){const B=J(),F=["验证密码","设置密码","二次确认"],P=m(!1),_=m(),a=m({oldPassword:"",newPassword:"",confirmPassword:""}),o=m(0),N=()=>{o.value-=1},x=n=>{var e,s;n===1?(e=_.value)==null||e.validate("oldPassword").then(()=>{o.value+=1}):n===2&&((s=_.value)==null||s.validate("newPassword").then(()=>{o.value+=1}))},V=()=>{x(o.value+1)},M=n=>{x(n)},y={old:async(n,e)=>{if(!e)return Promise.resolve();try{const s=await z(e);return s.status===200&&!s.result.passed?Promise.reject(s.result.reason):Promise.resolve()}catch{return Promise.reject("验证失败")}},new:async(n,e)=>{if(!e)return Promise.resolve();try{const s=await L("password",e);return s.status===200&&!s.result.passed?Promise.reject(s.result.reason):Promise.resolve()}catch{return Promise.reject("验证失败")}},confirm:async(n,e)=>{if(e){if(a.value.newPassword&&e!==a.value.newPassword)return Promise.reject("两次密码输入不一致")}else return Promise.resolve();try{const s=await L("password",e);return s.status===200&&!s.result.passed?Promise.reject(s.result.reason):Promise.resolve()}catch{return Promise.reject("验证失败")}}},U=()=>{var n;(n=_.value)==null||n.validate().then(()=>{P.value=!0;const e={oldPassword:a.value.oldPassword,newPassword:a.value.newPassword};A(e).then(s=>{s.status===200&&(D("保存成功","success"),w("close"),S.warning({content:"密码已重置，请重新登录",okText:"确定",onOk(){localStorage.clear(),B.push(X)}}))}).finally(()=>P.value=!1)})};return(n,e)=>{const s=Y,q=Z,C=G,g=H,E=K,I=Q,p=W,O=S;return d(),i(O,{visible:"",title:"重置密码",width:"615px",bodyStyle:{padding:0},confirmLoading:r(P),onCancel:e[4]||(e[4]=l=>w("close"))},{footer:t(()=>[r(o)===0?(d(),i(p,{key:0,onClick:e[3]||(e[3]=l=>w("close"))},{default:t(()=>[f("取消")]),_:1})):c("",!0),r(o)===2?(d(),i(p,{key:1,onClick:N},{default:t(()=>[f("上一步")]),_:1})):(d(),i(p,{key:2,type:"primary",onClick:V},{default:t(()=>[f("下一步")]),_:1})),r(o)===2?(d(),i(p,{key:3,type:"primary",onClick:U},{default:t(()=>[f("完成")]),_:1})):c("",!0)]),default:t(()=>[h("div",null,[h("div",se,[u(q,{current:r(o),size:"small","progress-dot":"",onChange:M},{default:t(()=>[(d(),v($,null,T(F,(l,k)=>u(s,{title:l,key:l},{description:t(()=>[r(o)===k?(d(),v("span",re,"进行中")):c("",!0),r(o)<k?(d(),v("span",oe,"未开始")):c("",!0),r(o)>k?(d(),v("span",te,"已完成")):c("",!0)]),_:2},1032,["title"])),64))]),_:1},8,["current"])]),h("div",ae,[u(I,{model:r(a),layout:"vertical",ref_key:"formRef",ref:_},{default:t(()=>[j(u(g,{label:"当前密码",name:"oldPassword",rules:[{required:!0,message:"请输入当前密码"},{validator:y.old,trigger:"blur"}]},{default:t(()=>[u(C,{value:r(a).oldPassword,"onUpdate:value":e[0]||(e[0]=l=>r(a).oldPassword=l),placeholder:"请输入当前密码"},null,8,["value"])]),_:1},8,["rules"]),[[b,r(o)===0]]),j(u(g,{label:"新密码",name:"newPassword",rules:[{required:!0,message:"请输入新密码"},{validator:y.new,trigger:"blur"}]},{default:t(()=>[u(E,{value:r(a).newPassword,"onUpdate:value":e[1]||(e[1]=l=>r(a).newPassword=l),placeholder:"请输入新密码"},null,8,["value"])]),_:1},8,["rules"]),[[b,r(o)===1]]),j(u(g,{label:"确认新密码",name:"confirmPassword",rules:[{required:!0,message:"请确认新密码"},{validator:y.confirm,trigger:"blur"}]},{default:t(()=>[u(C,{value:r(a).confirmPassword,"onUpdate:value":e[2]||(e[2]=l=>r(a).confirmPassword=l),placeholder:"请确认新密码"},null,8,["value"])]),_:1},8,["rules"]),[[b,r(o)===2]])]),_:1},8,["model"])])])]),_:1},8,["confirmLoading"])}}});const ce=ee(ne,[["__scopeId","data-v-72bd6ea9"]]);export{ce as default};
