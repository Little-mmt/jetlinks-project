import{aF as w,aO as q,v as M}from"./index-1730252110824.js";import{d as p,ai as G,k,p as I,e as R,q as A,b as K,ab as z,U as i,Z as h,_ as u,f as c,u as s,Y as D,X as f,F as X,a1 as Y,V as Z}from"./vue-1730252110824.js";import{u as $}from"./scene-17302521108242.js";import x from"./DropdownButton-1730252110824.js";import"./Menus-1730252110824.js";import"./Time.vue_vue_type_style_index_0_lang-1730252110824.js";import{_ as H}from"./FilterCondition.vue_vue_type_script_setup_true_name_FilterCondition_lang-1730252110824.js";import{b as J,E as B,g as Q}from"./util-17302521108242.js";import{h as W}from"./util-17302521108245.js";import{f as _}from"./util-1730252110824.js";import ee from"./CheckFilterItem-1730252110824.js";import{f as ae}from"./flattenDeep-1730252110824.js";const te={class:"terms-params filter-group"},ne={class:"terms-params-warp"},me={key:0,class:"term-type-warp"},se={class:"terms-content"},re=u("span",null,"分组",-1),oe=p({name:"FilterGroup"}),ge=p({...oe,props:{isFirst:{type:Boolean,default:!0},isLast:{type:Boolean,default:!0},showDeleteBtn:{type:Boolean,default:!0},name:{type:Number,default:0},branchName:{type:Number,default:0},thenName:{type:Number,default:0},actionName:{type:Number,default:0}},setup(a){const e=a,F=$(),{data:m}=G(F),v=k([]),y=J({branch:e.branchName,branchGroup:e.thenName,action:e.actionName}),C=n=>{"isDelete"in n||g()};B.subscribe(y,C),I("filter-params",v);const g=()=>{const n={branch:e.branchName,branchGroup:e.thenName,action:e.actionName};Q(n,m.value).then(t=>{v.value=W(t,"id")})},N=R(()=>{var n;return(n=m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].terms)==null?void 0:n[e.name].terms}),b=k(!1),E=()=>{b.value=!0},S=()=>{b.value=!1},O=(n,t)=>{m.value.branches[e.branchName].then[e.thenName].actions[e.name].options.termsColumns=n;let l=[...new Set(ae(n)).values()];t!=null&&t.otherColumns&&(l=[...t==null?void 0:t.otherColumns,...l]),m.value.branches[e.branchName].then[e.thenName].actions[e.name].options.columns=l},T=()=>{var t;const n={type:"and",key:w(),terms:[{column:void 0,value:{type:"fixed",value:void 0},termType:void 0,type:"and",key:w()}]};(t=m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].terms)==null||t.push(n),m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].options.terms.push({terms:[["","eq","","and"]],termType:"并且"})},P=n=>{m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].options.terms[e.name].termType=n.label},V=()=>{var o;(o=m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].terms)==null||o.splice(e.name,1);const n=m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].options,t=(n==null?void 0:n.termsColumns)||[];n!=null&&n.termsColumns&&(t.splice(e.name,1),O(t,n)),m.value.branches[e.branchName].then[e.thenName].actions[e.actionName].options.terms.splice(e.name,1)},j=[{validator(n,t){return console.log(t),t!==void 0&&!t.error?Object.keys(t).length?_(t):Promise.reject(new Error("该数据已发生变更，请重新配置")):t!=null&&t.error?Promise.reject(new Error("该数据已发生变更，请重新配置")):Promise.reject(new Error("请选择参数"))}}];return A(()=>{g()}),K(()=>{B.unSubscribe(y,C)}),(n,t)=>{const o=z("AIcon"),l=q,L=M;return i(),h("div",te,[u("div",ne,[a.isFirst?D("",!0):(i(),h("div",me,[c(s(x),{options:[{label:"并且",value:"and"},{label:"或者",value:"or"}],type:"type",value:s(m).branches[a.branchName].then[a.thenName].actions[a.actionName].terms[a.name].type,"onUpdate:value":t[0]||(t[0]=d=>s(m).branches[a.branchName].then[a.thenName].actions[a.actionName].terms[a.name].type=d),onSelect:P},null,8,["value"])])),u("div",{class:"terms-params-content",onMouseover:E,onMouseout:S},[c(l,{title:"确认删除？",onConfirm:V,show:s(b),className:"terms-params-delete"},{default:f(()=>[c(o,{type:"CloseOutlined"})]),_:1},8,["show"]),(i(!0),h(X,null,Y(s(N),(d,r)=>(i(),Z(L,{key:d.key,name:["branches",a.branchName,"then",a.thenName,"actions",a.actionName,"terms",a.name,"terms",r],rules:j},{default:f(()=>[c(ee,{value:s(m).branches[a.branchName].then[a.thenName].actions[a.actionName].terms[a.name].terms[r],name:r,termsName:a.name,actionName:a.actionName,thenName:a.thenName,branchName:a.branchName},{default:f(()=>[c(H,{value:s(m).branches[a.branchName].then[a.thenName].actions[a.actionName].terms[a.name].terms[r],"onUpdate:value":U=>s(m).branches[a.branchName].then[a.thenName].actions[a.actionName].terms[a.name].terms[r]=U,isFirst:r===0,isLast:r===s(N).length-1,showDeleteBtn:s(N).length!==1,name:r,termsName:a.name,actionName:a.actionName,thenName:a.thenName,branchName:a.branchName},null,8,["value","onUpdate:value","isFirst","isLast","showDeleteBtn","name","termsName","actionName","thenName","branchName"])]),_:2},1032,["value","name","termsName","actionName","thenName","branchName"])]),_:2},1032,["name"]))),128))],32),a.isLast?(i(),h("div",{key:1,class:"terms-group-add",onClick:T},[u("div",se,[c(o,{type:"PlusOutlined",style:{"font-size":"12px","padding-right":"4px"}}),re])])):D("",!0)])])}}});export{ge as _};
