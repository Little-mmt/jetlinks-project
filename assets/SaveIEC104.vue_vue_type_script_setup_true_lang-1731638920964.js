import{aF as V,I as T,v as D,a6 as E,a8 as J,e as F,a7 as L,C as O,aG as S,a9 as K,F as R,d as $,Z as z,aa as G}from"./index-1731638920964.js";import"./index-1731638920964280.js";import"./index-1731638920964290.js";import{s as X,u as Z,q as H}from"./collector-1731638920964.js";import Q from"./DeathArea-1731638920964.js";import{d as W,k as p,o as Y,U as ee,V as ae,X as s,f as a,E as f,u as o,_}from"./vue-1731638920964.js";const te=_("span",null,"点位死区",-1),ne=_("span",{class:"explain"},"点位死区范围内的异常数据将被过滤（请勿配置非数值类型）",-1),oe=_("p",null,[f(" 采集频率"),_("span",{style:{"margin-left":"5px",color:"#9d9ea1","font-size":"12px"}},"采集频率为0时不执行轮询任务")],-1),de=W({__name:"SaveIEC104",props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(g,{emit:y}){const u=g,v=p(!1),h=p(),b=p(),t=p({name:u.data.name,configuration:u.data.configuration||{typeIdentifierName:void 0,pointAddress:"",interval:3e3},accessModes:[],features:[],description:u.data.description||""}),d={name:[{required:!0,message:"请输入名称",trigger:"blur"}],configuration:{typeIdentifierName:[{required:!0,message:"请输入类型标识",trigger:"change"}],pointAddress:[{required:!0,message:"请输入地址",trigger:"blur"}],interval:[{required:!0,message:"请输入采集频率",trigger:"change"}]},accessModes:[{required:!0,message:"请选择访问类型",trigger:"change"}]},C=(i,e)=>new Promise(async(r,n)=>{if(!e||(e==null?void 0:e.length)===0)return r("");if((e==null?void 0:e.length)===1)return e[0].value&&e[0].termType?r(""):n("请配置点位死区");if((e==null?void 0:e[0].column)==="currentValue")return e.every(m=>m.termType&&m.value)?r(""):n("请配置点位死区");e.forEach(c=>c.column==="this['currentValue'] - this['lastValue']*init/100"?n("请配置点位死区"):r(""))}),I=async()=>{var n;const i=await((n=h.value)==null?void 0:n.validate()),e={...i,configuration:{...i.configuration},inheritBreaker:!0,pointKey:u.data.pointKey||V(9),provider:u.data.provider,collectorId:u.data.collectorId,accessModes:i==null?void 0:i.accessModes.filter(c=>c)};v.value=!0;const r=u.data.id?await Z(u.data.id,{...u.data,...e}).catch(()=>{}):await X(e).catch(()=>{});y("change",(r==null?void 0:r.status)===200),v.value=!1},x=()=>{y("change",!1)},k=async()=>{const i=await H();i.success&&(b.value=i.result.map(e=>({label:e.name,value:e.key})))};return Y(()=>{var i,e,r;k(),t.value.features=(i=u.data.features)==null?void 0:i.map(n=>n.value),((e=u.data.accessModes)==null?void 0:e.length)!==0&&(t.value.accessModes=(r=u.data.accessModes)==null?void 0:r.map(n=>n.value))}),(i,e)=>{const r=T,n=D,c=E,m=J,w=F,M=L,j=O,N=S,U=K,q=R,A=$,B=z,P=G;return ee(),ae(P,{title:g.data.id?"编辑":"新增",visible:"",onCancel:x},{footer:s(()=>[a(A,{onClick:x},{default:s(()=>[f("取消")]),_:1}),a(B,{key:"submit",type:"primary",loading:o(v),onClick:I,style:{"margin-left":"8px"},hasPermission:`DataCollect/Collector:${g.data.id?"update":"add"}`},{default:s(()=>[f(" 确认 ")]),_:1},8,["loading","hasPermission"])]),default:s(()=>[a(q,{model:o(t),layout:"vertical",ref_key:"formRef",ref:h},{default:s(()=>[a(n,{label:"点位名称",name:"name",rules:d.name},{default:s(()=>[a(r,{placeholder:"请输入点位名称",value:o(t).name,"onUpdate:value":e[0]||(e[0]=l=>o(t).name=l),maxlength:64},null,8,["value"])]),_:1},8,["rules"]),a(n,{label:"类型标识",name:["configuration","typeIdentifierName"],rules:d.configuration.typeIdentifierName},{default:s(()=>[a(c,{value:o(t).configuration.typeIdentifierName,"onUpdate:value":e[1]||(e[1]=l=>o(t).configuration.typeIdentifierName=l),options:o(b),placeholder:"请选择类型标识",allowClear:"","show-search":""},null,8,["value","options"])]),_:1},8,["rules"]),a(n,{label:"地址",name:["configuration","pointAddress"],rules:d.configuration.pointAddress},{default:s(()=>[a(r,{value:o(t).configuration.pointAddress,"onUpdate:value":e[2]||(e[2]=l=>o(t).configuration.pointAddress=l),placeholder:"请输入地址",min:1,max:65535,precision:0},null,8,["value"])]),_:1},8,["rules"]),a(n,{label:"访问类型",name:"accessModes",rules:d.accessModes},{default:s(()=>[a(m,{multiple:"",showImage:!1,value:o(t).accessModes,"onUpdate:value":e[3]||(e[3]=l=>o(t).accessModes=l),options:[{label:"读",value:"read"},{label:"写",value:"write"},{label:"订阅",value:"subscribe"}],column:3},null,8,["value"])]),_:1},8,["rules"]),a(n,{name:["configuration","terms"],rules:[{validator:C,trigger:"change"}]},{label:s(()=>[a(w,null,{default:s(()=>[te,ne]),_:1})]),default:s(()=>[a(Q,{value:o(t).configuration.terms,"onUpdate:value":e[4]||(e[4]=l=>o(t).configuration.terms=l)},null,8,["value"])]),_:1},8,["rules"]),a(n,{label:"轮询任务",name:["configuration","interval"],rules:d.configuration.interval},{default:s(()=>[oe,a(M,{style:{width:"100%"},placeholder:"请输入采集频率",value:o(t).configuration.interval,"onUpdate:value":e[5]||(e[5]=l=>o(t).configuration.interval=l),"addon-after":"ms",max:2147483648,min:0},null,8,["value"])]),_:1},8,["rules"]),a(n,{name:"features"},{default:s(()=>[a(N,{value:o(t).features,"onUpdate:value":e[6]||(e[6]=l=>o(t).features=l)},{default:s(()=>[a(j,{value:"changedOnly"},{default:s(()=>[f("只推送变化的数据")]),_:1})]),_:1},8,["value"])]),_:1}),a(n,{label:"说明",name:"description"},{default:s(()=>[a(U,{placeholder:"请输入说明",value:o(t).description,"onUpdate:value":e[7]||(e[7]=l=>o(t).description=l),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title"])}}});export{de as _};
