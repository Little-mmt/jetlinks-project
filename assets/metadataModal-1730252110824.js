import{h as m,$ as F,a8 as J,v as V,F as B,aa as q,o as Q,g as X}from"./index-1730252110824.js";import"./index-1730252110824290.js";import{u as $}from"./product-17302521108245.js";import{d as P,ai as z,k as L,r as G,ab as H,U as K,V as W,X as d,_ as h,f as n,E as N,u as v,af as Y,ag as Z}from"./vue-1730252110824.js";import{B as A,m as ee}from"./product-17302521108244.js";import{s as ae}from"./plugin-17302521108242.js";import"./encodeQuery-1730252110824.js";const te=i=>(Y("data-v-ff372c58"),i=i(),Z(),i),oe={class:"tip"},se=te(()=>h("span",{style:{"font-weight":"bold",padding:"0 4px"}},"物模型",-1)),ce=["src"],ne=P({name:"MetadataModal"}),ie=P({...ne,props:{metadata:{type:Object,default:()=>({})},access:{type:Object,default:()=>({})},data:{type:Object,default:()=>({})}},emits:["submit","cancel"],setup(i,{emit:w}){const a=i,g=$(),{current:b}=z(g),x=L(),p=G({type:void 0}),u=L(!1),U=[{value:"intersection",label:"取交集",subLabel:"仅保留标识一致的属性",iconUrl:m("/device/intersection.png")},{value:"union",label:"取并集",subLabel:"保留平台、插件中的所有属性",iconUrl:m("/device/union.png")},{value:"ignore",label:"忽略",subLabel:"仅保留平台中的属性",iconUrl:m("/device/ignore.png")},{value:"cover",label:"覆盖",subLabel:"仅保留插件中的属性",iconUrl:m("/device/cover.png")}],C=async(s,o,e)=>{var c,T,j,k,D,I,M,O;const{storePolicy:t,...r}=o,y={...b.value,metadata:JSON.stringify(e),transportProtocol:(c=a.access)==null?void 0:c.transport,protocolName:(j=(T=a.access)==null?void 0:T.protocolDetail)==null?void 0:j.name,accessId:(k=a.access)==null?void 0:k.id,accessName:(D=a.access)==null?void 0:D.name,accessProvider:(I=a.access)==null?void 0:I.provider,messageProtocol:(M=a.access)==null?void 0:M.protocol};if(u.value=!0,!(await A(y)).success){u.value=!1;return}((O=a.access)==null?void 0:O.provider)==="plugin_gateway"&&a.data.productTypeId&&await ae("product",a.access.id,a.data.id,a.data.productTypeId).catch(()=>({}));const l=await ee(s||"",{id:s,configuration:{...r},storePolicy:t});u.value=!1,l.status===200&&(Q("操作成功！"),g.current.storePolicy=t,window.onTabSaveSuccess?l.result&&(window.onTabSaveSuccess(l),setTimeout(()=>window.close(),300)):(await g.getDetail(b.value.id),w("submit")))},E=()=>{x.value.validate().then(s=>{var o;if(s){let e=JSON.parse(((o=b.value)==null?void 0:o.metadata)||"{}");switch(p.type[0]){case"intersection":e.properties=f(e.properties,a.metadata.properties),e.events=f(e.events,a.metadata.events),e.functions=f(e.functions,a.metadata.functions),e.tags=f(e.tags,a.metadata.tags);break;case"union":e.properties=_(e.properties,a.metadata.properties),e.functions=_(e.functions,a.metadata.functions),e.events=_(e.events,a.metadata.events),e.tags=_(e.tags,a.metadata.tags);break;case"cover":e=a.metadata;break}C(a.data.id,a.data.values,e)}}).catch(()=>{})},R=()=>{w("cancel")},f=(s=[],o=[])=>{const e=[];return s.length?(o.forEach(t=>{console.log(t,t.id),s.some(r=>r.id===t.id)&&e.push(t)}),e):[]},_=(s=[],o=[])=>{const e=new Map;return o.forEach(t=>{e.set(t.id,t)}),s.forEach(t=>{e.has(t.id)||e.set(t.id,t)}),console.log(s,o,[...e.values()]),[...e.values()]};return(s,o)=>{const e=H("a-icon"),t=F,r=J,y=V,S=B,l=q;return K(),W(l,{title:"选择处理方式",visible:"",width:"900px",okText:"确定",cancelText:"取消",confirmLoading:v(u),onOk:E,onCancel:R},{default:d(()=>[h("div",oe,[n(e,{type:"ExclamationCircleOutlined"}),N(" 平台 "),se,N(" 中已有数据，请选择处理方式。 "),n(t,{title:"默认采用覆盖的方式处理功能、事件、标签下的数据"},{default:d(()=>[n(e,{type:"QuestionCircleOutlined"})]),_:1})]),n(S,{layout:"vertical",ref_key:"formRef",ref:x,model:v(p)},{default:d(()=>[n(y,{label:"处理方式",rules:[{required:!0,message:"请选择处理方式"}]},{default:d(()=>[n(r,{value:v(p).type,"onUpdate:value":o[0]||(o[0]=c=>v(p).type=c),column:4,options:U},{image:d(({image:c})=>[h("img",{src:c},null,8,ce)]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["confirmLoading"])}}});const me=X(ie,[["__scopeId","data-v-ff372c58"]]);export{me as default};
