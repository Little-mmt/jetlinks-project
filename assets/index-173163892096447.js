import{g as $,au as D,o as b,Z as L,dC as Z,aT as q,cY as U,d3 as W}from"./index-1731638920964.js";import"./index-1731638920964282.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import{h as X,a as P,b as z}from"./firmware-1731638920964.js";import{k as G,r as J,o as K,ab as B,U as t,V as k,X as s,f as a,E as n,_ as m,Y as i,u as w,$ as r,Z as I,F as Q,d as x,af as ee,ag as se}from"./vue-1731638920964.js";const F=f=>(ee("data-v-850bce2a"),f=f(),se(),f),ae={class:"generalInfo"},te={class:"allOperation"},oe={class:"progress"},ne={style:{width:"90%"}},ie=F(()=>m("span",null,"当前进度",-1)),le={class:"total"},ce={key:3,class:"state"},de={key:0},re={key:1},ue={key:2},pe=F(()=>m("span",{class:"tip"},"关闭弹窗不会影响任务执行状态",-1)),_e=x({name:"TaskDetail"}),me=Object.assign(_e,{props:{data:{type:Object,default:{}},deviceId:{type:String}},emits:["closeDetail","refresh"],setup(f,{emit:C}){const u=f,M=[{title:"设备名称",dataIndex:"deviceName",key:"deviceName"},{title:"所属产品",dataIndex:"productName",key:"productName"},{title:"创建时间",key:"createTime",dataIndex:"createTime",width:200},{title:"完成时间",key:"completeTime",dataIndex:"completeTime"},{title:"固件版本",key:"version",dataIndex:"version",width:100},{title:"状态",dataIndex:"state",width:300,key:"state"}],N=G(),v=J({total:0,percent:0}),O=(l,c)=>l.deviceId===u.deviceId?"heightLightRow":"",g=async()=>{var p;const l={paging:!1,sorts:[{name:"createTime",order:"desc"},{name:"upgradeTime",order:"desc"}],terms:[{terms:[{column:"taskId",value:(p=u==null?void 0:u.data)==null?void 0:p.id}]}]},c=await X(l);if(c.status===200){N.value=c.result,v.total=c.result.length;let _=0;c.result.forEach(y=>{var h;((h=y==null?void 0:y.state)==null?void 0:h.value)==="success"&&(_+=1)}),v.percent=(_/v.total).toFixed(2)*100}},R=async()=>{C("refresh"),await g(),b("操作成功")},S=async()=>{(await P(u.data.id,["canceled","failed"])).success&&(b("操作成功","success"),g(),C("refresh"))},E=async()=>{(await P(u.data.id,["failed"])).success&&(b("操作成功","success"),g(),C("refresh"))},H=async()=>{(await z(u.data.id)).success&&(b("操作成功","success"),g(),C("refresh"))};return K(()=>{g()}),(l,c)=>{const p=B("AIcon"),_=L,y=Z,h=B("Ellipsis"),V=q,j=U,A=W;return t(),k(A,{visible:"",title:"任务详情",width:1200,closable:!1,maskClosable:!1},{footer:s(()=>[pe,a(j,{value:"large",type:"primary",onClick:c[0]||(c[0]=T=>l.$emit("closeDetail"))},{default:s(()=>[n("关闭")]),_:1})]),default:s(()=>{var T,Y;return[m("div",ae,[m("div",te,[a(_,{onClick:H,hasPermission:"device/Firmware:update"},{icon:s(()=>[a(p,{type:"PauseOutlined"})]),default:s(()=>[n("全部暂停 ")]),_:1}),a(_,{style:{"margin-left":"20px"},hasPermission:"device/Firmware:update",onClick:S},{icon:s(()=>[a(p,{type:"CaretRightOutlined"})]),default:s(()=>[n("全部开始")]),_:1}),((Y=(T=f.data)==null?void 0:T.mode)==null?void 0:Y.value)==="push"?(t(),k(_,{key:0,style:{"margin-left":"20px"},hasPermission:"device/Firmware:update",onClick:E},{icon:s(()=>[a(p,{type:"RedoOutlined"})]),default:s(()=>[n(" 批量重试 ")]),_:1})):i("",!0),a(_,{type:"text",hasPermission:"device/Firmware:update",style:{float:"right"},onClick:R},{icon:s(()=>[a(p,{type:"RedoOutlined"})]),default:s(()=>[n(" 刷新状态 ")]),_:1})]),m("div",oe,[m("div",ne,[ie,a(y,{style:{width:"90%","margin-left":"20px"},strokeWidth:10,percent:w(v).percent,format:d=>`${d}%`},null,8,["percent","format"])]),m("span",le,"共"+r(w(v).total)+"个任务",1)])]),a(V,{columns:M,"data-source":w(N),pagination:!1,rowClassName:O,scroll:{y:400}},{bodyCell:s(({column:d,text:e,record:o})=>[d.dataIndex==="deviceName"||d.dataIndex==="productName"?(t(),k(h,{key:0,style:{width:"100%"}},{default:s(()=>[n(r(e),1)]),_:2},1024)):i("",!0),d.dataIndex==="createTime"?(t(),k(h,{key:1,style:{width:"100%"}},{default:s(()=>[n(r(w(D)(e).format("YYYY-MM-DD HH:mm:ss")),1)]),_:2},1024)):i("",!0),d.dataIndex==="completeTime"?(t(),k(h,{key:2,style:{width:"100%"}},{default:s(()=>[n(r(e?w(D)(e).format("YYYY-MM-DD HH:mm:ss"):"--"),1)]),_:2},1024)):i("",!0),d.dataIndex==="state"?(t(),I("div",ce,[a(y,{type:"circle",style:{"margin-right":"10px"},width:20,showInfo:!1,trailColor:"#f0f0f0",percent:(e==null?void 0:e.value)==="failed"?"100":o==null?void 0:o.progress,status:(e==null?void 0:e.value)==="failed"?"exception":""},null,8,["percent","status"]),(e==null?void 0:e.value)==="processing"||(e==null?void 0:e.value)==="success"?(t(),I("div",de,r((o==null?void 0:o.progress)+"%"),1)):i("",!0),(e==null?void 0:e.value)==="failed"?(t(),I("div",re,r((e==null?void 0:e.text)+"："+(o==null?void 0:o.errorReason)),1)):i("",!0),(e==null?void 0:e.value)==="waiting"||(e==null?void 0:e.value)==="canceled"?(t(),I("div",ue,r(e==null?void 0:e.text),1)):i("",!0)])):i("",!0),d.dataIndex==="version"?(t(),I(Q,{key:4},[n(r(e||"--"),1)],64)):i("",!0)]),_:1},8,["data-source"])]}),_:1})}}}),Ie=$(me,[["__scopeId","data-v-850bce2a"]]);export{Ie as default};
