import{X as W,h as Y,o as b,a4 as z,Z as G,ds as H,a0 as K,a1 as Q,$ as P,a2 as ee,a3 as te,g as se}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{m as ae,b as j,n as ne,o as oe,r as ie}from"./accessConfig-1730252110824.js";import{a as le}from"./setting-17302521108242.js";import ce from"./index-1730252110824132.js";import{d as $,k as f,ab as g,U as p,V as m,X as t,_ as r,f as n,u as _,E as w,W as re,R as de,$ as u,Y as v,Z as pe,F as ue,af as me,ag as _e}from"./vue-1730252110824.js";import"./index-1730252110824299.js";import"./FirstKind-1730252110824.js";import"./data-17302521108246.js";import"./index-1730252110824133.js";import"./index-1730252110824288.js";import"./SecondKind-1730252110824.js";import"./index-1730252110824300.js";import"./ThirdKind-1730252110824.js";import"./FourthKind-1730252110824.js";import"./FifthKind-1730252110824.js";import"./SixthKind-1730252110824.js";const fe=y=>(me("data-v-76acf588"),y=y(),_e(),y),ge=["src"],ye={class:"card-item-content"},ve={class:"card-title"},he={class:"card-item-content-text-title"},xe=fe(()=>r("div",{class:"card-item-content-text-title"}," 协议 ",-1)),ke=$({name:"AccessConfigPage"}),Ce=$({...ke,setup(y){const I=W(),h=f({}),S=f({}),x=f(!1),A=f();let T=f([]);const k=new Map;k.set("enabled","success"),k.set("disabled","error");const D=[{title:"名称",dataIndex:"name",key:"name",search:{type:"string"}},{title:"网关类型",dataIndex:"provider",key:"provider",search:{type:"select",options:async()=>{const e=await j();return le(e.result||[]).filter(i=>i.id!=="modbus-tcp"&&i.id!=="opc-ua")}}},{title:"状态",dataIndex:"state",key:"state",search:{type:"select",options:[{label:"禁用",value:"disabled"},{label:"正常",value:"enabled"}]},scopedSlots:!0},{title:"说明",dataIndex:"description",key:"description",search:{type:"string"}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],F=e=>{if(!e)return[];const o=e.state.value,i=o==="enabled"?"禁用":"启用";return[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:async()=>{R(e.id)}},{key:"action",text:i,tooltip:{title:i},icon:o==="enabled"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${i}?`,onConfirm:()=>{let l=o==="enabled"?ne(e.id):oe(e.id);return l.then(s=>{var d;s.success&&(b("操作成功","success"),(d=h.value)==null||d.reload())}),l}}},{key:"delete",text:"删除",disabled:o==="enabled",tooltip:{title:o==="enabled"?"请先禁用，再删除":"删除"},popConfirm:{title:"确认删除?",onConfirm:()=>{const l=ie(e.id);return l.then(s=>{s.status===200?(b("操作成功","success"),h.value.reload()):b(s==null?void 0:s.message,"error")}),l}},icon:"DeleteOutlined"}]};(async()=>{const e=await j();T.value=e.result})();const N=()=>{I.jumpPage("link/AccessConfig/Detail",{id:":id"},{view:!1})},R=e=>{I.jumpPage("link/AccessConfig/Detail",{id:e},{view:!1})},V=e=>{x.value=!0,A.value=e},O=e=>{var o,i;return e.description?e.description:(i=(o=T.value)==null?void 0:o.find(l=>l.id===e.provider))==null?void 0:i.description},J=e=>e.channelInfo.addresses[0].health===-1?"error":"processing",M=e=>{var i;const o=z(e);(i=o.terms)!=null&&i.length&&o.terms.forEach(l=>{l.terms=l.terms.map(s=>(s.column==="provider"&&(s.value==="collector-gateway"?(s.termType=s.termType==="eq"?"in":"nin",s.value=["opc-ua","modbus-tcp","collector-gateway"]):Array.isArray(s.value)&&s.value.includes("collector-gateway")&&(s.value=["opc-ua","modbus-tcp",...s.value])),s))}),S.value=o};return(e,o)=>{const i=g("pro-search"),l=g("AIcon"),s=G,d=g("Ellipsis"),B=H,C=K,E=Q,q=P,L=ee,X=te,Z=g("FullPage"),U=g("page-container");return p(),m(U,null,{default:t(()=>[r("div",null,[n(i,{columns:D,target:"search-link-access-config",onSearch:M}),n(Z,null,{default:t(()=>[n(X,{ref_key:"tableRef",ref:h,model:"CARD",columns:D,request:_(ae),defaultParams:{sorts:[{name:"createTime",order:"desc"}]},gridColumn:"2",gridColumns:[1,2],params:_(S)},{headerTitle:t(()=>[n(s,{type:"primary",onClick:N,hasPermission:"link/AccessConfig:add"},{icon:t(()=>[n(l,{type:"PlusOutlined"})]),default:t(()=>[w(" 新增 ")]),_:1})]),card:t(a=>[n(L,re({showStatus:!0,value:a,actions:F(a)},a,{status:a.state.value,statusText:a.state.text,statusNames:{enabled:"processing",disabled:"error"},onClick:c=>V(a)}),{img:t(()=>[de(e.$slots,"img",{},()=>[r("img",{src:_(Y)("/device-access.png")},null,8,ge)],!0)]),content:t(()=>[r("div",ye,[n(d,{style:{width:"calc(100% - 100px)"}},{default:t(()=>[r("span",ve,u(a.name),1)]),_:2},1024),n(E,{class:"card-item-content-box"},{default:t(()=>[a.channelInfo?(p(),m(C,{key:0,span:12,class:"card-item-content-text"},{default:t(()=>[n(d,{style:{width:"calc(100% - 100px)"}},{default:t(()=>[r("div",he,u(a.channelInfo.name),1)]),_:2},1024),a.channelInfo.addresses?(p(),m(d,{key:0,style:{width:"calc(100% - 10px)",display:"flex","margin-top":"4px"}},{default:t(()=>[n(B,{status:J(a)},null,8,["status"]),r("span",null,u(a.channelInfo.addresses[0].address),1)]),_:2},1024)):v("",!0)]),_:2},1024)):v("",!0),a.protocolDetail?(p(),m(C,{key:1,span:12,class:"card-item-content-text"},{default:t(()=>[xe,n(d,{style:{width:"calc(100% - 10px)"},lineClamp:2},{default:t(()=>[r("div",null,u(a.protocolDetail.name),1)]),_:2},1024)]),_:2},1024)):v("",!0)]),_:2},1024),n(E,null,{default:t(()=>[n(C,{span:24,class:"card-item-content-description"},{default:t(()=>[n(q,null,{title:t(()=>[w(u(O(a)),1)]),default:t(()=>[w(" "+u(O(a)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),actions:t(c=>[n(s,{disabled:c.disabled,popConfirm:c.popConfirm,tooltip:{...c.tooltip},onClick:c.onClick,hasPermission:"link/AccessConfig:"+c.key},{default:t(()=>[c.key==="delete"?(p(),m(l,{key:0,type:"DeleteOutlined"})):(p(),pe(ue,{key:1},[n(l,{type:c.icon},null,8,["type"]),r("span",null,u(c==null?void 0:c.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["value","actions","status","statusText","onClick"])]),state:t(a=>[n(B,{text:a.state.text,status:_(k).get(a.state.value)},null,8,["text","status"])]),_:3},8,["request","params"])]),_:3})]),_(x)?(p(),m(ce,{key:0,data:_(A),onCloseDrawer:o[0]||(o[0]=a=>x.value=!1)},null,8,["data"])):v("",!0)]),_:3})}}});const We=se(Ce,[["__scopeId","data-v-76acf588"]]);export{We as default};
