import{d as T,ai as x,R as j}from"./vue-1730252110824.js";import{u as N}from"./scene-17302521108242.js";import{F as b,g4 as J,dG as R}from"./index-1730252110824.js";import{l as V}from"./product-17302521108244.js";import{g as E}from"./department-17302521108242.js";const G=T({name:"CheckItem"}),M=T({...G,setup(L){const C=N(),{data:a}=x(C),F=b.useInjectFormItemContext(),O=()=>{F.onFieldChange()},q=async()=>{var l,u,f,d,m,g,v,h,P,I,y,_,k,w,S;const e=a.value.trigger.device,c=e.productId,n=await V({terms:[{terms:[{column:"id",termType:"eq",value:c}]}]});if(n.success&&((l=n.result)==null?void 0:l.total)===0)return a.value.trigger.device.productId="",!1;const p=(f=(u=n==null?void 0:n.result)==null?void 0:u.data)==null?void 0:f[0],s=(d=e.selectorValues)==null?void 0:d.map(t=>t.value);let i=JSON.parse((p==null?void 0:p.metadata)||"{}");if(e.selector==="fixed"){const t=await J({terms:[{terms:[{column:"id",termType:"in",value:s==null?void 0:s.toString()}]}]});if(t.success&&t.result.length!==s.length)return a.value.trigger.device.selectorValues=void 0,!1;if(s.length===1){const r=await R(s[0]),o=r==null?void 0:r.result;i=JSON.parse((o==null?void 0:o.metadata)||"{}")}}else if(e.selector==="org"){const t=await E({paging:!1,terms:[{column:"id",termType:"eq",value:s[0]}]});if(t.success&&t.result.length!==s.length)return a.value.trigger.device.selectorValues=void 0,!1}if(["readProperty","writeProperty"].includes((m=e.operation)==null?void 0:m.operator)){let t=!1;if((g=i.properties)!=null&&g.length){if((v=e.operation)!=null&&v.readProperties&&((h=e.operation)!=null&&h.readProperties.length))t=e.operation.readProperties.every(r=>i.properties.some(o=>o.id===r));else if((P=e.operation)!=null&&P.writeProperties&&Object.keys((I=e.operation)==null?void 0:I.writeProperties).length){const r=Object.keys((y=e.operation)==null?void 0:y.writeProperties)[0];t=i.properties.some(o=>r===o.id)}}if(!t)return((_=e.operation)==null?void 0:_.operator)==="readProperty"?e.operation.readProperties=[]:e.operation.writeProperties={},!1}if(((k=e.operation)==null?void 0:k.operator)==="invokeFunction"){let t=!1;if(i.functions.length){const r=(w=e.operation)==null?void 0:w.functionId;t=i.functions.some(o=>r===o.id)}if(!t)return e.operation.functionId=void 0,e.operation.functionParameters=[],!1}if(((S=e.operation)==null?void 0:S.operator)==="reportEvent"){let t=!1;if(i.events.length){const r=e.operation.eventId;t=i.events.some(o=>r===o.id)}if(!t)return e.operation.eventId=void 0,!1}return!0};return(async()=>{var e;(e=a.value.trigger)!=null&&e.device&&(await q()||O())})(),(e,c)=>j(e.$slots,"default")}});export{M as _};
