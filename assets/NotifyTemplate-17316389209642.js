import{Z as A,a0 as j,a1 as L,J as O,a2 as V,a3 as q,g as z}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{T as F}from"./template-1731638920964.js";import{M as K,N as Z}from"./const-17316389209642.js";import{_ as G,n as H}from"./data-17316389209647.js";import{d as U,k as v,w as W,ab as T,U as X,Z as Y,_ as c,f as n,X as s,E as g,W as P,u as S,R as Q,$ as y,F as ee,af as te,ag as ae}from"./vue-1731638920964.js";const b=d=>(te("data-v-8d07a73c"),d=d(),ae(),d),oe={class:"header"},ne={class:"alert"},se={style:{"max-height":"400px","overflow-y":"auto"}},ie=["src"],le={style:{"font-size":"16px","font-weight":"600"}},ce=b(()=>c("div",{class:"card-item-content-text"}," 通知方式 ",-1)),re=b(()=>c("div",{class:"card-item-content-text"},"说明",-1)),de={style:{height:"30px"}},pe=U({__name:"NotifyTemplate",props:{notifierId:{type:String,default:""},value:{type:String,default:""},notifyType:{type:String,default:""}},emits:["update:value","change","update:detail"],setup(d,{emit:i}){const p=d,N=(e,t)=>{var a;return(a=K[e].find(_=>_.value===t))==null?void 0:a.logo},k=e=>{var t;return(t=Z.find(a=>a.value===e))==null?void 0:t.label},x=v(),I=v({}),l=v([]),w=[{title:"名称",dataIndex:"name",key:"name",search:{type:"string"}},{title:"ID",dataIndex:"id",key:"id",search:{type:"string"}},{title:"说明",dataIndex:"description",key:"description",search:{type:"string"}}],E=e=>{I.value=e},R=e=>{l.value.includes(e.id)?(l.value=[],i("update:value",void 0),i("change",{templateName:void 0,value:void 0}),i("update:detail",void 0)):(l.value=[e.id],i("update:value",e.id),i("change",{templateName:e==null?void 0:e.name,value:e==null?void 0:e.id}),i("update:detail",e))},B=e=>{l.value=[...e]},D=async e=>{const t=[{name:"id",value:p.value},{name:"createTime",order:"desc"}],a=await F.getListVariableByConfigId(p.notifierId,{...e,sorts:t}),_=((a==null?void 0:a.result)||[]).filter(r=>{var f;const m=G.get(r.type);return(((f=r==null?void 0:r.variableDefinitions)==null?void 0:f.map(u=>u==null?void 0:u.id))||[]).includes(m)});return{code:a.message,result:{data:_,pageIndex:0,pageSize:a.result.length,total:a.result.length},status:a.status}},J=()=>{const e=window.open(`${origin}/#/iot/notice/Template/detail/:id?notifyType=${H.get(p.notifyType)}&notifierId=${p.notifierId}`);e.onTabSaveSuccess=t=>{var a;l.value=[t.id],i("update:value",t.id),i("change",{templateName:t==null?void 0:t.name,value:t==null?void 0:t.id}),i("update:detail",t),(a=x.value)==null||a.reload()}};return W(()=>p.value,e=>{e?l.value=[e]:l.value=[]},{deep:!0,immediate:!0}),(e,t)=>{const a=T("pro-search"),_=A,r=T("AIcon"),m=T("Ellipsis"),h=j,f=L,u=O,M=V,$=q;return X(),Y(ee,null,[c("div",oe,[n(a,{columns:w,type:"simple",target:"action-notice-template",onSearch:E,style:{"padding-bottom":"0"}}),n(_,{onClick:J,type:"primary",hasPermission:["notice/Template:add"]},{default:s(()=>[g(" 新增 ")]),_:1})]),c("div",ne,[n(r,{type:"InfoCircleOutlined"}),g(" 已规定固定收信人的模板在当前页面将被过滤 ")]),c("div",se,[n($,{columns:w,request:o=>D(o),model:"CARD",bodyStyle:{padding:0},ref_key:"tableRef",ref:x,alertRender:!1,params:S(I),gridColumn:3,noPagination:!0,rowSelection:{selectedRowKeys:S(l),onChange:B}},{card:s(o=>[n(M,P({showStatus:!1,value:o,showTool:!1,actions:[]},o,{onClick:R,active:S(l).includes(o.id)}),{img:s(()=>[Q(e.$slots,"img",{},()=>[c("img",{src:N(o.type,o.provider),class:"notify-logo"},null,8,ie)],!0)]),content:s(()=>[n(m,{style:{width:"calc(100% - 100px)"}},{default:s(()=>[c("span",le,y(o.name),1)]),_:2},1024),n(f,null,{default:s(()=>[n(h,{span:12},{default:s(()=>[ce,c("div",null,y(k(o.type)),1)]),_:2},1024),n(h,{span:12},{default:s(()=>[re,n(m,null,{default:s(()=>[g(y(o.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),c("div",de,[n(u,{lineClamp:2},{default:s(()=>{var C;return[g(y(((C=o.template)==null?void 0:C.message)||""),1)]}),_:2},1024)])]),_:2},1040,["value","active"])]),_:3},8,["request","params","rowSelection"])])],64)}}});const Ie=z(pe,[["__scopeId","data-v-8d07a73c"]]);export{Ie as default};
