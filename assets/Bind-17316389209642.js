import{k as r,ac as Z,e as z,o as G,ab as T,U as _,Z as k,f as u,X as p,_ as h,u as i,G as S,F as g,a1 as V,V as x,E as W,$ as Y,Y as H,af as Q,ag as ee}from"./vue-1731638920964.js";import{g as te,a4 as j,ax as ae,aC as ne,cW as se,cX as le,Z as oe,e as ce,a3 as de,d3 as ie}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import"./index-1731638920964292.js";import"./index-1731638920964293.js";import re from"./index-1731638920964158.js";import ue from"./index-1731638920964166.js";import{q as pe}from"./auto-1731638920964.js";import"./cascade-1731638920964.js";import"./index-1731638920964289.js";import"./mediaTool-1731638920964.js";import"./RadioButton-1731638920964.js";import"./channel-17316389209642.js";import"./Share-1731638920964.js";import"./Preset.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./unionBy-1731638920964.js";const A=f=>(Q("data-v-126a2ac2"),f=f(),ee(),f),me={class:"bindControl"},ve={class:"bind_left"},_e=A(()=>h("div",null,"选择设备及目录查看已绑定的通道：",-1)),he={class:"bind_right"},fe={style:{padding:"12px 24px 0",display:"flex"}},Ie=A(()=>h("div",{class:"catalogue"},"当前目录：",-1)),ye={__name:"Bind",props:{cacheDeviceIds:{type:Object,default:()=>({})}},emits:["closeBind","submit"],setup(f,{emit:B}){const y=f,w=r(),m=r([]),D=r(),b=r(!1),O=Z(),n=r(),C=r(),N=r(),l=r({}),R=z(()=>l.value[n.value]?l.value[n.value].channelCatalog:[]),$=[{title:"ID",dataIndex:"channelId",key:"channelId",ellipsis:!0,search:{type:"string"}},{title:"名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string",first:!0}},{title:"厂商",dataIndex:"manufacturer",key:"manufacturer",ellipsis:!0},{title:"安装地址",dataIndex:"address",ellipsis:!0,key:"address",search:{type:"string"}},{title:"状态",dataIndex:"status",key:"status",scopedSlots:!0,width:100,search:{type:"select",options:[{label:"已连接",value:"online"},{label:"未连接",value:"offline"}]}},{title:"操作",key:"action",width:80,scopedSlots:!0}],K=(t,e)=>t?[{key:"view",text:"播放",tooltip:{title:"播放"},icon:"PlayCircleOutlined",onClick:()=>{D.value=j(t),b.value=!0}}]:[],P=(t,e)=>{const a=l.value[n.value].channelIds,o=new Set([...m.value,...a]),c=new Set([...a]);e?(o.add(t.channelId),c.add(t.channelId)):(o.delete(t.channelId),c.delete(t.channelId)),m.value=[...o.values()],l.value[n.value].channelIds=[...c.values()]},U=(t,e,a)=>{const o=l.value[n.value].channelIds,c=new Set([...o,...m.value]),I=new Set([...o]);t?(a.map(d=>{c.add(d.channelId)}),a.map(d=>{I.add(d.channelId)})):(a.map(d=>{c.delete(d.channelId)}),a.map(d=>{I.delete(d.channelId)})),l.value[n.value].channelIds=[...I.values()],m.value=[...c.values()]},E=({dId:t,node:e})=>{const a={...l.value};a[e.id]||(a[e.id]={paths:e.paths,channelCatalog:e.channelCatalog,channelIds:[]},l.value=a),q([])},M=t=>{const e=t,a={terms:[{terms:[{column:"channelId$media-record-schedule-bind-channel$not",value:[{column:"scheduleId",termType:"eq",value:O.params.id}]}]},{column:"catalogType",termType:"eq",value:"device",type:"and"}]};if(y.cacheDeviceIds[n.value]){const{channelIds:o}=y.cacheDeviceIds[n.value];a.terms.push({column:"channelId",termType:"nin",value:o.toString(),type:"and"})}return n.value&&a.terms.push({column:"deviceId",value:n.value,type:"and"}),e.terms=[...a.terms,...e.terms],pe(e)},q=t=>{N.value=t},F=()=>{const t=[];Object.keys(l.value).forEach(e=>{l.value[e].channelIds.length||t.push(e)}),B("submit",ne(l.value,t))};return G(()=>{Object.keys(y.cacheDeviceIds)&&(l.value=j(y.cacheDeviceIds))}),(t,e)=>{const a=se,o=le,c=T("pro-search"),I=T("AIcon"),d=oe,J=ce,L=de,X=ie;return _(),k(g,null,[u(X,{visible:"",title:"绑定通道",width:1200,onCancel:e[2]||(e[2]=s=>B("closeBind")),onOk:F},{default:p(()=>[h("div",me,[h("div",ve,[_e,u(re,{type:"unBind",deviceId:i(n),"onUpdate:deviceId":e[0]||(e[0]=s=>S(n)?n.value=s:null),channelId:i(C),"onUpdate:channelId":e[1]||(e[1]=s=>S(C)?C.value=s:null),onSelect:E},null,8,["deviceId","channelId"])]),h("div",he,[h("div",fe,[Ie,u(o,null,{default:p(()=>[(_(!0),k(g,null,V(i(R),s=>(_(),x(a,null,{default:p(()=>[W(Y(s),1)]),_:2},1024))),256))]),_:1})]),u(c,{columns:$,style:{"padding-bottom":"0","margin-bottom":"0"},type:"simple",onSearch:q}),i(n)?(_(),x(L,{key:0,style:{"min-height":"calc(100% - 60px)","padding-top":"0"},ref_key:"tableRef",ref:w,model:"table",rowKey:"channelId",columns:$,request:M,params:i(N),rowSelection:{selectedRowKeys:i(m),onSelect:P,onSelectAll:U,onSelectNone:()=>m.value=[]}},{status:p(s=>[u(ae,{text:s.status.text,status:s.status.value,statusNames:{online:"success",offline:"error"}},null,8,["text","status"])]),action:p(s=>[u(J,{size:16},{default:p(()=>[(_(!0),k(g,null,V(K(s,"table"),v=>(_(),x(d,{key:v.key,disabled:v.disabled,popConfirm:v.popConfirm,type:"link",tooltip:{...v.tooltip},onClick:v.onClick},{default:p(()=>[u(I,{type:v.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick"]))),128))]),_:2},1024)]),_:1},8,["params","rowSelection"])):H("",!0)])])]),_:1}),u(ue,{visible:i(b),"onUpdate:visible":e[3]||(e[3]=s=>S(b)?b.value=s:null),data:i(D),onRefresh:e[4]||(e[4]=s=>i(w).reload())},null,8,["visible","data"])],64)}}},Ee=te(ye,[["__scopeId","data-v-126a2ac2"]]);export{Ee as default};
