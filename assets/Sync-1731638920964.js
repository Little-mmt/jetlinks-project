import{e8 as x,cY as k,aa as v,B as b,P as B,fo as C}from"./index-1731638920964.js";import{p as E}from"./encodeQuery-1731638920964.js";import{i as P}from"./cardManagement-1731638920964.js";import{k as S,r as T,e as j,U as n,V as _,X as p,u as c,E as w,Y as N,_ as i,Z as d,f as V,$ as A,d as $}from"./vue-1731638920964.js";const D={style:{margin:"10px 0px 20px 0px","padding-right":"10px"}},M={key:0},O=i("div",null,"正在同步物联卡状态",-1),J={key:1},L=$({name:"SyncModal"}),U=Object.assign(L,{props:{params:{type:Object,default:()=>({})}},emits:["close"],setup(m,{emit:f}){const u=m,s=S(!0),e=T({count:0,total:0,error:0}),y=j(()=>e.total?((e.error+e.count)/e.total*100).toFixed(2):0),g=()=>{f("close")},h=()=>{const o=E(u.params),r=new URLSearchParams;Object.keys(o).forEach(t=>{o[t]&&r.append(t,o[t])});const l=`${b}/network/card/state/_sync?:X_Access_Token=${B()}&${r}`,a=new C.EventSourcePolyfill(l);a.onmessage=t=>{e.count+=Number(t.data),e.count>=e.total&&(a.close(),s.value=!1)},a.onerror=t=>{a.close(),s.value=!1}};return(()=>{P(u.params).then(o=>{o.success&&(e.total=o.result,h())})})(),(o,r)=>{const l=x,a=k,t=v;return n(),_(t,{visible:"",width:"800px",maskClosable:!1,title:"同步",closable:!1},{footer:p(()=>[c(s)?N("",!0):(n(),_(a,{key:0,type:"primary",onClick:g},{default:p(()=>[w("完成")]),_:1}))]),default:p(()=>[i("div",D,[c(s)?(n(),d("div",M,[O,V(l,{percent:c(y)},null,8,["percent"])])):(n(),d("div",J,[i("p",null,A(c(e).count)+"张物联卡已同步至最新状态",1)]))])]),_:1})}}}),I=U;export{I as default};
