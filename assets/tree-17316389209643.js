import{J as w,dg as T,g as C}from"./index-1731638920964.js";import"./index-1731638920964281.js";import{c as v}from"./cascade-1731638920964.js";import{d as D,k as g,ab as S,U as h,Z as N,f as x,X as p,_ as V,u as _,V as B,Y as K,E as k,$ as z,G as A}from"./vue-1731638920964.js";const E={class:"left-content"},J={class:"name"},b=D({__name:"tree",emits:["onSelect"],setup(j,{emit:I}){const c=g([]),y=(a,{node:e})=>{I("onSelect",{dId:e.deviceId,cId:e.channelId})},f=a=>!a.channelNumber,n=g([]);(async()=>{const a=await v.getMediaTree({paging:!1});a.success&&(n.value=a.result.sort((e,t)=>t.createTime-e.createTime).map(e=>{const t={};return t.isLeaf=f(e),{...e,...t}}),n.value.length>0&&n.value[0]&&o(n.value[0].id,{pageIndex:0,pageSize:100,terms:[{column:"deviceId",value:n.value[0].id}]},!0))})();const m=(a,e,t)=>a.map(s=>s.id===e?{...s,children:s.children?[...s.children,...t]:t}:s.children?{...s,children:m(s.children,e,t)}:s),o=(a,e,t)=>new Promise(async s=>{const r=await v.queryChannelList(e);if(r.status===200){const{total:i,pageIndex:l,pageSize:d}=r.result;n.value=m(n.value,a,r.result.data.map(u=>({...u,class:u.status.value,isLeaf:f(u)}))),i>(l+1)*d&&setTimeout(()=>{o(a,{...e,pageIndex:e.pageIndex+1})},50),t&&c.value.push(n.value[0].id),s(r.result)}}),L=({key:a,children:e})=>new Promise(async t=>{if(e){t();return}await o(a,{pageIndex:0,pageSize:100,terms:[{column:"deviceId",value:a}]}),t()});return(a,e)=>{const t=S("AIcon"),s=w,r=T;return h(),N("div",E,[x(r,{height:700,"show-line":{showLeafIcon:!1},"show-icon":!0,"tree-data":_(n),loadData:L,fieldNames:{title:"name",key:"id"},onSelect:y,expandedKeys:_(c),"onUpdate:expandedKeys":e[0]||(e[0]=i=>A(c)?c.value=i:null)},{title:p(({id:i,name:l})=>[V("div",J,[_(n).find(d=>d.id===i)?K("",!0):(h(),B(t,{key:0,type:"VideoCameraOutlined",style:{"margin-right":"5px"}})),x(s,null,{default:p(()=>[k(z(l),1)]),_:2},1024)])]),icon:p(()=>[]),_:1},8,["tree-data","expandedKeys"])])}}});const O=C(b,[["__scopeId","data-v-ed945738"]]);export{O as default};
