import{N as T,h as J,p as X,q as Z,O as z,A as G,P as H,Q as W,R as ee,T as L,t as te,n as se,d as oe,I as ne,v as ae,w as ie,F as le,g as re}from"./index-1731638920964.js";import{g as ce}from"./home-1731638920964.js";import{e as ue}from"./encrypt-1731638920964.js";import{d as F,k as d,r as A,U as w,Z as C,f as l,X as c,u as i,_ as o,F as R,$ as V,E as O,V as de,Y as B,af as _e,ag as pe}from"./vue-1731638920964.js";const q=k=>(_e("data-v-393aa7d4"),k=k(),pe(),k),me={class:"oauth-warp"},fe={key:0,class:"oauth"},ge={class:"oauth-header"},ve={class:"oauth-header-left"},he=["src"],ye={class:"oauth-content"},we={class:"oauth-content-header"},ke=["src"],be=q(()=>o("h2",null,"授权登录",-1)),Ce={class:"oauth-content-content"},Ie={class:"oauth-content-content-text"},xe=q(()=>o("li",null,"获取您的个人信息",-1)),Ae={class:"oauth-content-button"},Oe={class:"oauth-content-header"},qe=["src"],Se=q(()=>o("h2",null,"授权登录",-1)),Ue={class:"oauth-content-login"},Ne=["src"],je=F({name:"Oauth"}),Ke=F({...je,setup(k){const g=d(!0),I=d(!1),$=d(""),b=d(""),S=d("-"),U=d("-"),D=d("false"),u=d();document.title=`OAuth授权-${T.title}`,b.value=J(T.layout.logo);const r=A({username:void 0,password:void 0,verifyCode:void 0}),v=A({base64:void 0,key:void 0}),N=d(),x=async t=>{const e=await W(t);e.success&&e.result&&(S.value=e.result.name)},h=async()=>{var e,s,n;if((e=(await X()).result)!=null&&e.enabled){const a=await Z();a.success&&(v.base64=(s=a.result)==null?void 0:s.base64,v.key=(n=a.result)==null?void 0:n.key)}},j=async t=>{console.log(t,u.value);const e=await ee(t||u.value);e.success?window.location.href=e.result:h()},E=()=>{localStorage.removeItem(L),I.value=!1},K=async t=>{var e,s;if(H()){const n=await ce();console.log(u.value,t),n.success?(U.value=(s=(e=n.result)==null?void 0:e.user)==null?void 0:s.name,I.value=!0,x((t==null?void 0:t.client_id)||u.value.client_id),j(t)):n.status===401?(setTimeout(()=>{g.value=!1}),h(),x((t==null?void 0:t.client_id)||u.value.client_id)):setTimeout(()=>{g.value=!1})}else x((t==null?void 0:t.client_id)||u.value.client_id),setTimeout(()=>{g.value=!1})},M=()=>{var _;const t=window.location.href.indexOf("?"),n=(((_=window.location.href.substr(t+1).split("#"))==null?void 0:_[0])||"").split("&"),a=new Map;for(let p=0;p<n.length;p++){const y=n[p].split("="),[f,Y]=y;a.set(f,Y)}return a},m=A({enabled:!1,publicKey:"",id:""}),P=()=>{N.value.validate().then(async t=>{var n,a,_,p;const e=await te();e.status===200&&(n=e.result)!=null&&n.encrypt&&(m.enabled=(a=e.result)==null?void 0:a.encrypt.enabled,m.publicKey=(_=e.result)==null?void 0:_.encrypt.publicKey,m.id=(p=e.result)==null?void 0:p.encrypt.id);const s=await se({verifyKey:v.key,...r,password:m.enabled?ue(r.password,m.publicKey):r.password,encryptId:m.enabled?m.id:void 0});if(s.success){const y=s.result.token;localStorage.setItem(L,y),K()}else h()})},Q=async()=>{var a;let t;location.hash.indexOf("?");const e=M(),s={client_id:e.get("client_id"),state:e.get("state"),redirect_uri:decodeURIComponent(e.get("redirect_uri")),response_type:e.get("response_type"),scope:e.get("scope")},n=e.get("internal");s.redirect_uri&&(`${s.redirect_uri.split("/").slice(0,3).join("/")}${(a=s.redirect_uri)==null?void 0:a.split("redirect=")[1]}`,t=s.redirect_uri),console.log(u),D.value=n,u.value={...s,redirect_uri:t},console.log(u.value),K({...s,internal:e.get("internal"),redirect_uri:t})};return(()=>{z("front").then(t=>{if(t.status===200){const e=document.querySelector('link[rel="icon"]');e.href=t.result.ico,b.value=t.result.logo,t.result.title?document.title=`OAuth授权-${t.result.title}`:document.title="OAuth授权"}})})(),h(),Q(),(t,e)=>{const s=oe,n=ne,a=ae,_=ie,p=le,y=G;return w(),C("div",me,[l(y,{spinning:i(g)},{default:c(()=>[i(g)?B("",!0):(w(),C("div",fe,[o("div",ge,[o("div",ve,[o("img",{src:i($),alt:""},null,8,he)])]),o("div",ye,[i(I)?(w(),C(R,{key:0},[o("div",we,[o("img",{src:i(b)},null,8,ke)]),be,o("div",Ce,[o("div",Ie," 您正在授权登录, "+V(i(S))+" 将获得以下权限: ",1),o("ul",null,[o("li",null,"关联"+V(i(U))+"账号",1),xe]),o("div",Ae,[l(s,{type:"primary",onClick:e[0]||(e[0]=()=>j())},{default:c(()=>[O(" 同意授权 ")]),_:1}),l(s,{type:"primary",onClick:E},{default:c(()=>[O(" 切换账号 ")]),_:1})])])],64)):(w(),C(R,{key:1},[o("div",Oe,[o("img",{src:i(b)},null,8,qe)]),Se,o("div",Ue,[l(p,{layout:"vertical",model:i(r),ref_key:"formRef",ref:N},{default:c(()=>[l(a,{label:"用户名",name:"username",required:"",rules:[{required:!0,message:"请输入用户名"}]},{default:c(()=>[l(n,{placeholder:"用户名",value:i(r).username,"onUpdate:value":e[1]||(e[1]=f=>i(r).username=f)},null,8,["value"])]),_:1}),l(a,{label:"密码",name:"password",required:"",rules:[{required:!0,message:"请输入密码"}]},{default:c(()=>[l(_,{placeholder:"密码",value:i(r).password,"onUpdate:value":e[2]||(e[2]=f=>i(r).password=f)},null,8,["value"])]),_:1}),i(v).base64?(w(),de(a,{key:0,name:"verifyCode",required:"",rules:[{required:!0,message:"请输入验证码"}]},{default:c(()=>[l(n,{placeholder:"请输入验证码",value:i(r).verifyCode,"onUpdate:value":e[3]||(e[3]=f=>i(r).verifyCode=f)},{addonAfter:c(()=>[o("img",{src:i(v).base64,onClick:h,style:{cursor:"pointer"}},null,8,Ne)]),_:1},8,["value"])]),_:1})):B("",!0),l(a,null,{default:c(()=>[l(s,{type:"primary",onClick:P,style:{width:"100%"}},{default:c(()=>[O(" 登录 ")]),_:1})]),_:1})]),_:1},8,["model"])])],64))])]))]),_:1},8,["spinning"])])}}});const Fe=re(Ke,[["__scopeId","data-v-393aa7d4"]]);export{Fe as default};
