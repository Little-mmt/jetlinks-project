import{J as Q,d as W,aa as Y,g as Z}from"./index-1730252110824.js";import{C as aa}from"./config-17302521108242.js";import{T as ea}from"./template-1730252110824.js";import{a as ta}from"./noticeRule-1730252110824.js";import{g as sa}from"./user-17302521108242.js";import{d as oa,k as na,r as la,e as ia,o as da,U as ra,V as ca,X as c,f as u,E as p,_ as a,$ as v,u as h,af as _a,ag as ua}from"./vue-1730252110824.js";const m=f=>(_a("data-v-091fca39"),f=f(),ua(),f),pa={class:"detail"},fa={class:"item"},va=m(()=>a("div",{class:"label"},"通知方式",-1)),ma={class:"value"},ha={class:"item"},ba=m(()=>a("div",{class:"label"},"通知配置",-1)),Ca={class:"value"},ga={class:"item"},ya=m(()=>a("div",{class:"label"},"通知模板",-1)),Ia={class:"value"},ja={class:"item"},wa=m(()=>a("div",{class:"label"},"模版内容",-1)),xa={class:"value"},La={class:"item"},ka=m(()=>a("div",{class:"label"},"模板变量",-1)),Sa={class:"value"},Va={class:"item"},$a=m(()=>a("div",{class:"label"},"用户权限",-1)),Ba={class:"value"},Da=oa({__name:"index",props:{data:{type:Object,default:()=>{}}},emits:["close","save"],setup(f,{emit:w}){const l=f,I=na([]),s=la({notifier:"",template:"",content:"",variables:[],role:"未配置权限"}),G=async()=>{var o,_,i,b,C,g,x,L,k,S,V,$,B,D,J,N,T,E,K,M,O,q,A,R,U,X,z,F;if((_=(o=l.data)==null?void 0:o.channelConfiguration)!=null&&_.notifierId){const t=await aa.detail((b=(i=l.data)==null?void 0:i.channelConfiguration)==null?void 0:b.notifierId);t.status===200&&(s.notifier=(C=t.result)==null?void 0:C.name)}if((x=(g=l.data)==null?void 0:g.channelConfiguration)!=null&&x.templateId){const t=await ea.detail((k=(L=l.data)==null?void 0:L.channelConfiguration)==null?void 0:k.templateId);if(t.status===200&&(s.template=(S=t.result)==null?void 0:S.name,s.content=($=(V=t.result)==null?void 0:V.template)==null?void 0:$.message,(D=(B=t.result)==null?void 0:B.variableDefinitions)!=null&&D.length&&((N=(J=l.data)==null?void 0:J.channelConfiguration)!=null&&N.variables))){const d=(E=(T=l.data)==null?void 0:T.channelConfiguration)==null?void 0:E.variables;if(((K=Object.keys(d))==null?void 0:K.find(e=>{var r;return((r=d==null?void 0:d[e])==null?void 0:r.source)==="upper"}))&&!I.value.length){const e=await ta(l.data.providerId);if(e.status===200){const y=[...new Set(e.result.map(n=>n==null?void 0:n.id)).values()].map(n=>e.result.reverse().find(P=>P.id===n));I.value=y.map(n=>({...n,id:"detail."+n.id}))}}s.variables=(((M=t.result)==null?void 0:M.variableDefinitions)||[]).map(e=>{var y;const r=d==null?void 0:d[e==null?void 0:e.id];return{name:e.name,value:(r==null?void 0:r.value)||((y=I.value.find(n=>r.upperKey===n.id))==null?void 0:y.name)||r.upperKey}})}}if((R=(A=(q=(O=l.data)==null?void 0:O.grant)==null?void 0:q.role)==null?void 0:A.idList)!=null&&R.length){const t=await sa();t.status===200&&(s.role=((F=(z=(X=(U=l.data)==null?void 0:U.grant)==null?void 0:X.role)==null?void 0:z.idList.map(d=>{var j;return(j=((t==null?void 0:t.result)||[]).find(e=>(e==null?void 0:e.id)===d))==null?void 0:j.name}))==null?void 0:F.join(";"))||"未配置权限")}},H=ia(()=>s.variables.map(o=>`${o==null?void 0:o.name} - ${o==null?void 0:o.value}`).join(";"));return da(()=>{G()}),(o,_)=>{const i=Q,b=W,C=Y;return ra(),ca(C,{width:644,visible:"",title:"配置详情",onCancel:_[1]||(_[1]=g=>w("close")),maskClosable:!1},{footer:c(()=>[u(b,{type:"primary",onClick:_[0]||(_[0]=g=>w("close"))},{default:c(()=>[p("确定")]),_:1})]),default:c(()=>[a("div",pa,[a("div",fa,[va,a("div",ma,[u(i,{lineClamp:2},{default:c(()=>[p(v(f.data.name),1)]),_:1})])]),a("div",ha,[ba,a("div",Ca,[u(i,{lineClamp:2},{default:c(()=>[p(v(h(s).notifier),1)]),_:1})])]),a("div",ga,[ya,a("div",Ia,[u(i,{lineClamp:2},{default:c(()=>[p(v(h(s).template),1)]),_:1})])]),a("div",ja,[wa,a("div",xa,[u(i,{lineClamp:2},{default:c(()=>[p(v(h(s).content),1)]),_:1})])]),a("div",La,[ka,a("div",Sa,[u(i,{lineClamp:2},{default:c(()=>[p(v(h(H)),1)]),_:1})])]),a("div",Va,[$a,a("div",Ba,[u(i,{lineClamp:2},{default:c(()=>[p(v(h(s).role),1)]),_:1})])])])]),_:1})}}});const qa=Z(Da,[["__scopeId","data-v-091fca39"]]);export{qa as default};
