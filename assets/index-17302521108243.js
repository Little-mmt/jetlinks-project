import{d as ae,ad as le,r as A,k as y,e as re,w as ce,o as de,ab as M,U as d,Z as p,f as i,X as r,_ as o,u as e,$ as _,Y as w,V as ue,E as R,F as W,a1 as D,G as pe}from"./vue-1730252110824.js";import{h as u,j as _e,u as me,k as ge,S as he,L as C,T as fe,l as ve,m as ye,n as be,p as we,q as xe,s as ke,V as Ce,r as Le,t as Ie,B as je,I as Se,v as Ae,w as Re,C as $e,d as Ee,F as Ue,x as Ve,y as Pe,z as Ke,A as Ne,D as Te,g as Be}from"./index-1730252110824.js";import"./index-1730252110824287.js";import"./index-1730252110824280.js";import{e as Fe}from"./encrypt-1730252110824.js";import{u as Me}from"./useRequest-1730252110824.js";const We=u("/apply/internal-standalone.png"),b=new Map;b.set("dingtalk-ent-app",u("/bind/dingtalk.png"));b.set("wechat-webapp",u("/bind/wechat-webapp.png"));b.set("internal-standalone",u("/apply/internal-standalone.png"));b.set("third-party",u("/apply/third-party.png"));b.set("wechat-miniapp",u("/apply/wechat-miniapp.png"));const De={class:"container"},He={class:"left"},Je=["src"],Oe={key:0,href:"https://beian.miit.gov.cn/#/Integrated/index",target:"_blank",rel:"noopener noreferrer",class:"records"},ze={class:"right"},Ye={class:"content"},qe={class:"top"},Ge={class:"header"},Xe=["src"],Ze={class:"desc"},Qe={class:"main"},et=["src"],tt={key:0,class:"other"},nt={class:"other-text"},ot={class:"other-button"},st=["onClick"],it=["alt","src"],at={class:"more-button"},lt=["onClick"],rt=["alt","src"],ct={key:0,class:"more"},dt={key:0,class:"bottom"},ut={class:"view"},pt={class:"url"},_t={style:{height:"33px"}},mt=["src"],gt={href:"https://view.jetlinks.cn/",target:"_blank",rel:"noopener noreferrer"},ht=ae({__name:"index",setup(ft){const{t:a}=_e(),$=me(),E=ge();le();const U=u("/logo.png"),H=u("/view-logo.png"),J=A({backgroundImage:`url(${U})`}),L=y(!1),I=y(document.body.clientWidth),j=y(document.body.clientHeight),l=A({username:"",password:"",remember:!1,expires:36e5,verifyCode:"",verifyKey:""}),h=A({enabled:!1,publicKey:"",id:""}),V=y(""),P=y(!1),f=y([]);let x=null;const O={username:[{validator(n,t){return t?Promise.resolve():Promise.reject(a("Login.index.265048-13"))}}],password:[{validator(n,t){return t?Promise.resolve():Promise.reject(a("Login.index.265048-14"))}}],verifyCode:[{validator(n,t){return t?Promise.resolve():Promise.reject(a("Login.index.265048-15"))}}]},{loading:K,run:z}=Me(be,{immediate:!1,onSuccess:async n=>{var m;C.set(fe,n.result.token);const t=await ve();if(N(),t.success){const c=t.result.username==="admin";if($.$patch({userInfos:{...t.result,token:n.result.token,isAdmin:t.result.username==="admin"}}),c){const g=await ye();if(g.success&&!((m=g.result)!=null&&m.length)){window.location.href="/#/init-home";return}}}else $.$patch({...n.result});window.location.href="/"},onError(){l.verifyCode="",k(),T()}}),Y=async()=>{let n={};h.enabled&&(n={password:Fe(l.password,h.publicKey),encryptId:h.id}),z({...l,...n})},N=()=>{x&&(window.clearTimeout(x),x=null)},k=async()=>{const n=await we();if(!n.success||n.success&&!n.result.enabled)return;P.value=!0;const t=await xe();t.success&&(V.value=t.result.base64,l.verifyKey=t.result.key,N(),x=setTimeout(()=>{k()},5*60*1e3))},q=()=>{C.removeAll(),ke().then(n=>{n.success&&n.result&&(C.set(Ce,n.result.edition),n.result.edition!=="community"&&Le().then(t=>{t.success&&(f.value=t.result)}))}),E.getFront()},T=async()=>{var t,m,c,g;const n=await Ie();n.status===200&&(t=n.result)!=null&&t.encrypt&&(h.enabled=(m=n.result)==null?void 0:m.encrypt.enabled,h.publicKey=(c=n.result)==null?void 0:c.encrypt.publicKey,h.id=(g=n.result)==null?void 0:g.encrypt.id)},v=re(()=>E.configInfo.front||{}),B=n=>{C.set("onLogin","no"),window.open(`${je}/application/sso/${n.id}/login`),window.onstorage=t=>{t.newValue&&(window.location.href="/")}},F=(n,t)=>{J.backgroundImage=`url(${U})`};return window.onresize=()=>(()=>{I.value=document.body.clientWidth,j.value=document.body.clientHeight})(),ce([()=>I.value,()=>j.value],n=>{F(n[0],n[1])},{deep:!0}),q(),k(),F(I.value,j.value),Te(),de(()=>{T()}),(n,t)=>{const m=Se,c=Ae,g=Re,G=$e,X=Ee,Z=Ue,Q=Ve,ee=M("Ellipsis"),te=Pe,ne=M("AIcon"),oe=Ke,se=Ne;return d(),p("div",null,[i(se,{spinning:e(K),delay:500},{default:r(()=>[o("div",De,[o("div",He,[o("img",{style:{width:"100%",height:"100%"},src:e(v).background||e(u)("/login.png")},null,8,Je),e(v).showRecordNumber?(d(),p("a",Oe,_(e(a)("Login.index.265048-0"))+_(e(v).recordNumber),1)):w("",!0)]),o("div",ze,[o("div",Ye,[o("div",qe,[o("div",Ge,[o("img",{alt:"logo",class:"logo",src:e(v).logo||e(u)("/logo.png")},null,8,Xe)]),o("div",Ze,_(e(v).title||e(he).SYSTEM_NAME),1),o("div",Qe,[i(Z,{layout:"vertical",model:e(l),class:"login-form",onFinish:Y,rules:O},{default:r(()=>[i(c,{label:e(a)("Login.index.265048-2"),name:"username"},{default:r(()=>[i(m,{value:e(l).username,"onUpdate:value":t[0]||(t[0]=s=>e(l).username=s),placeholder:e(a)("Login.index.265048-3"),maxlength:64},null,8,["value","placeholder"])]),_:1},8,["label"]),i(c,{label:e(a)("Login.index.265048-4"),name:"password"},{default:r(()=>[i(g,{value:e(l).password,"onUpdate:value":t[1]||(t[1]=s=>e(l).password=s),placeholder:e(a)("Login.index.265048-5"),maxlength:64},null,8,["value","placeholder"])]),_:1},8,["label"]),e(P)?(d(),ue(c,{key:0,class:"verifyCode",label:e(a)("Login.index.265048-6"),name:"verifyCode"},{default:r(()=>[i(m,{value:e(l).verifyCode,"onUpdate:value":t[3]||(t[3]=s=>e(l).verifyCode=s),autocomplete:"off",maxlength:64,placeholder:e(a)("Login.index.265048-7")},{addonAfter:r(()=>[o("div",null,[o("img",{src:e(V),onClick:t[2]||(t[2]=s=>k())},null,8,et)])]),_:1},8,["value","placeholder"])]),_:1},8,["label"])):w("",!0),i(c,{name:"remember",style:{"text-align":"left"}},{default:r(()=>[i(G,{checked:e(l).remember,"onUpdate:checked":t[4]||(t[4]=s=>e(l).remember=s),onChange:t[5]||(t[5]=()=>e(l).expires=e(l).remember?-1:36e5)},{default:r(()=>[R(_(e(a)("Login.index.265048-8")),1)]),_:1},8,["checked"])]),_:1}),i(c,null,{default:r(()=>[i(X,{loading:e(K),type:"primary","html-type":"submit",class:"login-form-button",block:""},{default:r(()=>[R(_(e(a)("Login.index.265048-9")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),e(f).length?(d(),p("div",tt,[i(Q,{plain:""},{default:r(()=>[o("div",nt,_(e(a)("Login.index.265048-10")),1)]),_:1}),o("div",ot,[(d(!0),p(W,null,D(e(f).slice(0,4),(s,S)=>(d(),p("div",{class:"other-button-item",key:S,onClick:ie=>B(s)},[o("img",{style:{width:"32px",height:"32px"},alt:s.name,src:s.logoUrl||e(b).get(s.provider)||e(We)},null,8,it)],8,st))),128)),i(oe,{trigger:"click",visible:e(L),"onUpdate:visible":t[6]||(t[6]=s=>pe(L)?L.value=s:null),placement:"bottomRight"},{content:r(()=>[i(te,{"max-height":120},{default:r(()=>[o("div",at,[(d(!0),p(W,null,D(e(f).slice(4,e(f).length-1),(s,S)=>(d(),p("div",{class:"more-button-item",key:S,onClick:ie=>B(s)},[o("img",{style:{width:"32px",height:"32px"},alt:s.name,src:s.logoUrl},null,8,rt),i(ee,{style:{"margin-top":"5px",width:`calc(\r
                                                                        100%\r
                                                                    )`,margin:`0\r
                                                                        auto`}},{default:r(()=>[R(_(s.name),1)]),_:2},1024)],8,lt))),128))])]),_:1})]),default:r(()=>[e(f).length>4?(d(),p("div",ct,[i(ne,{class:"moreIcon",type:"MoreOutlined",style:{"font-size":"20px"}})])):w("",!0)]),_:1},8,["visible"])])])):w("",!0)])])]),e(v).recommend==="true"?(d(),p("div",dt,[o("div",ut,_(e(a)("Login.index.265048-11")),1),o("div",pt,[o("div",_t,[o("img",{src:e(H)},null,8,mt)]),o("a",gt,_(e(a)("Login.index.265048-12")),1)])])):w("",!0)])])]),_:1},8,["spinning"])])}}});const Ct=Be(ht,[["__scopeId","data-v-d4e4ca6e"]]);export{Ct as default};
