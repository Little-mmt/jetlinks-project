import{a4 as D,I as J,v as N,a6 as R,a8 as V,a7 as F,C as T,aG as $,a9 as q,F as E,d as G,Z as S,aa as X}from"./index-1730252110824.js";import"./index-1730252110824280.js";import"./index-1730252110824290.js";import{c as Z,s as z,u as H}from"./collector-1730252110824.js";import{O as y}from"./data-17302521108242.js";import{d as K,k as d,o as Q,w as W,U as Y,V as ee,X as s,f as o,E as _,u as a}from"./vue-1730252110824.js";const ue=K({__name:"SaveOPCUA",props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(h,{emit:f}){const c=h,m=d(!1),v=d(),p=c.data.id,w=c.data.collectorId,C=c.data.provider,b=d([]),t=d({name:"",configuration:{type:void 0,interval:3e3},accessModes:[],features:[],description:""}),k=async()=>{var i;const n=await((i=v.value)==null?void 0:i.validate()),{interval:e}=t.value.configuration,r={...c.data,...n,provider:C,collectorId:w,interval:e};m.value=!0;const l=p?await H(p,{...c.data,...r}).catch(()=>{}):await z(r).catch(()=>{});f("change",(l==null?void 0:l.status)===200),m.value=!1},g=()=>{f("change",!1)},x=(n,e)=>e.label.toLowerCase().indexOf(n.toLowerCase())>=0;return Q(()=>{Z().then(n=>{n.status===200&&(b.value=((n==null?void 0:n.result)||[]).map(e=>({label:e,value:e})))})}),W(()=>c.data,n=>{var e,r;if(n.id&&n.provider==="OPC_UA"){const l=D(n);t.value=l,(e=l.accessModes[0])!=null&&e.value&&(t.value.accessModes=n.accessModes.map(i=>i.value)),(r=l.features[0])!=null&&r.value&&(t.value.features=n.features.map(i=>i.value))}},{immediate:!0,deep:!0}),(n,e)=>{const r=J,l=N,i=R,j=V,U=F,M=T,O=$,P=q,I=E,B=G,L=S,A=X;return Y(),ee(A,{title:"编辑",visible:!0,width:"700px",onCancel:g},{footer:s(()=>[o(B,{key:"back",onClick:g},{default:s(()=>[_("取消")]),_:1}),o(L,{key:"submit",type:"primary",loading:a(m),onClick:k,style:{"margin-left":"8px"},hasPermission:`DataCollect/Collector:${a(p)?"update":"add"}`},{default:s(()=>[_(" 确认 ")]),_:1},8,["loading","hasPermission"])]),default:s(()=>[o(I,{class:"form",layout:"vertical",model:a(t),name:"basic",autocomplete:"off",rules:a(y),ref_key:"formRef",ref:v},{default:s(()=>[o(l,{label:"点位名称",name:"name"},{default:s(()=>[o(r,{placeholder:"请输入点位名称",value:a(t).name,"onUpdate:value":e[0]||(e[0]=u=>a(t).name=u)},null,8,["value"])]),_:1}),o(l,{label:"数据类型",name:["configuration","type"]},{default:s(()=>[o(i,{style:{width:"100%"},value:a(t).configuration.type,"onUpdate:value":e[1]||(e[1]=u=>a(t).configuration.type=u),options:a(b),placeholder:"请选择数据类型",allowClear:"","show-search":"","filter-option":x},null,8,["value","options"])]),_:1}),o(l,{label:"访问类型",name:"accessModes"},{default:s(()=>[o(j,{multiple:"",showImage:!1,value:a(t).accessModes,"onUpdate:value":e[2]||(e[2]=u=>a(t).accessModes=u),options:[{label:"读",value:"read"},{label:"写",value:"write"},{label:"订阅",value:"subscribe"}],column:3},null,8,["value"])]),_:1}),o(l,{label:"采集频率",name:["configuration","interval"],rules:[...a(y).interval]},{default:s(()=>[o(U,{style:{width:"100%"},placeholder:"请输入采集频率",value:a(t).configuration.interval,"onUpdate:value":e[3]||(e[3]=u=>a(t).configuration.interval=u),"addon-after":"ms",max:2147483648,min:0},null,8,["value"])]),_:1},8,["rules"]),o(l,{label:"",name:["features"]},{default:s(()=>[o(O,{value:a(t).features,"onUpdate:value":e[4]||(e[4]=u=>a(t).features=u)},{default:s(()=>[o(M,{value:"changedOnly",name:"type"},{default:s(()=>[_("只推送变化的数据")]),_:1})]),_:1},8,["value"])]),_:1}),o(l,{label:"说明",name:["description"]},{default:s(()=>[o(P,{placeholder:"请输入说明",value:a(t).description,"onUpdate:value":e[5]||(e[5]=u=>a(t).description=u),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1})}}});export{ue as _};
