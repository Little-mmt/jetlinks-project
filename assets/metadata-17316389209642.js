import{f as m}from"./product-17316389209644.js";import{eW as f}from"./index-1731638920964.js";const O=(i,r,t,e)=>{if(!t)return t;const s=JSON.parse(t.metadata||"{}");return s[i]=(r||[]).sort((c,o)=>(o==null?void 0:o.sortsIndex)-(c==null?void 0:c.sortsIndex)),t.metadata=JSON.stringify(s),e==null||e(t.metadata),t},g=(i,r)=>{switch(i){case"product":return m(r);case"device":const t=JSON.parse(r.metadata||"{}"),e=JSON.parse((r==null?void 0:r.productMetadata)||"{}"),s=JSON.parse(r.metadata||"{}"),c=new Map;Object.keys(e).forEach(a=>{if(console.log("asyncUpdateMetadata",e,a),Array.isArray(e[a])){const d=e[a].map(n=>n.id);c.set(a,d)}}),Object.keys(t).forEach(a=>{Array.isArray(t[a])&&(s[a]=t[a].filter((d,n)=>!(c.get(a)&&c.get(a).includes(d.id))))});const o=Object.keys(t).reduce((a,d)=>{var u;const n=new Set(((u=e[d])==null?void 0:u.map(p=>p.id))||[]);return console.log(t[d]),a[d]=t[d].filter(p=>!n.has(p.id)),a},{});return console.log(s,o),f(r.id,o)}},S=(i,r,t,e)=>{const s=JSON.parse(t.metadata||"{}"),c=s[i]||[];return s[i]=c.filter(o=>!r.map(a=>a.id).includes(o.id)),e==null||e("remove",r),t.metadata=JSON.stringify(s),t};export{g as a,S as r,O as u};
