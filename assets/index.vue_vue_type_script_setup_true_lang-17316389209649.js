import{dT as R,dU as T,dR as w,d as J,aH as P,I as U,v as V,a0 as $,aD as q,a6 as O,a1 as G,F as H}from"./index-1731638920964.js";import{_ as X}from"./index.vue_vue_type_script_setup_true_lang-17316389209648.js";import{u as Y}from"./instance-1731638920964.js";import{d as Z,ai as z,r as A,k as D,o as K,p as Q,U as h,Z as b,f as a,X as t,E as S,u as c,F as W,a1 as ee,V as x,$ as ae,Y as te}from"./vue-1731638920964.js";const re=Z({__name:"index",props:["childData"],emits:["closeChildSave"],setup(E,{emit:B}){const u=E,F=Y(),{current:l}=z(F),r=A({name:"",productId:""}),j=D(),I=D(),y=D(!1),M=async()=>{const s=await R({terms:[{column:"accessProvider",value:"edge-child-device"}]});s.status===200&&(I.value=s.result,k())},k=()=>{var s,o,_;if((s=u.childData)!=null&&s.id){if(l.value.parentId=u.childData.id,r.name=(o=u.childData)==null?void 0:o.name,r.productId=(_=u.childData)==null?void 0:_.productId,L(r.productId),l.value.metadata){const d=l.value.metadata;d&&d.length!==0&&T(l.value.id,{deviceId:u.childData.id,query:{}}).then(i=>{var e;if(i.status===200){const f=(e=i.result[0])==null?void 0:e.reduce((n,g)=>{const m=d.find(p=>p.metadataId===g.metadataId);return m?Object.assign(m,g):n.push(g),n},d),C=f.filter(n=>n.metadataName);l.value.metadata=C;const v=f.filter(n=>!n.metadataName).map(n=>n.id);v&&v.length!==0&&w(l.value.id,{deviceId:u.childData.id,idList:[...v]})}})}y.value=!0}else l.value.parentId=""},L=s=>{var d,i;s&&(y.value=!0);const o=I.value.filter(e=>e.id===s)[0],_=(i=(d=JSON.parse((o==null?void 0:o.metadata)||"{}"))==null?void 0:d.properties)==null?void 0:i.map(e=>({metadataType:"property",metadataName:`${e.name}(${e.id})`,metadataId:e.id,name:e.name}));l.value.metadata=_};K(()=>{M()}),Q("validate",async()=>j.value.validateFields());const N=()=>{B("closeChildSave")};return(s,o)=>{const _=J,d=P,i=U,e=V,f=$,C=q,v=O,n=G,g=H;return h(),b("div",null,[a(d,{data:"基本信息"},{extra:t(()=>[a(_,{onClick:N,style:{"margin-left":"10px"}},{default:t(()=>[S("返回")]),_:1})]),_:1}),a(g,{layout:"vertical",model:c(r),ref_key:"formRef",ref:j},{default:t(()=>[a(n,{gutter:24},{default:t(()=>[a(f,{span:12},{default:t(()=>[a(e,{label:"设备名称",name:"name",rules:{required:!0,message:"请输入设备名称"}},{default:t(()=>[a(i,{value:c(r).name,"onUpdate:value":o[0]||(o[0]=m=>c(r).name=m)},null,8,["value"])]),_:1})]),_:1}),a(f,{span:12},{default:t(()=>[a(e,{label:"产品名称",name:"productId",rules:{required:!0,message:"请选择产品名称"}},{default:t(()=>{var m;return[a(v,{disabled:(m=u.childData)==null?void 0:m.id,onChange:L,value:c(r).productId,"onUpdate:value":o[1]||(o[1]=p=>c(r).productId=p)},{default:t(()=>[(h(!0),b(W,null,ee(c(I),p=>(h(),x(C,{key:p.id,value:p.id},{default:t(()=>[S(ae(p.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["disabled","value"])]}),_:1})]),_:1})]),_:1}),c(y)?(h(),x(n,{key:0,gutter:24},{default:t(()=>[a(f,{span:24},{default:t(()=>[a(X,{productList:c(I),onClose:N,onGetEdgeMap:k},null,8,["productList"])]),_:1})]),_:1})):te("",!0)]),_:1},8,["model"])])}}});export{re as _};
