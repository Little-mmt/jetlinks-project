import{dY as U,dZ as Y,d_ as b,aD as q,a6 as B,v as D,a0 as J,I as L,d as W,a1 as A,F as K,g as Z}from"./index-1730252110824.js";import{u as X}from"./instance-1730252110824.js";import $ from"./EditTable-17302521108242.js";import{d as z,k as x,r as G,e as H,U as d,Z as g,f as s,X as a,u as o,E as m,V as v,F as C,a1 as h,$ as j,Y as T,J as M,af as Q,ag as ee,_ as te}from"./vue-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";const ae=y=>(Q("data-v-890ff37e"),y=y(),ee(),y),ne={class:"function"},oe=ae(()=>te("div",null,"参数列表",-1)),se=z({__name:"index",emits:["update:modelValue"],setup(y,{expose:F,emit:re}){const R=X(),P=x(),I=(l,e)=>e.label.toLowerCase().indexOf(l.toLowerCase())>=0,w=x(null),t=G({type:void 0,properties:void 0,function:void 0,inputs:[],propertyValue:void 0}),O=H(()=>{var l;return JSON.parse(((l=R.current)==null?void 0:l.metadata)||"{}")}),S=l=>{var e,u;if(l){const p=(((u=(e=O.value)==null?void 0:e.functions.find(n=>n.id===l))==null?void 0:u.inputs)||[]).map(n=>{var c;return{id:n.id,name:n.name,value:void 0,valueType:n==null?void 0:n.valueType,required:(c=n==null?void 0:n.expands)==null?void 0:c.required}});t.inputs=p}},N=async()=>{var u,_,p,n,c;if(!await((u=P.value)==null?void 0:u.validate()))return;const e=M(t);if(e.type==="READ_PROPERTY")await U(((_=R.current)==null?void 0:_.id)||"",[e.properties]);else if(e.type==="WRITE_PROPERTY")await Y(((p=R.current)==null?void 0:p.id)||"",{[e.properties||""]:e.propertyValue});else{if(t.inputs.length&&!await((n=w.value)==null?void 0:n.onSave()))return;const V=(c=(t==null?void 0:t.inputs)||[])==null?void 0:c.filter(f=>!!f.value),E={};V.map(f=>{E[f.id]=f.value}),await b(R.current.id||"",(e==null?void 0:e.function)||"",{...E})}};return F({saveBtn:N}),(l,e)=>{const u=q,_=B,p=D,n=J,c=L,V=W,E=A,f=K;return d(),g("div",ne,[s(f,{layout:"vertical",ref_key:"formRef",ref:P,model:o(t)},{default:a(()=>[s(E,{gutter:24},{default:a(()=>{var k;return[s(n,{span:6},{default:a(()=>[s(p,{name:"type",rules:{required:!0,message:"请选择"}},{default:a(()=>[s(_,{placeholder:"请选择",value:o(t).type,"onUpdate:value":e[0]||(e[0]=r=>o(t).type=r),"show-search":"","filter-option":I},{default:a(()=>[s(u,{value:"READ_PROPERTY"},{default:a(()=>[m("读取属性")]),_:1}),s(u,{value:"WRITE_PROPERTY"},{default:a(()=>[m("修改属性")]),_:1}),s(u,{value:"INVOKE_FUNCTION"},{default:a(()=>[m("调用功能")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),["READ_PROPERTY","WRITE_PROPERTY"].includes(((k=o(t))==null?void 0:k.type)||"")?(d(),v(n,{key:0,span:6},{default:a(()=>[s(p,{name:"properties",rules:{required:!0,message:"请选择属性"}},{default:a(()=>[s(_,{placeholder:"请选择属性",value:o(t).properties,"onUpdate:value":e[1]||(e[1]=r=>o(t).properties=r),"show-search":"","filter-option":I},{default:a(()=>{var r;return[(d(!0),g(C,null,h(((r=o(O))==null?void 0:r.properties)||[],i=>(d(),v(u,{key:i.id,value:i.id,label:i.name},{default:a(()=>[m(j(i.name),1)]),_:2},1032,["value","label"]))),128))]}),_:1},8,["value"])]),_:1})]),_:1})):T("",!0),o(t).type==="WRITE_PROPERTY"?(d(),v(n,{key:1,span:6},{default:a(()=>[s(p,{name:"propertyValue",rules:{required:!0,message:"请输入值"}},{default:a(()=>[s(c,{value:o(t).propertyValue,"onUpdate:value":e[2]||(e[2]=r=>o(t).propertyValue=r)},null,8,["value"])]),_:1})]),_:1})):T("",!0),o(t).type==="INVOKE_FUNCTION"?(d(),v(n,{key:2,span:6},{default:a(()=>[s(p,{name:"function",rules:{required:!0,message:"请选择功能"}},{default:a(()=>[s(_,{placeholder:"请选择功能",value:o(t).function,"onUpdate:value":e[3]||(e[3]=r=>o(t).function=r),"show-search":"","filter-option":I,onChange:S},{default:a(()=>{var r;return[(d(!0),g(C,null,h(((r=o(O))==null?void 0:r.functions)||[],i=>(d(),v(u,{key:i.id,value:i.id,label:i.name},{default:a(()=>[m(j(i.name),1)]),_:2},1032,["value","label"]))),128))]}),_:1},8,["value"])]),_:1})]),_:1})):T("",!0),s(n,{span:4},{default:a(()=>[s(V,{type:"primary",onClick:N},{default:a(()=>[m("发送")]),_:1})]),_:1}),o(t).type==="INVOKE_FUNCTION"&&o(t).function&&o(t).inputs.length?(d(),v(n,{key:3,span:24},{default:a(()=>[oe,s($,{modelValue:o(t).inputs,"onUpdate:modelValue":e[4]||(e[4]=r=>o(t).inputs=r),ref_key:"inputsRef",ref:w},null,8,["modelValue"])]),_:1})):T("",!0)]}),_:1})]),_:1},8,["model"])])}}});const me=Z(se,[["__scopeId","data-v-890ff37e"]]);export{me as default};
