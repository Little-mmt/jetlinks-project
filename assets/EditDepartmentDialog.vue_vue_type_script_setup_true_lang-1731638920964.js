import{a4 as I,o as j,fz as T,v as w,I as B,a7 as U,F as V,aa as q}from"./index-1731638920964.js";import{u as E,e as L}from"./department-17316389209642.js";import{d as F,k as f,e as J,r as M,q as N,U as R,V as S,X as s,f as o,u as l,E as $,$ as z}from"./vue-1731638920964.js";const G=F({__name:"EditDepartmentDialog",props:{treeData:{},data:{},visible:{type:Boolean}},emits:["refresh","update:visible"],setup(g,{emit:c}){const n=g,u=f(""),p=f(!1),x=()=>{var t;p.value=!0,(t=m.value)==null||t.validate().then(()=>a.submit()).then(e=>{j("操作成功"),c("refresh",e.result.id),c("update:visible",!1)}).finally(()=>p.value=!1)},_=J(()=>{if(!n.data.id)return n.treeData;const t=I(n.treeData),e=v(t,n.data.id);return e.disabled=!0,e.children&&e.children.length>0&&h(e.children),t}),v=(t,e)=>{let i=null;for(const d of t){if(d.id===e)return d;if(d.children&&d.children.length>0&&(i=v(d.children,e),i))return i}return null},h=t=>{t.length<1||t.forEach(e=>{e.disabled=!0,e.children&&e.children.length>0&&h(e.children)})},m=f(),a=M({data:{},init:()=>{n.data.id?(u.value="编辑",a.data=I(n.data)):n.data.parentId?(u.value="新增子组织",a.data={name:"",sortIndex:n.data.sortIndex,parentId:n.data.parentId}):(u.value="新增",a.data={name:"",sortIndex:n.data.sortIndex}),N(()=>{var t;(t=m.value)==null||t.clearValidate()})},submit:()=>{var e;const t=a.data.id?E:L;return a.data.parentId=a.data.parentId?a.data.parentId:"",a.data.id&&((e=a.data)!=null&&e.children)&&delete a.data.children,t(a.data)}});a.init();const b=()=>{const t=_.value.find(e=>e.id===a.data.parentId);a.data.sortIndex=t!=null&&t.children?t.children[t.children.length-1].sortIndex+1:1};return(t,e)=>{const i=T,d=w,D=B,y=U,k=V,C=q;return R(),S(C,{visible:"",title:l(u),maskClosable:!1,width:"520px",onCancel:e[3]||(e[3]=r=>c("update:visible",!1)),onOk:x,class:"edit-dialog-container",cancelText:"取消",okText:"确定",confirmLoading:l(p)},{default:s(()=>[o(k,{ref_key:"formRef",ref:m,model:l(a).data,layout:"vertical"},{default:s(()=>[o(d,{name:"parentId",label:"上级组织"},{default:s(()=>[o(i,{value:l(a).data.parentId,"onUpdate:value":e[0]||(e[0]=r=>l(a).data.parentId=r),style:{width:"100%"},placeholder:"请选择上级组织",allowClear:"","tree-data":l(_),"field-names":{value:"id"},onChange:b},{title:s(({name:r})=>[$(z(r),1)]),_:1},8,["value","tree-data"])]),_:1}),o(d,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"}]},{default:s(()=>[o(D,{value:l(a).data.name,"onUpdate:value":e[1]||(e[1]=r=>l(a).data.name=r),placeholder:"请输入名称"},null,8,["value"])]),_:1}),o(d,{name:"sortIndex",label:"排序",rules:[{required:!0,message:"请输入排序"}]},{default:s(()=>[o(y,{style:{width:"100%"},value:l(a).data.sortIndex,"onUpdate:value":e[2]||(e[2]=r=>l(a).data.sortIndex=r),placeholder:"请输入排序",controls:!1,min:0,max:99999999},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","confirmLoading"])}}});export{G as _};
