import{d as Y,ac as fe,k as p,e as he,o as ye,w as we,ab as Ce,U as c,Z as P,f as e,X as a,F as z,a1 as X,u as t,V as f,_ as o,E as _,$ as x,Y as C,a4 as be,af as ke,ag as Ie}from"./vue-1730252110824.js";import{X as Se,h as j,aF as Te,o as Z,an as Pe,ao as xe,I as je,v as Le,a0 as Me,a1 as Oe,a9 as We,F as Ae,du as Ne,ah as Be,ai as Ke,y as De,dp as Ue,Z as qe,af as Ee,aH as Je,d as Re,g as $e}from"./index-1730252110824.js";import"./index-1730252110824284.js";import"./index-1730252110824298.js";import"./index-1730252110824286.js";import{s as Fe,u as Ve,e as He}from"./accessConfig-1730252110824.js";import{P as ze}from"./data-17302521108246.js";import Xe from"./index-1730252110824133.js";import"./index-1730252110824288.js";const g=h=>(ke("data-v-aeaeb4fd"),h=h(),Ie(),h),Ze={class:"steps-content"},Ye={key:0,class:"steps-box"},Ge={class:"alert"},Qe={style:{"margin-top":"42px"}},et={class:"doc"},tt=g(()=>o("h1",null,"操作指引：",-1)),at=g(()=>o("div",null," 1、CTWing端创建应用、产品、设备；配置完成后查看产品详情。其中产品ID以及Master-APIkey在JetLinks平台配置时会使用。 ",-1)),ot={class:"image"},st=g(()=>o("div",null," 2、IOT端创建类型为CTWing的设备接入网关 ",-1)),nt=g(()=>o("div",null," 3、IOT端创建产品，选中接入方式为CTWing，填写CTWing平台中的产品ID、Master-APIkey。 ",-1)),lt={class:"image"},it=g(()=>o("div",null," 4、IOT端添加设备，设备ID需要配置真实设备的IMEI号，配置完成后启用设备（如果启用设备提示错误，请检查CTWing网关参数是否配置正确）。 ",-1)),rt={class:"image"},ct={class:"image"},dt={class:"overLength"},ut={class:"image"},pt=g(()=>o("div",null," 6、以上步骤配置完成后，可以触发真实设备进行上数，在平台对应设备详情页查看设备状态。 ",-1)),_t={class:"image"},mt=g(()=>o("h1",null," 其他说明 ",-1)),gt=g(()=>o("div",null," 在IOT端启用设备时，若CTWing平台没有与之对应的设备，则将在CTWing端自动创建新设备 ",-1)),vt={class:"steps-content"},ft={key:0,class:"steps-box"},ht={class:"alert"},yt={class:"search"},wt={key:0,class:"card-last"},Ct={class:"doc",style:{height:"606px"}},bt=g(()=>o("p",null," 3、添加设备，为每一台设备设置唯一的IMEI、IMSI码（需与OneNet平台中填写的值一致，若OneNet平台没有对应的设备，将会通过OneNet平台提供的LWM2M协议自动创建） ",-1)),kt=Y({name:"AccessCloudCtwing"}),It=Y({...kt,props:{provider:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},bindProduct:{type:Boolean,default:!1}},setup(h){const r=h,G=Se(),Q=window.location.origin,ee=j("/network/01.png"),te=j("/network/02.jpg"),ae=j("/network/03.png"),oe=j("/network/04.jpg"),se=j("/network/05-Ctwing.png"),ne=j("/network/06-Ctwing.png"),W=fe(),le=W.query.view,M=W.params.id,A=p(!1),K=p(),D=p(),d=p({apiAddress:"https://ag-api.ctwing.cn/",appKey:"",appSecret:"",description:""}),b=p({name:"",description:""}),U=he(()=>W.query.view==="false"&&!r.bindProduct),l=p(0),q=p(0),ie=p(["接入配置","消息协议","完成"]),O=p([]),N=p([]),v=p(""),re=i=>{v.value=i},ce=i=>{O.value=i?N.value.filter(s=>s.name&&s.name.toLocaleLowerCase().includes(i.toLocaleLowerCase())):N.value},de=async()=>{var y;const i=await((y=D.value)==null?void 0:y.validate());A.value=!0;const s={...i,configuration:{...d.value,protocol:v.value},protocol:v.value,provider:r.provider.id,transport:"HTTP"},u=M===":id"?await Fe(s):await Ve({...r.data,...s,id:M});u.status===200&&(Z("操作成功","success"),history.back(),window.onTabSaveSuccess&&(window.onTabSaveSuccess(u),setTimeout(()=>window.close(),300))),A.value=!1},E=async(i,s={})=>{const u=await He(ze.get(i),{...s,"sorts[0].name":"createTime","sorts[0].order":"desc",paging:!1});u.status===200&&(O.value=u.result,N.value=u.result)},ue=()=>{var u;const i=(u=G.menus["link/Protocol"])==null?void 0:u.path,s=window.open(`${window.location.origin+window.location.pathname}#${i}?save=true`);s.onTabSaveSuccess=y=>{var k,w;y.success&&(v.value=(k=y.result)==null?void 0:k.id,E((w=r.provider)==null?void 0:w.id))}},pe=async()=>{var i;l.value===0?(await((i=K.value)==null?void 0:i.validate()),E(r.provider.id),l.value=l.value+1):l.value===1&&(v.value?l.value=l.value+1:Z("请选择消息协议！","error"))},_e=()=>{l.value=l.value-1};return ye(()=>{M!==":id"&&(d.value=r.data.configuration,v.value=r.data.protocol,b.value={name:r.data.name,description:r.data.description})}),we(l,i=>{q.value=i},{deep:!0,immediate:!0}),(i,s)=>{const u=Pe,y=xe,k=Ce("AIcon"),w=je,I=Le,m=Me,S=Oe,J=We,R=Ae,T=Ne,L=Be,me=Ke,$=De,ge=Ue,F=qe,ve=Ee,B=Je,V=Re;return c(),P("div",null,[e(y,{class:"steps-steps",current:t(q)},{default:a(()=>[(c(!0),P(z,null,X(t(ie),n=>(c(),f(u,{disabled:"",key:n,title:n},null,8,["title"]))),128))]),_:1},8,["current"]),o("div",Ze,[t(l)===0?(c(),P("div",Ye,[o("div",Ge,[e(k,{type:"InfoCircleOutlined"}),_(" 通过CTWing平台的HTTP推送服务进行数据接入 ")]),o("div",Qe,[e(S,{gutter:[24,24]},{default:a(()=>[e(m,{span:16},{default:a(()=>[e(R,{model:t(d),ref_key:"formRef1",ref:K,name:"basic",autocomplete:"off",layout:"vertical"},{default:a(()=>[e(S,{gutter:[24,24]},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(I,{label:"接口地址",name:"apiAddress",rules:[{required:!0}]},{default:a(()=>[e(w,{value:t(d).apiAddress,"onUpdate:value":s[0]||(s[0]=n=>t(d).apiAddress=n)},null,8,["value"])]),_:1})]),_:1}),e(m,{span:12},{default:a(()=>[e(I,{label:"appKey",name:"appKey",rules:[{required:!0,message:"请输入appKey"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{default:a(()=>[e(w,{value:t(d).appKey,"onUpdate:value":s[1]||(s[1]=n=>t(d).appKey=n),placeholder:"请输入appKey"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:[24,24]},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(I,{label:"appSecret",name:"appSecret",rules:[{required:!0,message:"请输入appSecret"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{default:a(()=>[e(w,{value:t(d).appSecret,"onUpdate:value":s[2]||(s[2]=n=>t(d).appSecret=n),placeholder:"请输入appSecret"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(S,{gutter:[24,24]},{default:a(()=>[e(m,{span:24},{default:a(()=>[e(I,{label:"说明",name:"description"},{default:a(()=>[e(J,{placeholder:"请输入说明",rows:4,value:t(d).description,"onUpdate:value":s[3]||(s[3]=n=>t(d).description=n),"show-count":"",maxlength:200},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(m,{span:8},{default:a(()=>[e($,{height:"500"},{default:a(()=>[o("div",et,[tt,at,o("div",ot,[e(T,{width:"100%",src:t(ee)},null,8,["src"])]),st,nt,o("div",lt,[e(T,{width:"100%",src:t(te)},null,8,["src"])]),it,o("div",rt,[e(T,{width:"100%",src:t(ae)},null,8,["src"])]),o("div",ct,[e(T,{width:"100%",src:t(oe)},null,8,["src"])]),e(me,{bordered:"",size:"small",column:1,labelStyle:{width:"100px"}},{default:a(()=>[e(L,{label:"参数"},{default:a(()=>[_("说明")]),_:1}),e(L,{label:"IMEI"},{default:a(()=>[_("真实设备的IMEI号，需要填写正确，否则推送数据会接收失败")]),_:1}),e(L,{label:"SN"},{default:a(()=>[_(" 真实设备的SN号 ")]),_:1}),e(L,{label:"IMSI"},{default:a(()=>[_(" 真实设备的IMSI号 ")]),_:1}),e(L,{label:"PSK"},{default:a(()=>[_(" 真实设备的PSK，非必填 ")]),_:1})]),_:1}),o("div",dt," 5、CTWing端配置产品/设备/分组级订阅，订阅方URL地址请填写： "+x(`${t(Q)}/api/ctwing/${t(Te)()}/notify`)+"（此处订阅地址可以在JetLinks平台中配置完成CTWing网关后再填写）。 ",1),o("div",ut,[e(T,{width:"100%",src:t(se)},null,8,["src"])]),pt,o("div",_t,[e(T,{width:"100%",src:t(ne)},null,8,["src"])]),mt,gt])]),_:1})]),_:1})]),_:1})])])):C("",!0)]),o("div",vt,[t(l)===1?(c(),P("div",ft,[o("div",ht,[e(k,{type:"InfoCircleOutlined"}),_(" 只能选择HTTP通信方式的协议 ")]),o("div",yt,[e(ge,{allowClear:"",placeholder:"请输入",style:{width:"300px"},onSearch:ce}),t(U)?(c(),f(F,{key:0,type:"primary",onClick:ue,hasPermission:"link/Protocol:add"},{icon:a(()=>[e(k,{type:"PlusOutlined"})]),default:a(()=>[_(" 新增 ")]),_:1})):C("",!0)]),e($,{height:"480"},{default:a(()=>[t(O).length>0?(c(),f(S,{key:0,gutter:[24,24],style:{width:"100%"}},{default:a(()=>[(c(!0),P(z,null,X(t(O),n=>(c(),f(m,{span:8,key:n.id},{default:a(()=>[e(Xe,{onCheckedChange:re,checked:t(v),disabled:!t(U),data:{...n,type:"protocol"}},null,8,["checked","disabled","data"])]),_:2},1024))),128))]),_:1})):(c(),f(ve,{key:1,style:{"margin-top":"10%"},description:"暂无数据"}))]),_:1})])):C("",!0)]),t(l)===2?(c(),P("div",wt,[e(S,{gutter:[24,24]},{default:a(()=>[e(m,{span:12},{default:a(()=>[e(B,{data:"基本信息"}),e(R,{model:t(b),name:"basic",autocomplete:"off",layout:"vertical",ref_key:"formRef2",ref:D},{default:a(()=>[e(I,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{default:a(()=>[e(w,{placeholder:"请输入名称",value:t(b).name,"onUpdate:value":s[4]||(s[4]=n=>t(b).name=n)},null,8,["value"])]),_:1}),e(I,{label:"说明",name:"description"},{default:a(()=>[e(J,{placeholder:"请输入说明",rows:4,value:t(b).description,"onUpdate:value":s[5]||(s[5]=n=>t(b).description=n),"show-count":"",maxlength:200},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1}),e(m,{span:12},{default:a(()=>{var n,H;return[o("div",Ct,[e(B,{data:"配置概览"}),o("p",null,"接入方式："+x(h.provider.name),1),o("p",null,x(h.provider.description),1),o("p",null,"消息协议："+x(t(v)),1),e(B,{data:"设备接入指引"}),o("p",null," 1、创建类型为"+x(((n=r==null?void 0:r.provider)==null?void 0:n.id)==="OneNet"?"OneNet":"CTWing")+"的设备接入网关 ",1),o("p",null," 2、创建产品，并选中接入方式为 "+x(((H=r==null?void 0:r.provider)==null?void 0:H.id)==="OneNet"?"OneNet":"CTWing,选中后需填写CTWing平台中的产品ID、Master-APIkey。"),1),bt])]}),_:1})]),_:1})])):C("",!0),o("div",{class:be(t(l)!==2?"steps-action":"steps-action-save")},[t(l)>0?(c(),f(V,{key:0,onClick:_e,style:{"margin-right":"8px"}},{default:a(()=>[_(" 上一步 ")]),_:1})):C("",!0),t(l)===2&&t(le)==="false"?(c(),f(F,{key:1,type:"primary",style:{"margin-right":"8px"},onClick:de,hasPermission:`link/AccessConfig:${t(M)===":id"?"add":"update"}`,loading:t(A)},{default:a(()=>[_(" 保存 ")]),_:1},8,["hasPermission","loading"])):C("",!0),[0,1].includes(t(l))?(c(),f(V,{key:2,type:"primary",onClick:pe},{default:a(()=>[_(" 下一步 ")]),_:1})):C("",!0)],2)])}}});const At=$e(It,[["__scopeId","data-v-aeaeb4fd"]]);export{At as default};
