import{d as L,k as S,ac as z,w as A,U as r,V as f,X as p,Z as w,u as m,E as I,f as C,F as b,$ as D}from"./vue-1730252110824.js";import{aS as v,d as U,e as V,I as J,aT as q,o as M}from"./index-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import{c as _}from"./channel-17302521108242.js";import{u as O}from"./unionBy-1730252110824.js";const Y=L({__name:"Preset",props:{data:{type:Object,default:()=>({})},share:{type:Boolean,default:!1}},emits:["refresh"],setup(k,{emit:T}){const a=k,B=[{title:"序号",dataIndex:"id",width:60},{title:"预置点位",dataIndex:"name"},{title:"操作",dataIndex:"actions",width:90}],g=new Array(50).fill(0).map((t,d)=>({id:String(d+1),name:`预置点${d+1}`,flag:!1})),y=S(g),c=S(!1),N=z(),x=async(t,d=[])=>{const e={};N.query.type==="gb28181-2016"&&(e.channel=a.data.channelId);const n=await _.opFunction(t,"QueryPreset",e);n.status===200&&(y.value=O([...d,...g],"id").map(o=>{var i;const l=(((i=n.result)==null?void 0:i[0])||[]).find(s=>s.id===o.id);return l?{...l,name:o.name,flag:!0}:o}))},E=async t=>{var e,n;(await _.update(a.data.id,{id:a.data.id,address:a.data.address,channelId:a.data.channelId,description:a.data.description,deviceId:a.data.deviceId,name:a.data.name,manufacturer:a.data.manufacturer,ptzType:((e=a.data.ptzType)==null?void 0:e.value)||0,others:{...(n=a.data)==null?void 0:n.others,preset:t}})).status===200&&T("refresh")},h=(t,d,e)=>{c.value=!0,_.opFunction(t,d,e).then(async n=>{var o,l;if(n.status===200){M("操作成功！");const i=y.value.map(s=>({id:s.id,name:s.name}));(e==null?void 0:e.operation)==="SET"&&await E(i),(o=a.data)!=null&&o.deviceId&&await x((l=a.data)==null?void 0:l.deviceId,i)}}).finally(()=>{c.value=!1})},F=t=>{var e,n;if(!t.id)return;const d={operation:"SET",presetIndex:v(t.id)?Number(t.id):t.id,channel:(e=a.data)==null?void 0:e.channelId};h((n=a.data)==null?void 0:n.deviceId,"Preset",d)},P=t=>{var e,n;if(!t.id)return;const d={operation:"CALL",presetIndex:v(t.id)?Number(t.id):t.id,channel:(e=a.data)==null?void 0:e.channelId};h((n=a.data)==null?void 0:n.deviceId,"Preset",d)},$=t=>{var e,n;if(!t.id)return;const d={operation:"DEL",presetIndex:v(t.id)?Number(t.id):t.id,channel:(e=a.data)==null?void 0:e.channelId};h((n=a.data)==null?void 0:n.deviceId,"Preset",d)};return A(()=>a.data.deviceId,()=>{var t,d,e,n;(t=a.data)!=null&&t.deviceId&&x((d=a.data)==null?void 0:d.deviceId,(n=(e=a.data)==null?void 0:e.others)==null?void 0:n.preset)},{immediate:!0}),(t,d)=>{const e=U,n=V,o=J,l=q;return r(),f(l,{size:"small",columns:B,dataSource:m(y),pagination:!1,scroll:k.share?{y:560}:{y:200}},{bodyCell:p(({column:i,record:s})=>[i.dataIndex==="actions"?(r(),w(b,{key:0},[!s.flag||a.share?(r(),f(e,{key:0,type:"link",style:{padding:"0"},disabled:m(c),onClick:u=>F(s)},{default:p(()=>[I("设置")]),_:2},1032,["disabled","onClick"])):(r(),f(n,{key:1},{default:p(()=>[C(e,{danger:"",type:"link",disabled:m(c),style:{padding:"0"},onClick:u=>$(s)},{default:p(()=>[I("删除")]),_:2},1032,["disabled","onClick"]),C(e,{type:"link",disabled:m(c),style:{padding:"0"},onClick:u=>P(s)},{default:p(()=>[I("调用")]),_:2},1032,["disabled","onClick"])]),_:2},1024))],64)):i.dataIndex==="name"?(r(),f(o,{key:1,disabled:s.flag||a.share,value:s[i.dataIndex],"onUpdate:value":u=>s[i.dataIndex]=u},null,8,["disabled","value","onUpdate:value"])):(r(),w(b,{key:2},[I(D(s[i.dataIndex]),1)],64))]),_:1},8,["dataSource","scroll"])}}});export{Y as _};
