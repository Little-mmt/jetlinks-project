import{k as r,ac as Z,e as z,o as G,ab as T,U as _,Z as C,f as u,X as p,_ as h,u as i,G as k,F as S,a1 as V,V as x,E as W,$ as Y,Y as H,af as Q,ag as ee}from"./vue-1730252110824.js";import{g as te,a4 as j,ax as ne,aC as ae,cW as le,cX as se,Z as oe,e as ce,a3 as de,d3 as ie}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import"./index-1730252110824292.js";import"./index-1730252110824293.js";import re from"./index-1730252110824158.js";import ue from"./index-1730252110824166.js";import{q as pe}from"./auto-1730252110824.js";import"./cascade-1730252110824.js";import"./index-1730252110824289.js";import"./mediaTool-1730252110824.js";import"./RadioButton-1730252110824.js";import"./channel-17302521108242.js";import"./Share-1730252110824.js";import"./Preset.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./unionBy-1730252110824.js";const A=f=>(Q("data-v-9454695b"),f=f(),ee(),f),me={class:"bindControl"},ve={class:"bind_left"},_e=A(()=>h("div",null,"选择设备及目录查看已绑定的通道：",-1)),he={class:"bind_right"},fe={style:{padding:"12px 24px 0",display:"flex"}},Ie=A(()=>h("div",{class:"catalogue"},"当前目录：",-1)),ye={__name:"Bind",props:{cacheDeviceIds:{type:Object,default:()=>({})}},emits:["closeBind","submit"],setup(f,{emit:B}){const y=f,w=r(),m=r([]),D=r(),b=r(!1),O=Z(),a=r(),g=r(),N=r(),s=r({}),R=z(()=>s.value[a.value]?s.value[a.value].channelCatalog:[]),$=[{title:"ID",dataIndex:"channelId",key:"channelId",ellipsis:!0,search:{type:"string"}},{title:"名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string",first:!0}},{title:"厂商",dataIndex:"manufacturer",key:"manufacturer",ellipsis:!0},{title:"安装地址",dataIndex:"address",ellipsis:!0,key:"address",search:{type:"string"}},{title:"状态",dataIndex:"status",key:"status",scopedSlots:!0,width:100,search:{type:"select",options:[{label:"已连接",value:"online"},{label:"未连接",value:"offline"}]}},{title:"操作",key:"action",width:80,scopedSlots:!0}],K=(t,e)=>t?[{key:"view",text:"播放",tooltip:{title:"播放"},icon:"PlayCircleOutlined",onClick:()=>{D.value=j(t),b.value=!0}}]:[],P=(t,e)=>{const n=s.value[a.value].channelIds,o=new Set([...m.value,...n]),c=new Set([...n]);e?(o.add(t.channelId),c.add(t.channelId)):(o.delete(t.channelId),c.delete(t.channelId)),m.value=[...o.values()],console.log(c),s.value[a.value].channelIds=[...c.values()]},U=(t,e,n)=>{const o=s.value[a.value].channelIds,c=new Set([...o,...m.value]),I=new Set([...o]);t?(n.map(d=>{c.add(d.channelId)}),n.map(d=>{I.add(d.channelId)})):(n.map(d=>{c.delete(d.channelId)}),n.map(d=>{I.delete(d.channelId)})),s.value[a.value].channelIds=[...I.values()],m.value=[...c.values()]},E=({dId:t,node:e})=>{const n={...s.value};n[e.id]||(n[e.id]={paths:e.paths,channelCatalog:e.channelCatalog,channelIds:[]},s.value=n),q([])},M=t=>{const e=t,n={terms:[{terms:[{column:"channelId$media-record-schedule-bind-channel$not",value:[{column:"scheduleId",termType:"eq",value:O.params.id}]}]},{column:"catalogType",termType:"eq",value:"device",type:"and"}]};if(y.cacheDeviceIds[a.value]){const{channelIds:o}=y.cacheDeviceIds[a.value];n.terms.push({column:"channelId",termType:"nin",value:o.toString(),type:"and"})}return a.value&&n.terms.push({column:"deviceId",value:a.value,type:"and"}),e.terms=[...n.terms,...e.terms],pe(e)},q=t=>{N.value=t},F=()=>{const t=[];Object.keys(s.value).forEach(e=>{s.value[e].channelIds.length||t.push(e)}),B("submit",ae(s.value,t))};return G(()=>{Object.keys(y.cacheDeviceIds)&&(s.value=j(y.cacheDeviceIds))}),(t,e)=>{const n=le,o=se,c=T("pro-search"),I=T("AIcon"),d=oe,J=ce,L=de,X=ie;return _(),C(S,null,[u(X,{visible:"",title:"绑定通道",width:1200,onCancel:e[2]||(e[2]=l=>B("closeBind")),onOk:F},{default:p(()=>[h("div",me,[h("div",ve,[_e,u(re,{type:"unBind",deviceId:i(a),"onUpdate:deviceId":e[0]||(e[0]=l=>k(a)?a.value=l:null),channelId:i(g),"onUpdate:channelId":e[1]||(e[1]=l=>k(g)?g.value=l:null),onSelect:E},null,8,["deviceId","channelId"])]),h("div",he,[h("div",fe,[Ie,u(o,null,{default:p(()=>[(_(!0),C(S,null,V(i(R),l=>(_(),x(n,null,{default:p(()=>[W(Y(l),1)]),_:2},1024))),256))]),_:1})]),u(c,{columns:$,style:{"padding-bottom":"0","margin-bottom":"0"},type:"simple",target:"capture-plan-channel-bind",onSearch:q}),i(a)?(_(),x(L,{key:0,style:{"min-height":"calc(100% - 60px)","padding-top":"0"},ref_key:"tableRef",ref:w,model:"table",rowKey:"channelId",columns:$,request:M,params:i(N),rowSelection:{selectedRowKeys:i(m),onSelect:P,onSelectAll:U,onSelectNone:()=>m.value=[]}},{status:p(l=>[u(ne,{text:l.status.text,status:l.status.value,statusNames:{online:"success",offline:"error"}},null,8,["text","status"])]),action:p(l=>[u(J,{size:16},{default:p(()=>[(_(!0),C(S,null,V(K(l,"table"),v=>(_(),x(d,{key:v.key,disabled:v.disabled,popConfirm:v.popConfirm,type:"link",tooltip:{...v.tooltip},onClick:v.onClick},{default:p(()=>[u(I,{type:v.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick"]))),128))]),_:2},1024)]),_:1},8,["params","rowSelection"])):H("",!0)])])]),_:1}),u(ue,{visible:i(b),"onUpdate:visible":e[3]||(e[3]=l=>k(b)?b.value=l:null),data:i(D),onRefresh:e[4]||(e[4]=l=>i(w).reload())},null,8,["visible","data"])],64)}}},Ee=te(ye,[["__scopeId","data-v-9454695b"]]);export{Ee as default};
