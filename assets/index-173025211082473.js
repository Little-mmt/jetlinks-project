import{h as ra,ez as ia,eA as ua,o as pa,a4 as _a,aD as ga,a6 as va,d as fa,e as ha,$ as ya,dq as ma,aL as Ia,aM as Ma,aN as wa,J as ba,aT as xa,y as Sa,eB as Ca,g as ja}from"./index-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import{d as $,ai as ka,k as v,e as J,o as Ba,b as Da,ab as Oa,U as u,Z as w,_ as c,f as i,X as l,F as P,a1 as R,u as f,V as h,E as p,$ as y,Y as V,af as Ta,ag as Ja}from"./vue-1730252110824.js";import{u as Va}from"./instance-1730252110824.js";const b=x=>(Ta("data-v-d543b5af"),x=x(),Ja(),x),Na={class:"metadata-map"},Aa={class:"left"},La={class:"box"},Ua={key:0,style:{width:"100%",display:"flex","justify-content":"space-between","align-items":"center"}},Ea={key:0,class:"metadata-title",ref:"title"},Fa={class:"right"},Ka=b(()=>c("div",{class:"title"},"功能说明",-1)),Pa=b(()=>c("p",null,[p(" 该功能用于将协议包中的 "),c("b",null,"物模型属性标识"),p("与 "),c("b",null,"平台物模型属性标识"),p("进行映射,当两方属性标识不一致时，可在当前页面直接修改映射管理，系统将以映射后的物模型属性进行数据处理。 ")],-1)),Ra=b(()=>c("p",null," 未完成映射的属性标识“目标属性”列数据为空，代表该属性值来源以在平台配置的来源为准。 ",-1)),$a=b(()=>c("p",null,[p(" 数据条背景亮起代表"),c("b",null,"标识一致"),p("或"),c("b",null,"已完成映射"),p("的属性。 ")],-1)),qa=b(()=>c("div",{class:"title"},"功能图示",-1)),za=["src"],Qa=$({name:"MetadataMap"}),Wa=$({...Qa,setup(x){var F;const q=Va(),{current:m}=ka(q),I=v([]),_=v([]),N=v([]),S=v(void 0),A=v([]),D=v(void 0),O=v(void 0),L=v(!1),z=[{title:"序号",dataIndex:"index",width:100},{title:"平台属性",dataIndex:"name"},{title:"目标属性",dataIndex:"original",width:250}],Q=J(()=>{var e;return((e=_.value)==null?void 0:e.filter(a=>!!(a!=null&&a.original)).map(a=>a.id))||[]}),W=J(()=>{var e;return((e=_.value)==null?void 0:e.filter(a=>!!(a!=null&&a.original)).map(a=>a.original))||[]}),X=J(()=>{var e;return JSON.parse(((e=m.value)==null?void 0:e.metadata)||"{}")}),U=(F=m.value)==null?void 0:F.id,Y=()=>new Promise(e=>{Ca("device",U).then(a=>{var t,r;a.success&&e(((r=(t=a.result)==null?void 0:t.filter(n=>n.customMapping))==null?void 0:r.map(n=>({id:n.metadataId,originalId:n.originalId,customMapping:n.customMapping})))||[])})}),Z=e=>({id:e.id,class:D.value===(e==null?void 0:e.name)?"metadata-search-row":""}),G=(e,a)=>{O.value=a==null?void 0:a.label},H=()=>{var e;if(O.value){const a=I.value.find(t=>O.value===(t==null?void 0:t.name));a&&(D.value=a==null?void 0:a.name,(e=document.getElementById(a==null?void 0:a.id))==null||e.scrollIntoView())}else D.value=void 0},aa=async()=>{var C,j;const e=(C=X.value)==null?void 0:C.properties;if(!((j=m.value)!=null&&j.protocol))return;const a=await ea(),t=(a==null?void 0:a.properties)||[],r=await Y();N.value=t.map(s=>({...s,label:s==null?void 0:s.name,value:s.id}));const n=[...r];if(!n.length){L.value=!0;const s=n.map(o=>o.id),M=n.map(o=>o.originalId);t.map(o=>{!s.includes(o.id)&&!M.includes(o.id)&&n.push({id:o.id,originalId:o.id,customMapping:o==null?void 0:o.customMapping})})}_.value=(e==null?void 0:e.map((s,M)=>{var k;const o=n.find(T=>T.id===s.id);return{index:M+1,id:s.id,name:s==null?void 0:s.name,type:(k=s.valueType)==null?void 0:k.type,customMapping:o==null?void 0:o.customMapping,original:o==null?void 0:o.originalId}}))||[],I.value=_.value},ea=()=>new Promise(e=>{var t,r;const a=(t=m.value)==null?void 0:t.transport;ia(((r=m.value)==null?void 0:r.protocol)||"",a).then(n=>{n.success&&e(JSON.parse((n==null?void 0:n.result)||"{}")),e({properties:[]})})}),E=async(e,a)=>{(await ua("device",U,e)).success&&a&&pa("操作成功")},ta=async(e,a)=>{if(!a&&(e!=null&&e.customMapping)||a){const t=[{metadataType:"property",metadataId:e.id,originalId:a}];E(t,!0)}},na=({key:e})=>{A.value=_.value;const a=_a(_.value).sort((t,r)=>e?(r.original?1:-1)-(t.original?1:-1):(t.original?1:-1)-(r.original?1:-1));_.value=a,S.value=e},oa=()=>{S.value=void 0,_.value=A.value};return Ba(()=>{aa()}),Da(()=>{if(L.value&&I.value){const e=I.value.filter(a=>a==null?void 0:a.original).map(a=>({metadataType:"property",metadataId:a.id,originalId:a.original}));E(e)}}),(e,a)=>{const t=ga,r=va,n=Oa("AIcon"),C=fa,j=ha,s=ya,M=ma,o=Ia,k=Ma,T=wa,la=ba,sa=xa,K=Sa;return u(),w("div",Na,[c("div",Aa,[i(j,{style:{"margin-bottom":"24px"}},{default:l(()=>[i(r,{onChange:G,"show-search":"","allow-clear":"",placeholder:"请选择属性名称",style:{width:"250px"}},{default:l(()=>[(u(!0),w(P,null,R(f(I),d=>(u(),h(t,{label:d.name,value:d==null?void 0:d.id,key:d==null?void 0:d.id},{default:l(()=>[p(y(d==null?void 0:d.name),1)]),_:2},1032,["label","value"]))),128))]),_:1}),i(C,{type:"primary",onClick:H},{default:l(()=>[i(n,{type:"SearchOutlined"})]),_:1})]),_:1}),c("div",La,[i(K,{height:"100%"},{default:l(()=>[i(sa,{columns:z,"data-source":f(_),pagination:!1,rowSelection:{selectedRowKeys:f(Q),hideSelectAll:!0,columnWidth:0},rowKey:"id",customRow:Z},{headerCell:l(({column:d})=>[d.dataIndex==="original"?(u(),w("div",Ua,[c("span",null,[p(" 目标属性"),i(s,{title:"协议包中物模型下的属性"},{default:l(()=>[i(n,{style:{"margin-left":"10px"},type:"QuestionCircleOutlined"})]),_:1})]),f(S)!==void 0?(u(),h(M,{key:0,color:"#87d068",closable:"",onClose:oa},{default:l(()=>[i(n,{type:"ArrowUpOutlined"}),c("span",null,y(f(S)?"已映射":"未映射"),1)]),_:1})):(u(),h(T,{key:1},{overlay:l(()=>[i(k,{onClick:na},{default:l(()=>[(u(),h(o,{key:!0},{default:l(()=>[p("置顶已映射数据")]),_:1})),(u(),h(o,{key:!1},{default:l(()=>[p("置顶未映射数据")]),_:1}))]),_:1})]),default:l(()=>[i(n,{type:"FilterOutlined"})]),_:1}))])):V("",!0)]),bodyCell:l(({column:d,text:ca,record:B})=>[d.dataIndex==="name"?(u(),w("span",Ea,[i(la,null,{default:l(()=>[p(y(ca)+" ("+y(B.id)+") ",1)]),_:2},1024)],512)):V("",!0),d.dataIndex==="original"?(u(),h(r,{key:1,value:B.original,"onUpdate:value":g=>B.original=g,style:{width:"100%"},allowClear:"",onChange:g=>ta(B,g),placeholder:"请选择"},{default:l(()=>[(u(!0),w(P,null,R(f(N),(g,da)=>(u(),h(t,{key:da+"_"+g.id,value:g.value,disabled:f(W).includes(g.id)},{default:l(()=>[p(y(g.label)+" ("+y(g.id)+")",1)]),_:2},1032,["value","disabled"]))),128))]),_:2},1032,["value","onUpdate:value","onChange"])):V("",!0)]),_:1},8,["data-source","rowSelection"])]),_:1})])]),c("div",Fa,[i(K,null,{default:l(()=>[Ka,Pa,Ra,$a,qa,c("div",null,[c("img",{src:f(ra)("/device/matadataMap.jpg")},null,8,za)])]),_:1})])])}}});const te=ja(Wa,[["__scopeId","data-v-d543b5af"]]);export{te as default};
