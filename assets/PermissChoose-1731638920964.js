import{F as L,I as T,a0 as y,a1 as A,C as j,aG as U,g as B}from"./index-1731638920964.js";import"./index-1731638920964280.js";import{e as F}from"./permission-1731638920964.js";import{d as P,k as W,r as k,q as O,J,U as f,Z as b,f as c,u as _,G as N,_ as x,X as d,E as g,a0 as R,F as $,a1 as E,V as G,$ as H}from"./vue-1731638920964.js";const S={class:"permission-choose-container"},q={class:"permission-table"},z=P({__name:"PermissChoose",props:{btnId:{},value:{},firstWidth:{},maxHeight:{},disabled:{type:Boolean}},emits:["update:value"],setup(C,{emit:v}){const n=C;L.useInjectFormItemContext();const r=W(""),u=k({searchTimer:null,search:()=>{u.searchTimer&&clearTimeout(u.searchTimer),u.searchTimer=setTimeout(()=>{O(()=>l.getList()),u.searchTimer=null},1e3)}}),l=k({list:[],sourceList:[],init:()=>{l.getList()},getList:()=>{const e={paging:!1};r.value&&(e.terms=[{column:"name$like",value:`%${r.value}%`}]),F(e).then(t=>{l.sourceList=[...t.result],l.list=l.makeList(n.value,t.result)})},selectAllOpions:e=>{e.indeterminate=!1;const t=n.value.filter(i=>i.permission!==e.id);e=J(e),e.checkAll?(e.checkedList=e.options.map(i=>i.value),t.push({permission:e.id,actions:e.checkedList})):e.checkedList=[],v("update:value",t)},selectOption:(e,t)=>{const i=n.value.filter(s=>s.permission!==e.id);t.length===e.options.length?(e.checkAll=!0,e.indeterminate=!1,i.push({permission:e.id,actions:t})):t.length>0?(e.checkAll=!1,e.indeterminate=!0,i.push({permission:e.id,actions:t})):e.indeterminate=!1,v("update:value",i)},makeList:(e,t)=>t.map(s=>{const o=e==null?void 0:e.find(p=>p.permission===s.id),m=s.actions&&s.actions.map(p=>({label:p.name,value:p.action}))||[];return{id:s.id,name:s.name,checkedList:o&&o.actions||[],checkAll:o&&s.actions&&o.actions.length===s.actions.length||!1,indeterminate:o&&s.actions&&o.actions.length<s.actions.length||!1,options:m,disabled:s.status===0}})});return l.init(),(e,t)=>{const i=T,s=y,o=A,m=j,p=U;return f(),b("div",S,[c(i,{value:_(r),"onUpdate:value":t[0]||(t[0]=a=>N(r)?r.value=a:null),style:{width:"300px"},allowClear:"",placeholder:"请输入权限名称",onInput:_(u).search,disabled:n.disabled},null,8,["value","onInput","disabled"]),x("div",q,[c(o,{gutter:24,class:"table-head"},{default:d(()=>[c(s,{span:n.firstWidth},{default:d(()=>[g("权限名称")]),_:1},8,["span"]),c(s,{span:24-n.firstWidth},{default:d(()=>[g("权限操作")]),_:1},8,["span"])]),_:1}),x("div",{class:"table-body",style:R({"max-height":n.maxHeight})},[(f(!0),b($,null,E(_(l).list,a=>(f(),G(o,{gutter:24,class:"row"},{default:d(()=>[c(s,{span:n.firstWidth,class:"item-name"},{default:d(()=>[c(m,{checked:a.checkAll,"onUpdate:checked":h=>a.checkAll=h,indeterminate:a.indeterminate,onChange:()=>_(l).selectAllOpions(a),disabled:n.disabled||a.disabled},{default:d(()=>[g(H(a.name),1)]),_:2},1032,["checked","onUpdate:checked","indeterminate","onChange","disabled"])]),_:2},1032,["span"]),c(s,{span:24-n.firstWidth},{default:d(()=>[c(p,{value:a.checkedList,"onUpdate:value":h=>a.checkedList=h,options:a.options,onChange:h=>_(l).selectOption(a,h),disabled:n.disabled||a.disabled},null,8,["value","onUpdate:value","options","onChange","disabled"])]),_:2},1032,["span"])]),_:2},1024))),256))],4)])])}}});const M=B(z,[["__scopeId","data-v-9153dc8f"]]);export{M as default};
