import{h as T,o as F,dB as K,Z as M,ds as O,cY as Y,dE as Z,g as X}from"./index-1730252110824.js";import"./index-1730252110824299.js";import"./index-1730252110824306.js";import z from"./index-1730252110824157.js";import{j as G,k as U}from"./auto-1730252110824.js";import{_ as H}from"./planSelect.vue_vue_type_script_setup_true_name_planSelect_lang-1730252110824.js";import{d as N,k as m,o as J,ab as Q,U as o,V as f,X as p,E as h,Y as k,Z as i,F as R,a1 as W,_ as d,$ as v,f as g,u as D}from"./vue-1730252110824.js";import"./Setting.vue_vue_type_script_setup_true_name_Setting_lang-1730252110824.js";import"./Time-1730252110824.js";const ee={key:1,class:"content"},ae={key:0,class:"items"},te={class:"item"},se={class:"header"},ne={key:0,class:"header-detail"},oe={key:1,class:"calendar"},le={key:1,class:"empty"},de=["src"],re={class:"noPlanTip"},ce={class:"addPlan"},ie=N({name:"Plan"}),ue=N({...ie,props:{type:{type:String,default:"video"},data:{type:Object,default:()=>({})}},emits:["close"],setup(u,{emit:x}){const l=u,C=m(!0),B=m([]),r=m([]),b=m(!1),P=t=>{r.value.push({index:t})},q=t=>{r.value=r.value.filter(a=>a.index!==t.index)},S=async()=>{var n;const t=(n=r.value)==null?void 0:n.map(s=>{if(s.id)return{name:s.name,scheduleId:s.id,deviceId:l.data.deviceId,channelId:l.data.channelId,others:{channelCatalog:`${l.data.deviceName}/${l.data.name}`,times:s.times,trigger:s.trigger}}}).filter(s=>s);(await G(l.data.channelId,l.type,!0,t)).success&&(F("操作成功"),x("close"))},V=(t,a)=>{var n,s;console.log("option====",t,a),a.times=((n=t.others)==null?void 0:n.times)||[],a.trigger=(s=t.others)==null?void 0:s.trigger,a.name=t.name,a.state=t.state,a.saveDays=t.saveDays},A=async()=>{const t=await U({paging:!1,sorts:[{name:"createTime",order:"desc"}],terms:[{column:"type",value:l.type,termType:"eq"}]});t.success&&(B.value=t.result)},E=async()=>{b.value=!0;const t={paging:!1,sorts:[{name:"createTime",order:"desc"}],terms:[{column:"type",value:l.type,termType:"eq",type:"and"},{column:"id$media-record-channel-bind-schedule",value:[{column:"channelId",termType:"eq",value:l.data.channelId},{column:"deviceId",termType:"eq",value:l.data.deviceId}]}]},a=await U(t).finally(()=>{b.value=!1});a.success&&(r.value=a.result.map((n,s)=>{var _,y;return{...n,index:s,id:n.id,times:((_=n.others)==null?void 0:_.times)||[],trigger:((y=n.others)==null?void 0:y.trigger)||"week"}}))};return J(()=>{A(),E()}),(t,a)=>{const n=K,s=Q("AIcon"),_=M,y=O,I=Y,L=Z;return o(),f(L,{title:u.type==="video"?"录像计划":"抓拍计划",visible:"",onClose:a[2]||(a[2]=e=>x("close")),maskClosable:!1,width:"1000px"},{footer:p(()=>[C.value?(o(),f(I,{key:0,type:"primary",onClick:S},{default:p(()=>[h("保存")]),_:1})):k("",!0)]),default:p(()=>[b.value?(o(),f(n,{key:0})):(o(),i("div",ee,[r.value.length?(o(),i("div",ae,[(o(!0),i(R,null,W(r.value,(e,j)=>{var w,$;return o(),i("div",te,[d("div",se,[d("div",null,[d("span",null,"计划"+v(j+1)+": ",1),g(H,{value:e.id,"onUpdate:value":c=>e.id=c,options:B.value,selectKeys:r.value,disabled:!C.value,onChange:c=>V(c,e)},null,8,["value","onUpdate:value","options","selectKeys","disabled","onChange"])]),g(_,{shape:"circle",tooltip:{title:"删除"},danger:"",onClick:c=>q(e)},{default:p(()=>[g(s,{type:"DeleteOutlined"})]),_:2},1032,["onClick"])]),e!=null&&e.times?(o(),i("div",ne,[d("span",null,"计划详情: "+v(e.trigger==="week"?"按周":"自定义日历"),1),d("span",null,[h("计划状态： "),g(y,{status:((w=e==null?void 0:e.state)==null?void 0:w.value)==="enabled"?"success":"error",text:($=e==null?void 0:e.state)==null?void 0:$.text},null,8,["status","text"])]),d("span",null,"保存周期："+v(e.saveDays)+"天",1)])):k("",!0),e!=null&&e.times?(o(),i("div",oe,[g(z,{value:e.times,"onUpdate:value":c=>e.times=c,trigger:e.trigger,"onUpdate:trigger":c=>e.trigger=c,type:"timing",view:!0,disabled:!0},null,8,["value","onUpdate:value","trigger","onUpdate:trigger"])])):k("",!0)])}),256)),C.value?(o(),f(I,{key:0,onClick:a[0]||(a[0]=e=>P(r.value.length)),class:"add-btn"},{default:p(()=>[h("+ 添加计划")]),_:1})):k("",!0)])):(o(),i("div",le,[d("img",{src:u.type==="video"?D(T)("/media/videoPlan.png"):D(T)("/media/capturePlan.png")},null,8,de),d("div",re," 还没有关联的"+v(u.type==="video"?"录像":"抓拍")+"计划 ",1),d("div",null," 你可以点击关联"+v(u.type==="video"?"录像":"抓拍")+"计划按钮来关联计划 ",1),d("div",ce,[g(I,{shape:"round",onClick:a[1]||(a[1]=e=>P(0))},{default:p(()=>[h(v(u.type==="video"?"点击关联录像计划":"点击关联抓拍计划"),1)]),_:1})])]))]))]),_:1},8,["title"])}}});const Ce=X(ue,[["__scopeId","data-v-8396b919"]]);export{Ce as default};
