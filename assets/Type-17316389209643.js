import{a4 as B,h as N,aC as W,fy as X,v as Y,a6 as Z,F as z,g as G}from"./index-1731638920964.js";import{_ as H}from"./index.vue_vue_type_script_setup_true_name_Timer_lang-1731638920964.js";import J from"./TopCard-17316389209647.js";import"./TriggerWay.vue_vue_type_style_index_0_scoped_1bb0f74d_lang-1731638920964.js";import"./FunctionCall.vue_vue_type_script_setup_true_name_FunctionCall_lang-1731638920964.js";import{T as d}from"./util-17316389209644.js";import{_ as L}from"./ReadProperties.vue_vue_type_script_setup_true_name_ReadProperties_lang-1731638920964.js";import{_ as Q}from"./WriteProperty.vue_vue_type_script_setup_true_name_WriteProperties_lang-1731638920964.js";import{_ as ee}from"./InvokeFunction.vue_vue_type_script_setup_true_name_InvokeFunction_lang-1731638920964.js";import{d as te,r as V,k as f,e as v,ab as oe,U as _,Z as ae,_ as q,f as w,X as F,u as e,V as b,Y as k,af as re,ag as ne}from"./vue-1731638920964.js";import"./index-1731638920964279.js";import"./WhenOption-1731638920964.js";import"./Calendar-1731638920964.js";import"./useRequest-1731638920964.js";import"./index-1731638920964235.js";import"./index-1731638920964309.js";import"./TopCard.vue_vue_type_style_index_0_scoped_47c4fbf1_lang-1731638920964.js";import"./index-1731638920964282.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";const ie=y=>(re("data-v-cb9cdf4e"),y=y(),ne(),y),se={class:"type"},pe={class:"alert"},le=ie(()=>q("span",{style:{"padding-left":"10px"}},"只能依据产品物模型进行配置",-1)),ue=te({__name:"Type",props:{metadata:{type:Object,default:()=>({})},operator:{type:Object,default:()=>({})}},setup(y,{expose:A}){const u=y,o=V({operator:"online",timer:{},readProperties:[],writeProperties:{},eventId:void 0,functionId:void 0,functionParameters:[]});Object.assign(o,u.operator);const c=V({action:""}),I=f([]),g=f([]),x=f([]),h=f([]),U=f(),D=f(),C=f(),O=f(),M=v(()=>{var m,s,P;const n=B(d),t=[{label:"设备上线",value:"online",img:N("/scene/online.png")},{label:"设备离线",value:"offline",img:N("/scene/offline.png")},n.reportEvent,n.readProperty,n.writeProperty,n.reportProperty,n.invokeFunction];if(!u.metadata)return t;if((m=u.metadata.events)!=null&&m.length&&(n.reportEvent.disabled=!1,x.value=u.metadata.events.map(i=>({...i,label:i.name,value:i.id}))),(s=u.metadata.properties)!=null&&s.length){const i=u.metadata.properties;I.value=i.filter(r=>{var p,l;return(l=(p=r.expands)==null?void 0:p.type)==null?void 0:l.includes("read")}).map(r=>({...r,label:r.name,value:r.id})),g.value=i.filter(r=>{var p,l;return(l=(p=r.expands)==null?void 0:p.type)==null?void 0:l.includes("write")}).map(r=>({...r,label:r.name,value:r.id}));const a=i.filter(r=>{var p,l,$;return((l=(p=r.expands)==null?void 0:p.type)==null?void 0:l.includes("report"))||!(($=r.expands)!=null&&$.type)}).map(r=>({...r,label:r.name,value:r.id}));I.value.length&&(n.readProperty.disabled=!1),g.value.length&&(n.writeProperty.disabled=!1),a.length&&(n.reportProperty.disabled=!1)}return(P=u.metadata.functions)!=null&&P.length&&(n.invokeFunction.disabled=!1,h.value=u.metadata.functions.map(i=>({...i,label:i.name,value:i.id}))),t}),R=v(()=>o.operator===d.readProperty.value),T=v(()=>o.operator===d.writeProperty.value),j=v(()=>o.operator===d.reportEvent.value),E=v(()=>o.operator===d.invokeFunction.value),S=v(()=>[d.readProperty.value,d.writeProperty.value,d.invokeFunction.value].includes(o.operator)),K=(n,t)=>{c.action=`${t.name}上报`};return A({vail:()=>new Promise(async(n,t)=>{var i,a,r,p;const m=B(o),s=[];if(!await((i=U.value)==null?void 0:i.validateFields()))return n(!1);if(R.value||s.push("readProperties"),E.value){if(!await((a=O.value)==null?void 0:a.validateFields()))return n(!1)}else s.push("functionId"),s.push("functionParameters");if(S.value){if(!await((r=D.value)==null?void 0:r.validateFields()))return n(!1)}else s.push("timer");if(j.value||s.push("eventId"),T.value){if(!await((p=C.value)==null?void 0:p.validateFields()))return n(!1)}else s.push("writeProperties");n({data:W(m,s),action:c.action})})}),(n,t)=>{const m=oe("AIcon"),s=Y,P=Z,i=z;return _(),ae("div",se,[q("div",pe,[w(m,{type:"InfoCircleOutlined"}),le]),w(i,{ref_key:"typeForm",ref:U,model:e(o),layout:"vertical",colon:!1},{default:F(()=>[w(s,{required:"",label:"触发类型"},{default:F(()=>[w(e(J),{"label-bottom":!0,options:e(M),value:e(o).operator,"onUpdate:value":t[0]||(t[0]=a=>e(o).operator=a)},null,8,["options","value"])]),_:1}),e(S)?(_(),b(e(H),{key:0,ref_key:"timerRef",ref:D,value:e(o).timer,"onUpdate:value":t[1]||(t[1]=a=>e(o).timer=a)},null,8,["value"])):k("",!0),e(R)?(_(),b(L,{key:1,value:e(o).readProperties,"onUpdate:value":t[2]||(t[2]=a=>e(o).readProperties=a),action:e(c).action,"onUpdate:action":t[3]||(t[3]=a=>e(c).action=a),properties:e(I)},null,8,["value","action","properties"])):k("",!0),e(T)?(_(),b(Q,{key:2,ref_key:"writeRef",ref:C,value:e(o).writeProperties,"onUpdate:value":t[4]||(t[4]=a=>e(o).writeProperties=a),action:e(c).action,"onUpdate:action":t[5]||(t[5]=a=>e(c).action=a),properties:e(g)},null,8,["value","action","properties"])):k("",!0),e(j)?(_(),b(s,{key:3,name:"eventId",rules:[{required:!0,message:"请选择事件"}]},{default:F(()=>[w(P,{value:e(o).eventId,"onUpdate:value":t[6]||(t[6]=a=>e(o).eventId=a),"filter-option":e(X),options:e(x),placeholder:"请选择事件",style:{width:"100%"},onSelect:K},null,8,["value","filter-option","options"])]),_:1})):k("",!0),e(E)?(_(),b(ee,{key:4,ref_key:"invokeRef",ref:O,functionId:e(o).functionId,"onUpdate:functionId":t[7]||(t[7]=a=>e(o).functionId=a),functionParameters:e(o).functionParameters,"onUpdate:functionParameters":t[8]||(t[8]=a=>e(o).functionParameters=a),functions:e(h)},null,8,["functionId","functionParameters","functions"])):k("",!0)]),_:1},8,["model"])])}}});const Re=G(ue,[["__scopeId","data-v-cb9cdf4e"]]);export{Re as default};
