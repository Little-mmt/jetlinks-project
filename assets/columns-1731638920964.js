import{b4 as w,df as f,aC as k}from"./index-1731638920964.js";import{k as p,w as y,p as P,c as T}from"./vue-1731638920964.js";const b="metadata-unit",m=(t,e=!1)=>{var s,a,u;return t?t.type==="enum"&&!((s=t.elements)!=null&&s.length)?Promise.reject("请添加枚举项"):t.type==="array"&&!((a=t.elementType)!=null&&a.type)?Promise.reject("请选择元素类型"):e&&t.type==="object"&&!((u=t.properties)!=null&&u.length)?Promise.reject("请添加参数"):t.type==="date"&&!t.format?Promise.reject("请选择时间格式"):t.type==="file"&&(!t.bodyType||w(t.bodyType)&&!Object.keys(t.bodyType).length)?Promise.reject("请选择文件类型"):Promise.resolve():Promise.resolve()},S=(t,e={})=>{let s={};switch(t){case"array":e.type==="array"?s.elementType={...e,elementType:{type:"object",properties:[]}}:s.elementType=e;break;case"object":s.properties=(e||[]).map(a=>k(a,["config","action","_sortIndex"]));break;case"int":case"long":s.unit=e;break;case"file":s.bodyType=e;break;case"date":s.format=e;break;case"string":case"password":s.expands.maxLength=JSON.stringify(e)==="{}"?void 0:e;break;default:s=e;break}return s},_=t=>{let e={};switch(t){case"array":e.elementType={};break;case"object":e.properties=[];break;case"enum":e.elements=[];break;case"float":case"double":e.scale=2,e.unit=void 0;break;case"int":case"long":e.unit=void 0;break;case"file":e.bodyType=void 0;break;case"date":e.format=void 0;break;case"string":case"password":e.expands.maxLength=void 0;break;case"boolean":e.trueText="是",e.trueValue="true",e.falseText="否",e.falseValue="false";break}return e},q=(t,e,s,a,u)=>{const d=[{title:"标识",dataIndex:"id",form:{required:!0,rules:[{asyncValidator(i,r,...n){if(r){const c=n[2];if(t.value.some(l=>l.__dataIndex!==c.index&&l.id&&l.id===r))return Promise.reject("该标识已存在")}return Promise.resolve()}},{max:64,message:"最多可输入64个字符"},{pattern:/^[a-zA-Z0-9_]+$/,message:"标识只能由数字、字母、下划线组成"}]},filter:!0},{title:"名称",dataIndex:"name",form:{required:!0,rules:[{asyncValidator(i,r){if(r){if(r.length>64)return Promise.reject("最多可输入64个字符")}else return Promise.reject("请输入名称");return Promise.resolve()}}]},filter:!0}],h=d.concat([{title:"数据类型",dataIndex:"valueType",form:{required:!0,rules:[{asyncValidator(i,r){return r!=null&&r.type?m(r,!0):Promise.reject("请选择数据类型")}}]},width:260},{title:"属性来源",dataIndex:"expands",form:{required:!0,rules:[{asyncValidator:async(i,r)=>{var c;const n=r==null?void 0:r.source;return n?n==="device"&&!((c=r.type)!=null&&c.length)?Promise.reject("请选择读写类型"):Promise.resolve():Promise.reject("请选择属性来源")}}]},width:220},{title:"其它配置",dataIndex:"other",width:110}]),g=d.concat([{title:"是否异步",dataIndex:"async",width:120},{title:"输入参数",dataIndex:"inputs",width:110},{title:"输出参数",dataIndex:"output",width:240,form:{rules:[{asyncValidator:async(i,r)=>m(r)}]}},{title:"其它配置",dataIndex:"other",width:120},{title:"说明",dataIndex:"description",width:220,form:{rules:[{max:20,message:"最多可输入20个字符"}]}}]),x=d.concat([{title:"事件级别",dataIndex:"expands",width:150},{title:"输出参数",dataIndex:"valueType",width:110,form:{required:!0,rules:[{asyncValidator:async(i,r)=>{var n;return(n=r.properties)!=null&&n.length?Promise.resolve():Promise.reject("请添加配置参数")}}]}},{title:"其它配置",dataIndex:"other",width:120},{title:"说明",dataIndex:"description",width:220,form:{rules:[{max:20,message:"最多可输入20个字符"}]}}]),j=d.concat([{title:"数据类型",dataIndex:"valueType",width:240,form:{required:!0,rules:[{asyncValidator:async(i,r)=>r!=null&&r.type?m(r,!0):Promise.reject("请选择数据类型")}]}},{title:"其它配置",dataIndex:"other",width:110},{title:"说明",dataIndex:"description",width:250,form:{rules:[{max:20,message:"最多可输入20个字符"}]}}]),o=p([]);return y(()=>JSON.stringify(a.value),()=>{switch(e){case"properties":o.value=h;break;case"events":o.value=x;break;case"tags":o.value=j;break;case"functions":o.value=g;break}},{immediate:!0}),{columns:o}},O=t=>{const e=p([]);return y(()=>t.value,()=>{["float","double","int","long"].includes(t.value)&&!e.value.length&&f().then(s=>{s.success&&(e.value=s.result.map(a=>({label:a.description,value:a.id})))})},{immediate:!0}),{unitOptions:e}},U=()=>{const t=p([]);return P(b,t),f().then(e=>{e.success&&(t.value=e.result.map(s=>({label:s.description,value:s.id})))}),{unitOptions:t}},A=()=>T(b),N={int:"int(整数型)",long:"long(长整数型)",float:"float(单精度浮点型)",double:"double(双精度浮点数)",string:"text(字符串)",boolean:"boolean(布尔型)",date:"date(时间型)",enum:"enum(枚举)",array:"array(数组)",object:"object(结构体)",file:"file(文件)",password:"password(密码)",geoPoint:"geoPoint(地理位置)"};export{N as T,U as a,q as b,O as c,S as h,_ as t,A as u,m as v};
