import{X as O,i as X,h as Z,o as K,I as Q,v as Y,a0 as G,$ as H,e as W,a6 as ee,a1 as te,aJ as ae,aK as le,a9 as oe,Z as ne,F as se,g as ue}from"./index-1730252110824.js";import"./index-1730252110824279.js";import{d as re,g as ie,u as _e,s as pe}from"./configuration-1730252110824.js";import{q as ce}from"./config-1730252110824.js";import{a as de}from"./scene-1730252110824.js";import{d as me,ac as fe,k as p,ai as ge,w as ve,ab as y,U as v,V as k,X as l,_ as c,f as o,u as s,E as h,Z as B,Y as ye,F as he,a1 as xe,$ as be,af as Ce,ag as Se}from"./vue-1730252110824.js";import{u as Te}from"./alarm-1730252110824.js";const x=d=>(Ce("data-v-281a27d2"),d=d(),Se(),d),je=x(()=>c("div",null,"产品：以产品维度告警，某产品下的多个设备异常仅发送一条告警。",-1)),qe=x(()=>c("div",null,"设备：以设备维度告警，任何设备异常即发送一条告警。",-1)),we={key:0},Ie=x(()=>c("div",null,"其他：以场景联动维度告警，某场景下的多个设备异常仅发送一条告警。",-1)),ke=["src"],Be=me({__name:"index",emits:["change"],setup(d,{emit:b}){const _=fe();let C=p(!1);const A=Te();let{configurationData:S}=ge(A);const T=()=>{var a,e;(a=_.query)!=null&&a.id&&re((e=_.query)==null?void 0:e.id).then(n=>{var t,i;n.status===200&&(b("change",(t=n==null?void 0:n.result)==null?void 0:t.targetType),u.value=n==null?void 0:n.result,S.value.current=n.result,de({terms:[{terms:[{column:"id",termType:"alarm-bind-rule",value:(i=_.query)==null?void 0:i.id}],type:"and"}],sorts:[{name:"createTime",order:"desc"}]}).then(f=>{var g;f.status===200&&(C.value=!!((g=f.result.data)!=null&&g.length))}))})},F={name:[{required:!0,message:"请输入名称"},{max:64,message:"最多输入64个字符"}],targetType:[{required:!0,message:"请选择类型"}],level:[{required:!0,message:"请选择级别"}],description:[{max:200,message:"最多可输入200个字符"}]};let u=p({level:"",targetType:"",name:"",description:""}),j=p(),q=p(),m=p(!1);const w=p(),P=O();(async()=>{let a=await ie();a.status===200&&(j.value=a.result.map(e=>({label:e.name,value:e.id})))})(),(()=>{ce().then(a=>{var e,n;a.status===200&&(q.value=(n=(e=a.result)==null?void 0:e.levels)==null?void 0:n.filter(t=>(t==null?void 0:t.level)&&(t==null?void 0:t.title)).map(t=>({label:t.title,value:t.level})))})})();const J=async()=>{m.value=!0,w.value.validate().then(async()=>{var e,n,t,i;const a=(e=_.query)!=null&&e.id?await _e(u.value):await pe(u.value);a.status===200&&(K("操作成功,请配置关联的场景联动"),m.value=!1,b("change",u.value.targetType),(n=a.result)!=null&&n.id&&P.jumpPage("rule-engine/Alarm/Configuration/Save",{},{id:(t=a.result)==null?void 0:t.id}),(i=_.query)!=null&&i.id||(S.value.current=a.result))}).catch(a=>{m.value=!1,console.log(a)})};return T(),ve(()=>{var a;return(a=_.query)==null?void 0:a.id},()=>{T()}),(a,e)=>{const n=Q,t=Y,i=G,f=y("AIcon"),g=H,N=W,R=ee,U=te,V=y("Ellipsis"),D=ae,E=le,L=oe,$=ne,z=se,M=y("FullPage");return v(),k(M,null,{default:l(()=>[c("div",null,[o(z,{layout:"vertical",rules:F,model:s(u),ref_key:"formRef",ref:w},{default:l(()=>[o(U,{gutter:24},{default:l(()=>[o(i,{span:12},{default:l(()=>[o(t,{label:"名称",name:"name"},{default:l(()=>[o(n,{placeholder:"请输入名称",value:s(u).name,"onUpdate:value":e[0]||(e[0]=r=>s(u).name=r)},null,8,["value"])]),_:1})]),_:1}),o(i,{span:12},{default:l(()=>[o(t,{name:"targetType"},{label:l(()=>[o(N,null,{default:l(()=>[h(" 类型 "),o(g,null,{title:l(()=>[je,qe,s(X)?(v(),B("div",we,"组织：以组织维度告警，某组织下的多个设备异常仅发送一条告警。")):ye("",!0),Ie]),default:l(()=>[o(f,{type:"QuestionCircleOutlined",style:{color:"rgb(136, 136, 136)","font-size":"12px"}})]),_:1})]),_:1})]),default:l(()=>[o(R,{options:s(j),value:s(u).targetType,"onUpdate:value":e[1]||(e[1]=r=>s(u).targetType=r),disabled:s(C)},null,8,["options","value","disabled"])]),_:1})]),_:1})]),_:1}),o(t,{label:"级别",name:"level"},{default:l(()=>[o(E,{value:s(u).level,"onUpdate:value":e[2]||(e[2]=r=>s(u).level=r),class:"levelSelect"},{default:l(()=>[(v(!0),B(he,null,xe(s(q),(r,I)=>(v(),k(D,{key:I,value:r.value},{default:l(()=>[o(V,{style:{"text-align":"center","margin-top":"10px","font-size":"15px",width:"90%"}},{default:l(()=>[c("img",{src:s(Z)(`/alarm/alarm${I+1}.png`),style:{height:"40px"},alt:""},null,8,ke),h(be(r.label),1)]),_:2},1024)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),o(t,{label:"说明",name:"description"},{default:l(()=>[o(L,{value:s(u).description,"onUpdate:value":e[3]||(e[3]=r=>s(u).description=r),showCount:"",maxlength:200},null,8,["value"])]),_:1}),o($,{type:"primary",loading:s(m),onClick:J,hasPermission:["rule-engine/Alarm/Configuration:add","rule-engine/Alarm/Configuration:update"]},{default:l(()=>[h("保存")]),_:1},8,["loading"])]),_:1},8,["model"])])]),_:1})}}});const Ee=ue(Be,[["__scopeId","data-v-281a27d2"]]);export{Ee as default};
