import{X as Y,h as _,ax as G,o as y,Z as H,e as K,a2 as Q,a3 as W,aa as P,g as ee}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{_ as te}from"./save.vue_vue_type_script_setup_true_lang-17316389209647.js";import{a as ne,_ as L,e as se,f as ie}from"./scene-1731638920964.js";import{e as ae}from"./configuration-1731638920964.js";import{d as j,k as O,ab as x,U as f,V as M,X as s,f as a,u as c,E as B,_ as d,$ as k,Z as z,F as D,a1 as oe,Y as le,af as re,ag as ce}from"./vue-1731638920964.js";import"./TriggerWay-1731638920964.js";import"./TriggerWay.vue_vue_type_style_index_0_scoped_1bb0f74d_lang-1731638920964.js";const pe=C=>(re("data-v-f3364511"),C=C(),ce(),C),ue=["src"],de=["src"],ge={style:{"font-size":"16px","font-weight":"600"}},me={class:"subTitle"},_e=pe(()=>d("span",{class:"subTitle-title"}," 说明： ",-1)),ye={class:"subTitle-content"},fe=j({name:"Scene"}),ve=j({...fe,setup(C){const R=Y(),T=O(!1),E=O({}),N=new Map;N.set("started","success"),N.set("disable","error");const V=O({}),S=O({}),r=new Map;r.set("manual",{text:"手动触发",img:_("/scene/scene-hand.png"),icon:_("/scene/trigger-type-icon/manual.png"),tip:"适用于第三方平台向物联网平台下发指令控制设备"}),r.set("timer",{text:"定时触发",img:_("/scene/scene-timer.png"),icon:_("/scene/trigger-type-icon/timing.png"),tip:"适用于定期执行固定任务"}),r.set("device",{text:"设备触发",img:_("/scene/scene-device.png"),icon:_("/scene/trigger-type-icon/device.png"),tip:"适用于设备数据或行为满足触发条件时，执行指定的动作"});const $=[{dataIndex:"name",fixed:"left",ellipsis:!0,width:300,title:"名称",search:{type:"string"}},{dataIndex:"triggerType",title:"触发方式",scopedSlots:!0,search:{type:"select",options:Array.from(r).map(e=>{var l;return{label:(l=e[1])==null?void 0:l.text,value:e[0]}})}},{dataIndex:"state",title:"状态",scopedSlots:!0,search:{type:"select",options:[{label:"正常",value:"started"},{label:"禁用",value:"disable"}]}},{dataIndex:"description",title:"说明",ellipsis:!0,search:{type:"string"},scopedSlots:!0},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],A=async e=>{var p;(await ie(e)).status===200?(y("操作成功！"),(p=S.value)==null||p.reload()):y("操作失败！","error")},X=e=>{P.confirm({title:"该场景已绑定告警，确定删除？",onOk:async()=>{await A(e)}})},q=(e,l)=>{var g,m,v,h,w,I;if(!e)return[];const p=[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{T.value=!0,E.value=e}},{key:"action",text:((g=e.state)==null?void 0:g.value)!=="disable"?"禁用":"启用",tooltip:{title:e.triggerType&&((m=e.branches||[])!=null&&m.length)?((v=e.state)==null?void 0:v.value)!=="disable"?"禁用":"启用":"未配置规则的不能启用"},disabled:!(e!=null&&e.triggerType&&((h=(e==null?void 0:e.branches)||[])!=null&&h.length)),icon:e.state.value!=="disable"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${e.state.value!=="disable"?"禁用":"启用"}?`,onConfirm:async()=>{var u;let o;e.state.value!=="disable"?o=await L(e.id,"_disable"):o=await L(e.id,"_enable"),o&&o.status===200?(y("操作成功！"),(u=S.value)==null||u.reload()):y("操作失败！","error")}}},{key:"delete",text:"删除",disabled:((w=e.state)==null?void 0:w.value)!=="disable",tooltip:{title:e.state.value!=="disable"?"请先禁用该场景,再删除":"删除"},popConfirm:{title:"确认删除?",onConfirm:async()=>{var u;const o=await ae({pageSize:10,pageIndex:0,terms:[{terms:[{column:"id",termType:"rule-bind-alarm",value:{ruleId:[e.id],branchId:[-1]}}]}]});o.success&&((u=o.result)!=null&&u.total)?await X(e.id):await A(e.id)}},icon:"DeleteOutlined"}];if(e.triggerType==="manual"){const o={key:"tigger",text:"手动触发",disabled:((I=e.state)==null?void 0:I.value)==="disable",tooltip:{title:e.state.value!=="disable"?"手动触发":"未启用，不能手动触发"},icon:"LikeOutlined",popConfirm:{title:"确认手动触发？",onConfirm:async()=>{var t;(await se(e.id)).status===200?(y("操作成功！"),(t=S.value)==null||t.reload()):y("操作失败！","error")}}};p.splice(1,0,o)}return l==="table"&&p.splice(0,0,{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{F(e.id,e.triggerType)}}),p},Z=e=>{V.value=e},U=()=>{T.value=!0,E.value={}},F=(e,l)=>{R.jumpPage("rule-engine/Scene/Save",{},{triggerType:l,id:e,type:"view"})};return(e,l)=>{const p=x("pro-search"),g=x("AIcon"),m=H,v=K,h=x("Ellipsis"),w=Q,I=W,o=x("FullPage"),u=x("page-container");return f(),M(u,null,{default:s(()=>[a(p,{columns:$,target:"scene",onSearch:Z}),a(o,null,{default:s(()=>[a(I,{ref_key:"sceneRef",ref:S,columns:$,request:c(ne),defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:c(V)},{headerTitle:s(()=>[a(v,null,{default:s(()=>[a(m,{type:"primary",onClick:U,hasPermission:"rule-engine/Scene:add"},{icon:s(()=>[a(g,{type:"PlusOutlined"})]),default:s(()=>[B(" 新增 ")]),_:1})]),_:1})]),card:s(t=>{var i,b;return[a(w,{value:t,onClick:n=>F(t.id,t.triggerType),actions:q(t,"card"),status:(i=t.state)==null?void 0:i.value,statusText:(b=t.state)==null?void 0:b.text,statusNames:{started:"processing",disable:"error"}},{type:s(()=>{var n,J;return[d("span",null,[d("img",{height:16,src:(n=c(r).get(t.triggerType))==null?void 0:n.icon,style:{"margin-right":"5px"}},null,8,ue),B(k((J=c(r).get(t.triggerType))==null?void 0:J.text),1)])]}),img:s(()=>{var n;return[d("img",{src:(n=c(r).get(t.triggerType))==null?void 0:n.img},null,8,de)]}),content:s(()=>[a(h,{style:{width:"calc(100% - 100px)"}},{default:s(()=>[d("span",ge,k(t.name),1)]),_:2},1024),d("div",me,[_e,d("span",ye,[a(h,{lineClamp:2},{default:s(()=>{var n;return[B(k(t!=null&&t.description?t==null?void 0:t.description:(n=c(r).get(t.triggerType))==null?void 0:n.tip),1)]}),_:2},1024)])])]),actions:s(n=>[a(m,{disabled:n.disabled,popConfirm:n.popConfirm,tooltip:{...n.tooltip},onClick:n.onClick,hasPermission:"rule-engine/Scene:"+n.key},{default:s(()=>[n.key==="delete"?(f(),M(g,{key:0,type:"DeleteOutlined"})):(f(),z(D,{key:1},[a(g,{type:n.icon},null,8,["type"]),d("span",null,k(n==null?void 0:n.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1032,["value","onClick","actions","status","statusText"])]}),triggerType:s(t=>{var i;return[B(k((i=c(r).get(t.triggerType))==null?void 0:i.text),1)]}),state:s(t=>{var i,b;return[a(G,{status:(i=t.state)==null?void 0:i.value,text:(b=t.state)==null?void 0:b.text,statusNames:{started:"processing",disable:"error"}},null,8,["status","text"])]}),action:s(t=>[a(v,{size:16},{default:s(()=>[(f(!0),z(D,null,oe(q(t,"table"),i=>(f(),M(m,{key:i.key,disabled:i.disabled,popConfirm:i.popConfirm,tooltip:{...i.tooltip},onClick:i.onClick,type:"link",danger:i.key==="delete",style:{padding:"0 5px"},hasPermission:i.key==="view"?!0:"rule-engine/Scene:"+i.key},{icon:s(()=>[a(g,{type:i.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","danger","hasPermission"]))),128))]),_:2},1024)]),_:1},8,["request","params"])]),_:1}),c(T)?(f(),M(te,{key:0,onClose:l[0]||(l[0]=t=>T.value=!1),data:c(E)},null,8,["data"])):le("",!0)]),_:1})}}});const Ne=ee(ve,[["__scopeId","data-v-f3364511"]]);export{Ne as default};
