import{h as P,o as f,fs as J,a8 as M,v as q,F as T,d as Y,aa as Z}from"./index-1731638920964.js";import"./index-1731638920964290.js";import $ from"./product-1731638920964.js";import z from"./file-1731638920964.js";import A from"./plugin-1731638920964.js";import{d as j,k as c,r as G,p as H,e as Q,ab as R,U as l,Z as y,f as r,X as n,u as t,V as u,E as p,Y as g,_ as I,$ as W,F as ee}from"./vue-1731638920964.js";const te={key:0},oe={key:1},ae=["src"],se={key:2},le={style:{color:"#2F54EB"}},ne=j({name:"DeviceImport"}),ve=j({...ne,emits:["cancel","save"],setup(ce,{emit:k}){const o=c(0),a=G({productId:void 0,type:void 0}),i=c(),C=c([]),w=c(!0),b=c(!1),B=c(0),x=c(!1);H("flag",x);const F=Q(()=>{var s;const e=[{value:"file",label:"文件导入",subLabel:"支持上传XLSX、CSV格式文件",iconUrl:P("/device/import1.png")}];return((s=i.value)==null?void 0:s.accessProvider)==="plugin_gateway"&&e.push({value:"plugin",label:"插件导入",subLabel:"读取插件中的设备信息同步至平台",iconUrl:P("/device/import2.png")}),e}),D=e=>{a.type=e[0]},E=e=>{i.value=e},N=()=>{var e,s;if(o.value===0){if(!a.productId)return f("请选择产品","error");if(((e=i.value)==null?void 0:e.accessProvider)!=="plugin_gateway"){a.type="file",a.productId=(s=i.value)==null?void 0:s.id,o.value=2;return}}if(o.value===1&&!a.type)return f("请选择导入方式","error");o.value+=1},U=()=>{var e;((e=i.value)==null?void 0:e.accessProvider)!=="plugin_gateway"?o.value=0:o.value-=1},d=()=>{k("cancel")},K=e=>{C.value=e},O=()=>{a.type==="file"?(d(),k("save")):C.value.length?J(a.productId,C.value).then(e=>{var s,_,v;e.success&&(f("操作成功"),w.value=!1,b.value=!0,B.value=(v=(_=(s=e.result)==null?void 0:s[0])==null?void 0:_.result)==null?void 0:v.updated)}):f("请选择设备","error")},V=()=>{b.value=!1,k("save"),d()};return(e,s)=>{const _=M,v=q,S=T,m=Y,L=Z,X=R("a-icon");return l(),y(ee,null,[r(L,{maskClosable:!1,visible:t(w),width:"800px",title:"批量导入",onCancel:d},{footer:n(()=>[t(o)===0?(l(),u(m,{key:0,onClick:d},{default:n(()=>[p("取消")]),_:1})):g("",!0),t(o)!==0?(l(),u(m,{key:1,onClick:U},{default:n(()=>[p("上一步")]),_:1})):g("",!0),t(o)!==2?(l(),u(m,{key:2,onClick:N,type:"primary"},{default:n(()=>[p("下一步")]),_:1})):g("",!0),t(o)===2?(l(),u(m,{key:3,onClick:O,type:"primary",disabled:t(x)},{default:n(()=>[p("确认")]),_:1},8,["disabled"])):g("",!0)]),default:n(()=>[I("div",null,[t(o)===0?(l(),y("div",te,[r($,{rowKey:t(a).productId,"onUpdate:rowKey":s[0]||(s[0]=h=>t(a).productId=h),onChange:E},null,8,["rowKey"])])):t(o)===1?(l(),y("div",oe,[r(S,{layout:"vertical"},{default:n(()=>[r(v,{required:"",label:"选择导入方式"},{default:n(()=>[r(_,{value:[t(a).type],column:t(F).length,options:t(F),onChange:D},{image:n(({image:h})=>[I("img",{src:h},null,8,ae)]),_:1},8,["value","column","options"])]),_:1})]),_:1})])):(l(),y("div",se,[t(a).type==="file"?(l(),u(z,{key:0,product:t(a).productId},null,8,["product"])):(l(),u(A,{key:1,accessId:t(i).accessId,onChange:K},null,8,["accessId"]))]))])]),_:1},8,["visible"]),r(L,{maskClosable:!1,visible:t(b),width:"400px",title:"导入完成",onCancel:V,onOk:V},{default:n(()=>[r(X,{type:"CheckOutlined",style:{color:"#2F54EB"}}),p(" 已完成 新增设备 "),I("span",le,W(t(B)),1)]),_:1},8,["visible"])],64)}}});export{ve as _};
