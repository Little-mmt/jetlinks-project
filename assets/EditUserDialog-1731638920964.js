import{fy as L,Z as b,o as A,I as q,v as B,a0 as V,a1 as j,fz as F,w as J,F as M,aa as Z,g as z}from"./index-1731638920964.js";import{v as k,a as X,b as Y,c as G,d as H,u as K,e as Q}from"./user-17316389209642.js";import{a as W}from"./validate-1731638920964.js";import{d as ee,k as x,e as te,r as ae,q as se,ab as P,U as p,V as _,X as s,f as r,u as a,Z as U,Y as f,_ as re,E as N,$ as S}from"./vue-1731638920964.js";import"./regular-1731638920964.js";const le={key:0,class:"formName"},de={style:{width:"calc(100% - 10px)"}},oe={key:4,class:"formName"},ne="system/Department",ie="system/Role",ue=ee({__name:"EditUserDialog",props:{type:{},data:{},visible:{type:Boolean}},emits:["confirm","update:visible"],setup(T,{emit:c}){const m=T,g=x(!1),O=te(()=>m.type==="add"?"新增":m.type==="edit"?"编辑":m.type==="reset"?"重置密码":""),R=()=>{var l;g.value=!0,(l=v.value)==null||l.validate().then(()=>e.submit()).then(t=>{t.status===200&&(A("操作成功"),c("confirm"),c("update:visible",!1))}).finally(()=>g.value=!1)},v=x(),e=ae({data:{},rules:{checkUserName:(l,t)=>new Promise((n,o)=>{if(m.type==="edit")return n("");if(t){if(t.length>64)return o("最多可输入64个字符")}else return o("请输入用户名");k("username",t).then(i=>{i.result.passed?n(""):o(i.result.reason)})}),checkPassword:(l,t)=>new Promise((n,o)=>{if(t){if(t.length>64)return o("最多可输入64个字符");if(t.length<8)return o("密码不能少于8位");if(!W(t))return o("密码必须包含大小写英文和数字")}else return o("请输入密码");k("password",t).then(i=>{i.result.passed?n(""):o(i.result.reason)})}),checkAgainPassword:(l,t)=>t?t===e.data.password?Promise.resolve():Promise.reject("两次密码输入不一致"):Promise.reject("请再次输入密码")},roleOptions:[],departmentOptions:[],_departmentOptions:[],init:()=>{e.getDepartmentList(),e.getRoleList(),e.getUserInfo()},getUserInfo:()=>{const l=m.data.id||"";m.type==="add"?e.data={}:m.type==="reset"?e.data={id:l}:m.type==="edit"&&X(l).then(t=>{var n,o,i;e.data={...t.result,orgIdList:t.result.orgList.map(u=>u.id),roleIdList:t.result.roleList.map(u=>u.id)},e.data.roleIdList=(o=(n=t.result)==null?void 0:n.roleList)==null?void 0:o.map(u=>u.id),e._departmentOptions=(i=t.result)==null?void 0:i.orgList,se(()=>{var u;(u=v.value)==null||u.clearValidate()})})},submit:()=>{let l,t={};if(m.type==="add")l=H,t={user:e.data,orgIdList:e.data.orgIdList,roleIdList:e.data.roleIdList};else if(m.type==="edit")l=K,t={id:e.data.id,user:e.data,orgIdList:e.data.orgIdList,roleIdList:e.data.roleIdList};else if(m.type==="reset")l=Q,t={id:e.data.id,password:e.data.password};else return Promise.reject();return l(t)},getRoleList:()=>{Y({sorts:[{name:"createTime",order:"desc"}]}).then(l=>{l.status===200&&(e.roleOptions=D(l.result))})},getDepartmentList:()=>{G({paging:!1,sorts:[{name:"sortIndex",order:"asc"}]}).then(l=>{e.departmentOptions=l.result.sort((t,n)=>t.sortIndex===n.sortIndex?n.createTime-t.createTime:t.sortIndex-n.sortIndex)})},IsShow:(...l)=>l.includes(m.type),clickAddItem:(l,t)=>{const n=window.open(`${origin}/#/system/${t}?save=true`);n.onTabSaveSuccess=o=>{e.data[l]=[...e.data[l]||[],o],l==="roleIdList"?e.getRoleList():e.getDepartmentList()}}}),D=l=>l.map(t=>({name:t.groupName,id:t.groupId,disabled:!0,children:t!=null&&t.roles?t.roles.map(n=>({name:n.name,id:n.id})):[]}));return e.init(),(l,t)=>{const n=q,o=B,i=V,u=j,$=P("Ellipsis"),I=F,y=P("AIcon"),h=J,C=M,E=Z;return p(),_(E,{visible:"",title:a(O),maskClosable:!1,width:"675px",onOk:R,onCancel:t[10]||(t[10]=d=>c("update:visible",!1)),class:"edit-dialog-container",confirmLoading:a(g),cancelText:"取消",okText:"确定"},{default:s(()=>[r(C,{ref_key:"formRef",ref:v,model:a(e).data,layout:"vertical"},{default:s(()=>[a(e).IsShow("add","edit")?(p(),U("div",le,"基础信息")):f("",!0),a(e).IsShow("add","edit")?(p(),_(u,{key:1,gutter:24},{default:s(()=>[r(i,{span:24},{default:s(()=>[r(o,{name:"name",label:"姓名",rules:[{required:!0,message:"请输入姓名"},{max:64,message:"最多可输入64个字符"}]},{default:s(()=>[r(n,{value:a(e).data.name,"onUpdate:value":t[0]||(t[0]=d=>a(e).data.name=d),placeholder:"请输入姓名"},null,8,["value"])]),_:1})]),_:1})]),_:1})):f("",!0),a(e).IsShow("add","edit")?(p(),_(u,{key:2,gutter:24},{default:s(()=>[r(i,{span:12},{default:s(()=>[r(o,{name:"telephone",label:"手机号",rules:[{pattern:/^1[3456789]\d{9}$/,message:"请输入正确的手机号"}]},{default:s(()=>[r(n,{value:a(e).data.telephone,"onUpdate:value":t[1]||(t[1]=d=>a(e).data.telephone=d),placeholder:"请输入手机号",maxlength:64},null,8,["value"])]),_:1})]),_:1}),r(i,{span:12},{default:s(()=>[r(o,{name:"email",label:"邮箱",rules:[{pattern:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,message:"请输入正确的邮箱"}]},{default:s(()=>[r(n,{value:a(e).data.email,"onUpdate:value":t[2]||(t[2]=d=>a(e).data.email=d),placeholder:"请输入邮箱",maxlength:64},null,8,["value"])]),_:1},8,["rules"])]),_:1})]),_:1})):f("",!0),a(e).IsShow("add","edit")?(p(),_(u,{key:3,gutter:24},{default:s(()=>[r(i,{span:12},{default:s(()=>[r(o,{name:"roleIdList",label:"角色",class:"flex",rules:[{required:a(e).data.username!=="admin",message:"请选择角色"}]},{default:s(()=>[r(I,{value:a(e).data.roleIdList,"onUpdate:value":t[3]||(t[3]=d=>a(e).data.roleIdList=d),multiple:"","show-search":"",style:{width:"calc(100% - 40px)"},placeholder:"请选择角色","tree-data":a(e).roleOptions,fieldNames:{label:"name",value:"id",children:"children"},disabled:a(e).data.username==="admin",filterTreeNode:(d,w)=>a(L)(d,w,"name")},{title:s(({name:d})=>[re("div",de,[r($,null,{default:s(()=>[N(S(d),1)]),_:2},1024)])]),_:1},8,["value","tree-data","disabled","filterTreeNode"]),a(e).data.username!=="admin"?(p(),_(b,{key:0,hasPermission:`${ie}:add`,onClick:t[4]||(t[4]=d=>a(e).clickAddItem("roleIdList","Role"))},{default:s(()=>[r(y,{type:"PlusOutlined"})]),_:1},8,["hasPermission"])):f("",!0)]),_:1},8,["rules"])]),_:1}),r(i,{span:12},{default:s(()=>[r(o,{name:"orgIdList",label:"组织",class:"flex"},{default:s(()=>[r(I,{value:a(e).data.orgIdList,"onUpdate:value":t[5]||(t[5]=d=>a(e).data.orgIdList=d),"show-search":"",style:{width:"calc(100% - 40px)"},placeholder:"请选择组织","tree-data":a(e).departmentOptions,fieldNames:{label:"name",value:"id"},multiple:"",filterTreeNode:(d,w)=>a(L)(d,w,"name")},{title:s(({name:d})=>[N(S(d),1)]),_:1},8,["value","tree-data","filterTreeNode"]),r(b,{hasPermission:`${ne}:add`,onClick:t[6]||(t[6]=d=>a(e).clickAddItem("orgIdList","Department"))},{default:s(()=>[r(y,{type:"PlusOutlined"})]),_:1},8,["hasPermission"])]),_:1})]),_:1})]),_:1})):f("",!0),a(e).IsShow("add","edit")?(p(),U("div",oe,"账号信息")):f("",!0),a(e).IsShow("add","edit")?(p(),_(u,{key:5,gutter:24},{default:s(()=>[r(i,{span:24},{default:s(()=>[r(o,{name:"username",label:"用户名",validateFirst:!0,rules:[{required:!0,message:"请输入用户名"},{validator:a(e).rules.checkUserName,trigger:"blur"}]},{default:s(()=>[r(n,{value:a(e).data.username,"onUpdate:value":t[7]||(t[7]=d=>a(e).data.username=d),placeholder:"请输入用户名",disabled:m.type==="edit"},null,8,["value","disabled"])]),_:1},8,["rules"])]),_:1})]),_:1})):f("",!0),a(e).IsShow("add","reset")?(p(),_(u,{key:6},{default:s(()=>[r(i,{span:24},{default:s(()=>[r(o,{name:"password",label:"密码",rules:[{required:!0,message:""},{validator:a(e).rules.checkPassword,trigger:"change"}]},{default:s(()=>[r(h,{value:a(e).data.password,"onUpdate:value":t[8]||(t[8]=d=>a(e).data.password=d),placeholder:"请输入密码"},null,8,["value"])]),_:1},8,["rules"])]),_:1})]),_:1})):f("",!0),a(e).IsShow("add","reset")?(p(),_(u,{key:7},{default:s(()=>[r(i,{span:24},{default:s(()=>[r(o,{name:"confirmPassword",label:"确认密码",rules:[{required:!0,message:""},{validator:a(e).rules.checkAgainPassword,trigger:"blur"},{}]},{default:s(()=>[r(h,{value:a(e).data.confirmPassword,"onUpdate:value":t[9]||(t[9]=d=>a(e).data.confirmPassword=d),placeholder:"请再次输入密码",maxlength:64},null,8,["value"])]),_:1},8,["rules"])]),_:1})]),_:1})):f("",!0)]),_:1},8,["model"])]),_:1},8,["title","confirmLoading"])}}});const ge=z(ue,[["__scopeId","data-v-695b1d8c"]]);export{ge as default};
