import{a9 as ne,v as ue,a7 as re,a6 as se,dj as ie,I as de,cY as ve,d5 as ce,aD as me,dd as pe,F as fe,d as ye,Z as _e,aa as ge}from"./index-1730252110824.js";import{w as he}from"./collector-1730252110824.js";import{d as be,k as w,ab as ke,U as t,V as o,X as u,f,E as m,u as e,Z as U,F as N,a1 as S,_,Y as H,$ as Ce}from"./vue-1730252110824.js";const we={style:{"margin-top":"10px"}},Ue={style:{"margin-top":"10px"}},Pe=_("span",null,"写入优先级",-1),Ie=_("br",null,null,-1),je=_("br",null,null,-1),Ae=_("br",null,null,-1),$e=be({__name:"index",props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(n,{emit:P}){var D,O,B,$,Y,x;const d=n,y=(((D=d.data)==null?void 0:D.provider)==="OPC_UA"?((B=(O=d==null?void 0:d.data)==null?void 0:O.configuration)==null?void 0:B.type)||"String":((x=(Y=($=d.data)==null?void 0:$.configuration)==null?void 0:Y.codec)==null?void 0:x.provider)||"int8").toLocaleLowerCase(),T=["int8","int16","int32","ieee754_float","ieee754_double","number"],V=["Byte","Word","DWord","USInt","SInt","Int","UDInt","DInt","Real","LReal"],g=w(!1),I=w(),R=new Array(16),l=w({value:d.data.provider==="OPC_UA"?[""]:"",others:{priority:1}}),J=async(v,a)=>/^0[xX][0-9A-Fa-f]+$|^[0-9A-Fa-f]+$/.test(a)?Promise.resolve():Promise.reject("请输入16进制"),E=async(v,a)=>(console.log(a),a.length&&a.every(c=>c)?Promise.resolve():Promise.reject(`请输入${d.data.name}`)),W=d.data.collectorId,X=d.data.id,j=(v,a,c)=>{d.data.provider==="OPC_UA"?l.value.value[c]=a:l.value.value=a},Z=async()=>{var p;const v=await((p=I.value)==null?void 0:p.validate());d.data.provider==="OPC_UA"&&(v.value=v.value.length===1?v.value[0]:v.value);const a={...v,pointId:X};g.value=!0;const c=await he(W,[a]).catch(()=>{});P("change",(c==null?void 0:c.status)===200),g.value=!1},A=()=>{P("change",!1)},h=(v,a)=>a.label.toLowerCase().indexOf(v.toLowerCase())>=0;return(v,a)=>{const c=ne,p=ue,b=re,k=se,L=ie,C=de,q=ve,Q=ke("AIcon"),z=ce,G=me,K=pe,ee=fe,ae=ye,le=_e,te=ge;return t(),o(te,{title:"写入",visible:!0,width:"500px",onCancel:A},{footer:u(()=>[f(ae,{key:"back",onClick:A},{default:u(()=>[m("取消")]),_:1}),f(le,{key:"submit",type:"primary",loading:e(g),onClick:Z,style:{"margin-left":"8px"},hasPermission:"DataCollect/Collector:update"},{default:u(()=>[m(" 确认 ")]),_:1},8,["loading"])]),default:u(()=>[f(ee,{class:"form",layout:"vertical",model:e(l),name:"basic",autocomplete:"off",ref_key:"formRef",ref:I},{default:u(()=>{var F,M;return[n.data.provider==="MODBUS_TCP"&&((F=n.data)==null?void 0:F.configuration.function)==="Coils"?(t(),o(p,{key:0,label:n.data.name,name:"value",rules:[{required:!0,message:`请输入${n.data.name}`}]},{default:u(()=>[f(c,{placeholder:"请输入",value:e(l).value,"onUpdate:value":a[0]||(a[0]=r=>e(l).value=r),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1},8,["label","rules"])):n.data.provider==="OPC_UA"?(t(),o(p,{key:1,label:n.data.name,name:"value",rules:[{required:!0,message:`请输入${n.data.name}`},{validator:E,trigger:"change"}]},{default:u(()=>[(t(!0),U(N,null,S(e(l).value,(r,s)=>(t(),U("div",we,[["double","float","llong","long","integer","short"].includes(e(y))?(t(),o(b,{key:0,style:{width:"100%"},placeholder:"请输入",value:e(l).value[s],"onUpdate:value":i=>e(l).value[s]=i},null,8,["value","onUpdate:value"])):["boolean"].includes(e(y))?(t(),o(k,{key:1,style:{width:"100%"},value:e(l).value[s],"onUpdate:value":i=>e(l).value[s]=i,options:[{label:"是",value:!0},{label:"否",value:!1}],placeholder:"请选择",allowClear:"","show-search":"","filter-option":h},null,8,["value","onUpdate:value"])):["datetime"].includes(e(y))?(t(),o(L,{key:2,style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","show-time":"",placeholder:"请选择",onChange:(i,oe)=>j(i,oe,s)},null,8,["onChange"])):(t(),o(C,{key:3,placeholder:"请输入",value:e(l).value[s],"onUpdate:value":i=>e(l).value[s]=i},null,8,["value","onUpdate:value"]))]))),256)),_("div",Ue,[f(q,{onClick:a[1]||(a[1]=r=>e(l).value.push(""))},{default:u(()=>[m("+")]),_:1}),e(l).value.length!==1?(t(),o(q,{key:0,onClick:a[2]||(a[2]=r=>e(l).value.splice(e(l).value.length-1,1))},{default:u(()=>[m("-")]),_:1})):H("",!0)])]),_:1},8,["label","rules"])):n.data.provider==="snap7"?(t(),o(p,{key:2,label:n.data.name,name:"value",rules:[{required:!0,message:`请输入${n.data.name}`}]},{default:u(()=>{var r,s;return[V.includes((r=n.data.configuration)==null?void 0:r.type)?(t(),o(b,{key:0,style:{width:"100%"},placeholder:"请输入",value:e(l).value,"onUpdate:value":a[3]||(a[3]=i=>e(l).value=i)},null,8,["value"])):["Bool"].includes((s=n.data.configuration)==null?void 0:s.type)?(t(),o(k,{key:1,style:{width:"100%"},value:e(l).value,"onUpdate:value":a[4]||(a[4]=i=>e(l).value=i),options:[{label:"是",value:!0},{label:"否",value:!1}],placeholder:"请选择",allowClear:"","show-search":"","filter-option":h},null,8,["value"])):(t(),o(C,{key:2,placeholder:"请输入",value:e(l).value,"onUpdate:value":a[5]||(a[5]=i=>e(l).value=i)},null,8,["value"]))]}),_:1},8,["label","rules"])):(t(),o(p,{key:3,label:n.data.name,name:"value",rules:["hex"].includes(e(y))?[{required:!0,message:`请输入${n.data.name}`},{validator:J,trigger:"blur"}]:[{required:!0,message:`请输入${n.data.name}`}]},{default:u(()=>[T.includes(e(y))?(t(),o(b,{key:0,style:{width:"100%"},placeholder:"请输入",value:e(l).value,"onUpdate:value":a[6]||(a[6]=r=>e(l).value=r)},null,8,["value"])):["boolean"].includes(e(y))?(t(),o(k,{key:1,style:{width:"100%"},value:e(l).value,"onUpdate:value":a[7]||(a[7]=r=>e(l).value=r),options:[{label:"是",value:!0},{label:"否",value:!1}],placeholder:"请选择",allowClear:"","show-search":"","filter-option":h},null,8,["value"])):["datetime"].includes(e(y))?(t(),o(L,{key:2,style:{width:"100%"},format:"YYYY-MM-DD HH:mm:ss","show-time":"",placeholder:"请选择",onChange:j})):(t(),o(C,{key:3,placeholder:"请输入",value:e(l).value,"onUpdate:value":a[8]||(a[8]=r=>e(l).value=r)},null,8,["value"]))]),_:1},8,["label","rules"])),((M=n.data)==null?void 0:M.provider)==="BACNetIp"?(t(),o(p,{key:4,rules:[{required:!0,message:"请选择写入优先级"}],name:["others","priority"]},{label:u(()=>[_("div",null,[Pe,f(z,null,{title:u(()=>[m("写优先级允许系统管理员或控制策略决定哪些写入请求应被优先处理 "),Ie,m(" ·1表示最高优先级，16表示最低优先级"),je,m(" ·当多个控制器或系统尝试写入同一个点位时，较高优先级的写入请求会覆盖较低优先级的写入请求"),Ae,m(" ·如果高优先级的写入请求失效，系统会自动恢复次高优先级的写入值，依次类推直至找到有效的写入请求")]),default:u(()=>[f(Q,{type:"QuestionCircleOutlined",style:{"margin-left":"10px"}})]),_:1})])]),default:u(()=>[f(K,{value:e(l).others.priority,"onUpdate:value":a[9]||(a[9]=r=>e(l).others.priority=r)},{default:u(()=>[(t(!0),U(N,null,S(e(R),(r,s)=>(t(),o(G,{value:s+1},{default:u(()=>[m(Ce(s+1),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1})):H("",!0)]}),_:1},8,["model"])]),_:1})}}});export{$e as _};
