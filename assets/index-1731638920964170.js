import{d as re,ac as ue,e as M,k as r,o as de,ab as x,U as u,V as f,X as s,_ as U,f as o,u as e,E as S,Z as G,F as X,a1 as ce,W as pe,G as Z,Y as z}from"./vue-1731638920964.js";import{X as me,o as V,d as ye,$ as ve,Z as fe,ds as _e,e as ke,a3 as he,a4 as k,g as Ce}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{c as H}from"./channel-17316389209642.js";import{_ as be}from"./Save.vue_vue_type_script_setup_true_lang-17316389209646.js";import xe from"./index-1731638920964166.js";import ge from"./index-1731638920964168.js";import{d as W}from"./device-17316389209643.js";import Pe from"./index-1731638920964169.js";import Ie from"./index-1731638920964167.js";import"./index-1731638920964289.js";import"./mediaTool-1731638920964.js";import"./RadioButton-1731638920964.js";import"./Share-1731638920964.js";import"./Preset.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./unionBy-1731638920964.js";import"./index-1731638920964299.js";import"./index-1731638920964306.js";import"./index-1731638920964157.js";import"./Setting.vue_vue_type_script_setup_true_name_Setting_lang-1731638920964.js";import"./Time-1731638920964.js";import"./auto-1731638920964.js";import"./planSelect.vue_vue_type_script_setup_true_name_planSelect_lang-1731638920964.js";const qe={class:"device-channel-warp"},De={class:"right"},Se=re({__name:"index",setup(Ve){const Y=me(),i=ue(),O=[{title:"通道ID",dataIndex:"channelId",key:"channelId",ellipsis:!0,search:{type:"string"}},{title:"名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string",first:!0}},{title:"厂商",dataIndex:"manufacturer",key:"manufacturer",ellipsis:!0},{title:"安装地址",dataIndex:"address",ellipsis:!0,key:"address",search:{type:"string"}},{title:"状态",dataIndex:"status",key:"status",scopedSlots:!0,width:150,search:{type:"select",options:[{label:"已连接",value:"online"},{label:"未连接",value:"offline"}],handleValue:a=>a}},{title:"操作",key:"action",width:240,scopedSlots:!0}],A=M(()=>i.query.type==="fixed-media"?O.filter(a=>a.key!=="manufacturer"):O),g=r({}),p=r(),P=r(!1),h=r(!1),I=r(""),K=a=>{g.value=a},_=r(!1),Q=()=>{d.value=void 0,_.value=!0},m=r(),C=r(!1),d=r(),B=r(),ee=(a,l)=>{if(!a)return[];const y=[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{d.value=k(a),_.value=!0}},{key:"play",text:"播放",tooltip:{title:"播放"},icon:"PlayCircleOutlined",onClick:()=>{B.value=k(a),C.value=!0}},{key:"backPlay",text:"回放",tooltip:{title:"回放"},icon:"HistoryOutlined",onClick:()=>{Y.jumpPage("media/Device/Playback",{},{id:i.query.id,type:i.query.type,channelId:a.channelId})}},{key:"plan",text:"抓拍计划",tooltip:{title:"抓拍计划"},icon:"CameraOutlined",onClick:()=>{h.value=!0,I.value="screenshot",d.value=k(a)}},{key:"plan",text:"录像计划",tooltip:{title:"录像计划"},icon:"VideoCameraOutlined",onClick:()=>{I.value="video",h.value=!0,d.value=k(a)}},{key:"share",text:"分享地址",tooltip:{title:"分享地址"},icon:"ShareAltOutlined",onClick:()=>{P.value=!0,d.value=k(a)}},{key:"delete",text:"删除",tooltip:{title:"删除"},popConfirm:{title:"确认删除?",onConfirm:()=>{const c=H.del(a.id);return c.then(b=>{var v;b.status===200?(V("操作成功！"),(v=m.value)==null||v.reload()):V("操作失败！","error")}),c}},icon:"DeleteOutlined"}];return(i==null?void 0:i.query.type)==="gb28181-2016"?y.filter(c=>c.key!=="delete"):y},te=M(()=>i.query.id),ae=a=>{var l,y;a===te.value&&((l=m.value)!=null&&l.reload)?(y=m.value)==null||y.reload():g.value={terms:[{column:"parentId",value:a}]}},ne=async()=>{var l;(await W.updateChannels(p.value.id)).success&&(V("通道更新成功"),(l=m.value)==null||l.reload())};return de(async()=>{const a=await W.detail(i.query.id);a.success&&(p.value=a.result)}),(a,l)=>{const y=x("pro-search"),c=ye,b=ve,v=x("AIcon"),q=fe,le=_e,T=ke,oe=he,se=x("FullPage"),ie=x("page-container");return u(),f(ie,null,{default:s(()=>[U("div",qe,[o(ge,{deviceData:e(p),"on-tree-load":n=>a.show=n,"on-select":ae},null,8,["deviceData","on-tree-load"]),U("div",De,[o(y,{columns:e(A),target:"channel",onSearch:K},null,8,["columns"]),o(se,null,{default:s(()=>[o(oe,{ref_key:"listRef",ref:m,model:"table",columns:e(A),request:n=>{var t;return e(H).list(n,(t=e(i))==null?void 0:t.query.id)},defaultParams:{sorts:[{name:"modifyTime",order:"desc"}]},params:e(g)},{headerTitle:s(()=>[["gb28181-2016","onvif"].includes(e(i).query.type)?(u(),f(b,{key:0,title:`接入方式为${e(i).query.type==="onvif"?"Onvif":"GB/T28181"}时，不支持新增`},{default:s(()=>[o(c,{type:"primary",disabled:""},{default:s(()=>[S(" 新增 ")]),_:1})]),_:1},8,["title"])):(u(),f(q,{key:1,type:"primary",onClick:Q,hasPermission:"media/Device:add"},{icon:s(()=>[o(v,{type:"PlusOutlined"}),S("新增")]),_:1}))]),rightExtraRender:s(()=>{var n,t,D,w,$,R,j,J,E,F,N,L;return[o(q,{type:"text",tooltip:{title:((t=(n=e(i))==null?void 0:n.query)==null?void 0:t.type)==="fixed-media"?"固定地址无法更新通道":((w=(D=e(p))==null?void 0:D.state)==null?void 0:w.value)==="offline"?"设备已离线":((R=($=e(p))==null?void 0:$.state)==null?void 0:R.value)==="notActive"?"设备已禁用":"更新通道"},disabled:((J=(j=e(p))==null?void 0:j.state)==null?void 0:J.value)==="offline"||((F=(E=e(p))==null?void 0:E.state)==null?void 0:F.value)==="notActive"||((L=(N=e(i))==null?void 0:N.query)==null?void 0:L.type)==="fixed-media",onClick:ne},{icon:s(()=>[o(v,{type:"SyncOutlined"}),S("更新通道")]),_:1},8,["tooltip","disabled"])]}),status:s(n=>[o(T,null,{default:s(()=>[o(le,{status:n.status.value==="online"?"success":"error",text:n.status.text},null,8,["status","text"])]),_:2},1024)]),action:s(n=>[o(T,{size:16},{default:s(()=>[(u(!0),G(X,null,ce(ee(n,"table"),t=>(u(),G(X,{key:t.key},[t.key!=="play"&&t.key!=="backPlay"&&t.key!=="share"&&t.key!=="plan"?(u(),f(q,{key:0,danger:t.key==="delete",disabled:t.disabled,popConfirm:t.popConfirm,tooltip:{...t.tooltip},onClick:t.onClick,type:"link",style:{padding:"0px"},hasPermission:"media/Device:"+t.key},{icon:s(()=>[o(v,{type:t.icon},null,8,["type"])]),_:2},1032,["danger","disabled","popConfirm","tooltip","onClick","hasPermission"])):(u(),f(b,pe({key:t.key},t.tooltip),{default:s(()=>[o(c,{style:{padding:"0px"},type:"link",onClick:D=>t.onClick&&t.onClick(n)},{default:s(()=>[o(c,{disabled:t.disabled,style:{padding:"0"},type:"link"},{default:s(()=>[o(v,{type:t.icon},null,8,["type"])]),_:2},1032,["disabled"])]),_:2},1032,["onClick"])]),_:2},1040))],64))),128))]),_:2},1024)]),_:1},8,["columns","request","params"])]),_:1})])]),o(be,{visible:e(_),"onUpdate:visible":l[0]||(l[0]=n=>Z(_)?_.value=n:null),channelData:e(d),onSubmit:l[1]||(l[1]=n=>e(m).reload())},null,8,["visible","channelData"]),o(xe,{visible:e(C),"onUpdate:visible":l[2]||(l[2]=n=>Z(C)?C.value=n:null),data:e(B),onRefresh:l[3]||(l[3]=n=>e(m).reload())},null,8,["visible","data"]),e(P)?(u(),f(Pe,{key:0,onClose:l[4]||(l[4]=n=>P.value=!1),data:e(d)},null,8,["data"])):z("",!0),e(h)?(u(),f(Ie,{key:1,data:e(d),onClose:l[5]||(l[5]=n=>h.value=!1),type:e(I)},null,8,["data","type"])):z("",!0)]),_:1})}}});const lt=Ce(Se,[["__scopeId","data-v-61793a75"]]);export{lt as default};
