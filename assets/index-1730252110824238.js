import{d as L,ac as le,k as V,r as T,w as q,ab as w,U as r,V as _,X as l,f as s,_ as b,u as c,Z as B,$ as E,Y as j,E as D}from"./vue-1730252110824.js";import{aF as se,a4 as oe,o as N,dp as de,dg as ie,d as ue,I as re,v as ce,a7 as me,aJ as _e,aK as pe,Z as fe,aT as ye,F as he,aa as ve,g as ge}from"./index-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import{g as ke,r as be,a as xe,d as Ce,s as J}from"./dataSource-1730252110824.js";import{l as Ke}from"./lodash.default-1730252110824.js";import"./throttle-1730252110824.js";import"./min-1730252110824.js";import"./isNil-1730252110824.js";import"./isUndefined-1730252110824.js";import"./difference-1730252110824.js";import"./flattenDeep-1730252110824.js";import"./sortBy-1730252110824.js";import"./unionBy-1730252110824.js";import"./uniqBy-1730252110824.js";import"./toLower-1730252110824.js";const Ue={class:"manager-container"},Ie={class:"left"},Te={class:"tree"},we={key:0,style:{"justify-content":"space-between",display:"flex","align-items":"center",width:"200px"}},De={key:1},je={class:"right"},Ne={class:"btns"},Se=L({name:"Management"}),Fe=L({...Se,setup(Pe){const k=le().query.id,O=[{title:"列名",dataIndex:"name",key:"name"},{title:"类型",dataIndex:"type",key:"type"},{title:"长度",dataIndex:"length",key:"length"},{title:"精度",dataIndex:"scale",key:"scale"},{title:"不能为空",dataIndex:"notnull",key:"notnull",width:130},{title:"说明",dataIndex:"comment",key:"comment"},{title:"操作",dataIndex:"action",key:"action"}],S=V(),R=e=>{ke(e).then(t=>{x.data=t.result})},x=T({data:{}}),n=T({searchValue:"",sourceTree:[],treeData:[],selectedKeys:[],oldKey:""}),C=e=>{e&&be(k,e).then(t=>{f.data=t.result.columns.map((o,a)=>({old_id:se(),...o,index:a}))})},A=e=>{xe(k).then(t=>{var o,a;t.status===200&&(n.sourceTree=t.result,e?(n.selectedKeys=[(o=t.result[0])==null?void 0:o.name],C((a=t.result[0])==null?void 0:a.name)):C(n.selectedKeys[0]))}).catch(()=>{})},M=(e,t)=>{var a;if((a=t==null?void 0:t.node)!=null&&a.root){n.selectedKeys=[n.oldKey];return}if(!e[0])return;n.oldKey=e[0];const o=e[0];C(o)},Z=e=>{e==null||e.stopPropagation(),p.visible=!0};q(()=>k,e=>{e&&(R(e),A(!0))},{immediate:!0});const f=T({data:[]}),$=()=>{const e={scale:0,length:0,notnull:!1,type:"",comment:"",name:""};f.data.push(e)},z=(e,t)=>{if(e.scale!==void 0){const o=Ce(k,n.selectedKeys[0],[e.name]);return o.then(a=>{a.status===200&&f.data.splice(t,1)}),o}else f.data.splice(t,1)},X=()=>{S.value.validate().then(e=>{const t=oe(f.data);if(t.forEach(a=>{a==null||delete a.old_id,a==null||delete a.index}),!t.length){N("请配置数据源字段","error");return}const o={name:n.selectedKeys[0],columns:t};J(k,o).then(a=>{a.status===200&&(N("操作成功"),C(o.name))})})},K=V(),p=T({visible:!1,form:{name:""}}),Y=()=>{K.value&&K.value.validate().then(()=>{var t;const e=p.form.name;n.sourceTree.unshift({id:e,name:e}),n.oldKey=e,n.selectedKeys=[e],f.data=[],p.visible=!1,(t=K.value)==null||t.resetFields()}),J(k,{name:p.form.name,columns:[]}).then(e=>{e.status===200&&N("操作成功")})},G=()=>{var e;p.visible=!1,(e=K.value)==null||e.resetFields()};q([()=>n.searchValue,()=>n.sourceTree],([e,t])=>{var o,a,y,I,U,h;if(e){const u=t.filter(v=>v.name.includes(e));n.treeData=[{title:(o=x.data.shareConfig)==null?void 0:o.schema,key:(a=x.data.shareConfig)==null?void 0:a.schema,root:!0,children:u.map(v=>({title:v.name,key:v.name}))}],Ke.map(u,"name").includes(n.selectedKeys[0])||(n.selectedKeys=[(y=u[0])==null?void 0:y.name],C((I=u[0])==null?void 0:I.name))}else n.treeData=[{title:(U=x.data.shareConfig)==null?void 0:U.schema,key:(h=x.data.shareConfig)==null?void 0:h.schema,root:!0,children:n.sourceTree.map(u=>({title:u.name,key:u.name}))}]},{deep:!0});const H=(e,t)=>new Promise((o,a)=>{if(t){const y=t.slice(0,1);typeof Number(y)=="number"&&!isNaN(Number(y))?a("不能以数字开头"):o("")}else o("")});return(e,t)=>{const o=de,a=w("AIcon"),y=w("Ellipsis"),I=ie,U=ue,h=re,u=ce,v=me,F=_e,Q=pe,W=fe,ee=ye,P=he,te=w("FullPage"),ae=ve,ne=w("page-container");return r(),_(ne,null,{default:l(()=>[s(te,null,{default:l(()=>[b("div",Ue,[b("div",Ie,[s(o,{value:c(n).searchValue,"onUpdate:value":t[0]||(t[0]=d=>c(n).searchValue=d),placeholder:"请输入",style:{"margin-bottom":"24px"}},null,8,["value"]),b("div",Te,[c(n).treeData.length>0?(r(),_(I,{key:0,defaultExpandAll:"","tree-data":c(n).treeData,selectedKeys:c(n).selectedKeys,"onUpdate:selectedKeys":t[1]||(t[1]=d=>c(n).selectedKeys=d),onSelect:M,showLine:{showLeafIcon:!1},"show-icon":!0},{title:l(({dataRef:d})=>[s(y,null,{default:l(()=>[d.root?(r(),B("div",we,[b("span",null,E(d.title),1),s(a,{type:"PlusOutlined",style:{color:"#1677ff"},onClick:Z})])):(r(),B("span",De,E(d.title),1))]),_:2},1024)]),_:1},8,["tree-data","selectedKeys"])):j("",!0)])]),b("div",je,[b("div",Ne,[s(U,{type:"primary",onClick:X},{default:l(()=>[D("保存")]),_:1})]),s(P,{ref_key:"formRef",ref:S,model:c(f)},{default:l(()=>[s(ee,{columns:O,dataSource:c(f).data,pagination:!1,scroll:{y:500}},{bodyCell:l(({column:d,record:i,index:g})=>[d.key==="name"?(r(),_(u,{key:0,name:["data",g,"name"],rules:[{max:64,message:"最多可输入64个字符"},{required:!0,message:"请输入名称"}]},{default:l(()=>[s(h,{disabled:i.old_id,value:i.name,"onUpdate:value":m=>i.name=m,placeholder:"请输入名称"},null,8,["disabled","value","onUpdate:value"])]),_:2},1032,["name"])):d.key==="type"?(r(),_(u,{key:1,name:["data",g,"type"],rules:[{max:64,message:"最多可输入64个字符"},{required:!0,message:"请输入类型"}]},{default:l(()=>[s(h,{disabled:i.old_id,value:i.type,"onUpdate:value":m=>i.type=m,placeholder:"请输入类型"},null,8,["disabled","value","onUpdate:value"])]),_:2},1032,["name"])):d.key==="length"?(r(),_(u,{key:2,name:["data",g,"length"]},{default:l(()=>[s(v,{value:i.length,"onUpdate:value":m=>i.length=m,min:0,max:99999,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):d.key==="scale"?(r(),_(u,{key:3,name:["data",g,"scale"]},{default:l(()=>[s(v,{value:i.scale,"onUpdate:value":m=>i.scale=m,min:0,max:99999,style:{width:"100%"}},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):d.key==="notnull"?(r(),_(u,{key:4,name:["data",g,"notnull"],rules:[{required:!0,message:"请选择是否不能为空"}]},{default:l(()=>[s(Q,{value:i.notnull,"onUpdate:value":m=>i.notnull=m,"button-style":"solid"},{default:l(()=>[s(F,{value:!0},{default:l(()=>[D("是")]),_:1}),s(F,{value:!1},{default:l(()=>[D("否")]),_:1})]),_:2},1032,["value","onUpdate:value"])]),_:2},1032,["name"])):d.key==="comment"?(r(),_(u,{key:5,name:["data",g,"comment"]},{default:l(()=>[s(h,{value:i.comment,"onUpdate:value":m=>i.comment=m,placeholder:"请输入说明"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])):d.key==="action"?(r(),_(W,{key:6,hasPermission:"system/DataSource:delete",type:"link",tooltip:{title:"删除"},danger:!0,popConfirm:{title:"确认删除",onConfirm:()=>z(i,g)},disabled:i.status},{default:l(()=>[s(a,{type:"DeleteOutlined"})]),_:2},1032,["popConfirm","disabled"])):j("",!0)]),_:1},8,["dataSource"])]),_:1},8,["model"]),s(U,{class:"add-row",onClick:$},{default:l(()=>[s(a,{type:"PlusOutlined"}),D(" 新增行 ")]),_:1})])])]),_:1}),c(p).visible?(r(),_(ae,{key:0,visible:!0,title:"新增",onOk:Y,onCancel:G},{default:l(()=>[s(P,{model:c(p).form,ref_key:"addFormRef",ref:K,layout:"vertical"},{default:l(()=>[s(u,{label:"名称",name:"name",required:!0,rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符",trigger:"change"},{trigger:"change",validator:H},{pattern:/^[a-zA-Z0-9_\u4e00-\u9fa5]+$/,message:"名称只能由英文、汉字、下划线、数字组成",trigger:"change"}]},{default:l(()=>[s(h,{value:c(p).form.name,"onUpdate:value":t[2]||(t[2]=d=>c(p).form.name=d),placeholder:"请输入名称"},null,8,["value"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1})):j("",!0)]),_:1})}}});const We=ge(Fe,[["__scopeId","data-v-6dbc7193"]]);export{We as default};
