import{d as pe,ad as me,k as p,o as ve,ab as M,U as y,V as g,X as a,f as n,u as s,E as k,G as fe,W as ye,R as _e,_ as r,$ as u,Z,F as G,Y as T,a1 as he,af as ge,ag as xe}from"./vue-1730252110824.js";import{X as Ce,a as ke,h as Se,ax as z,au as Q,o as m,Z as be,e as we,a0 as Te,a1 as Ie,x as Fe,e8 as Me,a2 as De,a3 as Ae,g as Be}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import"./index-1730252110824287.js";import{b as Ne,c as Oe,u as Re,j as je,r as Ve,k as Ye,l as $e,m as Ee,n as Je,o as He}from"./cardManagement-1730252110824.js";import{_ as qe}from"./BindDevice.vue_vue_type_script_setup_true_lang-1730252110824.js";import Le from"./Import-17302521108242.js";import{_ as ze}from"./Export.vue_vue_type_script_setup_true_lang-1730252110824.js";import{_ as Ke}from"./Save.vue_vue_type_script_setup_true_lang-17302521108245.js";import{_ as Pe}from"./index.vue_vue_type_script_setup_true_lang-17302521108245.js";import{u as Ue}from"./useParams-1730252110824.js";import{a as We,O as Xe}from"./data-17302521108245.js";import Ze from"./Sync-1730252110824.js";import"./UploadFile.vue_vue_type_script_setup_true_lang-1730252110824.js";import"./encodeQuery-1730252110824.js";const Y=D=>(ge("data-v-98cdad45"),D=D(),xe(),D),Ge=["src"],Qe={style:{"font-size":"16px","font-weight":"600"}},et=Y(()=>r("div",{class:"card-item-content-text"}," 平台对接 ",-1)),tt=Y(()=>r("div",{class:"card-item-content-text"}," 运营商状态 ",-1)),at=Y(()=>r("div",{class:"card-item-content-text"}," 类型 ",-1)),ot=Y(()=>r("div",{class:"card-item-content-text"}," 绑定设备 ",-1)),lt={class:"content-bottom"},nt={class:"progress-text"},it={class:"card-item-content-text"},st=pe({__name:"index",setup(D){me();const K=Ce(),v=p({}),$=p({}),i=p([]),E=p(!1),A=p(!1),J=p(!1),B=p(!1),H=p(),N=p({}),q=p(""),I=p(!1),L=p(!1),P=[{title:"卡号",dataIndex:"id",key:"id",width:200,ellipsis:!0,fixed:"left",search:{type:"string"}},{title:"ICCID",dataIndex:"iccId",key:"iccId",ellipsis:!0,width:200,search:{type:"string"}},{title:"绑定设备",dataIndex:"deviceId",key:"deviceId",ellipsis:!0,scopedSlots:!0,width:200,search:{type:"string",rename:"deviceName"}},{title:"平台对接",dataIndex:"platformConfigName",key:"platformConfigName",width:200,search:{rename:"platformConfigId",type:"select",options:async()=>new Promise(e=>{Oe({sorts:[{name:"createTime",order:"desc"}],terms:[{column:"state",value:"enabled"}]}).then(l=>{const f=l.result.map(_=>({label:_.name,value:_.id}));e(f)})})}},{title:"运营商",dataIndex:"operatorName",key:"operatorName",width:120,search:{type:"select",options:async()=>Xe}},{title:"类型",dataIndex:"cardType",key:"cardType",scopedSlots:!0,width:120,search:{type:"select",options:[{label:"年卡",value:"year"},{label:"季卡",value:"season"},{label:"月卡",value:"month"},{label:"其他",value:"other"}]}},{title:"总流量",key:"totalFlow",dataIndex:"totalFlow",width:120,scopedSlots:!0},{title:"使用流量",dataIndex:"usedFlow",width:120,scopedSlots:!0},{title:"剩余流量",dataIndex:"residualFlow",width:120,scopedSlots:!0},{title:"激活日期",dataIndex:"activationDate",key:"activationDate",scopedSlots:!0,width:200,search:{type:"date"}},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",scopedSlots:!0,width:200,search:{type:"date"}},{title:"平台状态",dataIndex:"cardStateType",key:"cardStateType",width:180,scopedSlots:!0,search:{type:"select",options:[{label:"未同步",value:"notReady"},{label:"同步失败",value:"error"},{label:"激活",value:"using"},{label:"未激活",value:"toBeActivated"},{label:"停机",value:"deactivate"},{label:"其它",value:"other"}]}},{title:"运营商状态",dataIndex:"cardState",key:"cardState",width:180,scopedSlots:!0},{title:"运营商状态",dataIndex:"operatorState",key:"operatorState",hideInTable:!0,search:{type:"select",options:[{label:"激活(正常)",value:"using"},{label:"测试激活",value:"testActivation"},{label:"拆机",value:"disassemble"},{label:"停用(已停用)",value:"deactivate"},{label:"运营商管理状态",value:"operatorManagement"},{label:"可激活(电信)",value:"beActivated"},{label:"待激活",value:"toBeActivated"},{label:"测试去激活",value:"testToActivation"},{label:"可测试",value:"testable"},{label:"库存(移动)",value:"inStock"},{label:"预销户",value:"preSeller"},{label:"单向停机",value:"oneWayShutdown"},{label:"预销号",value:"preSale"},{label:"过户",value:"transfer"},{label:"休眠",value:"dormant"},{label:"可激活(联通)",value:"activatable"},{label:"已失效",value:"expired"},{label:"已清除",value:"cleared"},{label:"已更换",value:"replaced"},{label:"库存（联通）",value:"stock"},{label:"开始",value:"start"}]}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],ee=ke().hasPermission,te=ee("iot-card/Platform:add"),ae=()=>{var e;(e=v.value)==null||e.reload(),B.value=!1},oe=Ue(),U=(e,l)=>{var _,b,F,w,S,O,R,j,V;if(!e)return[];const f=[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{A.value=!0,N.value=e,q.value="edit"}},{key:"bind",text:e.deviceId?"解绑设备":"绑定设备",tooltip:{title:e.deviceId?"解绑设备":"绑定设备"},icon:e.deviceId?"DisconnectOutlined":"LinkOutlined",popConfirm:e.deviceId?{title:"确认解绑设备？",okText:"确定",cancelText:"取消",onConfirm:()=>{const c=Re(e.id);return c.then(x=>{var h;x.status===200&&(m("操作成功"),(h=v.value)==null||h.reload())}),c}}:void 0,onClick:()=>{e.deviceId||(E.value=!0,H.value=e.id)}},{key:((_=e.cardStateType)==null?void 0:_.value)==="toBeActivated"?"active":"action",text:((b=e.cardStateType)==null?void 0:b.value)==="toBeActivated"?"激活":((F=e.cardStateType)==null?void 0:F.value)==="deactivate"?"复机":"停用",tooltip:{title:((w=e.cardStateType)==null?void 0:w.value)==="toBeActivated"?"激活":((S=e.cardStateType)==null?void 0:S.value)==="deactivate"?"复机":"停用"},icon:((O=e.cardStateType)==null?void 0:O.value)==="toBeActivated"?"CheckCircleOutlined":((R=e.cardStateType)==null?void 0:R.value)==="deactivate"?"PoweroffOutlined":"StopOutlined",popConfirm:{title:((j=e.cardStateType)==null?void 0:j.value)==="toBeActivated"?"确认激活？":((V=e.cardStateType)==null?void 0:V.value)==="deactivate"?"确认复机？":"确认停用?",okText:"确定",cancelText:"取消",onConfirm:()=>{var x,h;let c;return((x=e.cardStateType)==null?void 0:x.value)==="toBeActivated"?(c=je(e.id),c.then(t=>{var o;t.status===200&&(m("操作成功"),(o=v.value)==null||o.reload())})):((h=e.cardStateType)==null?void 0:h.value)==="deactivate"?(c=Ve(e.id),c.then(t=>{var o;t.status===200&&(m("操作成功"),(o=v.value)==null||o.reload())})):(c=Ye(e.id),c.then(t=>{var o;t.status===200&&(m("操作成功"),(o=v.value)==null||o.reload())})),c}}},{key:"delete",text:"删除",tooltip:{title:"删除"},popConfirm:{title:"确认删除?",okText:"确定",cancelText:"取消",onConfirm:()=>{const c=$e(e.id);return c.then(x=>{var h;if(x.status===200){m("操作成功");const t=i.value.findIndex(o=>o===e.id);t!==-1&&i.value.splice(t,1),(h=v.value)==null||h.reload()}else m("操作失败！","error")}),c}},icon:"DeleteOutlined"}];return l==="card"?f:[{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{K.jumpPage("iot-card/CardManagement/Detail",{id:e.id})}},...f]},le=e=>{$.value={terms:(e==null?void 0:e.terms)||[]}},ne=(e,l)=>{i.value=[...e]},ie=e=>{if(e!=null&&e.cardStateType)if(I.value)if(i.value.includes(e.id)){const l=i.value.findIndex(f=>f===e.id);i.value.splice(l,1)}else i.value=[...i.value,e.id];else K.jumpPage("iot-card/CardManagement/Detail",{id:e.id})},se=()=>{i.value=[]},W=()=>{A.value=!0,N.value={},q.value="add"},re=e=>{var l;A.value=!1,N.value={},e&&((l=v.value)==null||l.reload())},de=e=>{var l;E.value=!1,H.value="",e&&((l=v.value)==null||l.reload())},ce=[{key:"export",text:"批量导出",permission:"iot-card/CardManagement:export",icon:"ExportOutlined",onClick:()=>{J.value=!0}},{key:"import",text:"批量导入",permission:"iot-card/CardManagement:import",icon:"ImportOutlined",onClick:()=>{B.value=!0}},{key:"stop",text:"批量停用",permission:"iot-card/CardManagement:action",icon:"StopOutlined",selected:{popConfirm:{title:"确认停用吗？",onConfirm:()=>{if(i.value.length>=10&&i.value.length<=100){const e=Ee(i.value);return e.then(l=>{l.status===200&&m("操作成功")}),e}else m("仅支持同一个运营商下且最少10条数据,最多100条数据","warning")}}}},{key:"resumption",text:"批量复机",ghost:!0,type:"primary",permission:"iot-card/CardManagement:action",icon:"PoweroffOutlined",selected:{popConfirm:{title:"确认复机吗？",onConfirm:()=>{if(i.value.length>=10&&i.value.length<=100){const e=Je(i.value);return e.then(l=>{l.status===200&&m("操作成功")}),e}else m("仅支持同一个运营商下且最少10条数据,最多100条数据","warning")}}}},{key:"sync",text:"同步状态",ghost:!0,type:"primary",permission:"iot-card/CardManagement:sync",icon:"SwapOutlined",onClick:async()=>{L.value=!0}},{key:"delete",text:"批量删除",danger:!0,permission:"iot-card/CardManagement:delete",icon:"StopOutlined",selected:{popConfirm:{title:"确认删除吗？",onConfirm:()=>{if(!i.value.length){m("请选择数据","error");return}const e=He(i.value.map(l=>({id:l})));return e.then(l=>{var f;l.status===200&&(m("操作成功"),i.value=[],(f=v.value)==null||f.reload())}),e}}}}],ue=()=>{var e;L.value=!1,(e=v.value)==null||e.reload()};return ve(()=>{oe.params.value.type==="add"&&te&&W()}),(e,l)=>{const f=M("pro-search"),_=M("AIcon"),b=be,F=we,w=M("Ellipsis"),S=Te,O=Ie,R=Fe,j=Me,V=De,c=Ae,x=M("FullPage"),h=M("page-container");return y(),g(h,null,{default:a(()=>[n(f,{columns:P,target:"iot-card-management-search",onSearch:le}),n(x,null,{default:a(()=>[n(c,{scroll:{x:1366},ref_key:"cardManageRef",ref:v,columns:P,request:s(Ne),defaultParams:{sorts:[{name:"createTime",order:"desc"}]},rowSelection:s(I)?{selectedRowKeys:s(i),onChange:ne}:!1,params:s($),gridColumn:3},{headerTitle:a(()=>[n(F,null,{default:a(()=>[n(b,{onClick:W,hasPermission:"iot-card/CardManagement:add",type:"primary"},{default:a(()=>[n(_,{type:"PlusOutlined"}),k("新增 ")]),_:1}),n(Pe,{isCheck:s(I),"onUpdate:isCheck":l[0]||(l[0]=t=>fe(I)?I.value=t:null),actions:ce,onChange:se},null,8,["isCheck"])]),_:1})]),card:a(t=>{var o,C;return[n(V,ye({value:t,onClick:ie,actions:U(t,"card")},t,{active:s(i).includes(t.id),status:(o=t.cardStateType)==null?void 0:o.value,statusText:(C=t.cardStateType)==null?void 0:C.text,statusNames:{using:"processing",toBeActivated:"default",deactivate:"error"}}),{img:a(()=>[_e(e.$slots,"img",{},()=>[r("img",{src:s(Se)("/iot-card/iot-card-bg.png")},null,8,Ge)],!0)]),content:a(()=>[r("span",Qe,[n(w,{style:{width:"calc(100% - 100px)"}},{default:a(()=>[k(u(t.id),1)]),_:2},1024)]),n(O,{style:{"margin-top":"20px"}},{default:a(()=>[n(S,{span:6},{default:a(()=>[et,n(w,{style:{width:"calc(100% - 20px)"}},{default:a(()=>[r("div",null,u(t.platformConfigName),1)]),_:2},1024)]),_:2},1024),n(S,{span:6},{default:a(()=>{var d,X;return[tt,n(z,{status:(d=t.cardState)==null?void 0:d.value,text:(X=t.cardState)==null?void 0:X.text,statusNames:{using:"processing",toBeActivated:"default",deactivate:"error"}},null,8,["status","text"])]}),_:2},1024),n(S,{span:6},{default:a(()=>[at,r("div",null,u(t.cardType.text),1)]),_:2},1024),n(S,{span:6},{default:a(()=>[ot,n(w,null,{default:a(()=>[k(u(t.deviceName),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),n(R,{style:{margin:"12px 0"}}),r("div",lt,[r("div",null,[r("div",nt,[r("div",null,u(t.totalFlow?(t.usedFlow/t.totalFlow*100).toFixed(2):"0.00")+" % ",1),r("div",it," 总共 "+u(t.totalFlow)+" M ",1)]),n(j,{strokeColor:"#ADC6FF",showInfo:!1,percent:t.totalFlow?t.usedFlow/t.totalFlow*100:0},null,8,["percent"])])])]),actions:a(d=>[n(b,{disabled:d.disabled,popConfirm:d.popConfirm,tooltip:{...d.tooltip},onClick:d.onClick,hasPermission:"iot-card/CardManagement:"+d.key},{default:a(()=>[d.key==="delete"?(y(),g(_,{key:0,type:"DeleteOutlined"})):(y(),Z(G,{key:1},[n(_,{type:d.icon},null,8,["type"]),r("span",null,u(d==null?void 0:d.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["value","actions","active","status","statusText"])]}),deviceId:a(t=>[k(u(t.deviceName),1)]),totalFlow:a(t=>[r("div",null,u(t.totalFlow?t.totalFlow.toFixed(2)+" M":""),1)]),usedFlow:a(t=>[r("div",null,u(t.usedFlow?t.usedFlow.toFixed(2)+" M":""),1)]),residualFlow:a(t=>[r("div",null,u(t.residualFlow?t.residualFlow.toFixed(2)+" M":""),1)]),operatorName:a(t=>[k(u(s(We)[t.operatorName]),1)]),cardType:a(t=>[k(u(t.cardType.text),1)]),cardStateType:a(t=>{var o,C;return[n(z,{status:(o=t.cardStateType)==null?void 0:o.value,text:(C=t.cardStateType)==null?void 0:C.text,statusNames:{using:"processing",toBeActivated:"default",deactivate:"error"}},null,8,["status","text"])]}),cardState:a(t=>{var o,C,d;return[(o=t.cardState)!=null&&o.state?(y(),g(z,{key:0,status:(C=t.cardState)==null?void 0:C.state,text:(d=t.cardState)==null?void 0:d.text,statusNames:{using:"processing",toBeActivated:"default",deactivate:"error"}},null,8,["status","text"])):T("",!0)]}),activationDate:a(t=>[k(u(t.activationDate?s(Q)(t.activationDate).format("YYYY-MM-DD HH:mm:ss"):""),1)]),updateTime:a(t=>[k(u(t.updateTime?s(Q)(t.updateTime).format("YYYY-MM-DD HH:mm:ss"):""),1)]),action:a(t=>[n(F,{size:16},{default:a(()=>[(y(!0),Z(G,null,he(U(t,"table"),o=>(y(),g(b,{key:o.key,disabled:o.disabled,popConfirm:o.popConfirm,tooltip:{...o.tooltip},onClick:o.onClick,type:"link",style:{padding:"0px"},hasPermission:o.key==="view"?!0:"iot-card/CardManagement:"+o.key,danger:o.key==="delete"},{icon:a(()=>[n(_,{type:o.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission","danger"]))),128))]),_:2},1024)]),_:3},8,["request","rowSelection","params"])]),_:3}),s(B)?(y(),g(Le,{key:0,onClose:l[1]||(l[1]=t=>B.value=!1),onSave:ae})):T("",!0),s(J)?(y(),g(ze,{key:1,onClose:l[2]||(l[2]=t=>J.value=!1),data:s(i)},null,8,["data"])):T("",!0),s(E)?(y(),g(qe,{key:2,cardId:s(H),onChange:de},null,8,["cardId"])):T("",!0),s(A)?(y(),g(Ke,{key:3,type:s(q),data:s(N),onChange:re},null,8,["type","data"])):T("",!0),s(L)?(y(),g(Ze,{key:4,params:s($),onClose:ue},null,8,["params"])):T("",!0)]),_:3})}}});const Bt=Be(st,[["__scopeId","data-v-98cdad45"]]);export{Bt as default};
