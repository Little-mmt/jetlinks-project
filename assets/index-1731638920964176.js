import{aQ as de,fT as ve,fU as fe,fV as me,o as O,aJ as ye,aK as he,$ as ge,a9 as ke,v as we,d as Ie,F as Se,af as Ce,Z as Me,e as Pe,aL as je,aM as be,fW as De,z as Fe,g as Q,aI as Ue}from"./index-1731638920964.js";import"./index-1731638920964288.js";import He from"./tree-17316389209643.js";import{c as U}from"./channel-17316389209642.js";import"./index-1731638920964279.js";import{L as $e}from"./index-1731638920964289.js";import{M as Te}from"./mediaTool-1731638920964.js";import{d as Z,k as v,w as Be,s as Le,ab as $,U as g,Z as j,_ as k,f as t,X as s,E as S,u as l,G as Ve,V as T,Y as A,F as E,a1 as N,$ as xe,a4 as z,a0 as R}from"./vue-1731638920964.js";import"./index-1731638920964281.js";import"./cascade-1731638920964.js";const Je={class:"live-player-warp"},Oe={class:"live-player-content"},Ae={key:0,class:"player-screen-tool"},Ee={class:"screen-tool-save"},Ne={class:"player-body"},ze=["onClick"],Re=["onClick"],H="screen-save",Qe=Z({__name:"ScreenPlayer",props:{url:{},id:{},channelId:{},className:{},historyHandle:{type:Function},onMouseDown:{type:Function},onMouseUp:{type:Function},showScreen:{type:Boolean}},setup(B,{expose:b}){const r=B,f=v(1),a=v([]),u=v(0),p=v([]),d=v(!1),C=v(!1),M=v(),I=v({name:""}),m=v(null),{isFullscreen:y,enter:L,exit:We,toggle:q}=de(m),V=(n,e,o,c)=>{const i=[...a.value];i[c]={id:"",channelId:"",url:"",key:i[c].key,show:!0};const h={id:n,url:o,channelId:e,key:i[c].key,show:!0};a.value=[...i],setTimeout(()=>{i[c]=h,a.value=[...i]},1e3)},x=(n,e,o)=>{const c=[...a.value],i={id:n,url:o,channelId:e,key:c[u.value].key,show:!0};c[u.value].url===o?V(n,e,o,u.value):(c[u.value]=i,a.value=c),u.value===f.value-1?u.value=0:u.value+=1},G=n=>{if(r.historyHandle){const e=JSON.parse(n.content||"{}");f.value=e.screen;const o=[...a.value];a.value=o.map((c,i)=>{if(c.show=!1,i<e.screen){const{deviceId:h,channelId:F}=e.players[i];return{...c,id:h,channelId:h,url:h?r.historyHandle(h,F):"",show:!0}}return c})}},D=async()=>{const n=await ve(H);n.success&&(p.value=n.result)},K=n=>{const e=fe(H,n);return e.then(o=>{o.success&&(D(),d.value=!1)}),e},W=async()=>{M.value.validate().then(async()=>{const n={name:I.value.name,content:JSON.stringify({screen:f.value,players:a.value.map(o=>({deviceId:o.id,channelId:o.channelId}))})};C.value=!0;const e=await me(n,H);C.value=!1,e.success?(d.value=!1,D(),O("保存成功"),M.value.resetFields()):O("保存失败","error")}).catch(n=>{console.log(n)})},X=()=>{const n=[];for(let e=0;e<9;e++)n.push({id:"",channelId:"",url:"",key:"time_"+new Date().getTime()+e,show:e===0});a.value=n},Y=n=>{n.target.value?ee(n.target.value):q()},ee=n=>{a.value=a.value.map((e,o)=>({id:"",channelId:"",url:"",updateTime:0,key:e.key,show:o<n})),u.value=0,f.value=n},ne=(n,e,o)=>{n.stopPropagation(),e.url&&V(e.id,e.channelId,e.url,o)},oe=n=>{const{id:e,channelId:o}=a.value[u.value];e&&o&&r.onMouseDown&&r.onMouseDown(e,o,n)},te=n=>{const{id:e,channelId:o}=a.value[u.value];e&&o&&r.onMouseUp&&r.onMouseUp(e,o,n)};return Be(()=>r.url,n=>{n&&r.id&&x(r.id,r.channelId,n)}),Le(()=>{r.showScreen!==!1&&D(),X()}),b({replaceVideo:x}),(n,e)=>{const o=ye,c=he,i=$("AIcon"),h=ge,F=ke,se=we,ae=Ie,le=Se,ce=Ce,re=Me,J=Pe,ue=je,ie=be,_e=De,pe=Fe;return g(),j("div",Je,[k("div",Oe,[n.showScreen?(g(),j("div",Ae,[t(c,{value:l(f),"button-style":"solid",onChange:Y},{default:s(()=>[t(o,{value:1},{default:s(()=>[S("单屏")]),_:1}),t(o,{value:4},{default:s(()=>[S("四分屏")]),_:1}),t(o,{value:9},{default:s(()=>[S("九分屏")]),_:1}),t(o,{value:0},{default:s(()=>[S("全屏")]),_:1})]),_:1},8,["value"]),k("div",Ee,[t(J,null,{default:s(()=>[t(h,{title:"可保存分屏配置记录"},{default:s(()=>[t(i,{type:"QuestionCircleOutlined"})]),_:1}),t(pe,{visible:l(d),"onUpdate:visible":e[2]||(e[2]=_=>Ve(d)?d.value=_:null),trigger:"click",title:"分屏名称"},{content:s(()=>[t(le,{ref_key:"formRef",ref:M,model:l(I),layout:"vertical"},{default:s(()=>[t(se,{name:"name",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"}]},{default:s(()=>[t(F,{value:l(I).name,"onUpdate:value":e[0]||(e[0]=_=>l(I).name=_)},null,8,["value"])]),_:1}),t(ae,{type:"primary",onClick:W,loading:l(C),style:{width:"100%","margin-top":"16px"}},{default:s(()=>[S(" 保存 ")]),_:1},8,["loading"])]),_:1},8,["model"])]),default:s(()=>[t(_e,{type:"primary",onClick:e[1]||(e[1]=_=>d.value=!0)},{overlay:s(()=>[t(ie,null,{default:s(()=>[l(p).length?A("",!0):(g(),T(ce,{key:0,description:"暂无数据"})),(g(!0),j(E,null,N(l(p),(_,P)=>(g(),T(ue,{key:`his${P}`,onClick:w=>G(_)},{default:s(()=>[t(J,null,{default:s(()=>[k("span",null,xe(_.name),1),t(re,{type:"text",popConfirm:{title:"确认删除？",onConfirm:w=>{w==null||w.stopPropagation(),K(_.key)}}},{default:s(()=>[t(i,{type:"DeleteOutlined"})]),_:2},1032,["popConfirm"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),default:s(()=>[S(" 保存 ")]),_:1})]),_:1},8,["visible"])]),_:1})])])):A("",!0),k("div",Ne,[k("div",{ref_key:"fullscreenRef",ref:m,class:z(["player-screen",`screen-${l(f)}`])},[(g(!0),j(E,null,N(l(a),(_,P)=>(g(),j("div",{key:_.key,class:z(["player-screen-item",{active:n.showScreen&&l(u)===P&&!l(y),"full-screen":l(y)}]),style:R({display:_.show?"block":"none"}),onClick:w=>u.value=P},[k("div",{class:"media-btn-refresh refreshBtn",style:R({display:_.url?"block":"none"}),onClick:w=>ne(w,_,P)}," 刷新 ",12,Re),t($e,{live:!0,url:_.url,autoplay:""},null,8,["url"])],14,ze))),128))],2)])]),t(Te,{onOnMouseDown:oe,onOnMouseUp:te})])}}});const Ze=Q(Qe,[["__scopeId","data-v-d893fcf5"]]),qe={class:"split-screen"},Ge={class:"right-content"},Ke=Z({__name:"index",setup(B){const b=v(""),r=v(""),f=v(),a=(p,d)=>U.ptzStart(p,d,"mp4"),u=p=>{var d;r.value=p.cId,b.value=p.dId,(d=f.value)==null||d.replaceVideo(p.dId,p.cId,a(p.dId,p.cId))};return(p,d)=>{const C=Ue,M=$("FullPage"),I=$("page-container");return g(),T(I,null,{default:s(()=>[t(M,null,{default:s(()=>[t(C,{class:"splitScreen"},{default:s(()=>[k("div",qe,[t(He,{onOnSelect:u}),k("div",Ge,[t(Ze,{ref_key:"player",ref:f,id:l(b),channelId:l(r),onMouseUp:(m,y)=>l(U).ptzStop(m,y),onMouseDown:(m,y,L)=>l(U).ptzTool(m,y,L),historyHandle:(m,y)=>a(m,y),showScreen:""},null,8,["id","channelId","onMouseUp","onMouseDown","historyHandle"])])])]),_:1})]),_:1})]),_:1})}}});const rn=Q(Ke,[["__scopeId","data-v-ea041c13"]]);export{rn as default};
