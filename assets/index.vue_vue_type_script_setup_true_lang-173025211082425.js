import{h as $,ev as A,ew as E,o as Z,v as z,a0 as M,$ as Q,I as G,a1 as X,aD as H,a6 as K,Z as W,a9 as Y,F as ee,aa as ae}from"./index-1730252110824.js";import{q as te}from"./product-17302521108244.js";import le from"./SaveProduct-1730252110824.js";import{d as oe,k as _,r as se,w as ne,ab as h,U as y,Z as k,f as a,X as t,_ as x,u as o,E as I,F as O,a1 as de,V as re,$ as ie,G as ue}from"./vue-1730252110824.js";const me={style:{"margin-top":"10px"}},ve=oe({__name:"index",props:{data:{type:Object,default:void 0}},emits:["close","save"],setup(i,{emit:j}){const c=i,v=_([]),g=_(!1),u=_(!1),p=_(),s=se({productId:void 0,id:void 0,name:"",describe:"",photoUrl:$("/device-gateway.png")}),V=async(n,e)=>{var m;if(!((m=c==null?void 0:c.data)!=null&&m.id)&&e){const d=await A(e);return d.status===200&&d.result?Promise.reject("该ID已存在"):Promise.resolve()}else return Promise.resolve()};ne(()=>c.data,n=>{te({paging:!1,sorts:[{name:"createTime",order:"desc"}],terms:[{terms:[{termType:"eq",column:"state",value:1,type:"and"},{termType:"eq",column:"accessProvider",value:"official-edge-gateway"}]}]}).then(e=>{e.status===200&&(v.value=e.result)}),Object.assign(s,n)},{immediate:!0,deep:!0});const q=()=>{j("close"),p.value.resetFields()},B=()=>{u.value=!1},D=n=>{v.value.push(n)},F=()=>{p.value.validate().then(async n=>{g.value=!0;const e={...n};e.id||delete e.id,(await E(e).finally(()=>{g.value=!1})).status===200&&(Z("操作成功！"),j("save"),p.value.resetFields())}).catch(n=>{console.log("error",n)})};return(n,e)=>{var C;const m=h("JProUpload"),d=z,f=M,b=h("AIcon"),w=Q,P=G,U=X,J=H,S=K,T=W,L=Y,R=ee,N=ae;return y(),k(O,null,[a(N,{maskClosable:!1,width:"650px",visible:!0,title:(C=i.data)!=null&&C.id?"编辑":"新增",onOk:F,onCancel:q,confirmLoading:o(g)},{default:t(()=>[x("div",me,[a(R,{layout:"vertical",ref_key:"formRef",ref:p,model:o(s)},{default:t(()=>[a(U,{type:"flex"},{default:t(()=>[a(f,{flex:"180px"},{default:t(()=>[a(d,{name:"photoUrl"},{default:t(()=>[a(m,{accept:"image/jpeg,image/png",modelValue:o(s).photoUrl,"onUpdate:modelValue":e[0]||(e[0]=l=>o(s).photoUrl=l),size:4},null,8,["modelValue"])]),_:1})]),_:1}),a(f,{flex:"auto"},{default:t(()=>[a(d,{name:"id",rules:[{pattern:/^[a-zA-Z0-9_\-]+$/,message:"请输入英文或者数字或者-或者_"},{max:64,message:"最多输入64个字符"},{validator:V,trigger:"blur"}]},{label:t(()=>[x("span",null,[I(" ID "),a(w,{title:"若不填写，系统将自动生成唯一ID"},{default:t(()=>[a(b,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})])]),default:t(()=>{var l;return[a(P,{value:o(s).id,"onUpdate:value":e[1]||(e[1]=r=>o(s).id=r),placeholder:"请输入ID",disabled:!!((l=i.data)!=null&&l.id)},null,8,["value","disabled"])]}),_:1},8,["rules"]),a(d,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多输入64个字符"}]},{default:t(()=>[a(P,{value:o(s).name,"onUpdate:value":e[2]||(e[2]=l=>o(s).name=l),placeholder:"请输入名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),a(U,null,{default:t(()=>[a(f,{span:22},{default:t(()=>[a(d,{name:"productId",rules:[{required:!0,message:"请选择所属产品"}]},{label:t(()=>[x("span",null,[I("所属产品 "),a(w,{title:"只能选择“正常”状态的产品"},{default:t(()=>[a(b,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})])]),default:t(()=>{var l;return[a(S,{showSearch:"",value:o(s).productId,"onUpdate:value":e[3]||(e[3]=r=>o(s).productId=r),disabled:!!((l=i.data)!=null&&l.id),placeholder:"请选择所属产品"},{default:t(()=>[(y(!0),k(O,null,de(o(v),r=>(y(),re(J,{value:r.id,key:r.id,label:r.name},{default:t(()=>[I(ie(r.name),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value","disabled"])]}),_:1})]),_:1}),a(f,{span:2,style:{"margin-top":"30px"}},{default:t(()=>[a(T,{type:"link",disabled:i.data.id,onClick:e[4]||(e[4]=l=>u.value=!0),hasPermission:"device/Product:add"},{default:t(()=>[a(b,{type:"PlusOutlined"})]),_:1},8,["disabled"])]),_:1})]),_:1}),a(d,{label:"说明",name:"describe",rules:[{max:200,message:"最多输入200个字符"}]},{default:t(()=>[a(L,{value:o(s).describe,"onUpdate:value":e[5]||(e[5]=l=>o(s).describe=l),placeholder:"请输入说明",showCount:"",maxlength:200},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1},8,["title","confirmLoading"]),a(le,{visible:o(u),"onUpdate:visible":e[6]||(e[6]=l=>ue(u)?u.value=l:null),productId:o(s).productId,"onUpdate:productId":e[7]||(e[7]=l=>o(s).productId=l),channel:"official-edge-gateway",onClose:B,deviceType:"gateway",onSave:D},null,8,["visible","productId"])],64)}}});export{ve as _};
