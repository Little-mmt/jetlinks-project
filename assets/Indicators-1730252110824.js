import{eN as M,aS as N,eO as $,o as q,dv as O,dw as D,v as X,a0 as Y,a1 as Z,F as z,aa as G,g as H}from"./index-1730252110824.js";import"./index-1730252110824283.js";import{u as K}from"./instance-1730252110824.js";import{d as P,k as F,r as Q,w as W,ab as aa,U as b,V as R,X as o,f as n,u as x,Z as U,F as B,a1 as ea,E as la,$ as ta,Y as oa,J as na,af as sa,ag as ua,_ as ca}from"./vue-1730252110824.js";const ra=e=>(sa("data-v-4ef0901b"),e=e(),ua(),e),da=ra(()=>ca("div",{class:"center-icon"},"~",-1)),va=P({__name:"Indicators",props:{data:{type:Object,default:()=>{}}},emits:["close"],setup(e,{emit:I}){const d=e,T=F(!1),V=K(),h=F(),v=Q({metrics:[]}),E=()=>{I("close")};W(()=>d.data.id,p=>{p&&V.current.id&&M(V.current.id,d.data.id).then(l=>{var f,r,c;if(l.status===200)if(Array.isArray(l==null?void 0:l.result)&&(l!=null&&l.result.length)){const _=l==null?void 0:l.result.map(a=>{var s;const t=Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value:N(a==null?void 0:a.value)?[a.value]:(s=a==null?void 0:a.value)==null?void 0:s.split(",");return{...a,value:t}});v.metrics=_}else if(((f=d.data.valueType)==null?void 0:f.type)==="boolean"){const a=(r=d.data.expands)==null?void 0:r.metrics.map(t=>{const s=((t==null?void 0:t.value)||{}).map(w=>String(w))||{};return{...t,value:s}});v.metrics=a||[]}else v.metrics=(((c=d.data.expands)==null?void 0:c.metrics)||[]).map(a=>{var s;const t=Array.isArray(a==null?void 0:a.value)?a==null?void 0:a.value:N(a==null?void 0:a.value)?[a.value]:(s=a==null?void 0:a.value)==null?void 0:s.split(",");return{...a,value:t}})})},{immediate:!0,deep:!0});const J=()=>{h.value.validate().then(async p=>{var r;T.value=!0;const l=(((r=na(v))==null?void 0:r.metrics)||[]).map(c=>({...c,value:c.value.join(",")}));(await $(V.current.id||"",d.data.id||"",l).finally(()=>{T.value=!1})).status===200&&(q("操作成功！"),I("close"),h.value.resetFields())}).catch(p=>{console.log("error",p)})};return(p,l)=>{const f=O,r=aa("Ellipsis"),c=D,_=X,a=Y,t=Z,s=z,w=G;return b(),R(w,{maskClosable:!1,visible:!0,title:"编辑指标",onOk:J,onCancel:E,confirmLoading:x(T)},{default:o(()=>[n(f,{message:"场景联动页面可引用指标配置触发条件",type:"warning",showIcon:""}),n(s,{layout:"vertical",ref_key:"formRef",ref:h,model:x(v),style:{"margin-top":"20px"}},{default:o(()=>[(b(!0),U(B,null,ea(x(v).metrics,(u,S)=>(b(),R(t,{key:S,type:"flex",justify:"space-between",align:"bottom"},{default:o(()=>[n(a,{span:u.range?11:24},{default:o(()=>{var y,i;return[n(_,{rules:{required:!0,message:`请${["date","boolean"].includes((i=(y=e.data)==null?void 0:y.valueType)==null?void 0:i.type)?"选择":"输入"}指标值`},name:["metrics",S,"value",0]},{label:o(()=>[n(r,null,{default:o(()=>[la(ta((u==null?void 0:u.name)||"指标值"),1)]),_:2},1024)]),default:o(()=>{var g,m,j,k,C,A;return[n(c,{modelValue:u.value[0],"onUpdate:modelValue":L=>u.value[0]=L,itemType:(g=e.data.valueType)==null?void 0:g.type,options:((m=e.data.valueType)==null?void 0:m.type)==="boolean"?[{label:(j=e.data.valueType)==null?void 0:j.trueText,value:String((k=e.data.valueType)==null?void 0:k.trueValue)},{label:(C=e.data.valueType)==null?void 0:C.falseText,value:String((A=e.data.valueType)==null?void 0:A.falseValue)}]:void 0},null,8,["modelValue","onUpdate:modelValue","itemType","options"])]}),_:2},1032,["rules","name"])]}),_:2},1032,["span"]),u.range?(b(),U(B,{key:0},[n(a,null,{default:o(()=>[da]),_:1}),n(a,{span:11},{default:o(()=>{var y,i;return[n(_,{name:["metrics",S,"value",1],rules:{required:!0,message:`请${["date","boolean"].includes((i=(y=e.data)==null?void 0:y.valueType)==null?void 0:i.type)?"选择":"输入"}指标值`}},{default:o(()=>{var g;return[n(c,{modelValue:u.value[1],"onUpdate:modelValue":m=>u.value[1]=m,itemType:(g=e.data.valueType)==null?void 0:g.type},null,8,["modelValue","onUpdate:modelValue","itemType"])]}),_:2},1032,["name","rules"])]}),_:2},1024)],64)):oa("",!0)]),_:2},1024))),128))]),_:1},8,["model"])]),_:1},8,["confirmLoading"])}}});const ia=H(va,[["__scopeId","data-v-4ef0901b"]]);export{ia as default};
