import{o as v,a2 as R,a3 as q,y as B,aa as J}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{b as V}from"./scene-1731638920964.js";import{u as j}from"./useRequest-1731638920964.js";import{u as E}from"./useAlarmLevel-1731638920964.js";import{b as O,g as D}from"./configuration-1731638920964.js";import{k as f,ab as i,U as K,V as U,X as s,f as o,u as r,R as H,_ as d,E as X,$ as z,d as F}from"./vue-1731638920964.js";import"./config-1731638920964.js";const G=""+new URL("../images/alarm/alarm-config.png",import.meta.url).href,P=d("img",{src:G},null,-1),Q={style:{"margin-top":"36px",display:"flex",gap:"6px","line-height":"1"}},W={style:{flex:"1 1 0","min-width":"0"}},Y=F({name:"AlarmModal"}),Z=Object.assign(Y,{props:{id:{type:String,default:""},actionId:{type:String,default:void 0},branchId:{type:String,default:""},targetType:{type:String}},emits:["cancel","ok"],setup(a,{emit:m}){const c=a,u=f({}),n=f([]),{run:h,loading:_}=j(O,{immediate:!1,onSuccess(){m("ok"),v("操作成功！")}}),{levelMap:ee,levelList:b}=E(),p=[{title:"类型",dataIndex:"targetType",search:{type:"select",options:async()=>{const e=await D();return e.success?e.result.filter(t=>c.targetType==="device"||t.id==="other").map(t=>({label:t.name,value:t.id})):[]}}},{title:"配置名称",dataIndex:"name",key:"name",search:{type:"string"},width:220,ellipsis:!0},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"正常",value:"enabled"},{label:"禁用",value:"disabled"}]},width:90},{title:"等级",dataIndex:"level",key:"level",scopedSlots:!0,search:{type:"select",options:async()=>b.value},width:200}],S=e=>{u.value=e},x=e=>{const t=new Set(n.value);t.has(e.id)?t.delete(e.id):t.add(e.id),n.value=[...t.values()]},k=()=>{n.value=[]},I=()=>{m("cancel")},T=async()=>{n.value.length?h(n.value.map(e=>({alarmId:e,ruleId:c.id,branchIndex:c.actionId}))):v("请选择告警","warning")};return(e,t)=>{const w=i("pro-search"),C=i("LevelIcon"),$=i("Ellipsis"),L=R,A=q,M=B,N=J;return K(),U(N,{visible:"",title:"新增关联告警",width:1e3,keyboard:!1,mask:!1,maskClosable:!1,loading:r(_),onCancel:I,onOk:T},{default:s(()=>[o(w,{columns:p,type:"simple",onSearch:S,style:{padding:"0"}}),o(M,{maxHeight:500},{default:s(()=>[o(A,{model:"CARD",columns:p,request:r(V),bodyStyle:{padding:0},gridColumn:3,defaultParams:{sorts:[{name:"createTime",order:"desc"}],terms:[{terms:[{column:"id$rule-bind-alarm$not",value:`${a.id}:${a.actionId||a.branchId}`},{column:"branchIndex$rule-bind-alarm$not",value:`${a.id}:-1`,type:"and"},{column:a.targetType==="device"?"targetType$in":"targetType",value:a.targetType==="device"?[]:"other",type:"and"}]}]},rowSelection:{selectedRowKeys:r(n),onSelectNone:k},params:r(u)},{card:s(l=>{var g,y;return[o(L,{value:l,active:r(n).includes(l.id),status:(g=l.state)==null?void 0:g.value,statusText:(y=l.state)==null?void 0:y.text,statusNames:{enabled:"processing",disabled:"error"},scroll:{y:510},onClick:x},{img:s(()=>[H(e.$slots,"img",{},()=>[P])]),content:s(()=>[d("div",Q,[o(C,{level:l.level},null,8,["level"]),d("div",W,[o($,null,{default:s(()=>[X(z(l.name),1)]),_:2},1024)])])]),_:2},1032,["value","active","status","statusText"])]}),_:3},8,["request","defaultParams","rowSelection","params"])]),_:3})]),_:3},8,["loading"])}}}),ge=Z;export{ge as default};
