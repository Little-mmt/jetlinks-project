import{I as S,d as U}from"./index-1730252110824.js";import k from"./ValueItem-1730252110824.js";import b from"./BooleanSelect-1730252110824.js";import{a as c,E as A}from"./index-1730252110824294.js";import"./index-1730252110824295.js";import"./index-1730252110824293.js";import{i as C}from"./isNil-1730252110824.js";import{d as g,k as y,p as V,e as j,w as E,ab as N,U as B,Z as O,f as t,X as n,u as i,E as T}from"./vue-1730252110824.js";const J=g({name:"Metrics"}),$=g({...J,props:{value:{type:Array,default:()=>[]},type:{type:String,default:void 0},options:{type:Array,default:()=>[]}},emits:["update:value"],setup(v,{expose:x,emit:q}){const u=v,s=y([]),f=y();V("metricsType",u.type);const _=[{title:"指标标识",dataIndex:"id",width:120,type:"text",placement:"Left",form:{required:!0,rules:[{asyncValidator(o,a,...l){if(a){const p=l[2];return s.value.filter((d,e)=>e!==p.index).some(d=>d.value===a)?Promise.reject("该标识已存在"):Promise.resolve()}return Promise.reject("请输入标识")}},{max:64,message:"最多可输入64个字符"},{pattern:/^[a-zA-Z0-9_\-]+$/,message:"标识只能由数字、字母、下划线、中划线组成"}]}},{title:"指标名称",dataIndex:"name",type:"text",form:{required:!0,rules:[{asyncValidator(o,a){return a?Promise.resolve():Promise.reject("请输入指标名称")}},{max:64,message:"最多可输入64个字符"}]}},{title:"指标配置",dataIndex:"value",width:100,form:{rules:[{asyncValidator(o,a){return C(a)||Array.isArray(a)&&a.some(l=>!l)?Promise.reject("请配置指标"):Promise.resolve()}}]}},{title:"操作",dataIndex:"action",width:60}],h=j(()=>{if(u.type&&!["string","boolean","date"].includes(u.type)){const o=[..._];return o.splice(2,0,{title:"指标值",dataIndex:"range",width:120}),o}return _}),I=()=>{s.value.push({id:void 0,name:void 0,range:!1,value:void 0})},w=o=>{s.value.splice(o,1)},P=()=>new Promise((o,a)=>{f.value.validate().then(l=>{o(l)}).catch(l=>{a(!1)})});return E(()=>u.value,()=>{s.value=JSON.parse(JSON.stringify(u.value))||[]},{immediate:!0,deep:!0}),x({getData:P}),(o,a)=>{const l=S,p=N("AIcon"),d=U;return B(),O("div",null,[t(i(A),{ref_key:"tableRef",ref:f,dataSource:i(s),columns:i(h),height:200},{id:n(({record:e,index:r})=>[t(i(c),{name:[r,"id"]},{default:n(()=>[t(l,{value:e.id,"onUpdate:value":m=>e.id=m,placeholder:"请输入标识"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),name:n(({record:e,index:r})=>[t(i(c),{name:[r,"name"]},{default:n(()=>[t(l,{value:e.name,"onUpdate:value":m=>e.name=m,placeholder:"请输入名称"},null,8,["value","onUpdate:value"])]),_:2},1032,["name"])]),range:n(({record:e})=>[t(b,{value:e.range,"onUpdate:value":r=>e.range=r,onSelect:r=>e.value=r?[void 0,void 0]:void 0},null,8,["value","onUpdate:value","onSelect"])]),value:n(({record:e,index:r})=>[t(i(c),{name:[r,"value"]},{default:n(()=>[t(k,{value:e.value,"onUpdate:value":m=>e.value=m,range:e.range,options:v.options},null,8,["value","onUpdate:value","range","options"])]),_:2},1032,["name"])]),action:n(({index:e})=>[t(d,{type:"link",onClick:()=>w(e)},{default:n(()=>[t(p,{type:"DeleteOutlined"})]),_:2},1032,["onClick"])]),_:1},8,["dataSource","columns"]),t(d,{style:{width:"100%","margin-top":"16px"},onClick:I},{icon:n(()=>[t(p,{type:"PlusOutlined"})]),default:n(()=>[T(" 添加指标值 ")]),_:1})])}}});export{$ as _};
