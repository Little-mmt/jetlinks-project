import{d as te,ac as ne,k as f,ab as C,U as I,V as R,X as t,f as n,u,E as T,_ as y,$ as q,G as ae,Z as E,Y as F,F as le,a1 as se,af as oe,ag as ie}from"./vue-1731638920964.js";import{o as m,d as ce,Z as re,e as de,$ as ue,I as pe,z as me,ds as _e,a3 as ve,g as fe}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{c as b}from"./cascade-1731638920964.js";import{_ as he}from"./index.vue_vue_type_script_setup_true_lang-173163892096427.js";const J=k=>(oe("data-v-17cec14e"),k=k(),ie(),k),ye=J(()=>y("h3",null,"通道列表",-1)),ge={style:{display:"flex","align-items":"center"}},Ce={class:"header"},Ie=J(()=>y("span",null,"编辑国标ID",-1)),be={class:"simple-form"},ke={key:0,class:"error"},xe=te({__name:"index",setup(k){const $=ne(),j=[{title:"设备名称",dataIndex:"deviceName",key:"deviceName",ellipsis:!0,search:{type:"string"}},{title:"通道名称",dataIndex:"name",ellipsis:!0,key:"name",search:{type:"string",first:!0}},{title:"国标ID",dataIndex:"gbChannelId",key:"gbChannelId",scopedSlots:!0,width:200,headerCell:"gbChannelIdHeader",search:{type:"string"}},{title:"安装地址",dataIndex:"address",key:"address",ellipsis:!0,search:{type:"string"}},{title:"厂商",dataIndex:"manufacturer",key:"manufacturer",ellipsis:!0,search:{type:"string"}},{title:"在线状态",dataIndex:"status",key:"status",scopedSlots:!0,width:150,search:{type:"select",options:[{label:"已连接",value:"online"},{label:"未连接",value:"offline"}],handleValue:e=>e}},{title:"操作",key:"action",width:100,scopedSlots:!0}],B=f({}),U=e=>{var l,c,a,d,o,v,S,w,V,D;((c=(l=e.terms[0])==null?void 0:l.terms[0])==null?void 0:c.column)==="gbChannelId"?B.value={terms:[{column:"id$gb28181-cascade-channel",value:[{column:"gb_channel_id",termType:(d=(a=e.terms[0])==null?void 0:a.terms[0])==null?void 0:d.termType,value:(v=(o=e.terms[0])==null?void 0:o.terms[0])==null?void 0:v.value}]},{terms:[{column:"id$gb28181-cascade-channel",value:[{column:"gb_channel_id",termType:"isnull",value:"1"}]},{column:"channelId",termType:(w=(S=e.terms[0])==null?void 0:S.terms[0])==null?void 0:w.termType,value:(D=(V=e.terms[0])==null?void 0:V.terms[0])==null?void 0:D.value}],type:"or"}]}:B.value=e},g=f(),r=f([]),x=f(!1),_=new Map,M=(e,l)=>{const c=new Set(r.value);l?(c.add(e.id),_.set(e.id,e.channelId)):(c.delete(e.id),_.delete(e.id)),r.value=[...c.values()]},O=(e,l,c)=>{if(e)c.map(a=>{r.value.includes(a.id)||(r.value.push(a.id),_.set(a.id,a.channelId))});else{const a=c.map(o=>o.id),d=[];r.value.map(o=>{a.includes(o)?_.delete(o):d.push(o)}),r.value=d}},z=()=>{r.value=[],_.clear()},G=(e,l)=>e?[{key:"delete",text:"解绑",tooltip:{title:"解绑"},icon:"DisconnectOutlined",popConfirm:{title:"确认解绑?",onConfirm:()=>{const a=b.unbindChannel($.query.id,[e.channelId]);return a.then(d=>{var o;d.success?(m("操作成功！"),(o=g.value)==null||o.reload()):m("操作失败！","error")}),a}}}]:[],H=async()=>{var l;if(!r.value.length){m("请先选择需要解绑的通道列表","error");return}(await b.unbindChannel($.query.id,[..._.values()])).success?(m("操作成功！"),r.value=[],_.clear(),(l=g.value)==null||l.reload()):m("操作失败！","error")},p=f(""),A=f(!1),K=async e=>{var c,a;if(p.value||m("请输入国标ID","error"),!((c=h.value)!=null&&c.passed))return;A.value=!0;const l=await b.updateGbChannelId(e.id,{gbChannelId:p.value});A.value=!1,l.success?(m("操作成功！"),(a=g.value)==null||a.reload(),h.value=void 0,p.value=""):m("操作失败！","error")},h=f(),L=async e=>{const{result:l}=await b.validateField(e.cascadeId,[p.value]);h.value=l},Z=e=>{e.popVis=!1,h.value=void 0,p.value=""},P=()=>{x.value=!1},X=()=>{var e;x.value=!1,(e=g.value)==null||e.reload()};return(e,l)=>{const c=C("pro-search"),a=ce,d=re,o=de,v=C("AIcon"),S=ue,w=C("Ellipsis"),V=pe,D=me,Y=_e,Q=ve,W=C("FullPage"),ee=C("page-container");return I(),R(ee,null,{default:t(()=>[n(c,{columns:j,target:"media",onSearch:U}),n(W,null,{default:t(()=>[n(Q,{ref_key:"listRef",ref:g,model:"table",columns:j,request:s=>{var i;return u(b).queryBindChannel((i=u($))==null?void 0:i.query.id,s)},defaultParams:{sorts:[{name:"name",order:"desc"}]},params:u(B),rowSelection:{selectedRowKeys:u(r),onSelect:M,onSelectAll:O,onSelectNone:z}},{headerTitle:t(()=>[ye]),rightExtraRender:t(()=>[n(o,null,{default:t(()=>[n(a,{type:"primary",onClick:l[0]||(l[0]=s=>x.value=!0)},{default:t(()=>[T(" 绑定通道 ")]),_:1}),n(d,{type:"primary",popConfirm:{title:"确认解绑？",onConfirm:H}},{default:t(()=>[T("批量解绑")]),_:1},8,["popConfirm"])]),_:1})]),gbChannelIdHeader:t(s=>[n(S,{title:"国标级联有16位、20位两种格式。在当前页面修改不会修改视频设备-通道页面中的国标ID"},{default:t(()=>[n(o,null,{default:t(()=>[y("span",null,q(s),1),n(v,{type:"InfoCircleOutlined"})]),_:2},1024)]),_:2},1024)]),gbChannelId:t(s=>[y("div",ge,[n(w,{style:{width:"150px"}},{default:t(()=>[T(q(s.gbChannelId),1)]),_:2},1024),n(D,{visible:s.popVis,"onUpdate:visible":i=>s.popVis=i,trigger:"click"},{title:t(()=>[y("div",Ce,[Ie,n(v,{type:"CloseOutlined",onClick:i=>Z(s)},null,8,["onClick"])])]),content:t(()=>{var i;return[y("div",be,[n(V,{value:u(p),"onUpdate:value":l[1]||(l[1]=N=>ae(p)?p.value=N:null),onChange:N=>L(s),placeholder:"请输入国标ID"},null,8,["value","onChange"]),u(h)&&!((i=u(h))!=null&&i.passed)?(I(),E("div",ke," 该国标ID在同一设备下已存在 ")):F("",!0)]),n(a,{type:"primary",onClick:N=>K(s),loading:u(A),style:{width:"100%"}},{default:t(()=>[T(" 保存 ")]),_:2},1032,["onClick","loading"])]}),default:t(()=>[n(a,{type:"link",onClick:i=>s.popVis=!0},{default:t(()=>[n(v,{type:"EditOutlined"})]),_:2},1032,["onClick"])]),_:2},1032,["visible","onUpdate:visible"])])]),status:t(s=>[n(o,null,{default:t(()=>[n(Y,{status:s.status.value==="online"?"success":"error",text:s.status.text},null,8,["status","text"])]),_:2},1024)]),action:t(s=>[n(o,{size:16},{default:t(()=>[(I(!0),E(le,null,se(G(s,"table"),i=>(I(),R(d,{key:i.key,disabled:i.disabled,popConfirm:i.popConfirm,tooltip:{...i.tooltip},onClick:i.onClick,type:"link",style:{padding:"0 5px"}},{icon:t(()=>[n(v,{type:i.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick"]))),128))]),_:2},1024)]),_:1},8,["request","params","rowSelection"])]),_:1}),u(x)?(I(),R(he,{key:0,onSubmit:X,onCancel:P})):F("",!0)]),_:1})}}});const je=fe(xe,[["__scopeId","data-v-17cec14e"]]);export{je as default};
