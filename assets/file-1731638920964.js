import{ap as P,T as I,L as $,fn as z,dh as J,o as U,di as K,v as M,C as X,A as Y,d as R,F as Z,fo as q,fp as G,g as H}from"./index-1731638920964.js";import"./index-1731638920964280.js";import{d as j,r as Q,k as x,c as W,ab as ee,U as g,Z as y,f as s,X as c,_ as l,E as n,u as t,$ as E,Y as S,af as te,ag as oe}from"./vue-1731638920964.js";const B=u=>(te("data-v-526a2864"),u=u(),oe(),u),se={class:"file"},ae={class:"alert"},le={class:"dragger-box"},ne=B(()=>l("span",{style:{margin:"16px 0 8px 0"}},"点击或拖拽上传文件",-1)),ce=B(()=>l("span",null,"格式：.xlsx, .csv",-1)),ie={style:{"margin-bottom":"16px"}},re={key:0,class:"result"},de={key:0},pe={key:1},ue={style:{color:"#ff595e"}},_e={class:"file-download"},fe=j({name:"DeviceImportFile"}),ve=j({...fe,props:{product:{type:String,default:void 0}},setup(u){const k=u,i=Q({product:k.product,upload:[],file:{fileType:"xlsx",autoDeploy:!1}}),L=x(!1),h=W("flag"),w=x(0),b=x(0),C=x(""),_=x(!1),F=async o=>{const e=await z(k.product,o);if(e){const a=new Blob([e],{type:o}),d=URL.createObjectURL(a);J(d,"设备导入模板",o)}},N=o=>{const e=o.type==="text/csv",a=o.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";return!e&&!a&&U("请上传.xlsx或.csv格式文件","warning"),e||a},O=()=>{},A=()=>{window.open(C.value)},T=async o=>{var e;if(o){w.value=0,b.value=0;const a=!!((e=i==null?void 0:i.file)!=null&&e.autoDeploy)||!1;L.value=!0,h.value=!0;let d=0,f=0;const p=new q.EventSourcePolyfill(G(k.product,o,a));p.onmessage=v=>{const r=JSON.parse(v.data);if(r.success){const D=r.result.total;d+=D,w.value=d}else r.detailFile?C.value=r.detailFile:(f+=1,b.value=f);_.value=!1},p.onerror=v=>{v.status===403&&(C.value="暂无权限，请联系管理员"),h.value=!1,_.value=!1,p.close()},p.onopen=()=>{}}else U("请先上传文件","error")},V=async o=>{if(_.value=!0,o.file.status==="done"){const e=o.file.response||{result:""};await T((e==null?void 0:e.result)||"")}else _.value=!1};return(o,e)=>{const a=ee("AIcon"),d=K,f=M,p=X,v=Y,r=R,D=Z;return g(),y("div",se,[s(D,{layout:"vertical"},{default:c(()=>[s(f,null,{label:c(()=>[l("div",null,[n(" 文件上传 "),l("div",ae,[s(a,{style:{"margin-right":"5px"},type:"InfoCircleOutlined"}),n("导入系统已存在的设备数据，不会更改已存在设备的所属产品信息")])])]),default:c(()=>[s(d,{fileList:t(i).upload,"onUpdate:fileList":e[0]||(e[0]=m=>t(i).upload=m),name:"file",action:t(P),headers:{[t(I)]:t($).get(t(I))},maxCount:1,showUploadList:!1,onChange:V,accept:".xlsx,.csv","before-upload":N,disabled:t(_),onDrop:O},{default:c(()=>[l("div",le,[s(a,{class:"icon",type:"PlusCircleFilled"}),ne,ce])]),_:1},8,["fileList","action","headers","accept","disabled"])]),_:1}),l("div",ie,[s(p,{checked:t(i).file.autoDeploy,"onUpdate:checked":e[1]||(e[1]=m=>t(i).file.autoDeploy=m)},{default:c(()=>[n("导入并启用")]),_:1},8,["checked"])]),t(L)?(g(),y("div",re,[t(h)?(g(),y("div",de,[s(v,{size:"small",style:{"margin-right":"10px"}}),n("正在导入 ")])):(g(),y("div",pe,[s(a,{style:{color:"#08e21e","margin-right":"10px","font-size":"16px"},type:"CheckCircleOutlined"}),n("导入完成 ")])),l("div",null,"导入成功："+E(t(w))+" 个",1),l("div",null,[n(" 导入失败："),l("span",ue,E(t(b)),1),n(" 个"),t(C)&&!t(h)&&t(b)>0?(g(),y("a",{key:0,style:{"margin-left":"20px"},onClick:A},"下载")):S("",!0)])])):S("",!0),s(f,{label:"下载模板"},{default:c(()=>[l("div",_e,[s(r,{class:"btn",onClick:e[2]||(e[2]=m=>F("xlsx"))},{default:c(()=>[n("模板格式.xlsx")]),_:1}),s(r,{class:"btn",onClick:e[3]||(e[3]=m=>F("csv"))},{default:c(()=>[n("模板格式.csv")]),_:1})])]),_:1})]),_:1})])}}});const ye=H(ve,[["__scopeId","data-v-526a2864"]]);export{ye as default};
