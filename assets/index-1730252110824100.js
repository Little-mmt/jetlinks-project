import{d as M,ac as j,e as D,r as x,k as E,U as J,V as N,X as _,f as v,u as a,E as R}from"./vue-1730252110824.js";import{a4 as U,o as l,dG as I,d as $,F as q,el as z,g as G}from"./index-1730252110824.js";import"./index-1730252110824302.js";import{u as L}from"./instance-1730252110824.js";import{u as O}from"./metadata-1730252110824.js";import{u as P}from"./product-17302521108245.js";import{u as V,a as X}from"./metadata-17302521108242.js";import A from"./BaseForm-1730252110824.js";import{_ as H}from"./product-17302521108244.js";import"./encodeQuery-1730252110824.js";import"./index-1730252110824279.js";import"./ExpandsForm.vue_vue_type_script_setup_true_name_ExpandsForm_lang-1730252110824.js";import"./data-17302521108244.js";import"./index-1730252110824291.js";import"./index-1730252110824304.js";import"./index-1730252110824284.js";import"./index-1730252110824282.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./context-1730252110824.js";import"./lodash.default-1730252110824.js";import"./throttle-1730252110824.js";import"./min-1730252110824.js";import"./isNil-1730252110824.js";import"./isUndefined-1730252110824.js";import"./difference-1730252110824.js";import"./flattenDeep-1730252110824.js";import"./sortBy-1730252110824.js";import"./unionBy-1730252110824.js";import"./uniqBy-1730252110824.js";import"./toLower-1730252110824.js";import"./ValueTypeForm-1730252110824.js";const K=M({name:"Edit"}),Q=M({...K,props:{type:{type:String,required:!0,default:"product"},tabs:{type:String}},emits:["refresh"],setup(g,{emit:k}){const r=g,S=j(),n=L(),p=P(),t=O(),C={properties:"属性",events:"事件",functions:"功能",tags:"标签"},h=()=>{t.set("edit",!1),t.set("item",{})},B=D(()=>t.model.action==="add"?"新增":"编辑"),c=x({model:{}});t.model.action==="edit"&&(c.model=U(t.model.item));const w=E(),s=x({loading:!1,saveMetadata:u=>{var e;s.loading=!0,(e=w.value)==null||e.validateFields().then(async m=>{const f=t.model.type,i=r.type==="device"?n.detail:p.detail,F=JSON.parse((i==null?void 0:i.metadata)||"{}")[f]||[];if(m.id&&t.model.action==="add"&&F.some(o=>o.id===m.id)){l("标识已存在","error"),s.loading=!1;return}const T=V(f,[m],i,o=>{if(r.type==="device"){const d=n.detail;d.metadata=o,n.setCurrent(d)}else{const d=p.detail||{};d.metadata=o,p.setCurrent(d)}k("refresh")}),y=await X(r.type,T);if(y.success)if(window.onTabSaveSuccess)y&&(window.onTabSaveSuccess(y),setTimeout(()=>window.close(),300));else{const{id:o}=S.params;(r==null?void 0:r.type)==="device"?n.refresh(o):p.getDetail(o),u?(await H(o)).success?(s.resetMetadata(),l("操作成功！")):l("操作失败！","error"):l("操作成功！"),t.set("edit",!1),t.set("item",{})}else l("操作失败！","error");s.loading=!1}),s.loading=!1},resetMetadata:async()=>{const{id:u}=S.params,e=await I(u);e.status===200&&(n.detail=(e==null?void 0:e.result)||[])}});return(u,e)=>{const m=$,f=q,i=z;return J(),N(i,{"mask-closable":!1,width:"25vw",visible:"",title:`${a(B)}-${C[a(t).model.type]}`,onClose:h,"destroy-on-close":"","z-index":1e3,placement:"right"},{extra:_(()=>[v(m,{loading:a(s).loading,type:"primary",onClick:e[0]||(e[0]=()=>a(s).saveMetadata())},{default:_(()=>[R("保存")]),_:1},8,["loading"])]),default:_(()=>[v(f,{ref_key:"formRef",ref:w,model:a(c).model,layout:"vertical"},{default:_(()=>[v(A,{"model-type":a(t).model.type,type:g.type,value:a(c).model,"onUpdate:value":e[1]||(e[1]=b=>a(c).model=b)},null,8,["model-type","type","value"])]),_:1},8,["model"])]),_:1},8,["title"])}}});const je=G(Q,[["__scopeId","data-v-bf16b780"]]);export{je as default};
