import{X as ee,ab as te,h as ne,ax as oe,au as ie,fu as se,e1 as ae,o as I,fv as le,Z as re,e as ce,a0 as de,a1 as ue,d as pe,aL as me,aM as fe,aN as _e,a2 as ye,a3 as ve}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{q as ge}from"./product-17316389209644.js";import{q as ke}from"./category-1731638920964.js";import{r as he}from"./device-17316389209642.js";import{_ as Ce}from"./index.vue_vue_type_script_setup_true_lang-173163892096425.js";import{_ as xe}from"./index.vue_vue_type_script_setup_true_lang-173163892096423.js";import{d as be,k as T,ab as D,U as r,V as _,X as t,f as o,u as v,E as N,_ as m,$ as g,Z as O,F as j,a1 as R,Y as V}from"./vue-1731638920964.js";import"./SaveProduct-1731638920964.js";import"./device-17316389209643.js";import"./plugin-17316389209642.js";import"./const-1731638920964.js";const we=["src"],Ie={style:{"font-size":"16px","font-weight":"600"}},Te=m("div",{class:"card-item-content-text"}," 设备类型 ",-1),De=m("div",{class:"card-item-content-text"}," 产品名称 ",-1),He=be({__name:"index",setup(Ae){const B=ee(),Y={sorts:[{name:"createTime",order:"desc"}],terms:[{terms:[{column:"productId$product-info",value:"accessProvider is official-edge-gateway"}],type:"and"}]},S=new Map;S.set("online","success"),S.set("offline","error"),S.set("notActive","warning");const P=T({}),k=T({}),A=T(!1),h=T(!1),$=T({}),q=e=>Array.isArray(e)&&e.length?(e||[]).map(s=>({...s,id:`classifiedId is ${s.id}`,children:q(s.children)})):[],M=[{title:"ID",dataIndex:"id",key:"id",search:{type:"string",defaultTermType:"eq"},ellipsis:!0},{title:"设备名称",dataIndex:"name",key:"name",search:{type:"string",first:!0},ellipsis:!0},{title:"产品名称",dataIndex:"productName",key:"productName",search:{type:"select",rename:"productId",options:()=>new Promise(e=>{ge({paging:!1}).then(s=>{e(s.result.map(y=>({label:y.name,value:y.id})))})})},ellipsis:!0},{title:"注册时间",dataIndex:"registryTime",key:"registryTime",scopedSlots:!0,search:{type:"date"}},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"禁用",value:"notActive"},{label:"离线",value:"offline"},{label:"在线",value:"online"}]}},{key:"productId$product-info",dataIndex:"productId$product-info",title:"产品分类",hideInTable:!0,search:{type:"treeSelect",options:()=>new Promise(e=>{ke({paging:!1}).then(s=>{e(q(s.result))})})}},{dataIndex:"deviceType",title:"设备类型",valueType:"select",hideInTable:!0,search:{type:"select",options:[{label:"直连设备",value:"device"},{label:"网关子设备",value:"childrenDevice"},{label:"网关设备",value:"gateway"}]}},{title:"说明",dataIndex:"describe",key:"describe",ellipsis:!0,search:{type:"string"}},{title:"操作",key:"action",fixed:"right",width:250,scopedSlots:!0}],E=(e,s)=>{var C,x,b;if(!e)return[];const y=[{key:"view",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{J(e.id)}},{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{h.value=!0,$.value=e}},{key:"action",text:((C=e.state)==null?void 0:C.value)!=="notActive"?"禁用":"启用",tooltip:{title:((x=e.state)==null?void 0:x.value)!=="notActive"?"禁用":"启用"},icon:e.state.value!=="notActive"?"StopOutlined":"CheckCircleOutlined",popConfirm:{title:`确认${e.state.value!=="notActive"?"禁用":"启用"}?`,onConfirm:()=>{let l;return e.state.value!=="notActive"?l=se(e.id):l=ae(e.id),l.then(d=>{var u;d&&d.status===200?(I("操作成功！"),(u=k.value)==null||u.reload()):I("操作失败！","error")}),l}}}],c=[{key:"setting",text:"远程控制",tooltip:{title:"远程控制"},icon:"ControlOutlined",onClick:()=>{B.jumpPage("edge/Device/Remote",{id:e.id})}},{key:"password",text:"重置密码",tooltip:{title:"重置密码"},icon:"RedoOutlined",popConfirm:{title:"确认重置密码为Jetlinks123？",onConfirm:()=>{const l=he(e.id);return l.then(d=>{var u;d.status===200&&(I("操作成功！"),(u=k.value)==null||u.reload())}),l}}}],f={key:"delete",text:"删除",disabled:((b=e.state)==null?void 0:b.value)!=="notActive",tooltip:{title:e.state.value!=="notActive"?"已启用的设备不能删除":"删除"},popConfirm:{title:"确认删除?",onConfirm:()=>{const l=le(e.id);return l.then(d=>{var u;d.status===200?(I("操作成功！"),(u=k.value)==null||u.reload()):I("操作失败！","error")}),l}},icon:"DeleteOutlined"};return s==="card"?[...y.filter(d=>d.key!=="view"),{key:"others",text:"其他",icon:"EllipsisOutlined",children:[...c]},f]:[...y,...c,f]},F=e=>{P.value=e},J=e=>{B.jumpPage("device/Instance/Detail",{id:e})},L=()=>{h.value=!0,$.value={}},z=()=>{var e;h.value=!1,(e=k.value)==null||e.reload()},H=()=>{var e;A.value=!1,(e=k.value)==null||e.reload()};return(e,s)=>{const y=D("pro-search"),c=D("AIcon"),f=re,C=ce,x=D("Ellipsis"),b=de,l=ue,d=pe,u=me,U=fe,X=_e,Z=ye,G=ve,K=D("FullPage"),Q=D("page-container");return r(),_(Q,null,{default:t(()=>[o(y,{columns:M,target:"edge-device",onSearch:F}),o(K,null,{default:t(()=>[o(G,{ref_key:"edgeDeviceRef",ref:k,columns:M,request:v(te),defaultParams:Y,params:v(P),gridColumn:3},{headerTitle:t(()=>[o(C,null,{default:t(()=>[o(f,{type:"primary",onClick:L,hasPermission:"edge/Device:add"},{icon:t(()=>[o(c,{type:"PlusOutlined"})]),default:t(()=>[N(" 新增 ")]),_:1}),o(f,{onClick:s[0]||(s[0]=n=>A.value=!0),hasPermission:"edge/Device:import"},{icon:t(()=>[o(c,{type:"ImportOutlined"})]),default:t(()=>[N(" 导入 ")]),_:1})]),_:1})]),card:t(n=>{var a,w;return[o(Z,{value:n,actions:E(n,"card"),status:(a=n.state)==null?void 0:a.value,statusText:(w=n.state)==null?void 0:w.text,onClick:i=>J(n.id),statusNames:{online:"processing",offline:"error",notActive:"warning"}},{img:t(()=>[m("img",{width:80,height:80,src:(n==null?void 0:n.photoUrl)||v(ne)("/device-gateway.png")},null,8,we)]),content:t(()=>[o(x,{style:{width:"calc(100% - 100px)"}},{default:t(()=>[m("span",Ie,g(n.name),1)]),_:2},1024),o(l,{style:{"margin-top":"18px"}},{default:t(()=>[o(b,{span:12},{default:t(()=>{var i;return[Te,m("div",null,g((i=n.deviceType)==null?void 0:i.text),1)]}),_:2},1024),o(b,{span:12},{default:t(()=>[De,o(x,{style:{width:"100%"}},{default:t(()=>[N(g(n.productName),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),actions:t(i=>[i.key==="others"?(r(),_(X,{key:0,placement:"bottomRight"},{overlay:t(()=>[o(U,null,{default:t(()=>[(r(!0),O(j,null,R(i.children,(p,W)=>(r(),_(u,{key:W},{default:t(()=>[o(f,{disabled:p.disabled||n.state.value!=="online",popConfirm:p.popConfirm,tooltip:{...p.tooltip},onClick:p.onClick,hasPermission:"edge/Device:"+p.key,type:"link"},{default:t(()=>[o(c,{type:p.icon},null,8,["type"]),m("span",null,g(p==null?void 0:p.text),1)]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1024))),128))]),_:2},1024)]),default:t(()=>[o(d,null,{default:t(()=>[o(c,{type:i.icon},null,8,["type"]),m("span",null,g(i.text),1)]),_:2},1024)]),_:2},1024)):(r(),_(f,{key:1,disabled:i.disabled,popConfirm:i.popConfirm,tooltip:{...i.tooltip},onClick:i.onClick,hasPermission:"edge/Device:"+i.key},{default:t(()=>[i.key==="delete"?(r(),_(c,{key:0,type:"DeleteOutlined"})):(r(),O(j,{key:1},[o(c,{type:i.icon},null,8,["type"]),m("span",null,g(i==null?void 0:i.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"]))]),_:2},1032,["value","actions","status","statusText","onClick"])]}),state:t(n=>{var a,w;return[o(oe,{status:(a=n.state)==null?void 0:a.value,text:(w=n.state)==null?void 0:w.text,statusNames:{online:"processing",offline:"error",notActive:"warning"}},null,8,["status","text"])]}),registryTime:t(n=>[m("span",null,g(n.registryTime?v(ie)(n.registryTime).format("YYYY-MM-DD HH:mm:ss"):""),1)]),action:t(n=>[o(C,{size:16},{default:t(()=>[(r(!0),O(j,null,R(E(n,"table"),a=>(r(),_(f,{key:a.key,disabled:a.disabled,popConfirm:a.popConfirm,tooltip:{...a.tooltip},onClick:a.onClick,type:"link",style:{padding:"0 5px"},danger:a.key==="delete",hasPermission:a.key==="view"?!0:"edge/Device:"+a.key},{icon:t(()=>[o(c,{type:a.icon},null,8,["type"])]),_:2},1032,["disabled","popConfirm","tooltip","onClick","danger","hasPermission"]))),128))]),_:2},1024)]),_:1},8,["request","params"])]),_:1}),v(h)?(r(),_(Ce,{key:0,data:v($),onClose:s[1]||(s[1]=n=>h.value=!1),onSave:z},null,8,["data"])):V("",!0),v(A)?(r(),_(xe,{key:1,onSave:H,onClose:s[2]||(s[2]=n=>A.value=!1),type:"official-edge-gateway"})):V("",!0)]),_:1})}}});export{He as default};
