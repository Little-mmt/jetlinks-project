import{o as b,Z as _,ax as P,e as $,a3 as A}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import N from"./AddBindUserDialog-1730252110824.js";import{m as V,n as q}from"./department-17302521108242.js";import{d as R,k as f,r as T,w as U,ab as y,U as x,Z as D,f as a,X as i,u as o,E as v,_ as C,V as F,G as E,Y as O}from"./vue-1730252110824.js";const j=C("div",{style:{display:"inline-block",width:"12px",height:"1px"}},null,-1),z={class:"dialogs"},J=R({name:"user"}),te=R({...J,props:{parentId:{}},setup(I){const c=I,m="system/Department",h=[{title:"姓名",dataIndex:"name",key:"name",ellipsis:!0,fixed:"left",search:{type:"string"}},{title:"用户名",dataIndex:"username",key:"username",ellipsis:!0,fixed:"left",search:{type:"string"}},{title:"状态",dataIndex:"status",key:"status",ellipsis:!0,fixed:"left",search:{type:"select",options:[{label:"正常",value:1},{label:"禁用",value:0}]},scopedSlots:!0},{title:"操作",dataIndex:"action",key:"action",scopedSlots:!0,width:80}],g=f({}),S=t=>{g.value=t},w=f({}),e=T({_selectedRowKeys:[],requestFun:async t=>{if(c.parentId){const n={...t,sorts:[{name:"createTime",order:"desc"}],terms:[...t.terms,{terms:[{column:"id$in-dimension$org",value:c.parentId}],type:"and"}]},s=await V(n);return{code:s.status,result:s.result,status:s.status}}else return{code:200,result:{data:[],pageIndex:0,pageSize:0,total:0},status:200}},unBind:t=>{const n=t?[t.id]:e._selectedRowKeys;if(n.length<1)return b("请勾选需要解绑的数据","warning");const s=q(c.parentId,n);return s.then(()=>{b("操作成功"),e._selectedRowKeys=[],e.refresh()}),s},onSelectChange:(t,n)=>{const s=new Set(e._selectedRowKeys);console.log(t),n?s.add(t.id):s.delete(t.id),e._selectedRowKeys=[...s.values()]},refresh:()=>{w.value.reload()}}),p=f(!1),k=(t,n,s)=>{if(t)s.map(r=>{e._selectedRowKeys.includes(r.id)||e._selectedRowKeys.push(r.id)});else{const r=s.map(d=>d.id),u=[];e._selectedRowKeys.map(d=>{r.includes(d)||u.push(d)}),e._selectedRowKeys=u}};return U(()=>c.parentId,()=>{e.refresh(),e._selectedRowKeys=[]}),(t,n)=>{const s=y("pro-search"),r=y("AIcon"),u=P,d=$,B=A,K=y("FullPage");return x(),D("div",null,[a(s,{columns:h,target:"category-user",onSearch:S,style:{"margin-bottom":"0"}}),a(K,{extraHeight:24},{default:i(()=>[a(B,{ref_key:"tableRef",ref:w,columns:h,request:o(e).requestFun,params:o(g),scroll:{x:!0,y:610},rowSelection:{selectedRowKeys:o(e)._selectedRowKeys,onSelect:o(e).onSelectChange,onSelectAll:k,onSelectNone:()=>o(e)._selectedRowKeys=[]},model:"TABLE"},{headerTitle:i(()=>[a(_,{type:"primary",hasPermission:`${m}:bind-user`,onClick:n[0]||(n[0]=l=>p.value=!0),style:{"margin-right":"15px"},disabled:!t.parentId},{default:i(()=>[a(r,{type:"PlusOutlined"}),v("绑定用户 ")]),_:1},8,["hasPermission","disabled"]),j,a(_,{hasPermission:`${m}:bind`,popConfirm:{title:"确认解除绑定？",onConfirm:()=>o(e).unBind()}},{default:i(()=>[a(r,{type:"DisconnectOutlined"}),v("批量解绑 ")]),_:1},8,["hasPermission","popConfirm"])]),status:i(l=>[a(u,{status:l.status,text:l.status?"正常":"禁用",statusNames:{1:"success",0:"error"}},null,8,["status","text"])]),action:i(l=>[a(d,{size:16},{default:i(()=>[a(_,{type:"link",hasPermission:`${m}:bind`,popConfirm:{title:"确认解除绑定？",onConfirm:()=>o(e).unBind(l)}},{default:i(()=>[a(r,{type:"DisconnectOutlined"})]),_:2},1032,["hasPermission","popConfirm"])]),_:2},1024)]),_:1},8,["request","params","rowSelection"])]),_:1}),C("div",z,[o(p)?(x(),F(N,{key:0,visible:o(p),"onUpdate:visible":n[1]||(n[1]=l=>E(p)?p.value=l:null),"parent-id":c.parentId,onConfirm:o(e).refresh},null,8,["visible","parent-id","onConfirm"])):O("",!0)])])}}});export{te as _};
