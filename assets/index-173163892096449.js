import{g as $,o as M,Z as q,ah as A,ai as J,af as R,dE as Z}from"./index-1731638920964.js";import"./index-1731638920964299.js";import"./index-1731638920964300.js";import{f as j}from"./firmware-1731638920964.js";import{_ as z}from"./index.vue_vue_type_script_setup_true_name_TaskPage_lang-1731638920964.js";import O from"./index-173163892096447.js";import{k as v,o as U,ab as X,U as o,Z as T,f as n,X as s,V as g,E as r,Y as m,F as S,a1 as Y,u,_ as d,$ as c,a0 as G,d as H}from"./vue-1731638920964.js";import"./index-1731638920964279.js";import"./SelectDevices-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";const K={class:"task"},Q={class:"taskTitle"},W={class:"taskTitleLeft"},ee={class:"upgradeMode"},se={class:"title"},ae={class:"taskTitleRight"},te=H({name:"TaskDrawer"}),oe=Object.assign(te,{props:{firmwareId:{type:String,default:""},productId:{type:String,default:""},showPosition:{type:String},deviceId:{type:String}},emits:["closeDrawer"],setup(h,{emit:ne}){const a=h,_=v([]),I=v(!1),w=v(!1),C=v(),p=v(),k=async()=>{var f;const l={paging:!1,sorts:[{name:"createTime",order:"desc"}],terms:[{terms:[{column:"firmwareId",value:a.firmwareId}]}]},i=await j(l);i.status===200&&(a!=null&&a.deviceId?(console.log(a.deviceId),_.value=i.result.filter(t=>!(t!=null&&t.deviceId)||t.deviceId.includes(a.deviceId))):_.value=i.result,(f=p.value)!=null&&f.id&&(p.value=_.value.find(t=>t.id===p.value.id)))},E=()=>{I.value=!0,C.value={}},F=l=>{I.value=!1,C.value={},l&&(M("操作成功","success"),k())},P=l=>{w.value=!0,p.value=l},B=()=>{w.value=!1,k()};return U(()=>{k()}),(l,i)=>{const f=q,t=X("Ellipsis"),y=A,V=J,L=R,N=Z;return o(),T(S,null,[n(N,{visible:"",title:"升级任务",placement:"right",width:700,closable:!1,onClose:i[0]||(i[0]=e=>l.$emit("closeDrawer"))},{extra:s(()=>[a!=null&&a.showPosition?m("",!0):(o(),g(f,{key:0,type:"primary",hasPermission:"device/Firmware:add",onClick:E},{default:s(()=>[r(" + 新增任务 ")]),_:1}))]),default:s(()=>[(o(!0),T(S,null,Y(u(_),e=>{var b;return o(),T("div",K,[d("div",Q,[d("div",W,[d("div",ee,c((b=e==null?void 0:e.mode)==null?void 0:b.text),1),d("div",se,[n(t,null,{default:s(()=>[r(c(e==null?void 0:e.name),1)]),_:2},1024)])]),d("div",ae,[d("div",null,[r(" 完成比例"),d("span",{class:"progress",style:G({color:(e==null?void 0:e.progress)===100?"#52C41A":"#FF4D4F"})},c(((e==null?void 0:e.progress)||0)+"%"),5)]),n(f,{type:"link",hasPermission:"device/Firmware:view",onClick:()=>P(e)},{default:s(()=>[r("任务详情")]),_:2},1032,["onClick"])])]),n(V,{bordered:"",column:2},{default:s(()=>{var x;return[((x=e==null?void 0:e.mode)==null?void 0:x.value)==="push"?(o(),g(y,{key:0,label:"响应超时时间"},{default:s(()=>[r(c((e==null?void 0:e.responseTimeoutSeconds)+"s"),1)]),_:2},1024)):m("",!0),n(y,{label:"升级超时时间"},{default:s(()=>[r(c((e==null?void 0:e.timeoutSeconds)+"s"),1)]),_:2},1024),n(y,{label:"升级设备"},{default:s(()=>{var D;return[r(c((D=e==null?void 0:e.deviceId)!=null&&D.length?"选择设备":"所有设备"),1)]}),_:2},1024),n(y,{label:"说明"},{default:s(()=>[n(t,{style:{"max-width":"200px"}},{default:s(()=>[r(c((e==null?void 0:e.description)||"--"),1)]),_:2},1024)]),_:2},1024)]}),_:2},1024)])}),256)),u(_).length===0?(o(),g(L,{key:0})):m("",!0)]),_:1}),u(I)?(o(),g(z,{key:0,data:u(C),productId:h.productId,firmwareId:h.firmwareId,onChange:F},null,8,["data","productId","firmwareId"])):m("",!0),u(w)?(o(),g(O,{key:1,onCloseDetail:B,onRefresh:k,deviceId:a.deviceId,data:u(p)},null,8,["deviceId","data"])):m("",!0)],64)}}}),he=$(oe,[["__scopeId","data-v-c29f59c5"]]);export{he as default};
