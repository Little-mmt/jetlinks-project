import{d as B,k as D,r as E,w as J,U as h,V as S,X as c,f as M,u as r,Z as U,F as A,a1 as F,E as X,$ as x,v as I,_ as T,A as P}from"./vue-1731638920964.js";import{X as Z,gc as $,g9 as q,o as f,gd as z,ge as G,gf as H,gg as Q,gh as R,aD as W,a6 as Y,dg as w,aa as V}from"./index-1731638920964.js";import"./index-1731638920964281.js";const ee={style:{margin:"20px 0 0 0"}},ne=B({__name:"MenuDialog",props:{mode:{},visible:{type:Boolean},data:{}},emits:["update:visible","refresh"],setup(K,{emit:l}){var _,v;const d=K,O=Z(),u=D(!1),L=async()=>{var s,o,i;const e=JSON.parse(JSON.stringify(a.menuTree)),t=k(e,[...a.checkedMenu]);if(y(t),console.log(t),a.checkedSystem)if(t&&t.length!==0){u.value=!0;const p=await $("iot",a.id,t).finally(()=>u.value=!1);await q(a.id,{...d.data,integrationModes:(o=(s=d.data)==null?void 0:s.integrationModes)==null?void 0:o.map(n=>(n==null?void 0:n.value)||n),page:{...(i=d.data)==null?void 0:i.page,configuration:{checkedSystem:a.checkedSystem}}}),p.status===200&&(f("操作成功"),l("update:visible",!1),l("refresh"))}else f("请勾选配置菜单","warning");else f("请选择所属系统","warning")},b=()=>{d.mode==="add"&&O.jumpPage("system/Apply/Save",{},{id:a.id}),l("update:visible",!1)},a=E({id:(_=d.data)==null?void 0:_.id,checkedSystem:void 0,checkedMenu:[],expandedKeys:[],half:[],provider:(v=d.data)==null?void 0:v.provider,systemList:[],menuTree:[]});function m(e){(a.provider==="internal-standalone"?z(a.id,e):G(e)).then(s=>{a.menuTree=s.result,a.expandedKeys=s.result.map(o=>o==null?void 0:o.code)})}const g=(e,t)=>{e.forEach(s=>{s.children?g(s.children,t):t.push(s.code)})};function C(e){H({terms:[{column:"appId",value:e},{terms:[{value:'%show":true%',termType:"like",column:"options"}]}]}).then(s=>{if(s.status===200){let o=[];g(s.result,o),a.checkedMenu=o}})}function N(e){(a.provider==="internal-standalone"?Q(e,["iot"]):R(["iot"])).then(s=>{s.status===200&&(a.systemList=s.result.map(o=>({label:o,value:o})))})}const y=e=>{e==null||e.forEach(t=>{t.options={show:!0},t.children&&y(t.children)})};J(()=>d.data,e=>{var t;a.checkedSystem=(t=e==null?void 0:e.page.configuration)==null?void 0:t.checkedSystem,a.checkedSystem&&m(a.checkedSystem),e!=null&&e.id&&(N(e==null?void 0:e.id),C(e==null?void 0:e.id))},{deep:!0,immediate:!0});function j(e,t){a.checkedMenu=e,a.half=t.halfCheckedKeys}function k(e,t){return e?e.filter(s=>{if(t.includes(s.code))return!0;if(s.children)return s.children=k(s.children,t),s.children.length}):[]}return(e,t)=>{const s=W,o=Y,i=w,p=V;return h(),S(p,{visible:"",title:"集成菜单",width:"600px",onOk:L,onCancel:b,class:"edit-dialog-container",confirmLoading:r(u)},{default:c(()=>[M(o,{value:r(a).checkedSystem,"onUpdate:value":t[0]||(t[0]=n=>r(a).checkedSystem=n),onChange:t[1]||(t[1]=n=>n&&m(n)),style:{width:"200px"},placeholder:"请选择集成系统"},{default:c(()=>[(h(!0),U(A,null,F(r(a).systemList,n=>(h(),S(s,{value:n.value,key:n.value},{default:c(()=>[X(x(n.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),I(T("p",ee," 当前集成菜单 ",512),[[P,r(a).menuTree.length>0]]),M(i,{checkedKeys:r(a).checkedMenu,"onUpdate:checkedKeys":t[2]||(t[2]=n=>r(a).checkedMenu=n),expandedKeys:r(a).expandedKeys,"onUpdate:expandedKeys":t[3]||(t[3]=n=>r(a).expandedKeys=n),checkable:"","tree-data":r(a).menuTree,fieldNames:{key:"code",title:"name"},onCheck:j,height:300},{title:c(({name:n})=>[T("span",null,x(n),1)]),_:1},8,["checkedKeys","expandedKeys","tree-data"])]),_:1},8,["confirmLoading"])}}});export{ne as _};
