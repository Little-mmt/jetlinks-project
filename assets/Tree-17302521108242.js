import{cY as R,J as U,d as q,e as z,dg as G,af as X,A as Y,g as Z}from"./index-1730252110824.js";import"./index-1730252110824281.js";import{j as F,f as H}from"./collector-1730252110824.js";import{d as Q,k as r,w as S,o as W,ab as ee,U as C,Z as te,E as x,$ as D,f as d,X as u,u as _,V as J,G as ae,_ as K,a4 as ne,af as ce,ag as se}from"./vue-1730252110824.js";const le=s=>(ce("data-v-562970d4"),s=s(),se(),s),oe={class:"tree-content"},re=le(()=>K("div",{class:"tree-header"},[K("div",null,"数据源")],-1)),de=Q({__name:"Tree",props:{data:{type:Object,default:()=>{}},unSelectKeys:{type:String,default:""},tableData:{type:Array,default:[]}},emits:["change","addAll","cancelAll"],setup(s,{emit:i}){var N,w,B;const l=s,L=(N=l.data)==null?void 0:N.channelId,M=(B=(w=l.data)==null?void 0:w.configuration)==null?void 0:B.instanceNumber,p=r([]),I=r([]),k=r(!1),f=r(!1),o=r(),b=r(),$=async()=>{k.value=!0;const a=await F(L,M).finally(()=>k.value=!1);a.status===200&&(o.value=a.result.map(t=>({...t,key:t.id,title:t.name})))},j=a=>a.filter(e=>f&&!I.value.includes(e.id)||!f).map(e=>{var n;return e.children&&((n=e.children)!=null&&n.length)?{...e,children:j(e.children)}:e}),T=a=>{var v,y,m,g,h;const t={...a},e=[],n=e.length?e[e.length-1]:void 0;if(e.map(c=>c==null?void 0:c.id).includes(t.id))return;const A={features:{value:n?(v=n==null?void 0:n.features)==null?void 0:v.value:((t==null?void 0:t.features)||[]).includes("changedOnly"),check:!0},nodeId:`${t==null?void 0:t.objectId.type}:${t==null?void 0:t.objectId.instanceNumber}`||"",objectId:(t==null?void 0:t.objectId)||{},name:(t==null?void 0:t.name)||"",propertyId:(t==null?void 0:t.propertyId)||"",valueType:(t==null?void 0:t.valueType)||"",accessModes:{value:n?(y=n==null?void 0:n.accessModes)==null?void 0:y.value:(t==null?void 0:t.accessModes)||[],check:!0},type:t==null?void 0:t.type,configuration:{...t==null?void 0:t.configuration,interval:{value:n?(g=(m=n==null?void 0:n.configuration)==null?void 0:m.interval)==null?void 0:g.value:((h=t==null?void 0:t.configuration)==null?void 0:h.interval)||3e3,check:!0},nodeId:t==null?void 0:t.id}};i("change",A)},O=async()=>{var t;const a=await H({paging:!1,terms:[{terms:[{column:"collectorId",value:(t=l.data)==null?void 0:t.id}]}]});a.status===200&&(I.value=a.result.map(e=>e.pointKey))},E=()=>{var a;if(l.tableData.length)i("cancelAll");else{const t=(a=o.value)==null?void 0:a.map(e=>{var n;return{features:{value:((e==null?void 0:e.features)||[]).includes("changedOnly"),check:!0},nodeId:`${e==null?void 0:e.objectId.type}:${e==null?void 0:e.objectId.instanceNumber}`||"",objectId:(e==null?void 0:e.objectId)||{},name:(e==null?void 0:e.name)||"",propertyId:(e==null?void 0:e.propertyId)||"",valueType:(e==null?void 0:e.valueType)||"",accessModes:{value:(e==null?void 0:e.accessModes)||[],check:!0},type:e==null?void 0:e.type,configuration:{...e==null?void 0:e.configuration,interval:{value:((n=e==null?void 0:e.configuration)==null?void 0:n.interval)||3e3,check:!0},nodeId:e==null?void 0:e.id}}});i("addAll",t)}};return S(()=>f.value,a=>{o.value=a?j(b.value):b.value},{deep:!0}),S(()=>b.value,a=>{o.value=f.value?j(a):a},{deep:!0}),S(()=>l.unSelectKeys,a=>{p.value=p.value.filter(t=>t!==a)},{deep:!0}),W(()=>{O(),$()}),(a,t)=>{const e=R,n=U,A=ee("AIcon"),v=q,y=z,m=G,g=X,h=Y;return C(),te("div",oe,[re,x(" "+D(s.unSelectKeys)+" ",1),d(e,{block:"",onClick:E},{default:u(()=>[x(D(l.tableData.length?"全部撤销":"全部添加"),1)]),_:1}),d(h,{spinning:_(k)},{default:u(()=>[_(o)?(C(),J(m,{key:0,"tree-data":_(o),checkedKeys:_(p),"onUpdate:checkedKeys":t[0]||(t[0]=c=>ae(p)?p.value=c:null),selectable:!1,onCheck:T,height:600},{title:u(({data:c,name:V,key:P})=>[d(y,null,{default:u(()=>[d(n,null,{default:u(()=>[K("span",{class:ne([_(I).includes(P)?"tree-selected":"tree-title"])},D(V),3)]),_:2},1024),d(v,{type:"link",onClick:ue=>T(c)},{default:u(()=>[d(A,{type:"ArrowRightOutlined"})]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["tree-data","checkedKeys"])):(C(),J(g,{key:1,style:{"margin-top":"22%"}}))]),_:1},8,["spinning"])])}}});const ye=Z(de,[["__scopeId","data-v-562970d4"]]);export{ye as default};
