import{d as ke,ac as Se,k as x,r as X,o as qe,e as we,w as Y,ab as Le,U as d,Z as h,f as l,X as i,u as t,F as P,a1 as xe,V as C,_ as A,E as U,$ as K,v as Z,a0 as Pe,A as Q,Y as m,G as ee}from"./vue-1730252110824.js";import{h as k,X as Me,aF as ae,fF as Te,g8 as Re,g7 as je,a4 as ze,o as te,g9 as Ke,ga as Ne,I as $e,v as Ae,dc as Oe,a0 as De,a1 as Fe,aD as Ve,a6 as Be,w as Ee,Z as Je,fz as We,a9 as Ge,cU as He,K as Xe,M as Ye,F as Ze,d as Qe,g as ea}from"./index-1730252110824.js";import"./index-1730252110824276.js";import"./index-1730252110824291.js";import"./index-1730252110824296.js";import{a as aa,b as ta}from"./validate-1730252110824.js";import u from"./FormLabel-1730252110824.js";import O from"./RequestTable-1730252110824.js";import{_ as la}from"./MenuDialog.vue_vue_type_script_setup_true_lang-1730252110824.js";import ra from"./ThirdMenu-1730252110824.js";import{g as ia}from"./user-17302521108242.js";import oa from"./index-1730252110824229.js";import na from"./InputGroup-1730252110824.js";import{d as sa}from"./difference-1730252110824.js";import"./regular-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./ChooseIconDialog-1730252110824.js";import"./MUpload-1730252110824.js";const ua={class:"edit-form-container"},da={key:0},pa={key:1},fa={key:0},va={key:1},ma={key:2},ga={key:1},ca={key:0},ha={key:2},ya={key:3},Ca={key:4},ba={class:"dialog"},le="system/Department",re="system/Role",Ua=ke({__name:"EditForm",emits:["changeApplyType"],setup(_a,{emit:ie}){const oe={"internal-standalone":k("/apply/internal-standalone.png"),"internal-integrated":k("/apply/internal-integrated.png"),"wechat-webapp":k("/apply/wechat-webapp.png"),"dingtalk-ent-app":k("/apply/dingtalk-ent-app.png"),"third-party":k("/apply/third-party.png"),"wechat-miniapp":k("/apply/wechat-miniapp.png")},g=Se().query,N=Me(),_=x([]),$=x(!1),D={name:"",provider:"internal-standalone",logoUrl:k("/apply/internal-standalone.png"),integrationModes:[],description:"",page:{baseUrl:"",routeType:"hash",parameters:[],configuration:{}},apiClient:{baseUrl:"",headers:[],parameters:[],authConfig:{type:"oauth2",bearer:{token:""},basic:{username:"",password:""},oauth2:{authorizationUrl:"",tokenUrl:"",redirectUri:"",clientId:"",clientSecret:"",grantType:"",accessTokenProperty:"",tokenRequestType:void 0}}},apiServer:{appId:ae(16),secureKey:ae(),redirectUri:"",roleIdList:[],orgIdList:[],ipWhiteList:"",enableOAuth2:!1},sso:{configuration:{oauth2:{authorizationUrl:"",redirectUri:"",clientId:"",clientSecret:"",userInfoUrl:"",scope:"",userProperty:{userId:"",username:"",name:"",avatar:"",email:"",telephone:"",description:""},grantType:"",tokenUrl:"",accessTokenProperty:"",tokenRequestType:""},appId:"",appKey:"",appSecret:""},autoCreateUser:!1,usernamePrefix:"",roleIdList:[],orgIdList:[],defaultPasswd:""}},F=x(),a=X({data:{...D},roleIdList:[],orgIdList:[],errorNumInfo:{page:new Set,apiClient:new Set,apiServer:new Set,ssoClient:new Set},fileList:[],uploadLoading:!1}),ne=(s,e)=>new Promise((n,o)=>/[\u4e00-\u9fa5]/.test(e)?o("用户名不能包含中文"):n("")),S=x(!0),q=x(!0),se=()=>new Promise((s,e)=>{S.value?s(""):e("请输入完整的请求头")}),ue=()=>new Promise((s,e)=>{q.value?s(""):e("请输入完整的请求参数")}),de=async()=>{const s=await je();if(s.status===200){const e=s.result.map(n=>{var o;return{label:n.name,value:n.provider,integrationModes:(o=n.integrationModes)==null?void 0:o.map(f=>({label:f.text,value:f.value}))}});_.value=e}};qe(async()=>{await de(),V(),B(),g.id&&fe(g.id),g.provider&&(a.data.provider=g==null?void 0:g.provider,_.value=_.value.filter(s=>s.value===g.provider),console.log(_.value[0].value),a.data.logoUrl=oe[_.value[0].value])});const pe=(s,e)=>new Promise((n,o)=>{if(e){if(e.length>64)return o("最多可输入64个字符");if(e.length<8)return o("密码不能少于8位");if(aa(e))n("");else return o("密码必须包含大小写英文和数字")}else return n("")}),M=we(()=>{var s;return((s=_.value.find(e=>{var n;return((n=a.data)==null?void 0:n.provider)===e.value}))==null?void 0:s.integrationModes)||[]}),b=X({visible:!1,current:{}});Y(()=>a.data.provider,s=>{a.data.id||(a.data.page.baseUrl="",a.data.apiClient.baseUrl="",a.data.page.parameters=[],a.data.apiClient.parameters=[],a.data.apiClient.authConfig.oauth2.authorizationUrl="",a.data.sso.configuration.oauth2.authorizationUrl="",a.data.apiClient.authConfig.oauth2.clientId="",a.data.sso.configuration.oauth2.clientId="",a.data.apiClient.authConfig.oauth2.clientSecret="",a.data.sso.configuration.oauth2.clientSecret="",a.data.apiClient.headers=[],a.data.apiServer.roleIdList=[],a.data.apiServer.orgIdList=[],a.data.description="",a.data.apiServer.redirectUri="",a.data.sso.configuration.appSecret=""),ie("changeApplyType",s),!g.id&&(["wechat-webapp","dingtalk-ent-app","wechat-miniapp"].includes(s)?a.data.integrationModes=["ssoClient"]:a.data.integrationModes=[])},{immediate:!0}),Y(()=>a.data.integrationModes,(s,e)=>{e.forEach(n=>{s.includes(n)||a.errorNumInfo[n].clear()})});function fe(s){Te(s).then(e=>{var n,o,f,y;e.result.apiClient&&(e.result.apiClient.headers=(n=e.result.apiClient.headers)==null?void 0:n.map(c=>({...c,label:c.key})),e.result.apiClient.parameters=(o=e.result.apiClient.parameters)==null?void 0:o.map(c=>({...c,label:c.key}))),e.result.page&&(e.result.page.parameters=(f=e.result.page.parameters)==null?void 0:f.map(c=>({...c,label:c.key}))),a.data={...D,...e.result,integrationModes:(y=e.result.integrationModes)==null?void 0:y.map(c=>c.value)},a.data.apiServer&&(a.data.apiServer.appId=s),g.id&&(_.value=_.value.filter(c=>{var p;return c.value===((p=a.data)==null?void 0:p.provider)}))})}function V(){ia().then(s=>{if(s.status===200){const e=s.result;a.roleIdList=e==null?void 0:e.map(n=>({label:n.name,value:n.id}))}})}function B(){Re({paging:!1}).then(s=>{s.status===200&&(a.orgIdList=s.result)})}function T(s,e){const n=window.open(`${origin}/#/system/${e}?save=true`);n.onTabSaveSuccess=o=>{e==="Role"?V():B(),s.push(o)}}function ve(){var s;(s=F.value)==null||s.validate().then(()=>{var f,y,c;const e=ze(a.data);if(sa(["page","apiClient","apiServer","ssoClient"],e.integrationModes).forEach(p=>{p==="ssoClient"&&delete e.sso,delete e[p]}),E(e),e.provider==="internal-standalone"&&e.integrationModes.includes("page")&&delete e.page.parameters,e.provider==="internal-standalone"&&(e.integrationModes.includes("ssoClient")&&e.integrationModes.length===1||e.integrationModes.includes("ssoClient")&&e.integrationModes.includes("apiServer")&&e.integrationModes.length===2))return te("配置单点登录需同时配置API客户端","warning");["internal-standalone","third-party"].includes(e.provider)&&(e.integrationModes.includes("apiClient")&&(e.id=e.apiClient.authConfig.oauth2.clientId),e.integrationModes.includes("apiServer")&&!e.integrationModes.includes("apiClient")&&(e.id=e.apiServer.appId)),e.integrationModes.includes("apiClient")&&(e.apiClient.headers=(f=e.apiClient.headers)==null?void 0:f.map(p=>({...p,key:p.label})),e.apiClient.parameters=(y=e.apiClient.parameters)==null?void 0:y.map(p=>({...p,key:p.label}))),e.integrationModes.includes("page")&&(e.page.parameters=(c=e.page.parameters)==null?void 0:c.map(p=>({...p,key:p.label}))),$.value=!0,(g.id?Ke(g.id,e):Ne(e)).then(p=>{p.status===200&&(e.integrationModes.includes("page")?(b.current={...e,id:g.id||p.result.id},b.visible=!0):(te("保存成功"),N.jumpPage("system/Apply")))}).finally(()=>{$.value=!1})})}function me(s,e){if(typeof s!="object")return;const n=["page","apiClient","apiServer","ssoClient"],o=s[0]==="sso"?"ssoClient":s[0];if(n.includes(o+"")){const f=s.slice(1).join(),y=a.errorNumInfo[o];e?y.has(f)&&y.delete(f):y.has(f)||y.add(f)}}function E(s){if(typeof s=="object"){for(const e in s)if(Object.prototype.hasOwnProperty.call(s,e)){const n=s[e];n===""?delete s[e]:typeof n=="object"&&E(s[e])}}}const ge=(s,e)=>{if(e){const n=e==null?void 0:e.split(/[\n,]/g).filter(f=>f&&f.trim()),o=n==null?void 0:n.filter(f=>!ta(f.replace(/\s*/g,"")));return new Promise((f,y)=>{o!=null&&o.length?y(`[${o}]不是正确的IP地址`):f("")})}else return Promise.resolve()},ce=(s,e)=>e?e==="http://"||e==="https://"?Promise.reject("请输入接入地址"):Promise.resolve():Promise.reject("请输入接入地址");return(s,e)=>{const n=$e,o=Ae,f=Oe,y=De,c=Fe,p=Ve,I=Be,he=Ee,R=Le("AIcon"),j=Je,J=We,W=Ge,ye=He,Ce=Xe,be=Ye,Ue=Ze,_e=Qe;return d(),h("div",ua,[l(Ue,{ref_key:"formRef",ref:F,model:t(a).data,layout:"vertical",class:"form",onValidate:me},{default:i(()=>[l(o,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"}]},{default:i(()=>[l(n,{value:t(a).data.name,"onUpdate:value":e[0]||(e[0]=v=>t(a).data.name=v),placeholder:"请输入名称"},null,8,["value"])]),_:1}),l(o,{label:"应用",name:"provider",rules:[{required:!0,message:"请选择应用"}]},{default:i(()=>{var v;return[l(oa,{options:t(_),photoUrl:t(a).data.logoUrl,"onUpdate:photoUrl":e[1]||(e[1]=w=>t(a).data.logoUrl=w),value:t(a).data.provider,"onUpdate:value":e[2]||(e[2]=w=>t(a).data.provider=w),disabled:!!t(g).id||!!((v=t(g))!=null&&v.provider)},null,8,["options","photoUrl","value","disabled"])]}),_:1}),l(c,null,{default:i(()=>[l(y,{span:t(M).length>=3?24:6*t(M).length},{default:i(()=>[l(o,{label:"接入方式",name:"integrationModes",rules:[{required:!0,message:"请选择接入方式"}]},{default:i(()=>[l(f,{value:t(a).data.integrationModes,"onUpdate:value":e[3]||(e[3]=v=>t(a).data.integrationModes=v),options:t(M),multiple:!0},null,8,["value","options"])]),_:1})]),_:1},8,["span"])]),_:1}),l(be,{style:{"margin-bottom":"20px"}},{default:i(()=>[(d(!0),h(P,null,xe(t(a).data.integrationModes,(v,w)=>(d(),C(Ce,{key:v+w,forceRender:!0},{header:i(()=>{var L,r,z,G,H;return[A("span",null,[U(K((L=t(M).find(Ie=>Ie.value===v))==null?void 0:L.label)+" ",1),Z(A("span",{class:"error-info",style:Pe(t(a).errorNumInfo.ssoClient.size>9&&((z=(r=t(a).errorNumInfo)==null?void 0:r.ssoClient)!=null&&z.size)?{padding:"0 8px"}:{})},K((G=t(a).errorNumInfo[v])==null?void 0:G.size),5),[[Q,(H=t(a).errorNumInfo[v])==null?void 0:H.size]])])]}),default:i(()=>{var L;return[v==="page"?(d(),h(P,{key:0},[l(o,{name:["page","baseUrl"],class:"resetLabel",rules:[{required:!0,message:"请输入接入地址"},{validator:ce,trigger:"change"}]},{label:i(()=>[l(u,{text:"接入地址",required:"",tooltip:"填写访问其它平台的地址"})]),default:i(()=>[l(na,{value:t(a).data.page.baseUrl,"onUpdate:value":e[4]||(e[4]=r=>t(a).data.page.baseUrl=r),style:{width:"100%"}},null,8,["value"])]),_:1},8,["rules"]),l(o,{label:"路由方式",name:["page","routeType"],rules:[{required:!0,message:"请选择路由方式"}]},{default:i(()=>[l(I,{value:t(a).data.page.routeType,"onUpdate:value":e[5]||(e[5]=r=>t(a).data.page.routeType=r)},{default:i(()=>[l(p,{value:"hash"},{default:i(()=>[U("hash")]),_:1}),l(p,{value:"history"},{default:i(()=>[U("history")]),_:1})]),_:1},8,["value"])]),_:1}),t(a).data.provider==="third-party"?(d(),C(o,{key:0},{label:i(()=>[l(u,{text:"参数",tooltip:"自定义参数,格式${name}"})]),default:i(()=>[l(O,{value:t(a).data.page.parameters,"onUpdate:value":e[6]||(e[6]=r=>t(a).data.page.parameters=r),"value-type":"input"},null,8,["value"])]),_:1})):m("",!0)],64)):m("",!0),v==="apiClient"?(d(),h(P,{key:1},[l(o,{class:"resetLabel",name:["apiClient","baseUrl"],rules:[{required:!0,message:"请输入接口地址"}]},{label:i(()=>[l(u,{text:"接口地址",required:"",tooltip:"访问Api服务的地址"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.baseUrl,"onUpdate:value":e[7]||(e[7]=r=>t(a).data.apiClient.baseUrl=r),placeholder:"请输入接口地址"},null,8,["value"])]),_:1}),t(a).data.provider==="internal-standalone"?(d(),h("div",da,[l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","authorizationUrl"],rules:[{required:!0,message:"请输入授权地址"}]},{label:i(()=>[l(u,{text:"授权地址",required:"",tooltip:"认证授权地址"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.authorizationUrl,"onUpdate:value":e[8]||(e[8]=r=>t(a).data.apiClient.authConfig.oauth2.authorizationUrl=r),placeholder:"请输入授权地址"},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","tokenUrl"],rules:[{required:!0,message:"请输入token地址"}]},{label:i(()=>[l(u,{text:"token地址",required:"",tooltip:"设置token令牌的地址"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.tokenUrl,"onUpdate:value":e[9]||(e[9]=r=>t(a).data.apiClient.authConfig.oauth2.tokenUrl=r),placeholder:"请输入token地址"},null,8,["value"])]),_:1}),l(o,null,{label:i(()=>[l(u,{text:"回调地址",tooltip:"授权完成后跳转到具体页面的回调地址"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.redirectUri,"onUpdate:value":e[10]||(e[10]=r=>t(a).data.apiClient.authConfig.oauth2.redirectUri=r),placeholder:"请输入回调地址"},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","clientId"],rules:[{required:!0,message:"请输入appId"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"appId",required:"",tooltip:"第三方应用唯一标识"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.clientId,"onUpdate:value":e[11]||(e[11]=r=>t(a).data.apiClient.authConfig.oauth2.clientId=r),placeholder:"请输入appId",disabled:!!t(a).data.id&&!!t(a).data.apiClient.authConfig.oauth2.clientId},null,8,["value","disabled"])]),_:1}),l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","clientSecret"],rules:[{required:!0,message:"请输入appKey"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"appKey",required:"",tooltip:"第三方应用唯一标识的密钥"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.clientSecret,"onUpdate:value":e[12]||(e[12]=r=>t(a).data.apiClient.authConfig.oauth2.clientSecret=r),placeholder:"请输入appKey"},null,8,["value"])]),_:1})])):t(a).data.provider==="third-party"?(d(),h("div",pa,[l(o,{label:"认证方式",name:["apiClient","authConfig","type"],rules:[{required:!0}]},{default:i(()=>[l(I,{value:t(a).data.apiClient.authConfig.type,"onUpdate:value":e[13]||(e[13]=r=>t(a).data.apiClient.authConfig.type=r)},{default:i(()=>[l(p,{value:"oauth2"},{default:i(()=>[U(" OAuth2 ")]),_:1}),l(p,{value:"basic"},{default:i(()=>[U(" 基本认证 ")]),_:1}),l(p,{value:"bearer"},{default:i(()=>[U(" bearer认证 ")]),_:1})]),_:1},8,["value"])]),_:1}),t(a).data.apiClient.authConfig.type==="oauth2"?(d(),h("div",fa,[l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","authorizationUrl"],rules:[{required:!0,message:"请输入授权地址"}]},{label:i(()=>[l(u,{text:"授权地址",required:"",tooltip:"认证授权地址"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.authorizationUrl,"onUpdate:value":e[14]||(e[14]=r=>t(a).data.apiClient.authConfig.oauth2.authorizationUrl=r),placeholder:"请输入授权地址"},null,8,["value"])]),_:1}),l(o,{label:"请求方式",name:["apiClient","authConfig","oauth2","tokenRequestType"],rules:[{required:!0,message:"请选择请求方式"}]},{default:i(()=>[l(I,{value:t(a).data.apiClient.authConfig.oauth2.tokenRequestType,"onUpdate:value":e[15]||(e[15]=r=>t(a).data.apiClient.authConfig.oauth2.tokenRequestType=r),placeholder:"请选择请求方式"},{default:i(()=>[l(p,{value:"POST_BODY"},{default:i(()=>[U(" 请求体 ")]),_:1}),l(p,{value:"POST_URI"},{default:i(()=>[U(" 请求头 ")]),_:1})]),_:1},8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","clientId"],rules:[{required:!0,message:"请输入client_id"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"client_id",required:"",tooltip:"应用唯一标识"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.clientId,"onUpdate:value":e[16]||(e[16]=r=>t(a).data.apiClient.authConfig.oauth2.clientId=r),placeholder:"请输入client_id"},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["apiClient","authConfig","oauth2","clientSecret"],rules:[{required:!0,message:"请输入client_secret"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"client_secret",required:"",tooltip:"应用唯一标识的秘钥"})]),default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.oauth2.clientSecret,"onUpdate:value":e[17]||(e[17]=r=>t(a).data.apiClient.authConfig.oauth2.clientSecret=r),placeholder:"请输入client_secret"},null,8,["value"])]),_:1})])):t(a).data.apiClient.authConfig.type==="basic"?(d(),h("div",va,[l(o,{label:"用户名",name:["apiClient","authConfig","basic","username"],rules:[{required:!0,message:"请输入用户名"},{max:64,message:"最多可输入64个字符"}]},{default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.basic.username,"onUpdate:value":e[18]||(e[18]=r=>t(a).data.apiClient.authConfig.basic.username=r),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),l(o,{label:"密码",name:["apiClient","authConfig","basic","password"],rules:[{required:!0,message:"请输入密码"},{max:64,message:"最多可输入64个字符"}]},{default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.basic.password,"onUpdate:value":e[19]||(e[19]=r=>t(a).data.apiClient.authConfig.basic.password=r),placeholder:"请输入密码"},null,8,["value"])]),_:1})])):t(a).data.apiClient.authConfig.type==="bearer"?(d(),C(o,{key:2,label:"token",name:["apiClient","authConfig","bearer","token"],rules:[{required:!0,message:"请输入token"}]},{default:i(()=>[l(n,{value:t(a).data.apiClient.authConfig.bearer.token,"onUpdate:value":e[20]||(e[20]=r=>t(a).data.apiClient.authConfig.bearer.token=r),placeholder:"请输入token"},null,8,["value"])]),_:1})):m("",!0)])):m("",!0),t(a).data.provider!=="internal-integrated"?(d(),h("div",ma,[l(o,{name:["apiClient","headers"],rules:[{required:!t(S),message:"请输入请求头"},{validator:se}]},{label:i(()=>[l(u,{text:"请求头",tooltip:"根据不同应用的调用规范，自定义请求头内容"})]),default:i(()=>[l(O,{value:t(a).data.apiClient.headers,"onUpdate:value":e[21]||(e[21]=r=>t(a).data.apiClient.headers=r),valid:t(S),"onUpdate:valid":e[22]||(e[22]=r=>ee(S)?S.value=r:null)},null,8,["value","valid"])]),_:1},8,["rules"]),l(o,{label:"参数",name:["apiClient","parameters"],rules:[{required:!t(q),message:"请输入参数"},{validator:ue}]},{default:i(()=>[l(O,{value:t(a).data.apiClient.parameters,"onUpdate:value":e[23]||(e[23]=r=>t(a).data.apiClient.parameters=r),valid:t(q),"onUpdate:valid":e[24]||(e[24]=r=>ee(q)?q.value=r:null)},null,8,["value","valid"])]),_:1},8,["rules"])])):m("",!0)],64)):m("",!0),v==="apiServer"?(d(),h(P,{key:2},[t(a).data.integrationModes.includes("apiClient")?m("",!0):(d(),C(o,{key:0,class:"resetLabel",name:["apiServer","appId"],rules:[{required:!0}]},{label:i(()=>[l(u,{text:"appId",required:"",tooltip:"第三方应用唯一标识"})]),default:i(()=>[l(n,{value:t(a).data.apiServer.appId,"onUpdate:value":e[25]||(e[25]=r=>t(a).data.apiServer.appId=r),disabled:"",placeholder:"请输入appId"},null,8,["value"])]),_:1})),l(o,{class:"resetLabel",name:["apiServer","secureKey"],rules:[{required:!0,message:"请输入secureKey"}]},{label:i(()=>[l(u,{text:"secureKey",required:"",tooltip:"第三方应用唯一标识匹配的秘钥"})]),default:i(()=>[l(he,{value:t(a).data.apiServer.secureKey,"onUpdate:value":e[26]||(e[26]=r=>t(a).data.apiServer.secureKey=r),placeholder:"请输入secureKey"},null,8,["value"])]),_:1}),Z(l(o,{class:"resetLabel"},{label:i(()=>[l(u,{text:"回调地址",tooltip:"授权完成后跳转到具体页面的回调地址"})]),default:i(()=>[l(n,{value:t(a).data.apiServer.redirectUri,"onUpdate:value":e[27]||(e[27]=r=>t(a).data.apiServer.redirectUri=r),placeholder:"请输入redirectUri"},null,8,["value"])]),_:1},512),[[Q,t(a).data.provider==="internal-standalone"]]),l(o,{class:"resetLabel",name:["apiServer","roleIdList"],rules:[{required:!0,message:"请选择角色"}]},{label:i(()=>[l(u,{text:"角色",required:"",tooltip:"为应用用户分配角色，根据绑定的角色，进行系统菜单赋权"})]),default:i(()=>[l(I,{value:t(a).data.apiServer.roleIdList,"onUpdate:value":e[28]||(e[28]=r=>t(a).data.apiServer.roleIdList=r),options:t(a).roleIdList,mode:"multiple",placeholder:"请选择角色"},null,8,["value","options"]),l(j,{hasPermission:`${re}:update`,type:"link",onClick:e[29]||(e[29]=r=>T(t(a).data.apiServer.roleIdList,"Role")),class:"add-item"},{default:i(()=>[l(R,{type:"PlusOutlined"})]),_:1},8,["hasPermission"])]),_:1}),l(o,null,{label:i(()=>[l(u,{text:"组织",tooltip:"为应用用户分配所属组织，根据绑定的组织，进行数据隔离"})]),default:i(()=>[l(J,{value:t(a).data.apiServer.orgIdList,"onUpdate:value":e[30]||(e[30]=r=>t(a).data.apiServer.orgIdList=r),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{label:"name",value:"id"},multiple:"","tree-data":t(a).orgIdList,placeholder:"请选择组织",filterTreeNode:(r,z)=>s.filterSelectNode(r,z,"name")},{title:i(({name:r})=>[U(K(r),1)]),_:1},8,["value","tree-data","filterTreeNode"]),l(j,{hasPermission:`${le}:update`,type:"link",onClick:e[31]||(e[31]=r=>T(t(a).data.apiServer.orgIdList,"Department")),class:"add-item"},{default:i(()=>[l(R,{type:"PlusOutlined"})]),_:1},8,["hasPermission"])]),_:1}),t(a).data.provider==="third-party"?(d(),h("div",ga,[l(o,null,{label:i(()=>[l(u,{text:"redirectUrl",tooltip:"授权后自动跳转的页面地址"})]),default:i(()=>[l(n,{value:t(a).data.apiServer.redirectUri,"onUpdate:value":e[32]||(e[32]=r=>t(a).data.apiServer.redirectUri=r),placeholder:"请输入redirectUrl"},null,8,["value"])]),_:1}),l(o,{label:"IP白名单",name:["apiServer","ipWhiteList"],rules:[{validator:ge}]},{default:i(()=>[l(W,{value:t(a).data.apiServer.ipWhiteList,"onUpdate:value":e[33]||(e[33]=r=>t(a).data.apiServer.ipWhiteList=r),placeholder:"请输入IP白名单，多个地址回车分隔，不填默认均可访问",rows:3,style:{width:"100%"}},null,8,["value"])]),_:1},8,["rules"])])):m("",!0)],64)):m("",!0),v==="ssoClient"?(d(),h(P,{key:3},[t(a).data.provider==="third-party"?(d(),h("div",ca,[l(o,{label:"认证方式",name:["sso","configuration","oauth2","type"],rules:[{required:!0,message:"请选择认证方式"}]},{default:i(()=>[l(I,{value:t(a).data.sso.configuration.oauth2.type,"onUpdate:value":e[34]||(e[34]=r=>t(a).data.sso.configuration.oauth2.type=r),placeholder:"请选择认证方式",options:[{label:"oauth2",value:"oauth2"}]},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["sso","configuration","oauth2","scope"],rules:[{required:!0,message:"请输入scope"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"scope",required:"",tooltip:"限制用户访问应用程序的权限"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.scope,"onUpdate:value":e[35]||(e[35]=r=>t(a).data.sso.configuration.oauth2.scope=r),placeholder:"请输入scope"},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["sso","configuration","oauth2","clientId"],rules:[{required:!0,message:"请输入client_id"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"client_id",required:"",tooltip:"应用唯一标识"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.clientId,"onUpdate:value":e[36]||(e[36]=r=>t(a).data.sso.configuration.oauth2.clientId=r),placeholder:"请输入client_id"},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["sso","configuration","oauth2","clientSecret"],rules:[{required:!0,message:"请输入client_secret"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"client_secret",required:"",tooltip:"应用唯一标识的秘钥"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.clientSecret,"onUpdate:value":e[37]||(e[37]=r=>t(a).data.sso.configuration.oauth2.clientSecret=r),placeholder:"请输入client_secret"},null,8,["value"])]),_:1})])):m("",!0),(t(a).data.provider==="internal-standalone"||t(a).data.provider==="third-party")&&!t(a).data.integrationModes.includes("apiClient")?(d(),C(o,{key:1,class:"resetLabel",name:["sso","configuration","oauth2","authorizationUrl"],rules:[{required:!0,message:"请输入授权地址"}]},{label:i(()=>[l(u,{text:"授权地址",required:"",tooltip:"认证授权地址"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.authorizationUrl,"onUpdate:value":e[38]||(e[38]=r=>t(a).data.sso.configuration.oauth2.authorizationUrl=r),placeholder:"请输入授权地址"},null,8,["value"])]),_:1})):m("",!0),t(a).data.provider==="third-party"?(d(),h("div",ha,[l(o,{class:"resetLabel",name:["sso","configuration","oauth2","tokenUrl"],rules:[{required:!0,message:"请输入token地址"}]},{label:i(()=>[l(u,{text:"token地址",required:"",tooltip:"设置token令牌的地址"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.tokenUrl,"onUpdate:value":e[39]||(e[39]=r=>t(a).data.sso.configuration.oauth2.tokenUrl=r),placeholder:"请输入token地址"},null,8,["value"])]),_:1}),l(o,{label:"用户信息地址",name:["sso","configuration","oauth2","userInfoUrl"],rules:[{required:!0,message:"请输入用户信息地址"}]},{default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.userInfoUrl,"onUpdate:value":e[40]||(e[40]=r=>t(a).data.sso.configuration.oauth2.userInfoUrl=r),placeholder:"请输入用户信息地址"},null,8,["value"])]),_:1}),l(o,{class:"resetLabel",name:["sso","configuration","oauth2","userProperty","userId"],rules:[{required:!0,message:"请输入用户ID"}]},{label:i(()=>[l(u,{text:"用户ID",required:"",tooltip:"通过jsonpath表达式从授权结果中获取第三方平台用户的唯一标识"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.userProperty.userId,"onUpdate:value":e[41]||(e[41]=r=>t(a).data.sso.configuration.oauth2.userProperty.userId=r),placeholder:"输入从用户信息接口返回数据中的用户ID字段。示例:result.id"},null,8,["value"])]),_:1}),l(o,{label:"用户名",name:["sso","configuration","oauth2","userProperty","username"],rules:[{required:!0,message:"请输入用户名"}]},{default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.userProperty.username,"onUpdate:value":e[42]||(e[42]=r=>t(a).data.sso.configuration.oauth2.userProperty.username=r),placeholder:"输入从用户信息接口返回数据中的用户名字段。示例:result.name"},null,8,["value"])]),_:1}),l(o,{label:"头像"},{default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.userProperty.avatar,"onUpdate:value":e[43]||(e[43]=r=>t(a).data.sso.configuration.oauth2.userProperty.avatar=r),placeholder:"输入从用户信息接口返回数据中的用户头像字段。示例:result.avatar"},null,8,["value"])]),_:1})])):t(a).data.integrationModes.includes("apiClient")?m("",!0):(d(),h("div",ya,[t(a).data.provider==="internal-standalone"?(d(),C(o,{key:0},{label:i(()=>[l(u,{text:"回调地址",tooltip:"授权完成后跳转到具体页面的回调地址"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.oauth2.redirectUri,"onUpdate:value":e[44]||(e[44]=r=>t(a).data.sso.configuration.oauth2.redirectUri=r),placeholder:"请输入回调地址"},null,8,["value"])]),_:1})):m("",!0),t(a).data.provider!=="dingtalk-ent-app"?(d(),C(o,{key:1,class:"resetLabel",name:["sso","configuration","appId"],rules:[{required:!0,message:"请输入appId"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"appId",required:"",tooltip:"第三方应用唯一标识"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.appId,"onUpdate:value":e[45]||(e[45]=r=>t(a).data.sso.configuration.appId=r),placeholder:"请输入appId"},null,8,["value"])]),_:1})):m("",!0),t(a).data.provider!=="wechat-webapp"&&t(a).data.provider!=="wechat-miniapp"?(d(),C(o,{key:2,class:"resetLabel",name:["sso","configuration","appKey"],rules:[{required:!0,message:"请输入appKey"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"appKey",required:"",tooltip:"第三方应用唯一标识的密钥"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.appKey,"onUpdate:value":e[46]||(e[46]=r=>t(a).data.sso.configuration.appKey=r),placeholder:"请输入appKey"},null,8,["value"])]),_:1})):m("",!0),["wechat-miniapp","wechat-webapp","dingtalk-ent-app"].includes((L=t(a).data)==null?void 0:L.provider)?(d(),C(o,{key:3,class:"resetLabel",name:["sso","configuration","appSecret"],rules:[{required:!0,message:"请输入appSecret"},{max:64,message:"最多可输入64个字符"}]},{label:i(()=>[l(u,{text:"appSecret",required:"",tooltip:"应用的唯一标识的秘钥"})]),default:i(()=>[l(n,{value:t(a).data.sso.configuration.appSecret,"onUpdate:value":e[47]||(e[47]=r=>t(a).data.sso.configuration.appSecret=r),placeholder:"请输入appSecret"},null,8,["value"])]),_:1})):m("",!0)])),l(o,{class:"resetLabel"},{label:i(()=>[l(u,{text:"自动创建用户",required:"",tooltip:"开启后，第三方用户第一次授权登录系统时，无需进入授权绑定页面。系统默认创建一个新用户与之绑定。"})]),default:i(()=>[l(ye,{checked:t(a).data.sso.autoCreateUser,"onUpdate:checked":e[48]||(e[48]=r=>t(a).data.sso.autoCreateUser=r)},null,8,["checked"])]),_:1}),t(a).data.sso.autoCreateUser?(d(),h("div",Ca,[l(o,{label:"用户名前缀",name:["sso","usernamePrefix"],rules:[{required:!0,message:"请输入用户名前缀"},{validator:ne,trigger:"change"}]},{default:i(()=>[l(n,{value:t(a).data.sso.usernamePrefix,"onUpdate:value":e[49]||(e[49]=r=>t(a).data.sso.usernamePrefix=r),placeholder:"请输入用户名前缀"},null,8,["value"])]),_:1},8,["rules"]),l(o,{label:"默认密码",name:["sso","defaultPasswd"],rules:[{required:!0,message:"请输入默认密码"},{validator:pe}]},{default:i(()=>[l(n,{value:t(a).data.sso.defaultPasswd,"onUpdate:value":e[50]||(e[50]=r=>t(a).data.sso.defaultPasswd=r),placeholder:"请输入默认密码"},null,8,["value"])]),_:1},8,["rules"]),l(o,{label:"角色"},{default:i(()=>[l(I,{value:t(a).data.sso.roleIdList,"onUpdate:value":e[51]||(e[51]=r=>t(a).data.sso.roleIdList=r),mode:"multiple",options:t(a).roleIdList,placeholder:"请选择角色"},null,8,["value","options"]),l(j,{hasPermission:`${re}:update`,type:"link",onClick:e[52]||(e[52]=r=>T(t(a).data.sso.roleIdList,"Role")),class:"add-item"},{default:i(()=>[l(R,{type:"PlusOutlined"})]),_:1},8,["hasPermission"])]),_:1}),l(o,{label:"组织"},{default:i(()=>[l(J,{value:t(a).data.sso.orgIdList,"onUpdate:value":e[53]||(e[53]=r=>t(a).data.sso.orgIdList=r),"show-search":"",style:{width:"100%"},"dropdown-style":{maxHeight:"400px",overflow:"auto"},fieldNames:{label:"name",value:"id"},multiple:"","tree-data":t(a).orgIdList,placeholder:"请选择组织"},{title:i(({name:r})=>[U(K(r),1)]),_:1},8,["value","tree-data"]),l(j,{hasPermission:`${le}:update`,type:"link",onClick:e[54]||(e[54]=r=>T(t(a).data.sso.orgIdList,"Department")),class:"add-item"},{default:i(()=>[l(R,{type:"PlusOutlined"})]),_:1},8,["hasPermission"])]),_:1})])):m("",!0)],64)):m("",!0)]}),_:2},1024))),128))]),_:1}),l(o,{label:"说明",name:"description"},{default:i(()=>[l(W,{value:t(a).data.description,"onUpdate:value":e[55]||(e[55]=v=>t(a).data.description=v),placeholder:"请输入说明",showCount:"",maxlength:200,rows:3,style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"]),t(g).view!=="true"?(d(),C(_e,{key:0,onClick:ve,type:"primary",loading:t($)},{default:i(()=>[U(" 保存 ")]),_:1},8,["loading"])):m("",!0),A("div",ba,[t(b).visible&&t(b).current.provider!=="third-party"?(d(),C(la,{key:0,visible:t(b).visible,"onUpdate:visible":e[56]||(e[56]=v=>t(b).visible=v),data:t(b).current,mode:t(g).id?"edit":"add",onRefresh:e[57]||(e[57]=v=>t(N).jumpPage("system/Apply"))},null,8,["visible","data","mode"])):m("",!0),t(b).visible&&t(b).current.provider==="third-party"?(d(),C(ra,{key:1,data:t(b).current,mode:t(g).id?"edit":"add",onCancel:e[58]||(e[58]=v=>t(b).visible=!1),onOk:e[59]||(e[59]=v=>t(N).jumpPage("system/Apply"))},null,8,["data","mode"])):m("",!0)])])}}});const Ba=ea(Ua,[["__scopeId","data-v-e6e45df0"]]);export{Ba as default};
