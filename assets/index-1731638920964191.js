import{X as re,a as ce,o as w,eX as J,Z as pe,as as de,e as ue,a0 as _e,a1 as me,d as fe,aL as ge,aM as ye,aN as ke,$ as he,a2 as Ce,a3 as ve,i as xe,g as be}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{C as I}from"./config-17316389209642.js";import{M as j,N as A}from"./const-17316389209642.js";import Se from"./index-1731638920964190.js";import Pe from"./index-1731638920964187.js";import we from"./index-1731638920964189.js";import{d as je,k as y,ab as h,U as r,V as u,X as e,f as n,u as p,E as C,R as Te,_ as c,$ as d,W as Oe,Z as L,F as R,a1 as F,G as Me,Y as U,af as Ee,ag as Ie}from"./vue-1731638920964.js";import"./ToUser.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./template-1731638920964.js";import"./ToOrg.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./ToTag.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./validate-1731638920964.js";import"./regular-1731638920964.js";import"./Record.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./vue-json-viewer-1731638920964.js";const X=v=>(Ee("data-v-0f5e57db"),v=v(),Ie(),v),Be=["src"],Ne={class:"card-item-content-title"},Ve=X(()=>c("div",{class:"card-item-content-text"}," 通知方式 ",-1)),De=X(()=>c("div",{class:"card-item-content-text"}," 说明 ",-1)),$e=je({__name:"index",setup(v){const B=re();let T=[];Object.keys(j).forEach(t=>{T=[...T,...j[t]]});const x=y({}),N=y({}),q=ce().hasPermission("notice/Config:import"),V=[{title:"配置名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string"}},{title:"通知方式",dataIndex:"type",key:"type",scopedSlots:!0,width:100,search:{type:"select",options:A,handleValue:t=>t}},{title:"类型",dataIndex:"provider",key:"provider",scopedSlots:!0,width:200,search:{type:"select",options:T,handleValue:t=>t}},{title:"说明",dataIndex:"description",key:"description",scopedSlots:!0,ellipsis:!0,search:{type:"string"}},{title:"操作",key:"action",fixed:"right",width:210,scopedSlots:!0}],G=t=>{N.value=t},Y=(t,l)=>{var a;return(a=j[t].find(s=>s.value===l))==null?void 0:a.logo},D=t=>{var l;return(l=A.find(a=>a.value===t))==null?void 0:l.label},Z=(t,l)=>{var a;return(a=j[t].find(s=>s.value===l))==null?void 0:a.label},z=()=>{B.jumpPage("notice/Config/Detail",{id:":id"})},H=t=>{console.log("file: ",t);const l=new FileReader;return l.readAsText(t),l.onload=async a=>{var _;const s=(_=a.target)==null?void 0:_.result;if(console.log("text: ",s),!t.type.includes("json"))return w("请上传json格式文件","error"),!1;try{const m=JSON.parse(s||"{}"),{success:f}=await I.update(m);return f&&(w("操作成功"),x.value.reload()),!0}catch{}return!0},!1},W=()=>{J(x.value._dataSource,"通知配置数据")},O=y(!1),b=y(!1),M=y(!1),g=y(),$=(t,l)=>{var _,m,f;if(!t)return[];const a=[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{B.jumpPage("notice/Config/Detail",{id:t.id})}},{key:"debug",text:"调试",tooltip:{title:"调试"},icon:"BugOutlined",onClick:()=>{b.value=!0,g.value=t}},{key:"delete",text:"删除",popConfirm:{title:"确认删除?",onConfirm:async()=>{var S;(await I.del(t.id)).status===200?(w("操作成功！"),(S=x.value)==null||S.reload()):w("操作失败！","error")}},icon:"DeleteOutlined"}],s={key:"others",text:"其他",icon:"EllipsisOutlined",children:[{key:"export",text:"导出",tooltip:{title:"导出"},icon:"ArrowDownOutlined",onClick:()=>{J(t,`${t.name}`)}},{key:"log",text:"通知记录",tooltip:{title:"通知记录"},icon:"BarsOutlined",onClick:()=>{M.value=!0,g.value=t}}]};return xe&&((_=s.children)==null||_.push({key:"bind",text:"同步用户",tooltip:{title:"同步用户"},icon:"TeamOutlined",onClick:()=>{O.value=!0,g.value=t}})),l==="card"?(t.provider!=="dingTalkMessage"&&t.provider!=="corpMessage"&&((m=s.children)==null||m.splice(1,1)),a.splice(a.length-1,0,s),a):(t.provider!=="dingTalkMessage"&&t.provider!=="corpMessage"&&((f=s.children)==null||f.splice(1,1)),a.splice(a.length-1,0,...s.children),a)};return(t,l)=>{const a=h("pro-search"),s=pe,_=de,m=ue,f=_e,E=h("Ellipsis"),S=me,k=h("AIcon"),K=fe,Q=ge,ee=ye,te=ke,oe=he,ne=Ce,se=ve,ie=h("FullPage"),le=h("page-container");return r(),u(le,null,{default:e(()=>[n(a,{columns:V,target:"notice-config",onSearch:G}),n(ie,null,{default:e(()=>[n(se,{ref_key:"configRef",ref:x,columns:V,request:p(I).list,defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:p(N),gridColumn:3},{headerTitle:e(()=>[n(m,null,{default:e(()=>[n(s,{type:"primary",onClick:z,hasPermission:"notice/Config:add"},{default:e(()=>[C(" 新增 ")]),_:1}),n(_,{name:"file",accept:".json",showUploadList:!1,"before-upload":H,disabled:!p(q)},{default:e(()=>[n(s,{hasPermission:"notice/Config:import"},{default:e(()=>[C(" 导入 ")]),_:1})]),_:1},8,["disabled"]),n(s,{popConfirm:{title:"确认导出？",onConfirm:W},hasPermission:"notice/Config:export"},{default:e(()=>[C(" 导出 ")]),_:1},8,["popConfirm"])]),_:1})]),card:e(i=>[n(ne,{showStatus:!1,statusNames:{},value:i,actions:$(i,"card")},{img:e(()=>[Te(t.$slots,"img",{},()=>[c("img",{src:Y(i.type,i.provider),class:"logo"},null,8,Be)],!0)]),content:e(()=>[c("h3",Ne,d(i.name),1),n(S,null,{default:e(()=>[n(f,{span:12},{default:e(()=>[Ve,c("div",null,d(D(i.type)),1)]),_:2},1024),n(f,{span:12},{default:e(()=>[De,n(E,null,{default:e(()=>[C(d(i.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),actions:e(o=>[n(oe,Oe(o.tooltip,{title:o.disabled&&o.tooltip.title}),{default:e(()=>[o.key==="others"?(r(),u(te,{key:0,placement:"bottomRight"},{overlay:e(()=>[n(ee,null,{default:e(()=>[(r(!0),L(R,null,F(o.children,(P,ae)=>(r(),u(Q,{key:ae},{default:e(()=>[n(s,{type:"link",onClick:P.onClick,hasPermission:`notice/Config:${P.key}`},{icon:e(()=>[n(k,{type:P.icon},null,8,["type"])]),default:e(()=>[c("span",null,d(P.text),1)]),_:2},1032,["onClick","hasPermission"])]),_:2},1024))),128))]),_:2},1024)]),default:e(()=>[n(K,null,{default:e(()=>[n(k,{type:o.icon},null,8,["type"]),c("span",null,d(o.text),1)]),_:2},1024)]),_:2},1024)):o.key==="delete"?(r(),u(s,{key:1,popConfirm:o.popConfirm,disabled:o.disabled,hasPermission:`notice/Config:${o.key}`},{icon:e(()=>[n(k,{type:"DeleteOutlined"})]),_:2},1032,["popConfirm","disabled","hasPermission"])):(r(),u(s,{key:2,disabled:o.disabled,onClick:o.onClick,hasPermission:`notice/Config:${o.key}`},{icon:e(()=>[n(k,{type:o.icon},null,8,["type"])]),default:e(()=>[c("span",null,d(o.text),1)]),_:2},1032,["disabled","onClick","hasPermission"]))]),_:2},1040,["title"])]),_:2},1032,["value","actions"])]),type:e(i=>[c("span",null,d(D(i.type)),1)]),provider:e(i=>[c("span",null,d(Z(i.type,i.provider)),1)]),description:e(i=>[n(E,null,{default:e(()=>[C(d(i.description),1)]),_:2},1024)]),action:e(i=>[n(m,{size:16},{default:e(()=>[(r(!0),L(R,null,F($(i,"table"),o=>(r(),u(s,{key:o.key,danger:o.key==="delete",disabled:o.disabled,popConfirm:o.popConfirm,tooltip:{...o.tooltip},onClick:o.onClick,type:"link",style:{padding:"0px"},hasPermission:"notice/Config:"+o.key},{icon:e(()=>[n(k,{type:o.icon},null,8,["type"])]),_:2},1032,["danger","disabled","popConfirm","tooltip","onClick","hasPermission"]))),128))]),_:2},1024)]),_:3},8,["request","params"])]),_:3}),n(Pe,{visible:p(b),"onUpdate:visible":l[0]||(l[0]=i=>Me(b)?b.value=i:null),data:p(g)},null,8,["visible","data"]),p(M)?(r(),u(we,{key:0,data:p(g),onCancel:l[1]||(l[1]=i=>M.value=!1)},null,8,["data"])):U("",!0),p(O)?(r(),u(Se,{key:1,data:p(g),onCancel:l[2]||(l[2]=i=>O.value=!1)},null,8,["data"])):U("",!0)]),_:3})}}});const it=be($e,[["__scopeId","data-v-0f5e57db"]]);export{it as default};
