import{B as J,L as N,T as O,fo as T,eX as A,e as P,a0 as V,a1 as L,a9 as U,aa as X}from"./index-1731638920964.js";import{d as I,e as k,w as K,k as r,U as b,V as M,X as l,f as u,_ as p,$ as d,u as t,Z as w,Y as x,G as C}from"./vue-1731638920964.js";const R={key:0},G=I({__name:"index",props:{visible:{type:Boolean,default:!1},data:{type:Object,default:()=>({})}},emits:["update:visible"],setup(f,{emit:S}){const g=f,a=k({get:()=>g.visible,set:s=>S("update:visible",s)});K(()=>a.value,s=>{s&&y()});const c=r(0),v=r(0),j=r(!1),i=r([]),_=k(()=>JSON.stringify(i.value)),y=()=>{c.value=0;const s=`${J}/media/gb28181-cascade/${g.data.id}/bindings/publish?:X_Access_Token=${N.get(O)}`,e=new T.EventSourcePolyfill(s);e.onmessage=m=>{const n=JSON.parse(m.data);n.successful?c.value+=1:(v.value+=1,i.value.length<=5&&i.value.push({...n}))},e.onerror=()=>{e.close()},e.onopen=()=>{}};return(s,e)=>{const m=P,n=V,B=L,$=U,E=X;return b(),M(E,{visible:t(a),"onUpdate:visible":e[2]||(e[2]=o=>C(a)?a.value=o:null),title:"推送",cancelText:"取消",okText:"确定",width:"900px",onOk:e[3]||(e[3]=o=>a.value=!1),onCancel:e[4]||(e[4]=o=>a.value=!1)},{default:l(()=>[u(B,{gutter:20},{default:l(()=>[u(n,{span:8},{default:l(()=>[p("p",null,"成功："+d(t(c)),1),u(m,null,{default:l(()=>[p("p",null,"失败："+d(t(v)),1),t(i).length?(b(),w("a",{key:0,onClick:e[0]||(e[0]=o=>t(A)(t(i)||"",f.data.name+"-推送失败"))},"下载")):x("",!0)]),_:1})]),_:1}),u(n,{span:8},{default:l(()=>[p("p",null,"推送通道数量："+d(f.data.count),1)]),_:1}),u(n,{span:8},{default:l(()=>[p("p",null,"已推送通道数量："+d(t(c)+t(v)),1)]),_:1})]),_:1}),t(j)?(b(),w("div",R,[u($,{rows:10,value:t(_),"onUpdate:value":e[1]||(e[1]=o=>C(_)?_.value=o:null)},null,8,["value"])])):x("",!0)]),_:1},8,["visible"])}}});export{G as _};
