import{ay as f,h as m,fR as B,au as F,a0 as I,a1 as J,g as R}from"./index-1730252110824.js";import d from"./TopCard-17302521108244.js";import V from"./Card-17302521108243.js";import{h as i}from"./home-17302521108243.js";import{e as j}from"./encodeQuery-1730252110824.js";import{d as E,k as l,ab as H,U as Q,V as S,X as s,f as a,u as e}from"./vue-1730252110824.js";import"./index-1730252110824279.js";import"./index-1730252110824297.js";const v={agg:()=>f.get("/media/record/file/agg"),aggPlaying:()=>f.get("/media/channel/playing/agg"),getPlayCount:y=>f.post("/dashboard/_multi",y)},U=E({__name:"index",setup(y){const p=l([]),C=l(0);(()=>{i.deviceCount({}).then(t=>{C.value=t.result}),i.deviceCount(j({terms:{state:"online"}})).then(t=>{p.value[0]={title:"在线",value:t.result,status:"success"}}),i.deviceCount(j({terms:{state:"offline"}})).then(t=>{p.value[1]={title:"离线",value:t.result,status:"error"}})})();const _=l([]),D=l(0);(()=>{i.channelCount({}).then(t=>{D.value=t.result}),i.channelCount({terms:[{column:"status",value:"online"}]}).then(t=>{_.value[0]={title:"在线",value:t.result,status:"success"}}),i.channelCount({terms:[{column:"status$not",value:"online"}]}).then(t=>{_.value[1]={title:"离线",value:t.result,status:"error"}})})();const b=l([]),M=l(0);(()=>{v.agg().then(t=>{M.value=t.result.total,b.value=[{title:"总时长",value:B(t.result.duration),status:""}]})})();const Y=l([]),x=l(0);(()=>{v.aggPlaying().then(t=>{x.value=t.result.playingTotal,Y.value=[{title:"播放人数",value:t.result.playerTotal,status:""}]})})();const P=l([]),k=async t=>{let g="1h",o=12;const n=t.time.end-t.time.start,c=60*60*1e3,u=c*24,w=u*30,T=365*u;let h="";n<=u?o=Math.abs(Math.ceil(n/c)):n>u&&n<T?(o=Math.abs(Math.ceil(n/u)),g="1d",h="M月dd日"):n>=T&&(o=Math.abs(Math.floor(n/w)),g="1M",h="YYYY年-MM月"),v.getPlayCount([{dashboard:"media_stream",object:"play_count",measurement:"quantity",dimension:"agg",group:"playCount",params:{format:h,time:g,from:F(Number(t.time.start)).format("YYYY-MM-DD HH:mm:ss"),to:F(Number(t.time.end)).format("YYYY-MM-DD HH:mm:ss"),limit:o}}]).then(N=>{let A=[];N.result.sort((r,q)=>q.data.timestamp-r.data.timestamp).forEach(r=>{A.push({group:r.group,...r.data})}),P.value=A.map(r=>({x:r.timeString,value:r.value}))})};return(t,g)=>{const o=I,n=H("full-page"),c=J,u=H("page-container");return Q(),S(u,null,{default:s(()=>[a(c,{gutter:24},{default:s(()=>[a(o,{span:6},{default:s(()=>[a(d,{title:"设备数量",img:e(m)("/media/dashboard-1.png"),footer:e(p),value:e(C)},null,8,["img","footer","value"])]),_:1}),a(o,{span:6},{default:s(()=>[a(d,{title:"通道数量",img:e(m)("/media/dashboard-2.png"),footer:e(_),value:e(D)},null,8,["img","footer","value"])]),_:1}),a(o,{span:6},{default:s(()=>[a(d,{title:"录像数量",img:e(m)("/media/dashboard-3.png"),footer:e(b),value:e(M)},null,8,["img","footer","value"])]),_:1}),a(o,{span:6},{default:s(()=>[a(d,{title:"播放中数量",tooltip:"当前正在播放的通道数量之和",img:e(m)("/media/dashboard-4.png"),footer:e(Y),value:e(x)},null,8,["img","footer","value"])]),_:1}),a(o,{span:24,class:"dash-board-bottom"},{default:s(()=>[a(n,null,{default:s(()=>[a(V,{title:"播放数量(人次)",chartData:e(P),onChange:k},null,8,["chartData"])]),_:1})]),_:1})]),_:1})]),_:1})}}});const ot=R(U,[["__scopeId","data-v-3e3ae018"]]);export{ot as default};
