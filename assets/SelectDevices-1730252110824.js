import{d as M,ac as $,k as g,r as z,o as G,w as X,ab as j,U as k,Z,f,X as c,a4 as Q,u as l,G as W,V as R,E as ee,Y as V,_ as y,$ as w,F as te}from"./vue-1730252110824.js";import{au as ae,I as se,C as ne,ds as le,a3 as oe,aa as ce,g as re}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{q as ie,c as de}from"./firmware-1730252110824.js";const ue=M({name:"SelectDevicesPage"}),pe=M({...ue,props:{data:{type:Object,default:()=>{}},productId:{type:String,default:""}},emits:["update:modelValue","change"],setup(x,{emit:S}){const i=x;$();const b=g({}),h=g(!1),a=g([]),d=z({indeterminate:!1,checkAll:!1,checkedList:[]});let u=[];const _=new Map,p=g(),I={context:{includeTags:!1,includeBind:!1,includeRelations:!1},terms:[{terms:[{column:"productId",value:i.productId}],type:"and"}],sorts:[{name:"createTime",order:"desc"}]},v=new Map;v.set("online","processing"),v.set("offline","error"),v.set("notActive","warning");const C=[{title:"ID",key:"id",dataIndex:"id",fixed:"left",width:200,ellipsis:!0,search:{type:"string"}},{title:"设备名称",key:"name",dataIndex:"name",ellipsis:!0,search:{type:"string"}},{title:"固件版本",dataIndex:"version",key:"version",ellipsis:!0,search:{type:"string"},scopedSlots:!0},{title:"注册时间",key:"registerTime",dataIndex:"registerTime",search:{type:"date",rename:"registryTime"},width:200,scopedSlots:!0},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,search:{type:"select",options:[{label:"在线",value:"online"},{label:"离线",value:"offline"},{label:"禁用",value:"notActive"}]},width:150}],B=e=>{Object.assign(d,{checkedList:e.target.checked?u:[],indeterminate:!1}),a.value=d.checkedList},N=(e,t,n)=>{a.value=t?[...D(n)]:a.value.filter(o=>o!==(e==null?void 0:e.id))},O=(e,t,n)=>{const o=A(n);a.value=e?[...D(t)]:a.value.concat(o).filter(r=>!o.includes(r))},A=e=>e.map(t=>t==null?void 0:t.id).filter(t=>!!t),D=e=>new Set([...a.value,...A(e)]),q=e=>{e.length===0&&(a.value=[])},Y=()=>{p.value=T(a.value),S("update:modelValue",a.value),h.value=!1},T=e=>{let t=e.map(n=>_.has(n)&&_.get(n)).toString();return t==="false"&&(t=e),t},E=()=>{!i.data.view&&(h.value=!0)},K=()=>{h.value=!1,a.value=[]};G(()=>{ie({...I,paging:!1}).then(e=>{e.status===200&&(u=e.result.map(t=>(_.set(t.id,t.name),t.id)),i.data.id&&(p.value=T(i.data.deviceId),S("update:modelValue",i.data.deviceId),console.log(111,p.value,i.data.deviceId)))})}),X(()=>a.value,e=>{Object.assign(d,{checkedList:e,indeterminate:!!e.length&&e.length<u.length,checkAll:!!u.length&&e.length===u.length})},{deep:!0});const P=e=>{var n;const t=(n=e==null?void 0:e.terms)==null?void 0:n.map(o=>(o.terms=o.terms.map(r=>r.column==="version"?{column:"id$dev-firmware",value:[r]}:r),o));b.value={terms:t||[]}};return(e,t)=>{const n=j("AIcon"),o=se,r=j("pro-search"),U=ne,F=le,H=oe,J=ce;return k(),Z(te,null,[f(o,{placeholder:"请选择设备",value:l(p),"onUpdate:value":t[0]||(t[0]=s=>W(p)?p.value=s:null),disabled:!0},{addonAfter:c(()=>[f(n,{class:Q(x.data.view?"disabled":""),type:"EditOutlined",onClick:E},null,8,["class"])]),_:1},8,["value"]),l(h)?(k(),R(J,{key:0,title:"选择设备","ok-text":"确认","cancel-text":"取消",visible:!0,width:"80%",onCancel:K,onOk:Y},{default:c(()=>[f(r,{columns:C,target:"search-select-device",onSearch:P,type:"simple"}),f(H,{ref:"tableRef",model:"TABLE",columns:C,request:l(de),defaultParams:I,rowSelection:{selectedRowKeys:l(a),onSelect:N,onSelectAll:O,onChange:q},params:l(b)},{headerTitle:c(()=>[l(u).length!==0?(k(),R(U,{key:0,checked:l(d).checkAll,"onUpdate:checked":t[1]||(t[1]=s=>l(d).checkAll=s),indeterminate:l(d).indeterminate,onChange:B,style:{"margin-left":"8px"}},{default:c(()=>[ee(" 全选 ")]),_:1},8,["checked","indeterminate"])):V("",!0)]),productId:c(s=>[y("span",null,w(s.productName),1)]),state:c(s=>{var m,L;return[f(F,{text:(m=s.state)==null?void 0:m.text,status:l(v).get((L=s.state)==null?void 0:L.value)},null,8,["text","status"])]}),version:c(s=>{var m;return[y("span",null,w(((m=s.firmwareInfo)==null?void 0:m.version)||""),1)]}),registerTime:c(s=>[y("span",null,w(l(ae)(s.registerTime).format("YYYY-MM-DD HH:mm:ss")),1)]),_:1},8,["request","rowSelection","params"])]),_:1})):V("",!0)],64)}}});const xe=re(pe,[["__scopeId","data-v-39453f1f"]]);export{xe as default};
