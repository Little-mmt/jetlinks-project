import{d as q,ac as C,k as r,o as N,ab as I,U as R,V as B,X as c,f as i,u as l,_ as J}from"./vue-1731638920964.js";import{o as p,ds as L,e as V,a3 as j,aa as A}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{c as h}from"./cascade-1731638920964.js";const M=J("h3",null,"通道列表",-1),G=q({__name:"index",emits:["cancel","submit"],setup(P,{emit:x}){const _=C(),f=[{title:"设备名称",dataIndex:"deviceName",key:"deviceName",ellipsis:!0,search:{type:"string"}},{title:"通道名称",dataIndex:"name",key:"name",ellipsis:!0,search:{type:"string",first:!0}},{title:"安装地址",dataIndex:"address",key:"address",ellipsis:!0,search:{type:"string"}},{title:"厂商",dataIndex:"manufacturer",key:"manufacturer",ellipsis:!0,search:{type:"string"}},{title:"状态",dataIndex:"status",key:"status",scopedSlots:!0,width:150,search:{type:"select",options:[{label:"已连接",value:"online"},{label:"未连接",value:"offline"}],handleValue:e=>e}}],y=r({}),v=e=>{y.value=e},S=r(),t=r([]),g=()=>{t.value=[]},k=(e,n)=>{const a=new Set([...t.value]);n?a.add(e.id):a.delete(e.id),t.value=[...a]},b=(e,n,a)=>{const u=a.map(s=>s.id)||[],o=new Set([...t.value]);u.map(s=>{e?o.add(s):o.delete(s)}),t.value=[...o]},d=r(!1),w=async()=>{if(!t.value.length){p("请勾选数据","error");return}d.value=!0,(await h.bindChannel(_.query.id,t.value).finally(()=>{d.value=!1})).success?(p("操作成功！"),x("submit")):p("操作失败！","error")};return N(()=>{v({terms:[]})}),(e,n)=>{const a=I("pro-search"),u=L,o=V,s=j,T=A;return R(),B(T,{visible:"",title:"绑定通道",cancelText:"取消",okText:"确定",width:"80%",onOk:w,onCancel:n[0]||(n[0]=m=>e.$emit("cancel")),confirmLoading:l(d)},{default:c(()=>[i(a,{columns:f,onSearch:v,type:"simple"}),i(s,{ref_key:"listRef",ref:S,model:"table",columns:f,request:l(h).queryChannelList,defaultParams:{sorts:[{name:"deviceName",order:"asc"},{name:"name",order:"asc"}],terms:[{column:"id",termType:"cascade_channel$not",type:"and",value:l(_).query.id},{column:"catalogType",termType:"eq",type:"and",value:"device"}]},params:l(y),rowSelection:{selectedRowKeys:l(t),onSelectNone:g,onSelect:k,onSelectAll:b}},{headerTitle:c(()=>[M]),status:c(m=>[i(o,null,{default:c(()=>[i(u,{status:m.status.value==="online"?"success":"error",text:m.status.text},null,8,["status","text"])]),_:2},1024)]),_:1},8,["request","defaultParams","params","rowSelection"])]),_:1},8,["confirmLoading"])}}});export{G as _};
