import{d as R,k as T,e as x,r as I,ab as Z,U as _,V as v,X as i,f as s,u as t,Z as U,F as $,E as S,$ as q,Y as Q,v as X,_ as y,a1 as Y,A as G,af as H,ag as K}from"./vue-1730252110824.js";import{a4 as W,o as ee,$ as te,I as ae,v as ne,d as oe,aT as se,F as ie,aD as le,a6 as re,ea as de,aa as ce,g as ue}from"./index-1730252110824.js";import"./index-1730252110824282.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import{c as pe,a as _e,b as me}from"./permission-1730252110824.js";const D=m=>(H("data-v-0fed67ec"),m=m(),K(),m),fe=D(()=>y("span",null,"标识",-1)),ge=D(()=>y("span",{class:"required-icon"},"*",-1)),ve=D(()=>y("span",null,"标识ID需与代码中的标识ID一致",-1)),ye={class:"pager"},ke=R({__name:"EditDialog",props:{data:{},visible:{type:Boolean}},emits:["refresh","update:visible"],setup(m,{emit:k}){var w,z;const r=m,B=[{action:"query",name:"查询",describe:"查询"},{action:"save",name:"保存",describe:"保存"},{action:"delete",name:"删除",describe:"删除"}],b=T(!1),j=x(()=>{var o;return(o=r.data)!=null&&o.id?"编辑":"新增"}),L=()=>{var o;b.value=!0,(o=C.value)==null||o.validate().then(()=>l.submit()).then(a=>{a.status===200&&(ee("操作成功"),k("refresh"),k("update:visible",!1))}).finally(()=>b.value=!1)},C=T(),l=I({data:{name:"",id:"",...r==null?void 0:r.data,actionTableData:x(()=>{const o=(e.current-1)*e.pageSize,a=Math.min(e.current*e.pageSize,d.data.length);return console.log(o,a),d.data.slice(o,a)})},rules:{idCheck:async(o,a)=>{var c,u,p;return a?a.length>64?Promise.reject("最多可输入64个字符"):/^[a-zA-Z0-9_\-]+$/.test(a)?(c=r.data)!=null&&c.id&&((u=r.data)==null?void 0:u.id)===((p=l.data)==null?void 0:p.id)||(await pe({id:a})).result.passed?Promise.resolve():Promise.reject("标识重复"):Promise.reject("请输入英文或者数字或者-或者_"):Promise.reject("请输入标识(ID)")}},submit:()=>{var c;const o={...l.data,actions:d.data.filter(u=>u.action&&u.name)};return((c=r.data)!=null&&c.id?_e:me)(o)}}),d=I({columns:[{title:"-",dataIndex:"index",key:"index",width:80,align:"center"},{title:"操作类型",dataIndex:"action",key:"action",width:220},{title:"名称",dataIndex:"name",key:"name",width:220},{title:"说明",dataIndex:"describe",key:"describe",width:220},{title:"操作",dataIndex:"act",key:"act"}],data:(w=r.data)!=null&&w.id?W([...((z=r.data)==null?void 0:z.actions)||[]]):[...B],clickRemove:o=>{e.total-=1,d.data.splice(o,1),e.current>1&&e.total%e.pageSize===0&&(e.current-=1)},clickAdd:()=>{d.data.push({}),e.total+=1,e.total%e.pageSize===1&&(e.current=Math.ceil(e.total/e.pageSize))}}),e=I({current:1,pageSize:12,total:d.data.length}),O=x(()=>{const o=Math.ceil(e.total/e.pageSize);return new Array(o).fill(1)});return(o,a)=>{const c=Z("AIcon"),u=te,p=ae,g=ne,P=oe,E=se,M=ie,N=le,V=re,F=de,J=ce;return _(),v(J,{visible:"",title:t(j),width:"1000px",onOk:L,onCancel:a[4]||(a[4]=n=>k("update:visible",!1)),confirmLoading:t(b),destroyOnClose:"",class:"edit-dialog-container"},{default:i(()=>[s(M,{ref_key:"formRef",ref:C,model:t(l).data,layout:"vertical"},{default:i(()=>[s(g,{name:"id",rules:[{required:!0,message:""},{validator:t(l).rules.idCheck,trigger:"blur"}],class:"question-item"},{label:i(()=>[fe,ge,s(u,{placement:"top"},{title:i(()=>[ve]),default:i(()=>[s(c,{type:"QuestionCircleOutlined",style:{color:"#00000073"}})]),_:1})]),default:i(()=>[s(p,{value:t(l).data.id,"onUpdate:value":a[0]||(a[0]=n=>t(l).data.id=n),placeholder:"请输入标识(ID)",disabled:t(j)==="编辑"},null,8,["value","disabled"])]),_:1},8,["rules"]),s(g,{name:"name",label:"名称",rules:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"}]},{default:i(()=>[s(p,{value:t(l).data.name,"onUpdate:value":a[1]||(a[1]=n=>t(l).data.name=n),placeholder:"请输入名称"},null,8,["value"])]),_:1}),s(E,{columns:t(d).columns,"data-source":t(l).data.actionTableData,pagination:!1},{bodyCell:i(({column:n,record:f,index:h})=>[n.key==="index"?(_(),U($,{key:0},[S(q(`#${(t(e).current-1)*t(e).pageSize+(h+1)}.`),1)],64)):n.key!=="index"&&n.key!=="act"?(_(),v(g,{key:1,name:["actionTableData",h,n.key],rules:[{required:n.key!=="describe",message:`请输入${n.title}`},{max:64,message:"最多可输入64个字符"}]},{default:i(()=>[s(p,{value:f[n.key],"onUpdate:value":A=>f[n.key]=A},null,8,["value","onUpdate:value"])]),_:2},1032,["name","rules"])):n.key==="act"?(_(),v(P,{key:2,class:"delete-btn",style:{padding:"0"},type:"link",onClick:A=>t(d).clickRemove(h)},{default:i(()=>[s(c,{type:"DeleteOutlined"})]),_:2},1032,["onClick"])):Q("",!0)]),_:1},8,["columns","data-source"])]),_:1},8,["model"]),X(y("div",ye,[s(V,{value:t(e).current,"onUpdate:value":a[2]||(a[2]=n=>t(e).current=n),style:{width:"60px"}},{default:i(()=>[(_(!0),U($,null,Y(t(O),(n,f)=>(_(),v(N,{value:f+1},{default:i(()=>[S(q(f+1),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"]),s(F,{current:t(e).current,"onUpdate:current":a[3]||(a[3]=n=>t(e).current=n),"page-size":t(e).pageSize,total:t(e).total},null,8,["current","page-size","total"])],512),[[G,t(e).total>t(e).pageSize]]),s(P,{type:"dashed",style:{width:"100%"},onClick:t(d).clickAdd},{default:i(()=>[s(c,{type:"PlusOutlined"}),S(" 添加 ")]),_:1},8,["onClick"])]),_:1},8,["title","confirmLoading"])}}});const Ce=ue(ke,[["__scopeId","data-v-0fed67ec"]]);export{Ce as default};
