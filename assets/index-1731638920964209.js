import{ay as C,X as K,au as h,h as E,i as W,af as N,o as ee,a0 as te,a1 as ae,a6 as se,g as oe}from"./index-1731638920964.js";import O from"./Charts-17316389209643.js";import P from"./TopCard-17316389209645.js";import re from"./NewAlarm-1731638920964.js";import{_ as le}from"./TimeSelect.vue_vue_type_script_setup_true_lang-17316389209643.js";import ne from"./Guide-17316389209643.js";import{e as ie}from"./encodeQuery-1731638920964.js";import{a as me}from"./scene-1731638920964.js";import{d as ce,k as v,r as R,ab as de,U as b,V as ue,X as g,_ as f,f as d,u as l,Z as x,F as pe,a1 as ge,$ as q,af as fe,ag as ye}from"./vue-1731638920964.js";import"./index-1731638920964297.js";import"./index-1731638920964279.js";const J=p=>C.post("/dashboard/_multi",p),_e=p=>C.get("/alarm/record/_query",p),Y=p=>C.post("/alarm/config/_count",p),he=()=>C.get("/alarm/config/default/level"),V=p=>(fe("data-v-185fdf45"),p=p(),ye(),p),ve={class:"DashBoardBox"},be={class:"alarm-card"},Me=V(()=>f("span",{style:{"margin-right":"24px"}},"告警统计",-1)),Te={class:"alarmBox"},ke={class:"alarmStatistics-chart"},xe={class:"alarmRank"},Ce=V(()=>f("h4",null,"告警排名",-1)),De={key:0,class:"rankingList"},we=["onClick"],Se=["src"],Fe=["title"],Ye={class:"rankingItemValue"},He={key:1,class:"empty-body"},Ae=ce({__name:"index",setup(p){const M=K();let H=v([{title:"当月告警",value:0,status:"success"}]),D=v([{title:"正常",value:0,status:"success"},{title:"禁用",value:0,status:"error"}]);const $=v([{label:"设备",value:"device"},{label:"产品",value:"product"},{label:"组织",value:"org"},{label:"其它",value:"other"}]),G=v([{label:"设备",value:"device"},{label:"产品",value:"product"},{label:"其它",value:"other"}]);let n=R({startTime:0,endTime:0,targetType:"device"}),A=v({}),r=R({today:0,thisMonth:0,config:0,enabledConfig:0,disabledConfig:0,alarmList:[],ranking:[],fifteenOptions:{}});const Q={dashboard:"alarm",object:"record",measurement:"trend",dimension:"agg",group:"today",params:{time:"1d",format:"HH:mm:ss",from:h(new Date(new Date().setHours(0,0,0,0))).format("YYYY-MM-DD HH:mm:ss"),to:"now"}},U={dashboard:"alarm",object:"record",measurement:"trend",dimension:"agg",group:"thisMonth",params:{time:"1M",format:"yyyy-MM",limit:1,from:"now-1M"}},X={dashboard:"alarm",object:"record",measurement:"trend",dimension:"agg",group:"15day",params:{time:"1d",format:"yyyy-MM-dd",from:"now-15d",to:"now",limit:15}};(()=>{J([Q,U,X]).then(t=>{var o,a;if(t.status==200){const s=t.result;r.today=((o=s.find(e=>e.group==="today"))==null?void 0:o.data.value)||0,r.thisMonth=((a=s.find(e=>e.group==="thisMonth"))==null?void 0:a.data.value)||0,H.value[0].value=r.thisMonth;const u=s.filter(e=>e.group==="15day").map(e=>e.data).sort((e,c)=>c.timestamp-e.timestamp);r.fifteenOptions={xAxis:{type:"category",data:u.map(e=>e.timeString),show:!1},yAxis:{type:"value",show:!1},grid:{top:"2%",left:40,bottom:0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},series:[{name:"告警数",data:u.map(e=>e.value),type:"line",color:"#FF595E",smooth:!0,symbolSize:0,areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#FF595E"},{offset:1,color:"#FFFFFF"}],global:!1}}}]}}})})(),(async()=>{const t=await Y({}),o=await Y({terms:[{column:"state",value:"enabled"}]}),a=await Y({terms:[{column:"state",value:"disabled"}]});t.status==200&&(r.config=t.result),o.status==200&&(r.enabledConfig=o.result,D.value[0].value=r.enabledConfig),a.status==200&&(r.disabledConfig=a.result,D.value[1].value=r.disabledConfig)})(),(async()=>{var s,u;const t=await he(),a=await _e(ie({sorts:{alarmTime:"desc"}}));if(a.status===200)if(t.status===200){const e=t.result.levels;r.alarmList=(s=a.result)==null?void 0:s.data.filter(c=>{var i;return((i=c==null?void 0:c.state)==null?void 0:i.value)==="warning"}).map(c=>{var i;return{...c,levelName:(i=e.find(_=>_.level===c.level))==null?void 0:i.title}})}else r.alarmList=(u=a.result)==null?void 0:u.data.filter(e=>{var c;return((c=e==null?void 0:e.state)==null?void 0:c.value)==="warning"})})();const z=t=>{n.startTime=t.start,n.endTime=t.end,j()},j=()=>{let t="1m",o="M月dd日 HH:mm",a=12;const s=n.endTime-n.startTime,u=60*60*1e3,e=u*24,c=e*30,i=365*e;s<=u+10?(a=60,o="HH:mm"):s>u&&s<=e?(t="1h",a=24):s>e&&s<i?(a=Math.abs(Math.ceil(s/e))+1,t="1d",o="M月dd日 HH:mm:ss"):s>=i&&(a=Math.abs(Math.floor(s/c)),t="1M",o="yyyy年-M月");const _={dashboard:"alarm",object:"record",measurement:"trend",dimension:"agg",group:"alarmTrend",params:{targetType:n.targetType,format:o,time:t,limit:a,from:h(n.startTime).format("YYYY-MM-DD HH:mm:ss"),to:h(n.endTime).format("YYYY-MM-DD HH:mm:ss")}},I={dashboard:"alarm",object:"record",measurement:"rank",dimension:"agg",group:"alarmRank",params:{time:t,targetType:n.targetType,from:h(n.startTime).format("YYYY-MM-DD HH:mm:ss"),to:h(n.endTime).format("YYYY-MM-DD HH:mm:ss"),limit:9}};let T="其它";n.targetType==="device"?T="设备":n.targetType==="product"?T="产品":n.targetType==="org"&&(T="组织"),J([_,I]).then(w=>{var L;if(w.status==200){const B=[],S=[];w.result.filter(m=>m.group==="alarmTrend").forEach(m=>{t==="1d"&&(m.data.timeString=m.data.timeString.split(" ")[0]),B.push(m.data.timeString),S.push(m.data.value)});const F=JSON.parse(JSON.stringify(S));if(F&&F.length>0){const m=F.sort((y,k)=>k-y)[0];A.value={xAxis:{type:"category",boundaryGap:!1,data:B.reverse()},yAxis:{type:"value"},tooltip:{trigger:"axis"},grid:{top:"2%",bottom:"5%",left:m<1e3?50:m.toString().length*10,right:"48px"},series:[{name:T,data:S.reverse(),type:"line",smooth:!0,color:"#ADC6FF",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#ADC6FF"},{offset:1,color:"#FFFFFF"}],global:!1}}}]}}else console.log("data is empty ");r.ranking=(L=w.result)==null?void 0:L.filter(m=>{var y,k;return m.group==="alarmRank"&&((k=(y=m.data)==null?void 0:y.value)==null?void 0:k.count)!==0}).map(m=>{var y;return(y=m.data)==null?void 0:y.value}).sort((m,y)=>y.count-m.count)}})},Z=t=>{switch(n.targetType){case"device":M.jumpPage("device/Instance/Detail",{id:t});break;case"product":M.jumpPage("device/Product/Detail",{id:t});break;case"org":M.jumpPage("system/Department",{},{id:t});break;case"other":me({terms:[{column:"id",termType:"eq",value:t}]}).then(o=>{var a,s;if(o.success&&((a=o.result)!=null&&a.data))if((s=o.result)!=null&&s.total){const u=o.result.data[0];M.jumpPage("rule-engine/Scene/Save",{},{triggerType:u.trigger.type,id:t})}else ee("数据已经删除","error")});break}};return(t,o)=>{const a=te,s=ae,u=se,e=N,c=de("page-container");return b(),ue(c,null,{default:g(()=>[f("div",ve,[d(s,{gutter:24},{default:g(()=>[d(a,{span:6},{default:g(()=>[d(P,{title:"今日告警",value:l(r).today,footer:l(H)},{default:g(()=>[d(O,{options:l(r).fifteenOptions},null,8,["options"])]),_:1},8,["value","footer"])]),_:1}),d(a,{span:6},{default:g(()=>[d(P,{title:"告警配置",value:l(r).config,footer:l(D),img:l(E)("/device/device-number.png")},null,8,["value","footer","img"])]),_:1}),d(a,{span:12},{default:g(()=>[d(re,{"alarm-list":l(r).alarmList},null,8,["alarm-list"])]),_:1})]),_:1}),d(s,{gutter:24},{default:g(()=>[d(a,{span:24},{default:g(()=>[f("div",be,[d(ne,null,{title:g(()=>[Me,d(u,{style:{width:"40%"},value:l(n).targetType,"onUpdate:value":o[0]||(o[0]=i=>l(n).targetType=i),options:l(W)?l($):l(G),onChange:j},null,8,["value","options"])]),extra:g(()=>[d(le,{key:"flow-static",type:"week",quickBtnList:[{label:"最近1小时",value:"hour"},{label:"最近24小时",value:"day"},{label:"近一周",value:"week"}],onChange:z})]),_:1}),f("div",Te,[f("div",ke,[d(O,{options:l(A)},null,8,["options"])]),f("div",xe,[Ce,l(r).ranking.length?(b(),x("ul",De,[(b(!0),x(pe,null,ge(l(r).ranking,(i,_)=>(b(),x("li",{key:i.targetId,style:{cursor:"pointer"},onClick:I=>Z(i.targetId)},[f("img",{src:l(E)(`/rule-engine/dashboard/ranking/${_+1}.png`),alt:""},null,8,Se),f("span",{class:"rankingItemTitle",title:i.targetName},q(i.targetName),9,Fe),f("span",Ye,q(i.count),1)],8,we))),128))])):(b(),x("div",He,[d(e,{image:l(N).PRESENTED_IMAGE_SIMPLE},null,8,["image"])]))])])])]),_:1})]),_:1})])]),_:1})}}});const Qe=oe(Ae,[["__scopeId","data-v-185fdf45"]]);export{Qe as default};
