import{F as q,o as te,I as oe,v as se,a0 as le,a6 as ne,a7 as re,$ as ie,Z as ue,d as de,a9 as pe,a1 as ce,dB as me,aa as fe,g as _e}from"./index-1730252110824.js";import ve from"./FileUpload-1730252110824.js";import{v as ge,s as be,u as he}from"./firmware-1730252110824.js";import{d as ye,k as b,r as F,w as L,ab as we,U as j,V as xe,X as o,f as e,u as t,W as c,a9 as Oe,aa as Ve,E as B,G as Ce,a4 as Ue,Z as E,F as Pe,a1 as je,J as ke}from"./vue-1730252110824.js";const Ie=ye({__name:"index",props:{data:{type:Object,default:()=>{}},productOptions:{type:Array,default:[]}},emits:["change"],setup(C,{emit:k}){const d=C,I=b(),m=F({properties:[]}),J=i=>{let a=m.properties.indexOf(i);a!==-1&&m.properties.splice(a,1)},S=()=>{m.properties.push({id:"",value:"",keyid:Date.now()})},h=b(!1),A=b(!1),z=q.useForm,U=d.data.id,D=d.data.versionOrder,N=d.data.sign,K=d.data.url,l=b({name:"",productId:void 0,version:"",versionOrder:"",signMethod:void 0,sign:"",url:"",properties:[],description:""}),f=b({}),T=async(i,a)=>{const{signMethod:r,url:s}=l.value;if(U&&N===a&&K===s)return Promise.resolve();if(a&&r&&s&&f.value)return f.value[r]!==a?Promise.reject("签名不一致，请检查文件是否上传正确"):Promise.resolve()},Y=async(i,a)=>{if(U&&D===a)return Promise.resolve();{const{signMethod:r,productId:s}=l.value;if(a&&r&&s){const u=await ge(s,a);if(u.status===200)return u.result?Promise.reject("版本序号已存在"):Promise.resolve()}}},Z=async(i,a)=>a?d.productOptions.find(s=>s.value===a)?Promise.resolve():Promise.reject("当前产品不存在，请选择产品"):Promise.resolve(),$=async(i,a)=>new Promise(async(r,s)=>/^[1-9]\d*$/.test(a.toString())?r(""):s("请输入1~99999之间的正整数")),{resetFields:Re,validate:R,validateInfos:p}=z(l,F({name:[{required:!0,message:"请输入名称"},{max:64,message:"最多可输入64个字符"}],productId:[{required:!0,message:"请选择所属产品"},{validator:Z,trigger:"blur"}],version:[{required:!0,message:"请输入版本号"},{max:64,message:"最多可输入64个字符",trigger:"change"}],versionOrder:[{required:!0,message:"请输入版本序号"},{validator:Y,trigger:"blur"},{validator:$,trigger:"change"}],signMethod:[{required:!0,message:"请选择签名方式"}],sign:[{required:!0,message:"请输入签名"},{validator:T}],url:[{required:!0,message:"请上传文件"}],description:[{max:200,message:"最多可输入200个字符"}]})),M=(i,a)=>a.label.toLowerCase().indexOf(i.toLowerCase())>=0,G=async()=>{var a;const{properties:i}=await((a=I.value)==null?void 0:a.validate());R().then(async r=>{var x,O,V;const s=d.productOptions.find(v=>(v==null?void 0:v.value)===r.productId),u=(s==null?void 0:s.label)||((x=d.data)==null?void 0:x.url),y=((O=f.value)==null?void 0:O.length)||((V=d.data)==null?void 0:V.size),w={...ke(l.value),properties:i||[],productName:u,size:y};h.value=!0;const _=U?await he({...d.data,...w}).catch(()=>{}):await be(w).catch(()=>{});(_==null?void 0:_.status)===200&&(te("操作成功","success"),k("change",!0)),h.value=!1}).catch(r=>{h.value=!1})},H=()=>{k("change",!1)},Q=()=>{l.value.sign="",l.value.url=""};return L(()=>d.data,i=>{i.id&&(l.value=i,m.properties=i.properties)},{immediate:!0,deep:!0}),L(()=>f.value,()=>R("sign"),{deep:!0}),(i,a)=>{const r=oe,s=se,u=le,y=ne,w=re,_=we("AIcon"),x=ie,O=ue,V=de,v=q,W=pe,X=ce,ee=me,ae=fe;return j(),xe(ae,{title:C.data.id?"编辑":"新增","ok-text":"确认","cancel-text":"取消",visible:!0,width:"700px","confirm-loading":t(h),maskClosable:!1,onCancel:H,onOk:G},{default:o(()=>[e(ee,{spinning:t(A)},{default:o(()=>[e(v,{class:"form",layout:"vertical",model:t(l),name:"basic",autocomplete:"off"},{default:o(()=>[e(X,{gutter:[24,0]},{default:o(()=>[e(u,{span:24},{default:o(()=>[e(s,c({label:"名称"},t(p).name),{default:o(()=>[e(r,{placeholder:"请输入名称",value:t(l).name,"onUpdate:value":a[0]||(a[0]=n=>t(l).name=n)},null,8,["value"])]),_:1},16)]),_:1}),e(u,{span:24},{default:o(()=>[e(s,c({label:"所属产品"},t(p).productId),{default:o(()=>[e(y,{value:t(l).productId,"onUpdate:value":a[1]||(a[1]=n=>t(l).productId=n),options:C.productOptions,placeholder:"请选择所属产品",allowClear:"","show-search":"","filter-option":M},null,8,["value","options"])]),_:1},16)]),_:1}),e(u,{span:12},{default:o(()=>[e(s,c({label:"版本号"},t(p).version),{default:o(()=>[e(r,{placeholder:"请输入版本号",value:t(l).version,"onUpdate:value":a[2]||(a[2]=n=>t(l).version=n)},null,8,["value"])]),_:1},16)]),_:1}),e(u,{span:12},{default:o(()=>[e(s,c({label:"版本序号"},t(p).versionOrder),{default:o(()=>[e(w,{placeholder:"请输入版本序号",style:{width:"100%"},min:1,max:99999,value:t(l).versionOrder,"onUpdate:value":a[3]||(a[3]=n=>t(l).versionOrder=n)},null,8,["value"])]),_:1},16)]),_:1}),e(u,{span:12},{default:o(()=>[e(s,c({label:"签名方式"},t(p).signMethod),{default:o(()=>[e(y,{value:t(l).signMethod,"onUpdate:value":a[4]||(a[4]=n=>t(l).signMethod=n),options:[{label:"MD5",value:"md5"},{label:"SHA256",value:"sha256"}],placeholder:"请选择签名方式",allowClear:"","show-search":"","filter-option":M,onChange:Q},null,8,["value"])]),_:1},16)]),_:1}),e(u,{span:12},{default:o(()=>[e(s,Oe(Ve(t(p).sign)),{label:o(()=>[B(" 签名 "),e(x,{title:"请输入本地文件进行签名加密后的值"},{default:o(()=>[e(_,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})]),default:o(()=>[e(r,{placeholder:"请输入签名",value:t(l).sign,"onUpdate:value":a[5]||(a[5]=n=>t(l).sign=n)},null,8,["value"])]),_:1},16)]),_:1}),e(u,{span:24},{default:o(()=>[e(s,c({label:"固件上传"},t(p).url),{default:o(()=>[e(ve,{modelValue:t(l).url,"onUpdate:modelValue":a[6]||(a[6]=n=>t(l).url=n),extraValue:t(f),"onUpdate:extraValue":a[7]||(a[7]=n=>Ce(f)?f.value=n:null)},null,8,["modelValue","extraValue"])]),_:1},16)]),_:1}),e(u,{span:24},{default:o(()=>[e(s,c({label:"其他配置"},t(p).properties),{default:o(()=>[e(v,{class:Ue(t(m).properties.length!==0&&"formRef"),ref_key:"formRef",ref:I,name:"dynamic_form_nest_item",model:t(m)},{default:o(()=>[(j(!0),E(Pe,null,je(t(m).properties,(n,g)=>(j(),E("div",{class:"formRef-content",key:n.keyid},[e(s,{label:g===0&&"Key",class:"formRef-form-item",name:["properties",g,"id"],rules:{required:!0,message:"请输入KEY"}},{default:o(()=>[e(r,{value:n.id,"onUpdate:value":P=>n.id=P,placeholder:"请输入KEY"},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name"]),e(s,{label:g===0&&"Value",class:"formRef-form-item",name:["properties",g,"value"],rules:{required:!0,message:"请输入VALUE"}},{default:o(()=>[e(r,{value:n.value,"onUpdate:value":P=>n.value=P,placeholder:"请输入VALUE"},null,8,["value","onUpdate:value"])]),_:2},1032,["label","name"]),e(s,{label:g===0&&"操作",class:"formRef-form-item",style:{width:"10%"}},{default:o(()=>[e(O,{type:"text",popConfirm:{title:"确认删除吗？",onConfirm:()=>J(n)}},{default:o(()=>[e(_,{type:"DeleteOutlined"})]),_:2},1032,["popConfirm"])]),_:2},1032,["label"])]))),128)),e(s,{class:"formRef-form-item-add"},{default:o(()=>[e(V,{type:"dashed",block:"",onClick:S},{default:o(()=>[e(_,{type:"PlusOutlined"}),B(" 添加 ")]),_:1})]),_:1})]),_:1},8,["class","model"])]),_:1},16)]),_:1}),e(u,{span:24},{default:o(()=>[e(s,c({label:"说明"},t(p).description),{default:o(()=>[e(W,{placeholder:"请输入说明",value:t(l).description,"onUpdate:value":a[8]||(a[8]=n=>t(l).description=n),maxlength:200,rows:3,showCount:""},null,8,["value"])]),_:1},16)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["spinning"])]),_:1},8,["title","confirm-loading"])}}});const Be=_e(Ie,[["__scopeId","data-v-67d9bd6b"]]);export{Be as default};
