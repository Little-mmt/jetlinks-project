import{ej as N,o as y,ef as O,dg as T,aI as V,d as J,aO as K,dP as U,dQ as $,A as z,aa as Q,g as R}from"./index-1730252110824.js";import"./index-1730252110824301.js";import"./index-1730252110824288.js";import"./index-1730252110824281.js";import{u as X}from"./instance-1730252110824.js";import{d as q,k as p,s as F,ab as G,U as H,V as W,X as o,_ as h,f as c,u as l,E as b,$ as Y,af as Z,ag as ee}from"./vue-1730252110824.js";const te=r=>(Z("data-v-723654b4"),r=r(),ee(),r),ae={class:"map-tree"},ne=te(()=>h("div",{class:"map-tree-top"}," 采集器的点位名称与属性名称一致时将自动映射绑定；有多个采集器点位名称与属性名称一致时以第1个采集器的点位数据进行绑定 ",-1)),se={class:"map-tree-content"},oe={style:{width:"100px"}},ce=q({__name:"PatchMapping",props:{type:{type:String,default:"MODBUS_TCP"},metaData:{type:Array,default:()=>[]},deviceId:{type:String,default:""}},emits:["close","save"],setup(r,{emit:I}){const i=r,S=X(),f=p([]),_=p([]),s=p([]),k=p([]),v=p(!1),m=(a,n,t)=>(a.forEach(e=>{e.key=e.id,e.title=e.name,e.checkable=n==="collectors",t&&(e.provider=t),e.collectors&&Array.isArray(e.collectors)&&e.collectors.length&&(e.children=m(e.collectors,"collectors",e.provider)),e.points&&Array.isArray(e.points)&&e.points.length&&(e.children=m(e.points,"points"))}),a),x=async()=>{v.value=!0;const a=await N({});v.value=!1,a.status===200&&(k.value=m(a.result,"channel"))},A=(a,n)=>{f.value=[...a],_.value=(n==null?void 0:n.checkedNodes)||[]},M=()=>{s.value=_.value},j=a=>{const n=s.value.findIndex(t=>t.key===a);s.value.splice(n,1),f.value=s.value.map(t=>t.key),_.value=s.value},w=async()=>{if(!s.value.length)y("请选择采集器","warning");else{const a=[];s.value.forEach(t=>{const e=(t.children||[]).map(d=>{var u;return{channelId:t.parentId,collectorId:d.collectorId,pointId:d.id,metadataType:"property",metadataId:(u=i.metaData.find(g=>g.name===d.name))==null?void 0:u.metadataId,provider:t.provider,state:S.current.state.value=="notActive"?"disabled":null}});a.push(...e)});const n=a.filter(t=>!!t.metadataId);n&&n.length!==0?(await O(i.deviceId,i.type,n)).status===200&&(y("操作成功"),I("save")):y("暂无对应属性的映射","error")}},D=()=>{I("close")};return F(()=>{i.type&&x()}),(a,n)=>{const t=T,e=V,d=J,u=G("AIcon"),g=K,P=U,B=$,L=z,E=Q;return H(),W(E,{width:"900px",title:"批量映射",visible:"",onOk:w,onCancel:D},{default:o(()=>[h("div",ae,[ne,c(L,{spinning:l(v)},{default:o(()=>[h("div",se,[c(e,{class:"map-tree-content-card",title:"源数据"},{default:o(()=>[c(t,{checkable:"",height:300,"tree-data":l(k),checkedKeys:l(f),onCheck:A},null,8,["tree-data","checkedKeys"])]),_:1}),h("div",oe,[c(d,{disabled:l(s).length>=l(_).length,onClick:M},{default:o(()=>[b("加入右侧")]),_:1},8,["disabled"])]),c(e,{class:"map-tree-content-card",title:"采集器"},{default:o(()=>[c(B,{size:"small","data-source":l(s),class:"map-tree-content-card-list"},{renderItem:o(({item:C})=>[c(P,null,{actions:o(()=>[c(g,{title:"确认删除？",onConfirm:()=>j(C.key)},{default:o(()=>[c(u,{type:"DeleteOutlined"})]),_:2},1032,["onConfirm"])]),default:o(()=>[b(Y(C.title)+" ",1)]),_:2},1024)]),_:1},8,["data-source"])]),_:1})])]),_:1},8,["spinning"])])]),_:1})}}});const ue=R(ce,[["__scopeId","data-v-723654b4"]]);export{ue as default};
