import{fy as C,a6 as D,v as F,a0 as S,a1 as b,F as q}from"./index-1730252110824.js";import"./index.vue_vue_type_script_setup_true_name_Timer_lang-1730252110824.js";import"./TopCard.vue_vue_type_style_index_0_scoped_47c4fbf1_lang-1730252110824.js";import"./TriggerWay.vue_vue_type_style_index_0_scoped_1bb0f74d_lang-1730252110824.js";import{_ as N}from"./FunctionCall.vue_vue_type_script_setup_true_name_FunctionCall_lang-1730252110824.js";import{d as g,k as O,r as U,e as $,U as A,V as B,X as d,f,u as s,E as J}from"./vue-1730252110824.js";const E=g({name:"InvokeFunction"}),K=g({...E,props:{functionId:{type:String,default:void 0},functionParameters:{type:Array,default:()=>[]},action:{type:String,default:""},functions:{type:Array,default:()=>[]}},emits:["update:functionParameters","update:functionId","update:action"],setup(v,{expose:x,emit:m}){const r=v,h=O(),e=U({functionId:r.functionId,functionData:r.functionParameters}),w=n=>{var c;const t=n==null?void 0:n.type;return t==="boolean"?[{label:(n==null?void 0:n.falseText)||"是",value:(n==null?void 0:n.falseValue)||!1},{label:(n==null?void 0:n.trueText)||"否",value:(n==null?void 0:n.trueValue)||!0}]:t==="enum"?(c=n==null?void 0:n.elements)==null?void 0:c.map(a=>({...a,label:a.text})):n==null?void 0:n.elements},P=$(()=>{var c,a,o,i,_;const n=r.functions.find(u=>u.id===e.functionId),t=[];if(n){const u=((c=n.input)==null?void 0:c.properties)||n.inputs;for(const l of u)t.push({id:l.id,name:l.name,type:((a=l.valueType)==null?void 0:a.type)||"-",type:((o=l.valueType)==null?void 0:o.type)||"-",format:((i=l.valueType)==null?void 0:i.format)||void 0,options:w(l.valueType),value:void 0,required:(_=l.expands)==null?void 0:_.required})}return t}),I=[{validator(n,t){const c=P.value.filter(a=>a==null?void 0:a.required);if(c.length)if(t!=null&&t.length){let a=t.find(o=>o.value===void 0);if(a){const o=c.find(i=>i.id===a.name);return Promise.reject(o!=null&&o.name?`请输入${o==null?void 0:o.name}值`:"请输入功能值")}}else return Promise.reject("请输入功能值");return Promise.resolve()}}],j=(n,t)=>{e.functionData=[],m("update:action",`执行${t.name}`),m("update:functionId",n),m("update:functionParameters",[])},k=n=>{m("update:functionParameters",n)};return x({validateFields:()=>new Promise(async n=>{var c;const t=await((c=h.value)==null?void 0:c.validateFields());n(t)})}),(n,t)=>{const c=D,a=F,o=S,i=b,_=q;return A(),B(_,{ref_key:"invokeForm",ref:h,model:s(e),layout:"vertical",colon:!1},{default:d(()=>[f(i,{gutter:24},{default:d(()=>[f(o,{span:10},{default:d(()=>[f(a,{name:"functionId",rules:[{required:!0,message:"请选择功能"}]},{default:d(()=>[f(c,{showSearch:"",allowClear:"",value:s(e).functionId,"onUpdate:value":t[0]||(t[0]=u=>s(e).functionId=u),style:{width:"100%"},placeholder:"请选择功能",options:v.functions,filterOption:s(C),onSelect:j},null,8,["value","options","filterOption"])]),_:1})]),_:1}),f(o,{span:14},{default:d(()=>[f(a,null,{default:d(()=>[J("定时调用所选功能")]),_:1})]),_:1}),f(o,{span:24},{default:d(()=>[f(a,{name:"functionData",rules:I},{default:d(()=>[f(s(N),{value:s(e).functionData,"onUpdate:value":t[1]||(t[1]=u=>s(e).functionData=u),data:s(P),onChange:k},null,8,["value","data"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])}}});export{K as _};
