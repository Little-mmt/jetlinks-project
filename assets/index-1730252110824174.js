import{X as M,h as X,o as N,Z,a0 as Q,a1 as U,a2 as W,ds as Y,e as G,a3 as H}from"./index-1730252110824.js";import"./index-1730252110824278.js";import"./index-1730252110824279.js";import"./index-1730252110824280.js";import"./index-1730252110824281.js";import"./index-1730252110824282.js";import"./index-1730252110824283.js";import{d as C}from"./device-17302521108243.js";import{p as O,P as K}from"./const-1730252110824.js";import{e as ee}from"./encodeQuery-1730252110824.js";import te from"./index-1730252110824173.js";import{d as ne,k as f,ab as v,U as _,V as k,X as n,f as o,u as m,E as y,W as ae,R as oe,_ as l,$ as d,Z as T,F as V,a1 as ie,Y as se}from"./vue-1730252110824.js";import"./index-1730252110824299.js";import"./index-1730252110824300.js";const le=["src"],re={style:{"font-size":"16px","font-weight":"700"}},de=l("div",{class:"card-item-content-text"}," 厂商 ",-1),ce=l("div",{class:"card-item-content-text"}," 通道数量 ",-1),ue=l("div",{class:"card-item-content-text"}," 型号 ",-1),pe=l("div",{class:"card-item-content-text"}," 接入方式 ",-1),Ne=ne({__name:"index",setup(me){const h=M(),b=f({}),I=f({}),g=f(!1),w=f(),S=[{title:"ID",dataIndex:"id",key:"id",width:200,fixed:"left",search:{type:"string"},ellipsis:!0},{title:"名称",dataIndex:"name",key:"name",search:{type:"string",first:!0},ellipsis:!0},{title:"接入方式",dataIndex:"provider",key:"provider",scopedSlots:!0,width:120,search:{type:"select",options:K,handleValue:e=>e}},{title:"通道数量",dataIndex:"channelNumber",key:"channelNumber",scopedSlots:!0,width:100},{title:"厂商",dataIndex:"manufacturer",key:"manufacturer",ellipsis:!0},{title:"产品名称",dataIndex:"productId",key:"productId",scopedSlots:!0,ellipsis:!0,search:{type:"select",options:async()=>x.value,handleValue:e=>e}},{title:"状态",dataIndex:"state",key:"state",scopedSlots:!0,width:100,search:{type:"select",options:[{label:"禁用",value:"notActive"},{label:"离线",value:"offline"},{label:"在线",value:"online"}],handleValue:e=>e}},{title:"操作",key:"action",fixed:"right",width:200,scopedSlots:!0}],j=e=>{I.value=e},B=()=>{h.jumpPage("media/Device/Save",{id:":id"})},D=(e,s)=>{if(!e)return[];const u=[{key:"update",text:"编辑",tooltip:{title:"编辑"},icon:"EditOutlined",onClick:()=>{h.jumpPage("media/Device/Save",{},{id:e.id})}},{key:"view",text:"查看通道",tooltip:{title:"查看通道"},icon:"PartitionOutlined",onClick:()=>{h.jumpPage("media/Device/Channel",{},{id:e.id,type:e.provider})}},{key:"viewDevice",text:"查看",tooltip:{title:"查看"},icon:"EyeOutlined",onClick:()=>{h.jumpPage("device/Instance/Detail",{id:e.id})}},{key:"delete",text:"删除",tooltip:{title:e.state.value==="online"?"在线设备无法删除":"删除"},disabled:e.state.value==="online",popConfirm:{title:"确认删除?",onConfirm:()=>{const i=C.del(e.id);return i.then(r=>{var p;r.status===200?(N("操作成功！"),(p=b.value)==null||p.reload()):N("操作失败！","error")}),i}},icon:"DeleteOutlined"}];let c=[];if(s==="card"){const i=u.filter(r=>r.key!=="viewDevice");c=e.provider==="fixed-media"?i.filter(r=>r.key!=="updateChannel"):i}else c=e.provider==="fixed-media"?u.filter(i=>i.key!=="updateChannel"):u;return c},x=f([]);(()=>{C.getProductList(ee({terms:{messageProtocol$in:["gb28181-2016","fixed-media","onvif","media-plugin"]}})).then(e=>{x.value=e.result.map(s=>({label:s.name,value:s.id}))})})();const A=e=>{var s;return(s=x.value.find(u=>u.value===e))==null?void 0:s.label},E=e=>{g.value=!0,w.value=e.id};return(e,s)=>{const u=v("pro-search"),c=v("AIcon"),i=Z,r=v("Ellipsis"),p=Q,R=U,J=W,L=Y,F=G,$=H,q=v("FullPage"),z=v("page-container");return _(),k(z,null,{default:n(()=>[o(u,{columns:S,target:"notice-config",onSearch:j}),o(q,null,{default:n(()=>[o($,{ref_key:"listRef",ref:b,columns:S,request:m(C).list,defaultParams:{sorts:[{name:"createTime",order:"desc"}]},params:m(I)},{headerTitle:n(()=>[o(i,{type:"primary",onClick:B,hasPermission:"media/Device:add"},{icon:n(()=>[o(c,{type:"PlusOutlined"})]),default:n(()=>[y(" 新增 ")]),_:1})]),card:n(a=>[o(J,ae({onClick:()=>E(a),value:a,actions:D(a,"card")},a,{showStatus:!0,status:a.state.value,statusText:a.state.text,statusNames:{online:"processing",offline:"error"}}),{img:n(()=>[oe(e.$slots,"img",{},()=>[l("img",{src:m(X)("/device-media.png")},null,8,le)])]),content:n(()=>[o(r,{style:{width:"calc(100% - 100px)"}},{default:n(()=>[l("span",re,d(a.name),1)]),_:2},1024),o(R,null,{default:n(()=>[o(p,{span:12},{default:n(()=>[de,o(r,{style:{width:"calc(100% - 20px)"}},{default:n(()=>[l("div",null,d(a.manufacturer),1)]),_:2},1024)]),_:2},1024),o(p,{span:12},{default:n(()=>[ce,l("div",null,d(a.channelNumber),1)]),_:2},1024),o(p,{span:12},{default:n(()=>[ue,o(r,{style:{width:"calc(100% - 20px)"}},{default:n(()=>[y(d(a.model),1)]),_:2},1024)]),_:2},1024),o(p,{span:12},{default:n(()=>[pe,l("div",null,d(m(O)[a.provider]),1)]),_:2},1024)]),_:2},1024)]),actions:n(t=>[o(i,{disabled:t.disabled,popConfirm:t.popConfirm,tooltip:{...t.tooltip},onClick:t.onClick,hasPermission:"media/Device:"+(t.key!=="updateChannel"?t.key:"update")},{default:n(()=>[t.key==="delete"?(_(),k(c,{key:0,type:"DeleteOutlined"})):(_(),T(V,{key:1},[o(c,{type:t.icon},null,8,["type"]),l("span",null,d(t==null?void 0:t.text),1)],64))]),_:2},1032,["disabled","popConfirm","tooltip","onClick","hasPermission"])]),_:2},1040,["onClick","value","actions","status","statusText"])]),channelNumber:n(a=>[y(d(a.channelNumber||0),1)]),provider:n(a=>[y(d(m(O)[a.provider]),1)]),productId:n(a=>[y(d(A(a.productId)),1)]),state:n(a=>{var t,P;return[o(L,{text:(t=a.state)==null?void 0:t.text,status:((P=a.state)==null?void 0:P.value)==="online"?"success":"error"},null,8,["text","status"])]}),action:n(a=>[o(F,{size:16},{default:n(()=>[(_(!0),T(V,null,ie(D(a,"table"),t=>(_(),k(i,{key:t.key,danger:t.key==="delete",disabled:t.disabled,popConfirm:t.popConfirm,tooltip:{...t.tooltip},onClick:t.onClick,type:"link",style:{padding:"0px"},hasPermission:"media/Device:"+(t.key!=="updateChannel"&&t.key!=="viewDevice"?t.key:"update")},{icon:n(()=>[o(c,{type:t.icon},null,8,["type"])]),_:2},1032,["danger","disabled","popConfirm","tooltip","onClick","hasPermission"]))),128))]),_:2},1024)]),_:3},8,["request","params"])]),_:3}),m(g)?(_(),k(te,{key:0,deviceId:m(w),onCloseDrawer:s[0]||(s[0]=a=>g.value=!1)},null,8,["deviceId"])):se("",!0)]),_:3})}}});export{Ne as default};
