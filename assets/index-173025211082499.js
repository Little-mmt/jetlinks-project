import{a5 as X,ac as Y,C as Z,$ as G,J as H,A as R,y as W,af as ee,ea as ae,eo as se,g as te}from"./index-1730252110824.js";import"./index-1730252110824280.js";import{g as ne,a as ce}from"./accessConfig-1730252110824.js";import{d as N,k as u,r as le,w as ie,o as oe,ab as de,U as d,Z as y,f as k,X as g,_ as o,u as s,V as m,Y as I,E as z,F as $,a1 as ue,a4 as E,$ as S}from"./vue-1730252110824.js";const re={class:"inkling-device"},pe={class:"search-box"},_e={class:"search-warp"},ve={key:0,class:"multiple"},ge={class:"device-list-warp"},he={class:"device-list-items"},fe=["onClick"],me={class:"item-title"},ye={class:"title-name no-tooltip"},ke={class:"title-id"},xe=["onClick"],Ie={class:"item-title"},Se={class:"title-name"},Ce={class:"title-id"},we={class:"device-list-pagination"},ze=N({name:"InklingDevice"}),be=N({...ze,props:{value:{type:[String,Array],default:void 0},accessId:{type:String,default:void 0},multiple:{type:Boolean,default:!1},pluginId:{type:String,default:void 0},type:{type:String,default:"device"},internalId:{type:String,default:void 0}},emits:["update:value","change"],setup(b,{emit:r}){const h=b,C=u(!0),P=u(!1),x=u([]),f=u([]),l=u([]),v=u(new Map),D=u(!1),n=le({pageSize:10,pageIndex:0,total:0}),j=u({terms:[]}),B=u([]),M=e=>new Promise(async t=>{var i;if(!e.length){t(!0);return}const a=await se(e,h.accessId);a&&(f.value=((i=a.result)==null?void 0:i.map(p=>p.externalId))||[]),t(!0)}),w=async()=>{var t,a,i;const e=await ce(h.accessId,{pageIndex:n.pageIndex,pageSize:n.pageSize,terms:j.value.terms}).catch(()=>({success:!1}));e.success&&(await M(((t=e.result)==null?void 0:t.data.map(p=>p.id))||[]),x.value=((a=e.result)==null?void 0:a.data)||[],n.total=((i=e.result)==null?void 0:i.total)||0)},T=e=>{if(e.target.checked){const t=x.value.filter(a=>{const i=!l.value.includes(a.id)&&!f.value.includes(a.id);return i&&!v.value.has(a.id)&&v.value.set(a.id,a),i}).map(a=>a.id);l.value=[...l.value,...t],r("update:value",l.value),r("change",[...v.value.values()])}else v.value.clear(),l.value=[],r("update:value",[]),r("change",[])},F=e=>{n.pageIndex=0,j.value=e,w()},K=(e,t)=>{n.pageSize=t,n.pageIndex=e-1,w()},V=async()=>{var e,t,a;if(h.accessId){const i=await ne(h.accessId);if(i.success&&((e=i.result)!=null&&e.length)){const p=i.result.find(_=>_.id==="QueryDevicePage");p&&(D.value=!0,B.value=(a=(t=p.expands)==null?void 0:t.terms)==null?void 0:a.map(_=>({title:_.name,dataIndex:_.id,search:{type:_.valueType.type}})))}C.value=!1,await w()}},L=(e,t)=>{if(t.disabled||f.value.includes(e))return;const a=new Set(l.value);h.multiple?(a.has(e)?(a.delete(e),v.value.delete(e)):(v.value.set(e,t),a.add(e)),l.value=[...a.values()],r("update:value",l.value),r("change",[...v.value.values()])):(l.value=[e],r("update:value",e),r("change",t))};return ie(()=>h.value,e=>{if(!e){l.value=[];return}X(e)?l.value=e:l.value=[e]},{immediate:!0,deep:!0}),oe(()=>{V()}),(e,t)=>{const a=Y,i=Z,p=G,_=H,q=de("a-icon"),A=R,O=W,Q=ee,U=ae;return d(),y("div",re,[k(A,{spinning:s(C)},{default:g(()=>[o("div",pe,[o("div",_e,[s(C)?I("",!0):(d(),m(a,{key:0,columns:s(B),type:"simple",onSearch:F,class:"device-inkling",target:"device-inkling"},null,8,["columns"]))]),b.multiple?(d(),y("div",ve,[k(i,{onChange:T},{default:g(()=>[z("全选")]),_:1})])):I("",!0)]),o("div",ge,[s(x).length?(d(),m(O,{key:0},{default:g(()=>[k(A,{spinning:s(P)},{default:g(()=>[o("div",he,[(d(!0),y($,null,ue(s(x),c=>(d(),y($,null,[s(f).includes(c.id)?(d(),m(p,{key:0,title:"该设备已绑定平台设备"},{default:g(()=>[o("div",{class:E({"device-list-item":!0,active:s(l).includes(c.id),disabled:s(f).includes(c.id)}),onClick:()=>L(c.id,c)},[o("div",me,[o("span",ye,S(c.name),1),o("span",ke," ("+S(c.id)+") ",1)])],10,fe)]),_:2},1024)):(d(),y("div",{key:1,class:E({"device-list-item":!0,active:s(l).includes(c.id),disabled:s(f).includes(c.id)}),onClick:()=>L(c.id,c)},[o("div",Ie,[o("span",Se,[k(_,null,{default:g(()=>[z(S(c.name),1)]),_:2},1024)]),o("span",Ce,[k(_,null,{default:g(()=>[z(" ("+S(c.id)+") ",1)]),_:2},1024)])]),s(l).includes(c.id)?(d(),m(q,{key:0,type:"CheckOutlined"})):I("",!0)],10,xe))],64))),256))])]),_:1},8,["spinning"])]),_:1})):(d(),m(Q,{key:1,description:"暂无数据",style:{"padding-top":"24px"}})),o("div",we,[s(D)?(d(),m(U,{key:0,total:s(n).total,current:s(n).pageIndex+1,pageSize:s(n).pageSize,"show-total":()=>{const c=s(n).pageIndex*s(n).pageSize+1,J=(s(n).pageIndex+1)*s(n).pageSize;return`第 ${c} - ${J>s(n).total?s(n).total:J} 条/总共 ${s(n).total} 条`},onChange:K},null,8,["total","current","pageSize","show-total"])):I("",!0)])])]),_:1},8,["spinning"])])}}});const Ae=te(be,[["__scopeId","data-v-6f254fea"]]);export{Ae as default};
