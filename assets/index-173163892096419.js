import{d as ne,ac as ve,k as a,o as _e,w as W,ab as ee,U as f,Z as le,f as c,u as i,G as fe,_ as ge,X as p,E as S,V as C,$ as L,Y as x}from"./vue-1731638920964.js";import{o as N,dp as he,Z as ye,dq as de,dg as Ce,af as ke,A as be,g as De}from"./index-1731638920964.js";import"./index-1731638920964281.js";import{x as Se,y as xe,z as Pe,A as Ae}from"./collector-1731638920964.js";import we from"./index-173163892096418.js";import{a as j}from"./data-17316389209642.js";import{l as v}from"./lodash.default-1731638920964.js";import"./index-1731638920964290.js";import"./index-1731638920964279.js";import"./validate-1731638920964.js";import"./regular-1731638920964.js";import"./throttle-1731638920964.js";import"./min-1731638920964.js";import"./isNil-1731638920964.js";import"./isUndefined-1731638920964.js";import"./difference-1731638920964.js";import"./flattenDeep-1731638920964.js";import"./sortBy-1731638920964.js";import"./unionBy-1731638920964.js";import"./uniqBy-1731638920964.js";import"./toLower-1731638920964.js";const Te={class:"tree-container"},Ee={class:"add-btn"},Ie=ne({name:"TreePage"}),Le=ne({...Ie,props:{data:{type:Object,default:()=>{}}},emits:["change"],setup(Ne,{emit:P}){var V;const A=(V=ve().query)==null?void 0:V.channelId,w=a(!1),t=a([]),_=a(),k=a(!1),b=a({}),T=a(),B=a([]),O=[{id:"*",name:"全部",children:[]}],g=a(v.cloneDeep(O)),E={paging:!1,sorts:[{name:"createTime",order:"desc"}],terms:A?[{terms:[{column:"channelId",value:A}],type:"and"}]:[]},m=a(),se=()=>{b.value={},k.value=!0},te=l=>{b.value=v.cloneDeep(l),k.value=!0},oe=l=>{var o;const s=(o=l==null?void 0:l.state)==null?void 0:o.value,n=Se(l==null?void 0:l.id,{state:s!=="disabled"?"disabled":"enabled",runningState:s!=="disabled"?"stopped":"running"});return n.then(u=>{if(u.status===200){h(m.value);const I=T.value.find(y=>{var D;return(y==null?void 0:y.id)===((D=t.value)==null?void 0:D[0])});P("change",I),N("操作成功","success")}}),n},ie=l=>{const s=xe(l);return s.then(n=>{n.status===200&&(t.value=[],h(m.value),N("操作成功","success"))}),s},re=l=>{k.value=!1,b.value={},l&&(h(m.value),N("操作成功","success"))},h=async l=>{var o;let s=!!A;!_.value&&!l?m.value=v.cloneDeep(E):_.value?(s=!0,m.value={...v.cloneDeep(E)},m.value.terms=[...((o=m.value)==null?void 0:o.terms)||[],{terms:[{column:"name",value:`%${_.value}%`,termType:"like"}]}]):l&&(m.value=l),w.value=!0;const n=await Pe(m.value);n.status===200&&(s?(g.value=n.result,n.result.length!==0&&t.value.length===0&&(t.value=[n.result[0].id])):(g.value=v.cloneDeep(O),g.value[0].children=n.result),T.value=n.result,t.value.length===0&&(t.value=n.result.length?["*"]:[]),setTimeout(()=>{const u=v.cloneDeep(t.value);t.value=[],t.value=u},0)),w.value=!1},ce=async()=>{const l=await Ae();B.value=l.result},ue=(l,s)=>{var n;t.value=[(n=s.node)==null?void 0:n.id]};return _e(()=>{h(v.cloneDeep(E)),ce()}),W(()=>t.value[0],(l,s)=>{const n=v.isArray(t.value)?t.value[0]:t.value;if(n)if(n!=="*"){const o=T.value.find(u=>u.id===n);P("change",o)}else P("change",{id:"*"})}),W(()=>_.value,l=>{l||setTimeout(()=>{h(l)},0)}),(l,s)=>{const n=he,o=ee("AIcon"),u=ye,I=ee("Ellipsis"),y=de,D=Ce,pe=ke,me=be;return f(),le("div",Te,[c(n,{value:i(_),"onUpdate:value":s[0]||(s[0]=d=>fe(_)?_.value=d:null),style:{"margin-bottom":"8px"},placeholder:"请输入",onSearch:h,allowClear:""},null,8,["value"]),ge("div",Ee,[c(u,{type:"primary",onClick:s[1]||(s[1]=d=>se()),hasPermission:"DataCollect/Collector:add"},{icon:p(()=>[c(o,{type:"PlusOutlined"})]),default:p(()=>[S(" 新增采集器 ")]),_:1})]),c(me,{spinning:i(w)},{default:p(()=>{var d,$,q;return[i(g).length===0||((q=($=(d=i(g))==null?void 0:d[0])==null?void 0:$.children)==null?void 0:q.length)===0?(f(),C(pe,{key:1,description:"暂无数据"})):(f(),C(D,{key:0,"tree-data":i(g),"selected-keys":i(t),fieldNames:{key:"id"},height:660,onSelect:ue,defaultExpandAll:"",showLine:{showLeafIcon:!1},"show-icon":!0},{title:p(({name:ae,data:e})=>{var M,U,J,K,R,Z,z,G,X,Y,F;return[c(I,{class:"tree-left-title"},{default:p(()=>[S(L(ae),1)]),_:2},1024),e.id!=="*"?(f(),C(y,{key:0,class:"tree-left-tag",color:i(j).get((M=e==null?void 0:e.uniformState)==null?void 0:M.value)},{default:p(()=>{var r;return[S(L((r=e==null?void 0:e.uniformState)==null?void 0:r.text),1)]}),_:2},1032,["color"])):x("",!0),e.id!=="*"?(f(),C(y,{key:1,class:"tree-left-tag2",color:((U=e==null?void 0:e.state)==null?void 0:U.value)==="disabled"?i(j).get((J=e==null?void 0:e.runningState)==null?void 0:J.value):i(j).get((K=e==null?void 0:e.state)==null?void 0:K.value)},{default:p(()=>{var r,H,Q;return[S(L(((r=e==null?void 0:e.state)==null?void 0:r.value)==="disabled"?(H=e==null?void 0:e.state)==null?void 0:H.text:(Q=e==null?void 0:e.runningState)==null?void 0:Q.text),1)]}),_:2},1032,["color"])):x("",!0),e.id!=="*"?(f(),le("span",{key:2,class:"func-btns",onClick:s[2]||(s[2]=r=>r.stopPropagation())},[c(u,{type:"link",tooltip:{title:"编辑"},onClick:r=>te(e),hasPermission:"DataCollect/Collector:update"},{default:p(()=>[c(o,{type:"EditOutlined"})]),_:2},1032,["onClick"]),c(u,{type:"link",tooltip:{title:((R=e==null?void 0:e.state)==null?void 0:R.value)==="disabled"?"启用":"禁用"},disabled:((Z=e==null?void 0:e.runningState)==null?void 0:Z.value)==="stopped"&&((z=e==null?void 0:e.state)==null?void 0:z.value)!=="disabled",hasPermission:"DataCollect/Collector:action",popConfirm:{title:((G=e==null?void 0:e.state)==null?void 0:G.value)==="disabled"?"确认启用？":"确认禁用？",onConfirm:()=>oe(e)}},{default:p(()=>{var r;return[c(o,{type:((r=e==null?void 0:e.state)==null?void 0:r.value)==="disabled"?"CheckCircleOutlined":"StopOutlined"},null,8,["type"])]}),_:2},1032,["tooltip","disabled","popConfirm"]),c(u,{type:"link",disabled:((X=e==null?void 0:e.state)==null?void 0:X.value)!=="disabled",tooltip:{title:((Y=e==null?void 0:e.state)==null?void 0:Y.value)!=="disabled"?"请先禁用，再删除":"删除"},danger:((F=e==null?void 0:e.state)==null?void 0:F.value)==="disabled",hasPermission:"DataCollect/Collector:delete",popConfirm:{title:"该操作将会删除下属点位，确定删除？",onConfirm:()=>ie(e.id)}},{default:p(()=>[c(o,{type:"DeleteOutlined"})]),_:2},1032,["disabled","tooltip","danger","popConfirm"])])):x("",!0)]}),_:1},8,["tree-data","selected-keys"]))]}),_:1},8,["spinning"]),i(k)?(f(),C(we,{key:0,channelListAll:i(B),data:i(b),onChange:re},null,8,["channelListAll","data"])):x("",!0)])}}});const nl=De(Le,[["__scopeId","data-v-8c4a3474"]]);export{nl as default};
