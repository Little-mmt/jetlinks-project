import{d as B,k as i,r as te,e as j,w as se,ab as oe,U as x,Z as C,_ as o,f as n,u as s,F as w,E as r,X as _,a0 as A,v as ae,A as le,G as h,af as ne,ag as ie}from"./vue-1731638920964.js";import{aQ as re,cC as ue,Z as D,eC as ce,eD as de,o as V,eE as pe,eF as ve,eG as _e,eH as fe,aD as me,a6 as ge,ec as ye,da as xe,I as Ce,a9 as we,eI as he,g as Ie}from"./index-1731638920964.js";import"./index-1731638920964303.js";import{u as ke}from"./instance-1731638920964.js";const J=I=>(ne("data-v-f0e47fb4"),I=I(),ie(),I),Se={class:"top"},be={class:"top-left"},Te={class:"bottom"},je={style:{width:"49.5%"}},De={class:"bottom-title"},Ve=J(()=>o("div",{class:"bottom-title-text"},"模拟输入",-1)),Je={class:"bottom-title-topic"},Oe=J(()=>o("div",{style:{"margin-right":"5px"}},"Topic:",-1)),Pe=J(()=>o("div",{style:{"margin-right":"5px"}},"URL:",-1)),Ue={style:{width:"49.5%"}},Ee=J(()=>o("div",{class:"bottom-title"},[o("div",{class:"bottom-title-text"},"运行结果")],-1)),Me={style:{"margin-top":"10px","margin-left":"10px"}},Ne=B({name:"Parsing"}),Fe=B({...Ne,setup(I){const L=`//注册设备下行数据监听器,当平台下发指令给设备时,回调将被调用,用于构造下发给设备的报文
      codec.onDownstream(function(ctx){

      });

      //注册设备上行数据监听器,当设备上行数据时,回调将被调用,用于解析设备上报的数据.
      codec.onUpstream(function(ctx){

      });
    `,E=i(null),{toggle:$}=re(E),a=ke(),O=i(""),f=i(!0),m=i(""),g=i(""),M=i([]),d=i(""),p=i({}),y=i(!1),k=i(!1),u=i(""),N=te({typescript:""}),z=j(()=>({color:f.value?"#415ed1":"#a6a6a6"})),Q=j(()=>ue(p.value.success)?{"margin-top":"10px","border-color":p.value.success?"green":"red"}:{"margin-top":"10px"}),q=(t,e)=>e.value.indexOf(t)!==-1,G=j(()=>d.value===""),P=j(()=>{var t;return p.value.success?JSON.stringify((t=p.value.outputs)==null?void 0:t[0]):p.value.reason}),K=(t,e)=>{e.languages.typescript.javascriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0,noSyntaxValidation:!1}),e.languages.typescript.javascriptDefaults.setCompilerOptions({allowJs:!0,checkJs:!0,allowNonTsExtensions:!0,target:e.languages.typescript.ScriptTarget.ESNext,strictNullChecks:!1,strictPropertyInitialization:!0,strictFunctionTypes:!0,strictBindCallApply:!0,useDefineForClassFields:!0,moduleResolution:e.languages.typescript.ModuleResolutionKind.NodeJs,module:e.languages.typescript.ModuleKind.CommonJS,typeRoots:["types"],lib:["esnext"]})},Z=async()=>{(await de(a.current.productId,a.current.id)).status===200&&(U(),V("操作成功"))},H=async()=>{var e;const t=await pe(a.current.protocol,a.current.transport);if(t.status===200){const c=(e=t.result.routes)==null?void 0:e.map(v=>({value:v.topic}));M.value=c}},X=()=>{ve(a.current.productId,a.current.id).then(t=>{t.success&&(N.typescript=t.result)})},U=async()=>{var e,c,v,S,b;const t=await _e(a.current.productId,a.current.id);if(t.status===200){const T=(c=(e=t.result)==null?void 0:e.configuration)!=null&&c.script?(S=(v=t.result)==null?void 0:v.configuration)==null?void 0:S.script:L;(b=t.result)!=null&&b.deviceId?(f.value=!1,O.value="rest",u.value=T):(f.value=!0,O.value="edit",u.value=T)}},F=async t=>{y.value=!0;const e=await he(t);e.status===200?(y.value=!1,p.value=e==null?void 0:e.result):y.value=!1},W=async()=>{const t={provider:"jsr223",configuration:{script:u.value,lang:"javascript"}};(await fe(a.current.productId,a.current.id,t)).status===200&&(V("保存成功"),U())},Y=()=>{a.current.transport==="MQTT"?g.value!==""?(F({headers:{topic:g.value},configuration:{script:u.value,lang:"javascript"},provider:"jsr223",payload:d.value}),k.value=!0):V("请输入topic","error"):m.value!==""?(F({headers:{url:m.value},provider:"jsr223",configuration:{script:u.value,lang:"javascript"},payload:d.value}),k.value=!0):V("请输入url","error")};return se(()=>{var t;return(t=a.current)==null?void 0:t.id},()=>{var t;(t=a.current)!=null&&t.id&&(U(),H(),X())},{immediate:!0}),(t,e)=>{const c=oe("AIcon"),v=me,S=ge,b=ye,T=xe,ee=Ce,R=we;return x(),C(w,null,[o("div",null,[o("div",Se,[o("div",be,[o("div",null,[n(c,{type:"ExclamationCircleOutlined"}),s(O)==="rest"?(x(),C(w,{key:0},[r(" 当前数据解析内容已脱离产品影响， "),n(D,{type:"link",hasPermission:"device/Instance:update",onClick:e[0]||(e[0]=l=>Z())},{default:_(()=>[r(" 重置 ")]),_:1}),r(" 后将继承产品数据解析内容 ")],64)):(x(),C(w,{key:1},[r(" 当前数据解析内容继承自产品, "),n(D,{type:"link",hasPermission:"device/Instance:update",onClick:e[1]||(e[1]=l=>f.value=!1),style:A(s(z))},{default:_(()=>[r(" 修改 ")]),_:1},8,["style"]),r(" 后将脱离产品影响。 ")],64))])]),o("div",null,[r(" 脚本语言: "),n(S,{defaultValue:"JavaScript",style:{width:"200px","margin-left":"5px"}},{default:_(()=>[n(v,{value:"JavaScript"},{default:_(()=>[r("JavaScript(ECMAScript 5)")]),_:1})]),_:1}),n(c,{type:"ExpandOutlined",style:{"margin-left":"20px"},onClick:s($)},null,8,["onClick"])])]),o("div",{class:"edit",ref_key:"el",ref:E},[ae(o("div",{class:"edit-only",onClick:e[2]||(e[2]=()=>{s(ce).warning({key:1,content:()=>"请点击上方修改字样,用以编辑脚本",style:{marginTop:"260px"}})})},null,512),[[le,s(f)]]),n(b,{language:"javascript",style:{height:"100%"},theme:"vs",modelValue:s(u),"onUpdate:modelValue":e[3]||(e[3]=l=>h(u)?u.value=l:null),registrationTypescript:s(N),init:K},null,8,["modelValue","registrationTypescript"])],512),o("div",Te,[o("div",je,[o("div",De,[Ve,o("div",Je,[s(a).current.transport==="MQTT"?(x(),C(w,{key:0},[Oe,n(T,{placeholder:"请输入Topic",style:{width:"300px"},options:s(M),allowClear:!0,filterOption:q,value:s(g),"onUpdate:value":e[4]||(e[4]=l=>h(g)?g.value=l:null)},null,8,["options","value"])],64)):(x(),C(w,{key:1},[Pe,n(ee,{placeholder:"请输入URL",value:s(m),"onUpdate:value":e[5]||(e[5]=l=>h(m)?m.value=l:null),style:{width:"300px"}},null,8,["value"])],64))])]),n(R,{rows:5,placeholder:"// 二进制数据以0x开头的十六进制输入，字符串数据输入原始字符串",style:{"margin-top":"10px"},value:s(d),"onUpdate:value":e[6]||(e[6]=l=>h(d)?d.value=l:null)},null,8,["value"])]),o("div",Ue,[Ee,n(R,{autoSize:{minRows:5},style:A(s(Q)),value:s(P),"onUpdate:value":e[7]||(e[7]=l=>h(P)?P.value=l:null)},null,8,["style","value"])])])]),o("div",Me,[n(D,{type:"primary",hasPermission:"device/Instance:update",loading:s(y),disabled:s(G),onClick:e[8]||(e[8]=l=>Y()),tooltip:{title:"需输入脚本和模拟数据后再点击"}},{default:_(()=>[r(" 调试 ")]),_:1},8,["loading","disabled"]),n(D,{hasPermission:"device/Instance:update",loading:s(y),disabled:!s(k),onClick:e[9]||(e[9]=l=>W()),style:{marginLeft:"10px"},tooltip:{title:s(k)?"":"请先调试"}},{default:_(()=>[r(" 保存 ")]),_:1},8,["loading","disabled","tooltip"])])],64)}}});const $e=Ie(Fe,[["__scopeId","data-v-f0e47fb4"]]);export{$e as default};
