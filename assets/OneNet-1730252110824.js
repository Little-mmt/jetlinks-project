import{d as ee,ac as ke,k as m,e as we,o as be,w as Te,ab as Oe,U as u,Z as I,f as e,X as t,F as X,a1 as Z,u as o,V as h,_ as a,E as l,$ as S,Y as O,a4 as Ne,af as Ce,ag as Ie}from"./vue-1730252110824.js";import{X as Se,h as j,aF as xe,o as Y,an as Pe,ao as je,$ as Ke,I as Ae,v as Le,a0 as Me,a1 as Be,a9 as Ee,F as He,du as Ue,ah as $e,ai as qe,dv as Je,y as We,dp as Re,Z as De,af as Fe,aH as G,d as Ve,g as ze}from"./index-1730252110824.js";import"./index-1730252110824283.js";import"./index-1730252110824284.js";import"./index-1730252110824298.js";import"./index-1730252110824286.js";import{s as Qe,u as Xe,e as Ze}from"./accessConfig-1730252110824.js";import Ye from"./index-1730252110824133.js";import{P as Ge}from"./data-17302521108246.js";import"./index-1730252110824288.js";const c=k=>(Ce("data-v-c5d3cd8e"),k=k(),Ie(),k),et={class:"steps-content"},tt={key:0,class:"steps-box"},ot={class:"alert"},at={style:{"margin-top":"42px"}},nt={class:"doc"},st=c(()=>a("h1",null,"操作指引：",-1)),lt=c(()=>a("div",null," 1、登录OneNet平台创建产品、设备，并配置HTTP的全局推送 ",-1)),it=c(()=>a("div",null," 2、获取OneNet平台的产品Key ",-1)),dt={class:"image"},rt=c(()=>a("div",null," 3、IOT端创建类型为OneNet的设备接入网关 ",-1)),ct=c(()=>a("div",null," 4、IOT端创建产品，选中接入方式为OneNet类型的设备接入网关，填写Master-APIkey（OneNet端的产品Key） ",-1)),ut={class:"image"},pt=c(()=>a("div",{class:"desc"},"填写OneNet网关相关参数",-1)),_t=c(()=>a("div",null," 5、IOT端添加设备，在设备实例页面为每一台设备设置唯一的IMEI、IMSI码（需与OneNet平台中的值一致） ",-1)),mt={class:"image"},vt=c(()=>a("h1",null,"HTTP推送配置说明",-1)),ft=c(()=>a("div",null,[l(" 1、点击"),a("b",null,"数据推送>HTTP推送>添加全局推送")],-1)),gt={class:"image"},yt=c(()=>a("div",null," 2、填写全局推送相关参数 ",-1)),ht={class:"image"},kt={style:{"word-wrap":"break-word"}},wt=c(()=>a("span",null,[l(" 开发者在OneNet物联网平台添加全局推送参数前，需要在JetLinks物联网平台添加OneNet接入网关且OneNet接入网关中的通知Token参数需要和OneNet物联网平台全局推送参数中的Token保持一致，否则OneNet物联网平台添加全局推送检验不通过，提示 "),a("span",{style:{color:"red"}},"validate fail: validate token fail.")],-1)),bt=c(()=>a("h1",null,"设备接入网关配置说明",-1)),Tt=c(()=>a("h1",null,"其他说明",-1)),Ot=c(()=>a("div",null," 1.在IOT端启用设备时，若OneNet平台没有与之对应的设备，则将在OneNet端自动创建新设备 ",-1)),Nt={class:"steps-content"},Ct={key:0,class:"steps-box"},It={class:"alert"},St={class:"search"},xt={key:0,class:"card-last"},Pt={class:"doc",style:{height:"606px"}},jt=c(()=>a("p",null," 3、添加设备，为每一台设备设置唯一的IMEI、SN、IMSI、PSK码（需与CTWingt平台中填写的值一致，若CTWing平台没有对应的设备，将会通过CTWing平台提供的LWM2M协议自动创建） ",-1)),Kt=ee({name:"AccessCloudOneNet"}),At=ee({...Kt,props:{provider:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},bindProduct:{type:Boolean,default:!1}},setup(k){const i=k,te=Se(),oe=window.location.origin,ae=j("/network/05.jpeg"),ne=j("/network/06.png"),se=j("/network/07.jpeg"),le=j("/network/08.png"),ie=j("/network/09.png"),L=ke(),de=L.query.view,K=L.params.id,E=m(),H=m(),p=m({apiAddress:i.provider.id==="OneNet"?"http://api.zj.cmcconenet.com/":"https://iot-api.heclouds.com",apiKey:"",validateToken:"",aesKey:"",description:""}),N=m({name:"",description:""}),M=m(!1),d=m(0),U=m(0),re=m(["接入配置","消息协议","完成"]),A=m([]),B=m([]),g=m(""),$=we(()=>L.query.view==="false"&&!i.bindProduct),ce=r=>{g.value=r},ue=r=>{A.value=r?B.value.filter(n=>n.name&&n.name.toLocaleLowerCase().includes(r.toLocaleLowerCase())):B.value},pe=async()=>{var w;const r=await((w=H.value)==null?void 0:w.validate());M.value=!0;const n={...r,configuration:{...p.value,protocol:g.value},protocol:g.value,provider:i.provider.id,transport:"HTTP"},_=K===":id"?await Qe(n):await Xe({...i.data,...n,id:K});_.status===200&&(Y("操作成功","success"),history.back(),window.onTabSaveSuccess&&(window.onTabSaveSuccess(_),setTimeout(()=>window.close(),300))),M.value=!1},q=async(r,n={})=>{const _=await Ze(Ge.get(r),{...n,"sorts[0].name":"createTime","sorts[0].order":"desc",paging:!1});_.status===200&&(A.value=_.result,B.value=_.result)},_e=()=>{var _;const r=(_=te.menus["link/Protocol"])==null?void 0:_.path,n=window.open(`${window.location.origin+window.location.pathname}#${r}?save=true`);n.onTabSaveSuccess=w=>{var f,C;w.success&&(g.value=(f=w.result)==null?void 0:f.id,q((C=i.provider)==null?void 0:C.id))}},me=async()=>{var r;d.value===0?(await((r=E.value)==null?void 0:r.validate()),q(i.provider.id),d.value=d.value+1):d.value===1&&(g.value?d.value=d.value+1:Y("请选择消息协议！","error"))},ve=()=>{d.value=d.value-1};return be(()=>{K!==":id"&&(p.value=i.data.configuration,g.value=i.data.protocol,N.value={name:i.data.name,description:i.data.description})}),Te(d,r=>{U.value=r},{deep:!0,immediate:!0}),(r,n)=>{const _=Pe,w=je,f=Oe("AIcon"),C=Ke,x=Ae,b=Le,v=Me,T=Be,J=Ee,W=He,P=Ue,y=$e,R=qe,fe=Je,D=We,ge=Re,F=De,ye=Fe,he=G,V=G,z=Ve;return u(),I("div",null,[e(w,{class:"steps-steps",current:o(U)},{default:t(()=>[(u(!0),I(X,null,Z(o(re),s=>(u(),h(_,{disabled:"",key:s,title:s},null,8,["title"]))),128))]),_:1},8,["current"]),a("div",et,[o(d)===0?(u(),I("div",tt,[a("div",ot,[e(f,{type:"InfoCircleOutlined"}),l(" 通过OneNet平台的HTTP推送服务进行数据接入 ")]),a("div",at,[e(T,{gutter:[24,24]},{default:t(()=>[e(v,{span:16},{default:t(()=>[e(W,{model:o(p),ref_key:"formRef1",ref:E,name:"basic",autocomplete:"off",layout:"vertical"},{default:t(()=>[e(T,{gutter:[24,24]},{default:t(()=>[e(v,{span:24},{default:t(()=>[e(b,{name:"apiAddress",rules:[{required:!0}]},{label:t(()=>[l(" 接口地址 "),e(C,{title:"同步物联网平台设备数据到OneNet"},{default:t(()=>[e(f,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})]),default:t(()=>[e(x,{value:o(p).apiAddress,"onUpdate:value":n[0]||(n[0]=s=>o(p).apiAddress=s)},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:[24,24]},{default:t(()=>[e(v,{span:24},{default:t(()=>[e(b,{label:"apiKey",name:"apiKey",rules:[{required:!0,message:"请输入apiKey"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{default:t(()=>[e(x,{value:o(p).apiKey,"onUpdate:value":n[1]||(n[1]=s=>o(p).apiKey=s),placeholder:"请输入apiKey"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:[24,24]},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(b,{name:"validateToken",rules:[{required:!0,message:"请输入通知Token"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{label:t(()=>[l(" 通知Token "),e(C,{title:"OneNet端HTTP推送配置中设置的Token"},{default:t(()=>[e(f,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})]),default:t(()=>[e(x,{value:o(p).validateToken,"onUpdate:value":n[2]||(n[2]=s=>o(p).validateToken=s),placeholder:"请输入通知Token"},null,8,["value"])]),_:1})]),_:1}),e(v,{span:12},{default:t(()=>[e(b,{name:"aesKey",rules:[{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{label:t(()=>[l(" aesKey "),e(C,{title:"OneNet端生成的消息加密key"},{default:t(()=>[e(f,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})]),default:t(()=>[e(x,{value:o(p).aesKey,"onUpdate:value":n[3]||(n[3]=s=>o(p).aesKey=s),placeholder:"请输入aesKey"},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(T,{gutter:[24,24]},{default:t(()=>[e(v,{span:24},{default:t(()=>[e(b,{label:"说明",name:"description"},{default:t(()=>[e(J,{placeholder:"请输入说明",rows:4,value:o(p).description,"onUpdate:value":n[4]||(n[4]=s=>o(p).description=s),"show-count":"",maxlength:200},null,8,["value"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(v,{span:8},{default:t(()=>[e(D,{height:"500"},{default:t(()=>[a("div",nt,[st,lt,it,a("div",dt,[e(P,{width:"100%",src:o(ae)},null,8,["src"])]),rt,ct,a("div",ut,[e(P,{width:"100%",src:o(ne)},null,8,["src"]),pt]),_t,a("div",mt,[e(P,{width:"100%",src:o(se)},null,8,["src"])]),vt,ft,a("div",gt,[e(P,{width:"100%",src:o(le)},null,8,["src"])]),yt,a("div",ht,[e(P,{width:"100%",src:o(ie)},null,8,["src"])]),e(R,{bordered:"",size:"small",column:1,labelStyle:{width:"100px"}},{default:t(()=>[e(y,{label:"参数"},{default:t(()=>[l("说明")]),_:1}),e(y,{label:"推送地址url"},{default:t(()=>[l(" 用于接收OneNet推送设备数据的物联网平台地址: "),a("div",kt,S(`${o(oe)}/api/one-net/${o(xe)()}/notify`),1)]),_:1}),e(y,{label:"Token"},{default:t(()=>[l(" 自定义token,可用于验证请求是否来自OneNet ")]),_:1}),e(y,{label:"AESKey"},{default:t(()=>[l(" 采用AES加密算法对推送的数据进行数据加密，AesKey为加密秘钥 ")]),_:1})]),_:1}),e(fe,{message:"注意：",style:{"margin-top":"15px"},type:"warning"},{description:t(()=>[wt]),_:1}),bt,e(R,{bordered:"",size:"small",column:1,labelStyle:{width:"100px"}},{default:t(()=>[e(y,{label:"参数"},{default:t(()=>[l("说明")]),_:1}),e(y,{label:"apiKey"},{default:t(()=>[l("OneNet平台中具体产品的Master-APIkey")]),_:1}),e(y,{label:"通知Token"},{default:t(()=>[l(" 填写OneNet数据推送配置中设置的Token ")]),_:1}),e(y,{label:"aesKey"},{default:t(()=>[l(" 若OneNet数据推送配置了消息加密，此处填写OneNet端数据推送配置中设置的AESkey ")]),_:1})]),_:1}),Tt,Ot])]),_:1})]),_:1})]),_:1})])])):O("",!0)]),a("div",Nt,[o(d)===1?(u(),I("div",Ct,[a("div",It,[e(f,{type:"InfoCircleOutlined"}),l(" 只能选择HTTP通信方式的协议 ")]),a("div",St,[e(ge,{allowClear:"",placeholder:"请输入",style:{width:"300px"},onSearch:ue}),o($)?(u(),h(F,{key:0,type:"primary",onClick:_e,hasPermission:"link/Protocol:add"},{icon:t(()=>[e(f,{type:"PlusOutlined"})]),default:t(()=>[l(" 新增 ")]),_:1})):O("",!0)]),e(D,{height:"480"},{default:t(()=>[o(A).length>0?(u(),h(T,{key:0,gutter:[24,24],style:{width:"100%"}},{default:t(()=>[(u(!0),I(X,null,Z(o(A),s=>(u(),h(v,{span:8,key:s.id},{default:t(()=>[e(Ye,{onCheckedChange:ce,checked:o(g),disabled:!o($),data:{...s,type:"protocol"}},null,8,["checked","disabled","data"])]),_:2},1024))),128))]),_:1})):(u(),h(ye,{key:1,style:{"margin-top":"10%"},description:"暂无数据"}))]),_:1})])):O("",!0)]),o(d)===2?(u(),I("div",xt,[e(T,{gutter:[24,24]},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(he,{data:"基本信息"}),a("div",null,[e(W,{model:o(N),name:"basic",autocomplete:"off",layout:"vertical",ref_key:"formRef2",ref:H},{default:t(()=>[e(b,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{default:t(()=>[e(x,{placeholder:"请输入名称",value:o(N).name,"onUpdate:value":n[5]||(n[5]=s=>o(N).name=s)},null,8,["value"])]),_:1}),e(b,{label:"说明",name:"description"},{default:t(()=>[e(J,{placeholder:"请输入说明",rows:4,value:o(N).description,"onUpdate:value":n[6]||(n[6]=s=>o(N).description=s),"show-count":"",maxlength:200},null,8,["value"])]),_:1})]),_:1},8,["model"])])]),_:1}),e(v,{span:12},{default:t(()=>{var s,Q;return[a("div",Pt,[e(V,{data:"配置概览"}),a("p",null,"接入方式："+S(k.provider.name),1),a("p",null,S(k.provider.description),1),a("p",null,"消息协议："+S(o(g)),1),e(V,{data:"设备接入指引"}),a("p",null," 1、创建类型为"+S(((s=i==null?void 0:i.provider)==null?void 0:s.id)==="OneNet"?"OneNet":"CTWing")+"的设备接入网关 ",1),a("p",null," 2、创建产品，并选中接入方式为 "+S(((Q=i==null?void 0:i.provider)==null?void 0:Q.id)==="OneNet"?"OneNet":"CTWing,选中后需填写CTWing平台中的产品ID、Master-APIkey。"),1),jt])]}),_:1})]),_:1})])):O("",!0),a("div",{class:Ne(o(d)!==2?"steps-action":"steps-action-save")},[o(d)>0?(u(),h(z,{key:0,onClick:ve,style:{"margin-right":"8px"}},{default:t(()=>[l(" 上一步 ")]),_:1})):O("",!0),o(d)===2&&o(de)==="false"?(u(),h(F,{key:1,style:{"margin-right":"8px"},type:"primary",onClick:pe,hasPermission:`link/AccessConfig:${o(K)===":id"?"add":"update"}`,loading:o(M)},{default:t(()=>[l(" 保存 ")]),_:1},8,["hasPermission","loading"])):O("",!0),[0,1].includes(o(d))?(u(),h(z,{key:2,type:"primary",onClick:me},{default:t(()=>[l(" 下一步 ")]),_:1})):O("",!0)],2)])}}});const Rt=ze(At,[["__scopeId","data-v-c5d3cd8e"]]);export{Rt as default};
