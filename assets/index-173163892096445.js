import{k as R,X as U,h as q,i as W,au as f,a0 as Z,a1 as tt,g as et}from"./index-1731638920964.js";import{_ as at}from"./TimeSelect.vue_vue_type_script_setup_true_lang-1731638920964.js";import D from"./Charts-1731638920964.js";import N from"./Guide-1731638920964.js";import{_ as ot,p as F,d as Y,a as h}from"./Amap.vue_vue_type_script_setup_true_lang-1731638920964.js";import{e as P}from"./encodeQuery-1731638920964.js";import _ from"./TopCard-17316389209642.js";import{d as st,k as r,ab as nt,U as V,V as $,X as i,_ as y,f as s,u as l,Y as lt}from"./vue-1731638920964.js";import"./index-1731638920964279.js";import"./index-1731638920964297.js";const rt={class:"DashBoardBox"},it={class:"message-card"},mt={class:"message-chart"},ut={class:"device-position"},dt={class:"device-map"},ct=st({__name:"index",setup(ft){var j;const z=(j=R().$state.configInfo.amap)==null?void 0:j.apiKey;let H=r(0),M=r([{title:"正常",value:0,status:"success"},{title:"禁用",value:0,status:"error"}]),C=r(0),b=r([{title:"在线",value:0,status:"success"},{title:"离线",value:0,status:"error"}]),O=r(0),S=r([{title:"昨日在线",value:0}]),w=r(0),A=r([{title:"当月设备消息量",value:0}]);r([]),r([]),r();let B=r({}),T=r({}),k=r({});U(),(()=>{F().then(t=>{t.status==200&&(H.value=t.result)}),F({terms:[{column:"state",value:"1"}]}).then(t=>{t.status==200&&(M.value[0].value=t.result)}),F({terms:[{column:"state",value:"0"}]}).then(t=>{t.status==200&&(M.value[1].value=t.result)})})(),(()=>{Y().then(t=>{t.status==200&&(C.value=t.result)}),Y(P({terms:{state:"online"}})).then(t=>{t.status==200&&(b.value[0].value=t.result,O.value=t.result)}),Y(P({terms:{state:"offline"}})).then(t=>{t.status==200&&(b.value[1].value=t.result)})})();const G=()=>{const t=f().subtract(0,"days").startOf("day").format("YYYY-MM-DD HH:mm:ss"),n=f().format("YYYY-MM-DD HH:mm:ss");h([{dashboard:"device",object:"session",measurement:"online",dimension:"agg",group:"aggOnline",params:{state:"online",limit:24,from:t,to:n,time:"1h",format:"yyyy-MM-dd HH:mm:ss"}}]).then(e=>{var a;if(e.status==200){const o=[],d=[];(a=e.result)==null||a.forEach(c=>{o.push(c.data.timeString),d.push(c.data.value)}),o.reverse();const u=d;u.reverse(),E(o,u)}})},I=()=>{const t=f().subtract(1,"days").startOf("day").format("YYYY-MM-DD HH:mm:ss"),n=f().subtract(1,"days").endOf("day").format("YYYY-MM-DD HH:mm:ss");h([{dashboard:"device",object:"session",measurement:"online",dimension:"agg",group:"aggOnline",params:{state:"online",limit:24,from:t,to:n,time:"1d",format:"yyyy-MM-dd HH:mm:ss"}}]).then(e=>{var a,o;e.status==200&&(S.value[0].value=((o=(a=e.result)==null?void 0:a[0])==null?void 0:o.data.value)||0)})},E=(t,n)=>{B.value={xAxis:{type:"category",data:t,show:!1},yAxis:{type:"value",show:!1},grid:{top:"5%",bottom:0},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},series:[{name:"在线数",data:n,type:"line",smooth:!0,symbolSize:0,showBackground:!0,color:"#D3ADF7",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#D3ADF7"},{offset:1,color:"#FFFFFF"}],global:!1}}}]}},J=(t,n)=>{T={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",boundaryGap:!1,show:!1,data:t},yAxis:{type:"value",show:!1},grid:{top:"2%",bottom:0},series:[{name:"消息量",data:n,type:"line",smooth:!0,symbolSize:0,color:"#F29B55",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#FBBB87"},{offset:1,color:"#FFFFFF"}],global:!1}}}]}},K=(t,n,e)=>{const a=String(Math.ceil(e)).length;k.value={xAxis:{type:"category",boundaryGap:!1,data:t},yAxis:{type:"value"},tooltip:{trigger:"axis",formatter:"{b0}<br />{a0}: {c0}"},grid:{top:"2%",bottom:"5%",left:e<9e5?"60px":a*7.5+Math.floor(a/3)*1.2+10+"px",right:"50px"},series:[{name:"消息量",data:n,type:"line",smooth:!0,symbolSize:0,color:"#ADC6FF",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#ADC6FF"},{offset:1,color:"#FFFFFF"}],global:!1}}}]}},L=()=>{const t=f().subtract(0,"days").startOf("day").format("YYYY-MM-DD HH:mm:ss"),n=f().format("YYYY-MM-DD HH:mm:ss");h([{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"today",params:{time:"1h",format:"yyyy-MM-dd HH:mm:ss",limit:24,from:t,to:n}},{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"oneday",params:{time:"1d",format:"yyyy-MM-dd",from:"now-1d"}},{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"thisMonth",params:{time:"1M",format:"yyyy-MM",limit:1,from:"now-1M"}}]).then(e=>{var a,o;if(e.status==200){const d=(a=e.result.find(m=>m.group==="thisMonth"))==null?void 0:a.data.value,u=(o=e.result.find(m=>m.group==="oneday"))==null?void 0:o.data.value;w.value=u,A.value[0].value=d;const c=e.result.filter(m=>m.group==="today"),v=c.map(m=>m.data.timeString).reverse(),p=c.map(m=>m.data.value).reverse();J(v,p)}})},X=t=>{let n="1m",e="M月dd日 HH:mm",a=12;const o=t.end-t.start,d=60*60*1e3,u=d*24,c=u*30,v=365*u;o<=d+10?(a=60,e="HH:mm"):o>d&&o<=u?(n="1h",a=24):o>u&&o<v?(a=Math.abs(Math.ceil(o/u))+1,n="1d",e="M月dd日"):o>=v&&(a=Math.abs(Math.floor(o/c)),n="1M",e="yyyy年-M月"),h([{dashboard:"device",object:"message",measurement:"quantity",dimension:"agg",group:"device_msg",params:{time:n,format:e,limit:a,from:t.start,to:t.end}}]).then(p=>{if(p.status===200){const m=p.result.map(g=>n==="1h"?`${g.data.timeString}时`:g.data.timeString).reverse(),x=p.result.map(g=>g.data.value).reverse(),Q=Math.max.apply(null,x.length?x:[0]);K(m,x,Q)}})};return G(),I(),L(),(t,n)=>{const e=Z,a=tt,o=nt("page-container");return V(),$(o,null,{default:i(()=>[y("div",rt,[s(a,{gutter:24},{default:i(()=>[s(e,{span:6},{default:i(()=>[s(_,{title:"产品数量",img:l(q)("/device/device-product.svg"),footer:l(M),value:l(H)},null,8,["img","footer","value"])]),_:1}),s(e,{span:6},{default:i(()=>[s(_,{title:"设备数量",img:l(q)("/device/device-number.svg"),footer:l(b),value:l(C)},null,8,["img","footer","value"])]),_:1}),s(e,{span:6},{default:i(()=>[s(_,{title:"当前在线",footer:l(S),value:l(O)},{default:i(()=>[s(D,{options:l(B)},null,8,["options"])]),_:1},8,["footer","value"])]),_:1}),s(e,{span:6},{default:i(()=>[s(_,{title:"今日设备消息量",footer:l(A),value:l(w)},{default:i(()=>[s(D,{options:l(T)},null,8,["options"])]),_:1},8,["footer","value"])]),_:1})]),_:1}),s(a,{gutter:24},{default:i(()=>[s(e,{span:24},{default:i(()=>[y("div",it,[s(N,{title:"设备消息"},{extra:i(()=>[s(at,{key:"flow-static",quickBtnList:[{label:"最近1小时",value:"hour"},{label:"最近24小时",value:"day"},{label:"近一周",value:"week"}],type:"week",onChange:X})]),_:1}),y("div",mt,[s(D,{options:l(k)},null,8,["options"])])])]),_:1})]),_:1}),l(z)&&l(W)?(V(),$(a,{key:0,span:24},{default:i(()=>[s(e,{span:24},{default:i(()=>[y("div",ut,[s(N,{title:"设备分布"}),y("div",dt,[s(ot)])])]),_:1})]),_:1})):lt("",!0)])]),_:1})}}});const Ct=et(ct,[["__scopeId","data-v-bf1bfd80"]]);export{Ct as default};
