import{d as he,f as e,E as a,F as q,i as Ze,k as j,r as Ye,w as Pe,u as s,p as eu,o as uu,b as tu,U as ne,Z as fe,_ as V,$ as Be,a1 as su,a4 as nu,a0 as Se,v as Oe,A as je,V as Le,Y as Me}from"./vue-1731638920964.js";import{h as le,aH as ke,d1 as pe,ai as Ce,ah as I,$ as Ne,ds as m,aa as Ge,X as ze,e as Ue,d as S,d$ as we,e0 as Re,o as W,dG as We,Z as L,e1 as Ie,e2 as au,e3 as Ve,e4 as qe,e5 as lu,e6 as ou,e7 as be,e8 as iu,g as cu}from"./index-1731638920964.js";import{u as Te}from"./instance-1731638920964.js";import{_ as He}from"./product-17316389209644.js";import{l as Y}from"./lodash.default-1731638920964.js";import{p as Ke}from"./initHome-1731638920964.js";import{_ as ru}from"./index.vue_vue_type_script_setup_true_lang-173163892096410.js";import du from"./index-173163892096461.js";import"./throttle-1731638920964.js";import"./min-1731638920964.js";import"./isNil-1731638920964.js";import"./isUndefined-1731638920964.js";import"./difference-1731638920964.js";import"./flattenDeep-1731638920964.js";import"./sortBy-1731638920964.js";import"./unionBy-1731638920964.js";import"./uniqBy-1731638920964.js";import"./toLower-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import"./index-173163892096458.js";import"./index-173163892096459.js";import"./EditTable-17316389209642.js";import"./index-173163892096460.js";import"./map-17316389209642.js";const ge=new Map;ge.set("loading",le("/diagnose/loading-2.png"));ge.set("error",le("/diagnose/error.png"));ge.set("success",le("/diagnose/success.png"));const me=new Map;me.set("loading","linear-gradient(89.95deg, #E6F5FF 0.03%, #E9EAFF 99.95%)");me.set("error","linear-gradient(89.95deg, rgba(231, 173, 86, 0.1) 0.03%, rgba(247, 111, 93, 0.1) 99.95%)");me.set("success","linear-gradient(89.95deg, #E8F8F7 0.03%, #EBEFFA 99.95%)");const De=new Map;De.set("loading","正在诊断中");De.set("error","发现连接问题");De.set("success","连接状态正常");const xe=new Map;xe.set("loading","已诊断XX个");xe.set("error","请处理连接异常");xe.set("success","现在可调试消息通信");const Ae=new Map;Ae.set("loading","#597EF7");Ae.set("error","#FAB247");Ae.set("success","#32D4A4");const fu="_statusBox_10js4_1",pu="_statusHeader_10js4_4",gu="_statusContent_10js4_7",vu="_statusItem_10js4_13",yu="_statusLeft_10js4_19",Fu="_statusImg_10js4_22",Eu="_statusContext_10js4_27",Bu="_statusTitle_10js4_27",Cu="_statusDesc_10js4_32",ku="_info_10js4_36",hu="_infoItem_10js4_41",mu="_statusRight_10js4_44",Du="_loading_10js4_49",xu="_alert_10js4_69",v={statusBox:fu,statusHeader:pu,statusContent:gu,statusItem:vu,statusLeft:yu,statusImg:Fu,statusContext:Eu,statusTitle:Bu,statusDesc:Cu,info:ku,infoItem:hu,statusRight:mu,loading:Du,alert:xu},ve=new Map;ve.set("loading","black");ve.set("error","red");ve.set("success","green");ve.set("warning","#FAB247");const ye=new Map;ye.set("error",le("/diagnose/status/error.png"));ye.set("success",le("/diagnose/status/success.png"));ye.set("warning",le("/diagnose/status/warning.png"));ye.set("loading",le("/diagnose/status/loading.png"));const Au=[{key:"network",name:"网络组件",desc:"诊断网络组件配置是否正确，配置错误将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"gateway",name:"设备接入网关",desc:"诊断设备接入网关状态是否正常，禁用状态将导致连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null}],_u=[{key:"gateway",name:"设备接入网关",desc:"诊断设备接入网关状态是否正常，网关配置是否正确",status:"loading",text:"正在诊断中...",info:null},{key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null}],wu=[{key:"gateway",name:"设备接入网关",desc:"诊断设备接入网关状态是否正常，网关配置是否正确",status:"loading",text:"正在诊断中...",info:null},{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null}],Iu=[{key:"gateway",name:"设备接入网关",desc:"诊断设备接入网关状态是否正常，禁用状态将导致连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null},{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"loading",text:"正在诊断中...",info:null}],f=(k,x,u)=>{let B=[];if(u!==0&&!u)for(let h=0;h<k.length;h++){const c=k[h];x.key===c.key?B.push(x):B.push(c)}else k.splice(u,0,x),B=[...k];return B},Je=(k,x)=>k.find(u=>x.includes(u)),bu=["websocket-server","http-server-gateway","udp-device-gateway","coap-server-gateway","mqtt-client-gateway","tcp-server-gateway"],ae=new Map;ae.set("mqtt-client-gateway","topic");ae.set("http-server-gateway","url");ae.set("websocket-server","url");ae.set("coap-server-gateway","url");ae.set("udp-device-gateway","url");ae.set("tcp-server-gateway","url");const Tu=he({props:{data:{type:Object,default:()=>{}}},emits:["close"],setup(k,{emit:x}){const{data:u}=k;return()=>e(Ge,{visible:!0,title:"设备诊断",width:1e3,onOk:()=>{x("close")},onCancel:()=>{x("close")}},{default:()=>[e("div",null,[e(ke,{data:"诊断建议"},null),e("div",{class:v.advice},[e("div",{class:v.alert},[e("span",{style:{marginRight:10}},[e(pe,{type:"InfoCircleOutlined"},null)]),a("所有诊断均无异常但设备仍未上线，请检查以下内容")]),e("div",{style:{marginLeft:10}},[((u==null?void 0:u.list)||[]).map((B,h)=>e("div",{class:v.infoItem,key:h,style:{margin:"10px 0"}},[B]))])])]),e("div",{style:{marginTop:15}},[e(ke,{data:"连接信息"},null),e(Ce,{column:2},{default:()=>{var B,h,c;return[e(I,{span:1,label:"设备ID"},{default:()=>{var p;return[((p=u==null?void 0:u.info)==null?void 0:p.id)||""]}}),((h=(B=u==null?void 0:u.info)==null?void 0:B.address)==null?void 0:h.length)>0&&e(I,{span:1,label:"连接地址"},{default:()=>{var p;return[e(Ne,{placement:"topLeft",title:e("div",{class:"serverItem"},[(((p=u==null?void 0:u.info)==null?void 0:p.address)||[]).map(T=>e("div",{key:T.address},[e(m,{color:T.health===-1?"red":"green"},null),T.address]))])},{default:()=>{var T;return[e("div",{class:"serverItem"},[(((T=u==null?void 0:u.info)==null?void 0:T.address)||[]).slice(0,1).map(w=>e("div",{key:w.address},[e(m,{color:w.health===-1?"red":"green"},null),w.address]))])]}})]}}),(Y.flatten(Y.map((c=u==null?void 0:u.info)==null?void 0:c.config,"properties"))||[]).map((p,T)=>e(I,{key:T,span:1,label:p!=null&&p.description?e("div",null,[e("span",{style:{marginRight:"10px"}},[p.name]),e(Ne,{title:p.description},{default:()=>[e(pe,{type:"QuestionCircleOutlined"},null)]})]):p.name},{default:()=>{var w;return[((w=u==null?void 0:u.info)==null?void 0:w.configValue[p==null?void 0:p.property])||""]}}))]}})])]})}});function $u(k){return typeof k=="function"||Object.prototype.toString.call(k)==="[object Object]"&&!Ze(k)}const Pu=he({props:{data:{type:Object,default:()=>{}}},emits:["close","save"],setup(k,{emit:x}){const{data:u}=k,B=Te(),h=ze(),c=()=>{var p,T,w,H,z,ee,oe,U,de,K,t,R;if(u.type==="device"||u.type==="product"){let N;return e(q,null,[e("div",{style:{flex:1}},[e("div",{class:v.alert},[e("span",{style:{marginRight:"10px"}},[e(pe,{type:"InfoCircleOutlined"},null)]),a("请检查配置项是否填写正确，若您确定该项无需诊断可"),e(S,{type:"link",style:"padding: 0",onClick:()=>{x("save",u)}},{default:()=>[a("忽略")]})]),e("div",{style:{marginTop:"10px"}},[e(Ce,{title:(p=u==null?void 0:u.data)==null?void 0:p.name,layout:"vertical",bordered:!0},$u(N=(((T=u==null?void 0:u.data)==null?void 0:T.properties)||[]).map(g=>e(I,{key:g.property,label:`${g.name}${g!=null&&g.description?`(${g.description})`:""}`},{default:()=>[(u==null?void 0:u.configuration[g.property])||""]})))?N:{default:()=>[N]})])]),(w=u==null?void 0:u.data)!=null&&w.description?e("div",{style:{width:"50%",border:"1px solid #f0f0f0",padding:"10px",borderLeft:"none"}},[e("h4",null,[a("诊断项说明")]),e("p",null,[(H=u==null?void 0:u.data)==null?void 0:H.description])]):""])}else return u.type==="cloud"?e(q,null,[e("div",{style:{flex:1}},[e("div",{class:v.alert},[e("span",{style:{marginRight:"10px"}},[e(pe,{type:"InfoCircleOutlined"},null)]),a("请检查配置项是否填写正确，若您确定该项无需诊断可"),e(S,{type:"link",style:"padding: 0",onClick:()=>{x("save",u)}},{default:()=>[a("忽略")]})]),e("div",{style:{marginTop:"10px"}},[e(Ce,{title:(z=u==null?void 0:u.data)==null?void 0:z.name,layout:"vertical",bordered:!0},{default:()=>{var N;return[((N=u.configuration)==null?void 0:N.provider)==="OneNet"?e(q,null,[e(I,{label:"接口地址"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.apiAddress)||""]}}),e(I,{label:"apiKey"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.apiKey)||""]}}),e(I,{label:"通知Token"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.validateToken)||""]}}),e(I,{label:"aesKey"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.aesKey)||""]}})]):e(q,null,[e(I,{label:"接口地址"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.apiAddress)||""]}}),e(I,{label:"appKey"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.appKey)||""]}}),e(I,{label:"appSecret"},{default:()=>{var g,A;return[((A=(g=u==null?void 0:u.configuration)==null?void 0:g.configuration)==null?void 0:A.appSecret)||""]}})])]}})])]),(oe=(ee=u==null?void 0:u.configuration)==null?void 0:ee.configuration)!=null&&oe.description?e("div",{style:{width:"50%",border:"1px solid #f0f0f0",padding:"10px",borderLeft:"none"}},[e("h4",null,[a("诊断项说明")]),e("p",null,[(de=(U=u==null?void 0:u.configuration)==null?void 0:U.configuration)==null?void 0:de.description])]):""]):u.type==="media"?e(q,null,[e("div",{style:{flex:1}},[e("div",{class:v.alert},[e("span",{style:{marginRight:"10px"}},[e(pe,{type:"InfoCircleOutlined"},null)]),a("请检查配置项是否填写正确，若您确定该项无需诊断可"),e(S,{type:"link",style:"padding: 0",onClick:()=>{x("save",u)}},{default:()=>[a("忽略")]})]),e("div",{style:{marginTop:"10px"}},[e(Ce,{title:(K=u==null?void 0:u.data)==null?void 0:K.name,layout:"vertical",bordered:!0},{default:()=>{var N,g,A,ie;return[(g=(N=u==null?void 0:u.configuration)==null?void 0:N.configuration)!=null&&g.shareCluster?e(q,null,[e(I,{label:"SIP 域"},{default:()=>{var y,D;return[((D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)==null?void 0:D.domain)||""]}}),e(I,{label:"SIP ID"},{default:()=>{var y,D;return[((D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)==null?void 0:D.sipId)||""]}}),e(I,{label:"集群"},{default:()=>{var y,D;return[(D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)!=null&&D.shareCluster?"共享配置":"独立配置"]}}),e(I,{label:"SIP 地址"},{default:()=>{var y,D,J,ue,te,ce;return[`${(J=(D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)==null?void 0:D.hostPort)==null?void 0:J.host}:${(ce=(te=(ue=u==null?void 0:u.configuration)==null?void 0:ue.configuration)==null?void 0:te.hostPort)==null?void 0:ce.port}`]}}),e(I,{label:"公网 Host"},{default:()=>{var y,D,J,ue,te,ce;return[`${(J=(D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)==null?void 0:D.hostPort)==null?void 0:J.publicHost}:${(ce=(te=(ue=u==null?void 0:u.configuration)==null?void 0:ue.configuration)==null?void 0:te.hostPort)==null?void 0:ce.publicPort}`]}})]):e(q,null,[e(I,{label:"SIP 域"},{default:()=>{var y,D;return[((D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)==null?void 0:D.domain)||""]}}),e(I,{label:"SIP ID"},{default:()=>{var y,D;return[((D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)==null?void 0:D.sipId)||""]}}),e(I,{label:"集群"},{default:()=>{var y,D;return[(D=(y=u==null?void 0:u.configuration)==null?void 0:y.configuration)!=null&&D.shareCluster?"共享配置":"独立配置"]}}),(ie=(A=u==null?void 0:u.configuration)==null?void 0:A.configuration)==null?void 0:ie.cluster.map((y,D)=>e("div",{key:D},[e("div",null,[a("节点"),D+1]),e(I,{label:"节点名称"},{default:()=>[(y==null?void 0:y.clusterNodeId)||""]}),e(I,{label:"SIP 地址"},{default:()=>[`${y.host}:${y==null?void 0:y.port}`]}),e(I,{label:"公网 Host"},{default:()=>[`${y==null?void 0:y.publicHost}:${y==null?void 0:y.publicPort}`]})]))])]}})])]),(t=u==null?void 0:u.configuration)!=null&&t.description?e("div",{style:{width:"50%",border:"1px solid #f0f0f0",padding:"10px",borderLeft:"none"}},[e("h4",null,[a("诊断项说明")]),e("p",null,[(R=u==null?void 0:u.configuration)==null?void 0:R.description])]):""]):null};return()=>e(Ge,{title:"人工检查",visible:!0,width:1e3,onOk:()=>{x("save",u)},onCancel:()=>{x("close")}},{default:()=>[e("div",{style:{display:"flex"}},[c()])],footer:e(Ue,null,{default:()=>[e(S,{onClick:()=>{var p;u.type==="device"?B.tabActiveKey="Info":u.type==="product"?h.jumpPage("device/Product/Detail",{id:u.productId,tab:"Device"}):h.jumpPage("link/AccessConfig/Detail",{id:(p=u.configuration)==null?void 0:p.id})}},{default:()=>[a("去修改")]}),e(S,{onClick:()=>{x("save",u)}},{default:()=>[a("确认无误")]})]})})}}),Su=he({components:{TitleComponent:ke},props:{providerType:{type:String,default:void 0}},emits:["percentChange","countChange","stateChange"],setup(k,{emit:x}){const u=Te(),B=500,h=j("loading"),c=j(u.current),p=j({}),T=j({}),w=j({}),H=j(!1),z=j(),ee=j(!1),oe=j(),U=j(!1),de=ze(),K=Ye({product:{},device:[]}),t=j([]),R=i=>{H.value=!0,z.value=i},N=()=>{de.jumpPage("device/Product/Detail",{id:s(c).productId,tab:"Device"})},g=()=>{u.tabActiveKey="Info"},A=()=>new Promise(async i=>{var l,r,F;if(((l=s(c).state)==null?void 0:l.value)==="online")setTimeout(()=>{t.value=f(s(t),{key:"network",name:"网络组件",desc:"诊断网络组件配置是否正确，配置错误将导致设备连接失败",status:"success",text:"正常",info:null}),i({})},B);else{const o=s(c);if(o.accessId){const n=await Ve(o.accessId);if(n.status===200){p.value=n.request;const d=((F=(r=n.result)==null?void 0:r.channelInfo)==null?void 0:F.addresses)||[],E=d.some(b=>b.health===-1),C=d.every(b=>b.health===1),P=E?-1:C?1:0;let _;P===1?_={key:"network",name:"网络组件",desc:"诊断网络组件配置是否正确，配置错误将导致设备连接失败",status:"success",text:"正常",info:null}:_={key:"network",name:"网络组件",desc:"诊断网络组件配置是否正确，配置错误将导致设备连接失败",status:"error",text:"异常",info:P===-1?e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("网络组件已禁用，请先"),e(L,{type:"link",style:"padding: 0",hasPermission:"link/Type:action",popConfirm:{title:"确认启用",onConfirm:()=>{var O;const b=Re((O=s(p))==null?void 0:O.channelId);return b.then(M=>{M.status===200&&(W("操作成功！"),t.value=f(t.value,{key:"network",name:"网络组件",desc:"诊断网络组件配置是否正确，配置错误将导致设备连接失败",status:"success",text:"正常",info:null}))}),b}}},{default:()=>[a("启用")]})])},null)])]):e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:"请检查服务器端口是否开放，如未开放，请开放后尝试重新连接"},null)]),e("div",{class:v.infoItem},[e(m,{status:"default",text:"请检查服务器防火策略，如有开启防火墙，请关闭防火墙或调整防火墙策略后重试"},null)])])},setTimeout(()=>{_&&(t.value=f(t.value,_)),i({})},B)}else W("请求发生错误","error")}else W("设备不含accessId","error")}}),ie=()=>new Promise(async i=>{var r,F,o,n,d,E,C,P;const l=k.providerType&&["child-device","cloud"].includes(k.providerType)?"诊断设备接入网关状态是否正常，网关配置是否正确":"诊断设备接入网关状态是否正常，禁用状态将导致连接失败";if(s(c).state.value==="online")setTimeout(()=>{t.value=f(t.value,{key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null}),i({})},B);else{let _;if((r=s(p))!=null&&r.id)((C=(E=s(p))==null?void 0:E.state)==null?void 0:C.value)==="enabled"?k.providerType==="cloud"||((P=s(c))==null?void 0:P.accessProvider)==="gb28181-2016"?_={key:"gateway",name:"设备接入网关",desc:l,status:"warning",text:"可能存在异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("请"),e(S,{type:"link",style:"padding: 0",onClick:async()=>{var O,M;const b=await qe(((O=s(p))==null?void 0:O.id)||"");b.status===200&&R({type:k.providerType,key:"gateway",name:"设备接入网关",desc:l,data:{name:`${(M=s(c))==null?void 0:M.accessProvider}配置`},configuration:{...b.result}})}},{default:()=>[a("人工检查")]}),a("网关配置是否已填写正确，若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])},null)])])}:_={key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null}:_={key:"gateway",name:"设备接入网关",desc:l,status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("设备接入网关已禁用，请先"),e(L,{hasPermission:"link/AccessConfig:action",type:"link",style:"padding: 0",popConfirm:{title:"确认启用",onConfirm:()=>{const b=we(s(c).accessId||"");return b.then(O=>{O.status===200&&(W("操作成功！"),t.value=f(t.value,{key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null}))}),b}}},{default:()=>[a("启用")]})])},null)])])},setTimeout(()=>{_&&(t.value=f(t.value,_)),i({})},B);else{const b=(F=s(c))==null?void 0:F.accessId;if(b){const O=await Ve(b);O.status===200?(p.value=O.result,((n=(o=O.result)==null?void 0:o.state)==null?void 0:n.value)==="enabled"?k.providerType==="cloud"||((d=s(c))==null?void 0:d.accessProvider)==="gb28181-2016"?_={key:"gateway",name:"设备接入网关",desc:l,status:"warning",text:"可能存在异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("请"),e(S,{type:"link",style:"padding: 0",onClick:async()=>{var G,se;const M=await qe(((G=O.result)==null?void 0:G.id)||"");M.status===200&&R({type:k.providerType,key:"gateway",name:"设备接入网关",desc:l,data:{name:`${(se=s(c))==null?void 0:se.accessProvider}配置`},configuration:{...M.result}})}},{default:()=>[a("人工检查")]}),a("网关配置是否已填写正确，若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])},null)])])}:_={key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null}:_={key:"gateway",name:"设备接入网关",desc:l,status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("设备接入网关已禁用，请先"),e(L,{hasPermission:"link/Type:action",type:"link",style:"padding: 0",popConfirm:{title:"确认启用",onConfirm:()=>{const M=we(s(c).accessId||"");return M.then(G=>{G.status===200&&(W("操作成功！"),t.value=f(t.value,{key:"gateway",name:"设备接入网关",desc:l,status:"success",text:"正常",info:null}))}),M}}},{default:()=>[a("启用")]})])},null)])])},setTimeout(()=>{_&&(t.value=f(t.value,_)),i({})},B)):W("请求发生错误","error")}else W("设备不含accessId","error")}}}),y=()=>new Promise(async i=>{var l,r,F,o;if(s(c).state.value==="online")setTimeout(()=>{t.value=f(s(t),{key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"success",text:"正常",info:null}),i({})},B);else{const n=s(c);if(!(n!=null&&n.parentId))setTimeout(()=>{t.value=f(s(t),{key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("未绑定父设备，请先"),e(S,{type:"link",style:"padding: 0",onClick:()=>{U.value=!0}},{default:()=>[a("绑定")]}),a("父设备后重试")])},null)])])}),i({})},B);else{let d;const E=await We(n==null?void 0:n.parentId);T.value=E.result,E.status===200&&(((r=(l=E==null?void 0:E.result)==null?void 0:l.state)==null?void 0:r.value)==="notActive"?d={key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("网关父设备已禁用，请先"),e(L,{hasPermission:"device/Product:action",type:"link",style:"padding: 0",popConfirm:{title:"确认启用",onConfirm:()=>{var P;const C=Ie(((P=C==null?void 0:C.result)==null?void 0:P.id)||"");return C.then(_=>{_.status===200&&(W("操作成功！"),t.value=f(t.value,{key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"success",text:"正常",info:null}))}),C}}},{default:()=>[a("启用")]})])},null)])])}:((o=(F=E==null?void 0:E.result)==null?void 0:F.state)==null?void 0:o.value)==="online"?d={key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"success",text:"正常",info:null}:d={key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("网关父设备已离线，请先排查网关设备故障")])},null)])])},setTimeout(()=>{d&&(t.value=f(s(t),d)),i({})},B))}}}),D=()=>new Promise(async i=>{var l,r;if(((l=s(c).state)==null?void 0:l.value)==="online")setTimeout(()=>{t.value=f(s(t),{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null}),i({})},B);else{const F=s(c);if(F.productId){const o=await lu(F.productId);if(o.status===200){w.value=o.result;let n;const d=(r=o.result)==null?void 0:r.state;n={key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:d===1?"success":"error",text:d===1?"正常":"异常",info:d===1?null:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("产品已禁用，请"),e(L,{hasPermission:"device/Product:action",type:"link",style:"padding: 0",popConfirm:{title:"确认启用",onConfirm:()=>{const E=He(s(c).productId||"");return E.then(C=>{C.status===200&&(W("操作成功！"),t.value=f(t.value,{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null}))}),E}}},{default:()=>[a("启用")]}),a("产品")])},null)])])},setTimeout(()=>{n&&(t.value=f(s(t),n)),i({})},B)}}}}),J=()=>new Promise(i=>{var r,F;const l=s(c);if(((r=l.state)==null?void 0:r.value)==="online")setTimeout(()=>{t.value=f(s(t),{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null}),i({})},B);else{let o;((F=l.state)==null?void 0:F.value)==="notActive"?o={key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("设备已禁用，请"),e(L,{hasPermission:"device/Instance:action",type:"link",style:"padding: 0",popConfirm:{title:"确认启用",onConfirm:()=>{var d;const n=Ie(((d=s(c))==null?void 0:d.id)||"");return n.then(E=>{E.status===200&&(u.current.state={value:"offline",text:"离线"},W("操作成功！"),t.value=f(t.value,{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null}))}),n}}},{default:()=>[a("启用")]}),a("设备")])},null)])])}:o={key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null},setTimeout(()=>{o&&(t.value=f(s(t),o)),i({})},B)}}),ue=()=>new Promise(async i=>{var r;const l=s(c);if(l.productId){const F=await ou(l.productId);if(F.status===200&&F.result.length>0){K.product=F.result;const o=((r=s(w))==null?void 0:r.configuration)||{};F.result.map((n,d)=>{var P;const E=[...t.value];Y.map(E,"key").includes(`product-auth${d}`)||(t.value=f(t.value,{key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,status:"loading",text:"正在诊断中...",info:null},t.value.length));const C=Y.map(n==null?void 0:n.properties,"property");((P=s(c).state)==null?void 0:P.value)==="online"?setTimeout(()=>{t.value=f(t.value,{key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,status:"success",text:"正常",info:null}),i({})},B):Je(C,Object.keys(o).filter(_=>!!o[_]))?setTimeout(()=>{t.value=f(t.value,{key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,status:"warning",text:"可能存在异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("请"),e(S,{type:"link",style:"padding: 0",onClick:()=>{R({type:"product",key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,data:{...n},configuration:o,productId:s(c).productId})}},{default:()=>[a("人工检查")]}),a("产品"),n.name,a("配置是否已填写正确,若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])},null)])])}),i({})},B):setTimeout(()=>{t.value=f(t.value,{key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("请根据设备接入配置需要"),e(S,{type:"link",style:"padding: 0",onClick:()=>{N()}},{default:()=>[a("填写")]}),a("，若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:`product-auth${d}`,name:`产品-${n==null?void 0:n.name}`,desc:`诊断产品${n==null?void 0:n.name}认证配置是否正确，错误的配置将导致连接失败`,status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])},null)])])}),i({})},B)})}else i({})}}),te=()=>new Promise(async i=>{const l=s(c);if(l.id){const r=await be(l.id);if(r.status===200&&r.result.length>0){K.device=r.result;const F=(l==null?void 0:l.configuration)||{};r.result.map((o,n)=>{var C;const d=[...t.value];Y.map(d,"key").includes(`device-auth${n}`)||(t.value=f(t.value,{key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,status:"loading",text:"正在诊断中...",info:null},t.value.length));const E=Y.map(o==null?void 0:o.properties,"property");((C=l.state)==null?void 0:C.value)==="online"?setTimeout(()=>{t.value=f(t.value,{key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,status:"success",text:"正常",info:null}),i({})},B):Je(E,Object.keys(F).filter(P=>!!F[P]))?setTimeout(()=>{t.value=f(t.value,{key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,status:"warning",text:"可能存在异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("请"),e(S,{type:"link",style:"padding: 0",onClick:()=>{R({type:"device",key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,data:{...o},configuration:F,productId:s(c).productId})}},{default:()=>[a("人工检查")]}),a("设备"),o.name,a("配置是否已填写正确,若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])},null)])])}),i({})},B):setTimeout(()=>{t.value=f(t.value,{key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("请根据设备接入配置需要"),e(S,{type:"link",style:"padding: 0",onClick:()=>{g()}},{default:()=>[a("填写")]}),a("，若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:`device-auth${n}`,name:`设备-${o==null?void 0:o.name}`,desc:`诊断设备${o==null?void 0:o.name}认证配置是否正确，错误的配置将导致连接失败`,status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])},null)])])}),i({})},B)})}else i({})}}),ce=()=>new Promise(async i=>{var r,F,o,n;const l=s(c);if((l==null?void 0:l.accessProvider)==="OneNet"){const d=await be((l==null?void 0:l.id)||"");K.device=d.result;const E=(l==null?void 0:l.configuration)||{};let C;(r=l.configuration)!=null&&r.onenet_imei||(F=l.configuration)!=null&&F.onenet_imsi||(o=s(w))!=null&&o.configuration&&((n=s(w))!=null&&n.configuration["api-key"])?C={key:"onenet",name:"设备-OneNet配置",desc:"诊断设备OneNet是否已配置，未配置将导致连接失败",status:"warning",text:"可能存在异常",info:e("div",null,[e("div",{class:v.infoItem},[a("请"),e(S,{type:"link",style:"padding: 0",onClick:()=>{R({type:"device",key:"onenet",name:"设备-OneNet配置",desc:"诊断设备OneNet是否已配置，未配置将导致连接失败",data:{...d.result[0]},configuration:E})}},{default:()=>[a("人工检查")]}),a("设备-OneNet配置是否已填写正确,若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:"onenet",name:"设备-OneNet配置",desc:"诊断设备OneNet是否已配置，未配置将导致连接失败",status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])])}:C={key:"onenet",name:"设备-OneNet配置",desc:"诊断设备OneNet是否已配置，未配置将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[a("请根据设备接入配置需要"),e(S,{type:"link",style:"padding: 0",onClick:()=>{g()}},{default:()=>[a("填写")]}),a("，若您确定该项无需诊断可"),e(L,{title:"确认忽略？",type:"link",style:"padding: 0",onConfirm:()=>{t.value=f(t.value,{key:"onenet",name:"设备-OneNet配置",desc:"诊断设备OneNet是否已配置，未配置将导致连接失败",status:"success",text:"正常",info:null})}},{default:()=>[a("忽略")]})])])},setTimeout(()=>{C&&(t.value=f(t.value,C,t.value.length)),i({})},B)}else i({})}),Xe=()=>new Promise(async i=>{var r,F,o;const l=s(c);if((l==null?void 0:l.accessProvider)==="Ctwing"){const n=await be((l==null?void 0:l.id)||"");K.device=n.result;const d=(l==null?void 0:l.configuration)||{};let E;const C=(r=s(w))==null?void 0:r.configuration;(F=l.configuration)!=null&&F.ctwing_imei||(o=l.configuration)!=null&&o.ctwing_imsi||C&&(C.ctwing_product_id||C.master_key)?E={key:"ctwing",name:"设备-CTWing配置",desc:"诊断设备CTWing是否已配置，未配置将导致连接失败",status:"warning",text:"可能存在异常",info:e("div",null,[e("div",{class:v.infoItem},[a("请"),e(S,{type:"link",style:"padding: 0",onClick:()=>{R({type:"device",key:"ctwing",name:"设备-CTWing配置",desc:"诊断设备CTWing是否已配置，未配置将导致连接失败",data:{...n.result[0]},configuration:d})}},{default:()=>[a("人工检查")]}),a("设备-CTWing配置是否已填写正确,若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:"ctwing",name:"设备-CTWing配置",desc:"诊断设备CTWing是否已配置，未配置将导致连接失败",status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])])}:E={key:"ctwing",name:"设备-CTWing配置",desc:"诊断设备CTWing是否已配置，未配置将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[a("请根据设备接入配置需要"),e(S,{type:"link",style:"padding: 0",onClick:()=>{g()}},{default:()=>[a("填写")]}),a("，若您确定该项无需诊断可"),e(L,{type:"link",style:"padding: 0",popConfirm:{title:"确认忽略？",onConfirm:()=>{t.value=f(t.value,{key:"ctwing",name:"设备-CTWing配置",desc:"诊断设备CTWing是否已配置，未配置将导致连接失败",status:"success",text:"正常",info:null})}}},{default:()=>[a("忽略")]})])])},setTimeout(()=>{E&&(t.value=f(t.value,E,t.value.length)),i({})},B)}else i({})}),Qe=async()=>{var i,l,r,F,o,n,d,E,C,P,_,b,O,M,G,se,X,Fe,Ee,_e,re;if(((i=s(c).state)==null?void 0:i.value)!="online"){const Q=[];let Z={id:s(c).id};if(Q.push(e(m,{status:"default",text:"请检查设备运行状态是否正常"},null)),k.providerType==="network"){if(Q.push(e(m,{status:"default",text:(((r=(l=s(p))==null?void 0:l.channelInfo)==null?void 0:r.addresses)||[]).length>1?e(q,null,[a("请检查设备网络是否畅通，并确保设备已连接到以下地址之一:"),e("div",{class:"serverItem"},[(((o=(F=s(p))==null?void 0:F.channelInfo)==null?void 0:o.addresses)||[]).map($=>e("span",{style:{marginLeft:15},key:$.address},[e(m,{color:$.health===-1?"red":"green"},null),$.address]))])]):e(q,null,[a("请检查设备网络是否畅通，并确保设备已连接到:"),(((d=(n=s(p))==null?void 0:n.channelInfo)==null?void 0:d.addresses)||[]).map($=>e("span",{style:{marginLeft:15},key:$.address},[e(m,{color:$.health===-1?"red":"green"},null),$.address]))])},null)),(E=s(c))!=null&&E.protocol&&((C=s(c))!=null&&C.accessProvider)&&bu.includes(s(c).accessProvider)){const $=await au(s(c).protocol,"MQTT");$.status===200&&((((P=$.result)==null?void 0:P.routes)||[]).length>0?Q.push(e(m,{status:"default",text:e("span",null,[a("请根据"),e(S,{type:"link",style:"padding: 0",onClick:()=>{N()}},{default:()=>[a("设备接入配置")]}),a("中"),ae.get((_=s(c))==null?void 0:_.accessProvider)||"",a("信息，任意上报一条数据")])},null)):Q.push(e(m,{status:"default",text:e("span",null,[a("请联系管理员提供"),ae.get((b=s(c))==null?void 0:b.accessProvider)||"",a("信息，并根据URL信息任意上报一条数据")])},null)))}Z={...Z,address:((M=(O=s(p))==null?void 0:O.channelInfo)==null?void 0:M.addresses)||[],config:K.device||[]}}else if(k.providerType==="child-device"){if(((G=s(c))==null?void 0:G.accessProvider)==="gb28181-2016"){const $=(X=(se=s(p))==null?void 0:se.channelInfo)==null?void 0:X.addresses[0];$&&(Q.push(e(m,{status:"default",text:e("span",null,[a("请检查设备网络是否畅通，并确保设备已连接到：SIP")," ",e("span",{style:{marginLeft:15}},[e(m,{color:$.health===-1?"red":"green"},null),$.address])])},null)),Z={...Z,address:[$]})}}else if(k.providerType==="media"){if(((Fe=s(c))==null?void 0:Fe.accessProvider)==="gb28181-2016"){const $=(_e=(Ee=s(p))==null?void 0:Ee.channelInfo)==null?void 0:_e.addresses[0];$&&(Q.push(e(m,{status:"default",text:e("span",null,[a("请检查设备网络是否畅通，并确保设备已连接到：SIP")," ",e("span",{style:{marginLeft:15}},[e(m,{color:$.health===-1?"red":"green"},null),$.address])])},null)),Z={...Z,address:[$]})}}else k.providerType==="cloud"?(Q.push(e(m,{status:"default",text:"需要三方云平台主动发送一条消息通知到本平台，触发设备状态为在线"},null)),Q.push(e(m,{status:"default",text:"请检查三方平台配置项是否填写正确"},null))):k.providerType;Z={...Z,configValue:((re=s(c))==null?void 0:re.configuration)||{}},oe.value={list:[...Q],info:Z},ee.value=!0}else x("stateChange","success")},$e=async()=>{x("percentChange",0),x("countChange",0),x("stateChange","loading"),h.value="loading";const{providerType:i}=k;let l=[];if(i==="network")t.value=[...Au],l=[A,ie,D,J,ue,te];else if(i==="child-device")t.value=[..._u],l=[ie,y,D,J,ue,te];else if(i==="media")t.value=[...Iu],l=[ie,D,J];else if(i==="cloud")t.value=[...wu],l=[ie,D,J,Xe,ce];else if(i==="channel"){W("未开发","error");return}if(l.length>0){for(let r=0;r<l.length;r++)await l[r](),x("percentChange");x("percentChange",100),h.value="finish"}};return Pe(()=>k.providerType,i=>{i&&(c.value=u.current,$e())},{deep:!0,immediate:!0}),Pe(()=>[t,h],()=>{var i;if(h.value==="finish"){const l=Y.uniq(Y.map(s(t),"status"));((i=s(c).state)==null?void 0:i.value)!=="online"?(x("stateChange","error"),l[0]==="success"&&l.length===1&&Qe()):x("stateChange","success")}else if(h.value==="loading"){const l=Y.map(s(t),"status").filter(r=>r!=="loading");x("countChange",l.length)}},{deep:!0,immediate:!0}),()=>e("div",{class:v.statusBox},[e("div",{class:v.statusHeader},[e(ke,{data:"连接详情"},null),e(Ue,null,{default:()=>{var i;return[h.value==="finish"&&((i=s(c).state)==null?void 0:i.value)!=="online"&&e(S,{type:"primary",onClick:async()=>{var r,F,o,n,d,E,C,P,_,b,O,M,G,se;let l=!0;if(Object.keys(s(p)).length>0&&((F=(r=s(p))==null?void 0:r.state)==null?void 0:F.value)!=="enabled"&&((await we(s(c).accessId||"")).status===200?t.value=f(t.value,{key:"gateway",name:"设备接入网关",desc:"诊断设备接入网关状态是否正常，禁用状态将导致连接失败",status:"success",text:"正常",info:null}):l=!1),((o=s(w))==null?void 0:o.state)!==1&&((await He(s(c).productId||"")).status===200?t.value=f(t.value,{key:"product",name:"产品状态",desc:"诊断产品状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null}):l=!1),((d=(n=s(c))==null?void 0:n.state)==null?void 0:d.value)==="notActive"&&((await Ke(((E=s(c))==null?void 0:E.id)||"")).status===200?(s(c).state={value:"offline",text:"离线"},t.value=f(t.value,{key:"device",name:"设备状态",desc:"诊断设备状态是否正常，禁用状态将导致设备连接失败",status:"success",text:"正常",info:null})):l=!1),k.providerType==="network"||k.providerType==="child-device"){const X=((P=(C=s(p))==null?void 0:C.channelInfo)==null?void 0:P.addresses)||[],Fe=X.some(re=>re.health===-1),Ee=X.every(re=>re.health===1);(Fe?-1:Ee?1:0)===-1&&((_=s(p))!=null&&_.channelId)&&((await Re((b=s(p))==null?void 0:b.channelId)).status===200?t.value=f(t.value,{key:"network",name:"网络组件",desc:"诊断网络组件配置是否正确，配置错误将导致设备连接失败",status:"success",text:"正常",info:null}):l=!1)}k.providerType==="child-device"&&((O=s(c))!=null&&O.parentId)&&((G=(M=s(T))==null?void 0:M.state)==null?void 0:G.value)==="notActive"&&((await Ke(((se=s(c))==null?void 0:se.parentId)||"")).status===200?t.value=f(t.value,{key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"success",text:"正常",info:null}):l=!1),l&&W("操作成功！")}},{default:()=>[a("一键修复")]}),e(S,{onClick:()=>{$e()}},{default:()=>[a("重新诊断")]})]}})]),e("div",{class:v.statusContent},[t.value.map(i=>e("div",{key:i.key,class:v.statusItem},[e("div",{class:v.statusLeft},[e("div",{class:v.statusImg},[e("img",{style:{height:32},class:i.status==="loading"?v.loading:{},src:ye.get(i.status)},null)]),e("div",{class:v.statusContext},[e("div",{class:v.statusTitle},[i==null?void 0:i.name]),e("div",{class:v.statusDesc},[i.desc]),e("div",{class:v.info},[i==null?void 0:i.info])])]),e("div",{class:v.statusRight,style:{color:ve.get(i.status)}},[i==null?void 0:i.text])]))]),ee.value&&e(Tu,{data:oe.value,onClose:()=>{ee.value=!1}},null),H.value&&e(Pu,{data:z.value,onClose:()=>{H.value=!1},onSave:i=>{t.value=f(t.value,{key:i.key,name:i.name,desc:i.desc,status:"success",text:"正常",info:null}),H.value=!1}},null),U.value&&e(ru,{data:c.value,onCancel:()=>{U.value=!1},onOk:async i=>{var F,o,n;let l;const r=await We(i);r.status===200&&(((o=(F=r==null?void 0:r.result)==null?void 0:F.state)==null?void 0:o.value)==="notActive"?l={key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("网关父设备已禁用，请先"),e(L,{hasPermission:"device/Product:action",type:"link",style:"padding: 0",popConfirm:{title:"确认启用",onConfirm:()=>{var E;const d=Ie(((E=d==null?void 0:d.result)==null?void 0:E.id)||"");return d.then(C=>{C.status===200&&(W("操作成功！"),t.value=f(t.value,{key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"success",text:"正常",info:null}))}),d}}},{default:()=>[a("启用")]})])},null)])])}:((n=r==null?void 0:r.state)==null?void 0:n.value)==="online"?l={key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"success",text:"正常",info:null}:l={key:"parent-device",name:"网关父设备",desc:"诊断网关父设备状态是否正常，禁用或离线将导致连接失败",status:"error",text:"异常",info:e("div",null,[e("div",{class:v.infoItem},[e(m,{status:"default",text:e("span",null,[a("网关父设备已离线，请先排查网关设备故障")])},null)])])},l&&(t.value=f(s(t),l)),u.current.parentId=i,U.value=!1)}},null)])}}),Ou=Su,ju={class:"diagnose"},Lu={class:"diagnose-top"},Mu={class:"diagnose-img"},Nu={key:0,style:{width:"100%",height:"100%",position:"relative"}},Ru=["src"],Wu=["src"],Vu=["src"],qu={class:"diagnose-text"},Hu={class:"diagnose-title"},Ku={class:"diagnose-desc"},Ju={class:"diagnose-progress"},Gu={class:"diagnose-radio"},zu=["onClick"],Uu=he({__name:"index",setup(k){const x=Te(),u=[{key:"status",text:"连接状态"},{key:"message",text:"消息通信"}],B={background:"#FFFFFF",border:"1px solid rgba(0, 0, 0, 0.09)",borderRadius:"2px 2px 0px 0px",color:"#000000BF"},h=j("loading"),c=j(0),p=j(0),T=j("status"),w=j(),H=j(!0),z=j(!1);eu("topState",h);const ee=t=>{h.value==="success"&&(T.value=t),H.value=!1},oe=t=>{t===0?p.value=0:p.value<100&&!t?p.value+=20:p.value=t},U=t=>{h.value=t},de=t=>{c.value=t},K=()=>{var R;z.value=!0,T.value="status";const t=(R=x.current)==null?void 0:R.accessProvider;t==="fixed-media"||t==="gb28181-2016"?w.value="media":t==="OneNet"||t==="Ctwing"?w.value="cloud":t==="modbus-tcp"||t==="opc-ua"?w.value="channel":t==="child-device"?w.value="child-device":w.value="network",h.value="loading"};return uu(()=>{setTimeout(()=>{K()},500)}),tu(()=>{z.value=!1}),(t,R)=>{const N=iu;return ne(),fe("div",ju,[V("div",{class:"diagnose-header",style:Se({background:s(me).get(s(h))})},[V("div",Lu,[V("div",Mu,[s(h)==="loading"?(ne(),fe("div",Nu,[V("img",{src:s(ge).get(s(h)),style:{height:"100%",position:"absolute","z-index":"2"}},null,8,Ru),V("img",{src:s(le)("/diagnose/loading-1.png"),class:"diagnose-loading",style:{height:"100%"}},null,8,Wu)])):(ne(),fe("img",{key:1,src:s(ge).get(s(h)),style:{height:"100%"}},null,8,Vu))]),V("div",qu,[V("div",Hu,Be(s(De).get(s(h))),1),V("div",Ku,[s(h)!=="loading"?(ne(),fe(q,{key:0},[a(Be(s(xe).get(s(h))),1)],64)):(ne(),fe(q,{key:1},[a("已诊断"+Be(s(c))+"个",1)],64))])])]),V("div",Ju,[e(N,{percent:s(p),showInfo:!1,size:"small",strokeColor:s(Ae).get(s(h)),style:{width:"100%"}},null,8,["percent","strokeColor"])]),V("div",Gu,[(ne(),fe(q,null,su(u,g=>V("div",{class:nu(["diagnose-radio-item",g.key==="message"&&s(h)!=="success"?"disabled":""]),key:g.key,style:Se(s(T)===g.key?{...B}:{}),onClick:A=>ee(g.key)},Be(g.text),15,zu)),64))])],4),V("div",null,[s(H)?Me("",!0):Oe((ne(),Le(du,{key:0},null,512)),[[je,s(T)==="message"]]),s(z)?Oe((ne(),Le(s(Ou),{key:1,providerType:s(w),onCountChange:de,onPercentChange:oe,onStateChange:U},null,8,["providerType"])),[[je,s(T)!=="message"]]):Me("",!0)])])}}});const xt=cu(Uu,[["__scopeId","data-v-d82e8c42"]]);export{xt as default};
