import{an as L,ao as q,v as z,F as G,d as M,e as W,aa as X,o as I,g as Y}from"./index-1731638920964.js";import"./index-1731638920964286.js";import A from"./NotifyWay-1731638920964.js";import{_ as H}from"./NotifyConfig.vue_vue_type_style_index_0_lang-1731638920964.js";import{_ as K}from"./NotifyTemplate.vue_vue_type_style_index_0_lang-1731638920964.js";import{_ as P}from"./VariableDefinitions.vue_vue_type_script_setup_true_lang-1731638920964.js";import{T as N}from"./template-1731638920964.js";import{d as U,k as c,r as Q,w as Z,s as h,U as p,V as f,X as s,f as l,u as a,E as v,Y as m,_ as S,G as w}from"./vue-1731638920964.js";import"./config-17316389209642.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import"./const-17316389209642.js";import"./BuildIn.vue_vue_type_script_setup_true_name_NotifyBuildIn_lang-1731638920964.js";import"./scene-1731638920964.js";import"./scene-17316389209642.js";import"./Org.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./Tag.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./InputFile.vue_vue_type_script_setup_true_lang-1731638920964.js";import"./User.vue_vue_type_script_setup_true_name_NotifyUser_lang-1731638920964.js";import"./unionBy-1731638920964.js";const V={class:"steps-steps"},ee={class:"steps-content"},te=U({name:"NotifyIndex"}),oe=U({...te,props:{value:{type:Object,default:()=>{}},options:{type:Object,default:()=>({})},name:{type:Number,default:0}},emits:["cancel","save"],setup(B,{emit:k}){const T=B,i=c(0),e=Q({notifyType:"",notifierId:"",templateId:"",variables:{},options:{}}),b=c([]),g=c(),u=c();Z(()=>T.value,o=>{Object.assign(e,o),o!=null&&o.templateId&&N.detail(o==null?void 0:o.templateId).then(t=>{t.status===200&&(u.value=t.result)})},{deep:!0,immediate:!0}),h(()=>{e.options=T.options||{}});const d=(o,t)=>{var r;t==="notifyType"?(e.templateId="",e.variables=[],e.notifierId="",e.options={}):t==="notifierId"?(e.templateId="",e.variables=[],e.options={...o}):t==="templateId"&&(e.variables=[],e.options={provider:((r=e==null?void 0:e.options)==null?void 0:r.provider)||"",...o}),e.options={...a(e.options),...o}},C=async o=>{var t;if(o===0)i.value=o;else if(o===1)e.notifyType?i.value=o:I("请选择通知方式","error");else if(o===2)e.notifierId?i.value=o:I("请选择通知配置","error");else if(o===3)if(e.templateId){const r=await N.getTemplateDetail(e.templateId);r.status===200&&(b.value=((t=r.result)==null?void 0:t.variableDefinitions)||[],i.value=o)}else I("请选择通知模板","error")},D=o=>{C(o)},O=()=>{i.value-=1},F=async()=>{C(i.value+1)},j=()=>{k("cancel")},x=async()=>{let o=null;b.value.length&&(o=await g.value.onSave()),e.variables=o;const{options:t,...r}=e;k("save",{...r},{...t})};return(o,t)=>{const r=L,J=q,_=z,R=G,y=M,$=W,E=X;return p(),f(E,{title:"执行动作",visible:"",width:900,onCancel:j,onOk:x,maskClosable:!1},{footer:s(()=>[l($,null,{default:s(()=>[a(i)===0?(p(),f(y,{key:0,onClick:j},{default:s(()=>[v("取消")]),_:1})):m("",!0),a(i)>0?(p(),f(y,{key:1,onClick:O},{default:s(()=>[v("上一步")]),_:1})):m("",!0),a(i)<3?(p(),f(y,{key:2,type:"primary",onClick:F},{default:s(()=>[v("下一步")]),_:1})):m("",!0),a(i)===3?(p(),f(y,{key:3,type:"primary",onClick:x},{default:s(()=>[v("确定")]),_:1})):m("",!0)]),_:1})]),default:s(()=>[S("div",V,[l(J,{current:a(i),size:"small",onChange:D},{default:s(()=>[l(r,{title:"通知方式",key:"way"}),l(r,{title:"通知配置",key:"config"}),l(r,{title:"通知模板",key:"template"}),l(r,{title:"模板变量",key:"variable"})]),_:1},8,["current"])]),S("div",ee,[l(R,{ref:"actionForm",model:a(e),layout:"vertical"},{default:s(()=>[a(i)===0?(p(),f(_,{key:0,label:"应用",name:"notifyType",rules:[{required:!0,message:"请选择通知方式"}]},{default:s(()=>[l(A,{value:a(e).notifyType,"onUpdate:value":t[0]||(t[0]=n=>a(e).notifyType=n),onChange:t[1]||(t[1]=n=>d(n,"notifyType"))},null,8,["value"])]),_:1})):m("",!0),a(i)===1?(p(),f(_,{key:1,name:"notifierId"},{default:s(()=>[l(H,{value:a(e).notifierId,"onUpdate:value":t[2]||(t[2]=n=>a(e).notifierId=n),notifyType:a(e).notifyType,onChange:t[3]||(t[3]=n=>d(n,"notifierId"))},null,8,["value","notifyType"])]),_:1})):m("",!0),a(i)===2?(p(),f(_,{key:2,name:"templateId"},{default:s(()=>[l(K,{value:a(e).templateId,"onUpdate:value":t[4]||(t[4]=n=>a(e).templateId=n),detail:a(u),"onUpdate:detail":t[5]||(t[5]=n=>w(u)?u.value=n:null),notifyType:a(e).notifyType,notifierId:a(e).notifierId,onChange:t[6]||(t[6]=n=>d(n,"templateId"))},null,8,["value","detail","notifyType","notifierId"])]),_:1})):m("",!0),a(i)===3?(p(),f(_,{key:3,name:"variables"},{default:s(()=>[l(P,{variableDefinitions:a(b),value:a(e).variables,notify:a(e),template:a(u),options:a(e).options,onChange:t[7]||(t[7]=n=>d(n,"variables")),ref_key:"variableRef",ref:g},null,8,["variableDefinitions","value","notify","template","options"])]),_:1})):m("",!0)]),_:1},8,["model"])])]),_:1})}}});const Se=Y(oe,[["__scopeId","data-v-92acdedb"]]);export{Se as default};
