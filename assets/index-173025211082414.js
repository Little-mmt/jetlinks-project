import{ap as P,T as $,L as V,o as j,dh as J,B as R,P as D,di as M,d as X,aa as Y,g as G}from"./index-1730252110824.js";import{k as K}from"./collector-1730252110824.js";import{d as H,k as r,ab as W,U as f,V as Z,X as b,_ as o,f as d,u as n,G as q,Z as w,E as v,Y as C,$ as E,af as z,ag as Q}from"./vue-1730252110824.js";const g=p=>(z("data-v-8aafe3d8"),p=p(),Q(),p),ee={class:"import-content"},se={class:"column"},te=g(()=>o("p",null,"上传文件",-1)),oe={class:"import"},ae={class:"dragger-box"},ne=g(()=>o("span",{style:{margin:"16px 0 8px 0"}},"点击或拖拽上传文件",-1)),le=g(()=>o("span",null,"格式：.xlsx, .csv",-1)),ce={key:0,class:"importing-status"},ie={key:1,class:"column"},re={key:0},de={class:"column"},pe=g(()=>o("p",null,"Excel导入模板",-1)),ue={class:"file-download"},_e=H({__name:"index",props:{data:{type:Object,default:{}}},emits:["closeImport"],setup(p,{emit:L}){var k,I,N,O;const a=p,x=r(),u=r("wait"),h=r(0),_=r(0),S=r(),T=r(""),y=((k=a==null?void 0:a.data)==null?void 0:k.provider)==="COLLECTOR_GATEWAY"?(N=(I=a==null?void 0:a.data)==null?void 0:I.configuration)==null?void 0:N.collectorProvider:(O=a==null?void 0:a.data)==null?void 0:O.provider,U=async t=>{if(h.value=0,_.value=0,t.file.status==="done"){const e=t.file.response||{result:""};F(e)}},A=t=>{const e=t.type==="text/csv",s=t.type==="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";return!e&&!s&&j("请上传.csv或.xlsx格式文件","warning"),e||s},B=async t=>{const e=await K(y,t);if(e){const s=new Blob([e],{type:t}),c=URL.createObjectURL(s);J(c,`${y}导入模版`,t)}},F=async t=>{var c;let e=[];u.value="importing";let s;s=new EventSource(`${R}/data-collect/point/${(c=a.data)==null?void 0:c.collectorId}/${y}/import?:X_Access_Token=${D()}&fileUrl=${t.result}`,{withCredentials:!0}),s.onopen=i=>{console.log("open")},s.onmessage=i=>{console.log(i,"123");const l=JSON.parse(i.data);l.success?h.value++:l.rowNumber!==-1?(_.value++,e.push({rowNumber:`第${l.rowNumber}行`,message:l.message,name:l.name}),S.value=JSON.stringify(e)):T.value=l.detailFile},s.onerror=i=>{u.value="done",s.close()}};return(t,e)=>{const s=W("AIcon"),c=M,i=X,l=Y;return f(),Z(l,{visible:"",title:"导入",onCancel:e[2]||(e[2]=m=>L("closeImport")),onOk:e[3]||(e[3]=m=>L("closeImport")),width:800,maskClosable:"false"},{default:b(()=>[o("div",ee,[o("div",se,[te,o("div",oe,[d(c,{fileList:n(x),"onUpdate:fileList":e[0]||(e[0]=m=>q(x)?x.value=m:null),name:"file",action:`${n(P)}?options=tempFile`,headers:{[n($)]:n(V).get(n($))},limit:1,showUploadList:!1,onChange:U,accept:["xlsx","xls","csv"],"before-upload":A},{default:b(()=>[o("div",ae,[d(s,{class:"icon",type:"PlusCircleFilled"}),ne,le])]),_:1},8,["fileList","action","headers"])])]),n(u)=="importing"?(f(),w("div",ce,[d(s,{type:"LoadingOutlined"}),v(" 正在导入 ")])):C("",!0),n(u)!="wait"?(f(),w("div",ie,[o("p",null,[d(s,{style:{color:"#00a4ff"},type:"CheckOutlined"}),v("导入成功 总数量 "+E(n(h)),1)]),n(_)?(f(),w("span",re,[d(s,{style:{color:"#e50012"},type:"CloseOutlined"}),v("导入失败 总数量 "+E(n(_)),1)])):C("",!0)])):C("",!0),o("div",de,[pe,o("div",ue,[d(i,{onClick:e[1]||(e[1]=m=>B("xlsx")),class:"btn"},{default:b(()=>[v(" 下载模板 ")]),_:1})])])])]),_:1})}}});const ge=G(_e,[["__scopeId","data-v-8aafe3d8"]]);export{ge as default};
