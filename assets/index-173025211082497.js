import{F as S,h as p,fy as W,o as g,v as Y,a0 as ee,$ as te,I as ae,a1 as se,fz as oe,d5 as le,a8 as ie,a9 as ne,aa as re,g as de}from"./index-1730252110824.js";import"./index-1730252110824290.js";import{r as ce,t as ue,u as pe,v as fe}from"./product-17302521108244.js";import me from"./index-173025211082496.js";import{u as _e}from"./product-17302521108245.js";import{i as ve}from"./regular-1730252110824.js";import{e as ge}from"./encodeQuery-1730252110824.js";import{d as ye,k as n,r as x,ab as k,U as be,Z as he,f as o,X as i,_ as y,u as s,$ as Ie,G as xe,F as Te,af as je,ag as Ue}from"./vue-1730252110824.js";const A=u=>(je("data-v-2436200f"),u=u(),Ue(),u),we={style:{"margin-top":"10px"}},Ne=A(()=>y("span",null,"ID",-1)),Ce=A(()=>y("template",null,null,-1)),De=ye({__name:"index",props:{title:{type:String,defult:""},isAdd:{type:Number,default:0}},emits:["success"],setup(u,{expose:R,emit:T}){const d=u,b=_e(),f=n(!1),j=n(),m=n([]),r=n(!1),U=n(),h=n(!1),F=S.useForm,V=n("/images/device-product.png"),I=x(["image/jpeg","image/png","image/jfif","image/pjp"]),L=n([{label:"直连设备",value:"device",iconUrl:p("/device-type-1.png"),tooltip:"直连物联网平台的设备"},{label:"网关子设备",value:"childrenDevice",iconUrl:p("/device-type-2.png"),tooltip:"作为网关的子设备，由网关代理连接到物联网平台"},{label:"网关设备",value:"gateway",iconUrl:p("/device/device-type-3.png"),tooltip:"能挂载子设备与平台进行通信的设备"}]),e=x({id:void 0,name:"",classifiedId:void 0,classifiedName:"",deviceType:"",describe:void 0,photoUrl:p("/device/instance/device-card.png")}),w=x({id:[{validator:async(a,t)=>{if(t)if(ve(t)){if(d.isAdd===1){const _=await ce(t);return _.status===200&&_.result?Promise.reject("ID重复"):Promise.resolve()}}else return Promise.reject("请输入英文或者数字或者-或者_");else return Promise.resolve()},trigger:"blur"},{max:64,message:"最多可输入64位字符",trigger:"change"}],name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64位字符",trigger:"change"}],deviceType:[{required:!0,validator:async(a,t)=>t?Promise.resolve():Promise.reject("请选择设备类型"),trigger:"blur"}],description:[{max:200,message:"最多可输入200位字符",trigger:"blur"}]}),q=(a,t)=>{e.classifiedName=t[0]},J=async()=>{ue(ge({sorts:{sortIndex:"asc"}})).then(a=>{a.status===200&&(m.value=a.result,m.value=N(m.value))})},N=a=>a.map(t=>(t.key=t.id,t.children&&(t.children=N(t.children)),t)),B=a=>{d.isAdd===2?(b.refresh(a.id),e.name=a.name,e.classifiedId=a.classifiedId,e.classifiedName=a.classifiedName,e.photoUrl=a.photoUrl||V.value,e.deviceType=a.deviceType.value,e.describe=a.describe,e.id=a.id,h.value=!0):d.isAdd===1&&(b.reSet(),e.name="",e.classifiedId=void 0,e.classifiedName="",e.photoUrl=p("/device/instance/device-card.png"),e.deviceType="",e.describe=void 0,e.id=void 0,h.value=!1),r.value=!0},O=()=>{r.value=!1};F(e,w);const Q=()=>{U.value.validate().then(async()=>{if(f.value=!0,d.isAdd===1){e.id===""&&(e.id=void 0);const a=await pe(e).finally(()=>{f.value=!1});a.status===200?(g("保存成功！"),r.value=!1,T("success"),j.value.show(a.result.id)):g("操作失败","error")}else d.isAdd===2&&(e.classifiedId?e.classifiedId:e.classifiedId="",e.classifiedName?e.classifiedName:e.classifiedName="",(await fe(e).finally(()=>{f.value=!1})).status===200?(g("保存成功！"),T("success"),r.value=!1):g("操作失败","error"))}).catch(a=>{})};J();const $=a=>{e.deviceType=a[0]};return R({show:B}),(a,t)=>{const _=k("j-pro-upload"),c=Y,C=ee,D=k("AIcon"),z=te,P=ae,M=se,E=oe,G=le,X=ie,Z=ne,H=S,K=re;return be(),he(Te,null,[o(K,{title:d.title,maskClosable:!1,"destroy-on-close":"",visible:s(r),"onUpdate:visible":t[5]||(t[5]=l=>xe(r)?r.value=l:null),onOk:Q,onCancel:O,okText:"确定",cancelText:"取消",width:"650px",confirmLoading:s(f)},{default:i(()=>[y("div",we,[o(H,{layout:"vertical",model:s(e),rules:s(w),ref_key:"formRef",ref:U},{default:i(()=>[o(M,{type:"flex"},{default:i(()=>[o(C,{flex:"180px"},{default:i(()=>[o(c,{name:"photoUrl"},{default:i(()=>[o(_,{modelValue:s(e).photoUrl,"onUpdate:modelValue":t[0]||(t[0]=l=>s(e).photoUrl=l),accept:s(I)&&s(I).length?s(I).toString():""},null,8,["modelValue","accept"])]),_:1})]),_:1}),o(C,{flex:"auto"},{default:i(()=>[o(c,{name:"id",validateFirst:!0},{label:i(()=>[Ne,o(z,{title:"若不填写，系统将自动生成唯一ID"},{default:i(()=>[o(D,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:1})]),default:i(()=>[o(P,{value:s(e).id,"onUpdate:value":t[1]||(t[1]=l=>s(e).id=l),placeholder:"请输入ID",disabled:s(h)},null,8,["value","disabled"])]),_:1}),o(c,{label:"名称",name:"name"},{default:i(()=>[o(P,{value:s(e).name,"onUpdate:value":t[2]||(t[2]=l=>s(e).name=l),placeholder:"请输入名称"},null,8,["value"])]),_:1})]),_:1})]),_:1}),o(c,{label:"产品分类",name:"classifiedId"},{default:i(()=>[o(E,{showSearch:"",value:s(e).classifiedId,"onUpdate:value":t[3]||(t[3]=l=>s(e).classifiedId=l),placeholder:"请选择产品分类","tree-data":s(m),onChange:q,"allow-clear":"",fieldNames:{label:"name",value:"id",children:"children"},filterTreeNode:(l,v)=>s(W)(l,v,"name")},{default:i(()=>[Ce]),_:1},8,["value","tree-data","filterTreeNode"])]),_:1}),o(c,{label:"设备类型",name:"deviceType"},{default:i(()=>{var l;return[o(X,{value:s(e).deviceType,options:s(L),onChange:$,disabled:!!((l=s(b).detail)!=null&&l.accessId)},{title:i(v=>[y("span",null,Ie(v.title),1),o(G,{title:v.option.tooltip},{default:i(()=>[o(D,{type:"QuestionCircleOutlined",style:{"margin-left":"2px"}})]),_:2},1032,["title"])]),_:1},8,["value","options","disabled"])]}),_:1}),o(c,{label:"说明",name:"description"},{default:i(()=>[o(Z,{maxlength:200,showCount:"","auto-size":{minRows:4,maxRows:5},value:s(e).describe,"onUpdate:value":t[4]||(t[4]=l=>s(e).describe=l),placeholder:"请输入说明"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["title","visible","confirmLoading"]),o(me,{ref_key:"dialogRef",ref:j},null,512)],64)}}});const Be=de(De,[["__scopeId","data-v-2436200f"]]);export{Be as default};
