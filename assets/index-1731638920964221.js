import{o as M,cY as N,ds as O,Z as J,a3 as R,aa as j,g as F}from"./index-1731638920964.js";import"./index-1731638920964278.js";import"./index-1731638920964279.js";import"./index-1731638920964280.js";import"./index-1731638920964281.js";import"./index-1731638920964282.js";import"./index-1731638920964283.js";import{b as Y}from"./scene-1731638920964.js";import Z from"./AlarmModal-1731638920964.js";import{q as K,a as U,c as W}from"./configuration-1731638920964.js";import{E as X}from"./util-17316389209642.js";import{u as z}from"./useRequest-1731638920964.js";import{u as G}from"./useAlarmLevel-1731638920964.js";import{d as H,k as p,ab as f,U as S,Z as Q,f as n,X as l,_ as d,E as u,$ as _,u as v,V as ee,W as te,Y as ae,F as se,af as oe,ag as ne}from"./vue-1731638920964.js";import"./scene-17316389209642.js";import"./config-1731638920964.js";const le=a=>(oe("data-v-1e35a1fe"),a=a(),ne(),a),re={class:"related-alarms-content"},de={class:"related-alarms-add-btn"},ie={class:"related-alarms-total",style:{"margin-bottom":"8px"}},ce=le(()=>d("div",{class:"related-alarms-tip"},"注意：关联的告警配置处于“禁用”状态时会导致场景联动无法完成执行动作",-1)),ue={style:{display:"flex"}},me=H({__name:"index",props:{id:{type:String,default:""},actionId:{type:String,default:void 0},branchId:{type:String,default:""},targetType:{type:String}},emits:["close"],setup(a,{emit:y}){const s=a,I=p(0),i=p(!1),m=p(),{levelMap:h}=G(),{data:k}=z(K,{defaultParams:{terms:[{column:"ruleId",value:s.id}]},onSuccess(o){return(o.result.data||[]).reduce((r,c)=>(r[c.ruleId]=c.branchIndex,r),{})},defaultValue:[]}),B={product:"产品",device:"设备",org:"组织",other:"其他"},T=[{dataIndex:"name",fixed:"left",ellipsis:!0,title:"名称"},{dataIndex:"targetType",title:"类型",scopedSlots:!0},{dataIndex:"level",title:"告警级别",scopedSlots:!0},{dataIndex:"state",title:"状态",scopedSlots:!0},{dataIndex:"description",title:"说明",ellipsis:!0},{dataIndex:"action",title:"操作",width:80,scopedSlots:!0}],b=()=>{const o=s.actionId||s.branchId;X.emit(`${o}_alarm`,{updateTime:new Date().getTime()})},C=()=>{i.value=!1,m.value.reload(),b()},$=()=>{i.value=!0},w=async o=>{(k.value[s.id]===-1?await U(o.id,[s.id]):await W(s.id,o.id,[s.actionId||s.branchId])).success&&(m.value.reload(),M("操作成功！"),b())},A=async o=>{const e=await Y(o);return I.value=e.result.total,{code:e.status,result:e.result,status:e.status}};return(o,e)=>{const r=f("AIcon"),c=N,E=f("LevelIcon"),P=f("Ellipsis"),q=O,V=J,L=R,D=j;return S(),Q(se,null,[n(D,{visible:"",title:"关联告警",width:1e3,keyboard:!1,maskClosable:!1,footer:null,onCancel:e[0]||(e[0]=t=>y("close")),onOk:e[1]||(e[1]=t=>y("close"))},{default:l(()=>[d("div",re,[d("div",de,[n(c,{type:"link",onClick:$},{icon:l(()=>[n(r,{type:"PlusOutlined"})]),default:l(()=>[u(" 关联告警 ")]),_:1})]),d("div",ie,[u("关联告警数量："),d("span",null,_(v(I)),1)]),ce,n(L,{ref_key:"tableRef",ref:m,model:"TABLE",columns:T,request:A,bodyStyle:{padding:0},defaultParams:{sorts:[{name:"createTime",order:"desc"}],terms:[{terms:[{column:"id$rule-bind-alarm",value:`${a.id}:${a.actionId||a.branchId}`},{column:"id$rule-bind-alarm",value:`${a.id}:-1`,type:"or"}]}]}},{level:l(t=>[d("div",ue,[n(E,{level:t.level},null,8,["level"]),n(P,null,{default:l(()=>[u(_(v(h)[t.level]),1)]),_:2},1024)])]),targetType:l(t=>[u(_(B[t.targetType]),1)]),state:l(t=>{var g,x;return[n(q,{text:(g=t.state)==null?void 0:g.text,status:((x=t.state)==null?void 0:x.value)==="disabled"?"error":"success"},null,8,["text","status"])]}),action:l(t=>[n(V,{danger:"",type:"link",style:{padding:"0"},popConfirm:{title:"确认取消关联",onConfirm:()=>{w(t)}},tooltip:{title:"取消关联"}},{default:l(()=>[n(r,{type:"DisconnectOutlined"})]),_:2},1032,["popConfirm"])]),_:1},8,["defaultParams"])])]),_:1}),v(i)?(S(),ee(Z,te({key:0},s,{onOk:C,onCancel:e[2]||(e[2]=t=>i.value=!1)}),null,16)):ae("",!0)],64)}}});const we=F(me,[["__scopeId","data-v-1e35a1fe"]]);export{we as default};
