import{d as X,ac as pe,k as u,o as _e,w as me,ab as ve,u as e,U as o,Z as _,V as m,X as a,F as B,a1 as $,Y as p,_ as f,f as n,E as y,$ as S,a4 as fe}from"./vue-1731638920964.js";import{X as ge,o as q,an as ye,ao as he,dp as ke,Z as we,ds as Ce,$ as be,a0 as xe,a1 as je,af as Se,y as Le,aH as D,I as Te,v as Ne,a9 as Pe,F as Ie,d as Be,g as $e}from"./index-1731638920964.js";import"./index-1731638920964286.js";import{s as Ae,u as Ee,c as Je}from"./accessConfig-1731638920964.js";import{d as Fe,P as Me,N as U}from"./data-17316389209646.js";import Ve from"./index-1731638920964133.js";import"./index-1731638920964288.js";const Oe={key:0},Re={key:1,class:"steps-content"},qe={key:0,class:"steps-box"},De={class:"alert"},Ue={class:"search"},Xe={class:"other"},Ze={key:0},ze={key:2,class:"card-last"},He={class:"doc",style:{height:"600px"}},Ye=X({name:"AccessEdge"}),Ge=X({...Ye,props:{provider:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}}},setup(h){const l=h,Z=ge(),A=pe(),E=A.query.view,k=A.params.id,C=u(!1),z=u(l.provider.type||l.data.type),b=u(l.provider.channel),g=u({name:"",description:""}),J=u(),c=u(0),F=u(0),H=u(["网络组件","完成"]),v=u(""),x=u([]),L=u([]),M=async t=>{C.value=!0;const s=l.provider.id,i={...t,protocol:"official-edge-protocol",provider:s,transport:Me.get(s)};v.value&&(i.channelId=v.value);const d=k===":id"?await Ae(i):await Ee({...i,id:k});d.status===200&&(q("操作成功","success"),history.back(),window.onTabSaveSuccess&&(window.onTabSaveSuccess(d),setTimeout(()=>window.close(),300))),C.value=!1},Y=t=>{v.value=t},G=t=>t.health===-1?"error":"processing",V=async(t,s,i={})=>{const d=await Je(U.get(t),s,i);d.status===200&&(x.value=d.result,L.value=d.result)},K=t=>{x.value=t?L.value.filter(s=>s.name&&s.name.toLocaleLowerCase().includes(t.toLocaleLowerCase())):L.value},Q=async()=>{var s;const t=await((s=J.value)==null?void 0:s.validate());M(t)},W=()=>{var i,d;const t=(i=Z.menus["link/Type/Detail"])==null?void 0:i.path,s=window.open(`${window.location.origin+window.location.pathname}#${t}?type=${U.get((d=l.provider)==null?void 0:d.id)||""}`);s.onTabSaveSuccess=w=>{var j;w.success&&(v.value=w.result.id,V((j=l.provider)==null?void 0:j.id,v.value||""))}},ee=async()=>{v.value?c.value=c.value+1:q("请选择网络组件！","error")},te=()=>{c.value=c.value-1};_e(()=>{var t;l.provider.id==="official-edge-gateway"&&V(l.provider.id,""),k!==":id"&&(g.value={name:l.data.name,description:((t=l.data)==null?void 0:t.description)||""},v.value=l.data.channelId)}),me(c,t=>{F.value=t},{deep:!0,immediate:!0});const se=t=>{let s="";return t.forEach(i=>{s=s+" "+i.address}),s};return(t,s)=>{const i=ye,d=he,w=ve("AIcon"),j=ke,T=we,oe=Ce,ae=be,N=xe,O=je,ne=Se,re=Le,ce=D,ie=Te,P=Ne,le=Pe,de=Ie,ue=D,R=Be;return e(z)==="edge"?(o(),_("div",Oe,[e(b)!=="edge-child-device"?(o(),m(d,{key:0,class:"steps-steps",current:e(F)},{default:a(()=>[(o(!0),_(B,null,$(e(H),r=>(o(),m(i,{disabled:"",key:r,title:r},null,8,["title"]))),128))]),_:1},8,["current"])):p("",!0),e(b)!=="edge-child-device"?(o(),_("div",Re,[e(c)===0?(o(),_("div",qe,[f("div",De,[n(w,{type:"InfoCircleOutlined"}),y(" 选择与设备通信的网络组件 ")]),f("div",Ue,[n(j,{allowClear:"",placeholder:"请输入",style:{width:"300px"},onSearch:K}),n(T,{type:"primary",onClick:W,hasPermission:"link/Type:add"},{icon:a(()=>[n(w,{type:"PlusOutlined"})]),default:a(()=>[y(" 新增 ")]),_:1})]),n(re,{height:"480"},{default:a(()=>[e(x).length>0?(o(),m(O,{key:0,gutter:[24,24],style:{width:"100%"}},{default:a(()=>[(o(!0),_(B,null,$(e(x),r=>(o(),m(N,{span:8,key:r.id},{default:a(()=>[n(Ve,{onCheckedChange:Y,checked:e(v),data:{...r,description:r.description?r.description:e(Fe)[h.provider.id]}},{other:a(()=>[f("div",Xe,[n(ae,{placement:"top",title:se(r.addresses)},{default:a(()=>[(o(!0),_(B,null,$((r.addresses||[]).slice(0,1),I=>(o(),_("div",{key:I.address,class:"item"},[n(oe,{status:G(I),text:I.address},null,8,["status","text"]),(r.addresses||[]).length>1?(o(),_("span",Ze,"等"+S(r.addresses.length)+"条",1)):p("",!0)]))),128))]),_:2},1032,["title"])])]),_:2},1032,["checked","data"])]),_:2},1024))),128))]),_:1})):(o(),m(ne,{key:1,style:{"margin-top":"10%"},description:"暂无数据"}))]),_:1})])):p("",!0)])):p("",!0),e(b)==="edge-child-device"||e(c)===1?(o(),_("div",ze,[n(O,{gutter:[24,24]},{default:a(()=>[n(N,{span:12},{default:a(()=>[n(ce,{data:"基本信息"}),n(de,{model:e(g),name:"basic",autocomplete:"off",layout:"vertical",onFinish:M,ref_key:"formRef",ref:J},{default:a(()=>[n(P,{label:"名称",name:"name",rules:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64个字符",trigger:"blur"}]},{default:a(()=>[n(ie,{placeholder:"请输入名称",value:e(g).name,"onUpdate:value":s[0]||(s[0]=r=>e(g).name=r)},null,8,["value"])]),_:1}),n(P,{label:"说明",name:"description"},{default:a(()=>[n(le,{placeholder:"请输入说明",rows:4,value:e(g).description,"onUpdate:value":s[1]||(s[1]=r=>e(g).description=r),"show-count":"",maxlength:200},null,8,["value"])]),_:1}),n(P,null,{default:a(()=>[e(c)!==1&&e(E)==="false"?(o(),m(T,{key:0,type:"primary","html-type":"submit",hasPermission:`link/AccessConfig:${e(k)===":id"?"add":"update"}`,loading:e(C)},{default:a(()=>[y(" 保存 ")]),_:1},8,["hasPermission","loading"])):p("",!0)]),_:1})]),_:1},8,["model"])]),_:1}),n(N,{span:12},{default:a(()=>[f("div",He,[n(ue,{data:"配置概览"}),f("p",null,"接入方式："+S(h.provider.name),1),f("p",null,S(h.provider.description),1),f("p",null,"消息协议："+S(h.provider.id),1)])]),_:1})]),_:1})])):p("",!0),e(b)!=="edge-child-device"?(o(),_("div",{key:3,class:fe(e(c)!==1?"steps-action":"steps-action-save")},[e(c)>0?(o(),m(R,{key:0,onClick:te,style:{"margin-right":"8px"}},{default:a(()=>[y(" 上一步 ")]),_:1})):p("",!0),e(c)===1&&e(E)==="false"?(o(),m(T,{key:1,type:"primary",style:{"margin-right":"8px"},onClick:Q,hasPermission:`link/AccessConfig:${e(k)===":id"?"add":"update"}`,loading:e(C)},{default:a(()=>[y(" 保存 ")]),_:1},8,["hasPermission","loading"])):p("",!0),[0].includes(e(c))?(o(),m(R,{key:2,onClick:ee},{default:a(()=>[y(" 下一步 ")]),_:1})):p("",!0)],2)):p("",!0)])):p("",!0)}}});const at=$e(Ge,[["__scopeId","data-v-9c0888f5"]]);export{at as default};
