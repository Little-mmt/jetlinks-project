import{d as H,ac as re,k as h,r as ue,e as de,s as pe,o as _e,ab as me,U as i,Z as w,f as o,X as n,V as m,u as e,_ as p,E as k,Y as b,F as B,a1 as D,$ as F,a0 as fe,af as ge,ag as ye}from"./vue-1731638920964.js";import{X as ve,o as M,an as he,ao as we,dp as ke,Z as be,J as xe,a0 as Ce,a1 as Se,af as je,y as Pe,aH as Ie,I as qe,v as Te,a9 as Be,dw as Ve,F as $e,d as Ae,g as Je}from"./index-1731638920964.js";import"./index-1731638920964286.js";import{i as Le,j as Re,s as Ee,u as Ne}from"./accessConfig-1731638920964.js";import Ue from"./index-1731638920964133.js";import{C as De}from"./rules-1731638920964.js";import"./index-1731638920964288.js";const O=x=>(ge("data-v-a03c36f3"),x=x(),ye(),x),Fe={class:"steps-content"},Me={key:0,class:"steps-box"},He={class:"search"},Oe={class:"plugin-other"},Xe={class:"plugin-id"},Ze=O(()=>p("div",{class:"plugin-text"}," 插件ID： ",-1)),ze={class:"other-content"},Ge={class:"plugin-version"},Ye=O(()=>p("div",{class:"plugin-text"}," 版本号： ",-1)),Ke={class:"other-content"},Qe={key:1,class:"steps-box"},We={class:"steps-action"},et=H({name:"AccessConfigPlugin"}),tt=H({...et,props:{provider:{type:Object,default:()=>{}},data:{type:Object,default:()=>{}},bindProduct:{type:Boolean,default:!1}},setup(x){const r=x,j=re(),X=ve(),f=h(0),C=h([]),g=h(r.data.channelId),P=j.params.id,Z=j.query.view,V=document.body.clientHeight,I=h(!1),u=ue({name:void 0,description:void 0,configuration:{}}),$=h(),q=h([]),A=(t={})=>{Le({terms:[{terms:[{column:"type",value:r.provider.id==="media-plugin"?"media":"deviceGateway",termType:"eq"}]},t],sorts:[{name:"createTime",order:"desc"}],paging:!1}).then(s=>{C.value=[],s.success&&(C.value=s.result||[])})},J=de(()=>j.query.view==="false"&&!r.bindProduct),z=t=>{var _,y,v,d;let s="输入",l=[];["select","date"].includes(((_=t.type)==null?void 0:_.type)||"string")&&(s="选择"),(v=(y=t.type)==null?void 0:y.expands)!=null&&v.required&&l.push({required:!0,message:`请${s}${t.name}`});const c=De((d=t.type)==null?void 0:d.type);return l=[...l,...c],l},G=(t,s=!0)=>{Re(t).then(l=>{var c,_,y;if(l.success){const v=((y=(_=(c=l.result)==null?void 0:c.others)==null?void 0:_.configMetadata)==null?void 0:y.properties)||[];q.value=v.map(d=>{var S;return s&&(u.configuration[d.property]=void 0),{label:d.name,name:d.property,type:((S=d.type)==null?void 0:S.type)||"string",rules:z(d)}})}})},Y=t=>{A({terms:[{column:"name",termType:"like",value:`%${t}%`}],type:"and"})},K=t=>{g.value=t},Q=()=>{var l;const t=(l=X.menus["link/plugin"])==null?void 0:l.path,s=window.open(`${window.location.origin+window.location.pathname}#${t}?save=true`);s.onTabSaveSuccess=c=>{var _;c.success&&(g.value=(_=c.result)==null?void 0:_.id,C.value.unshift(c.result))}},W=()=>{if(!g.value)return M("请选择插件！","error");f.value+=1},ee=()=>{f.value-=1},te=()=>{$.value.validate().then(async t=>{var s;if(t){const l={...r.data,...t,protocol:r.provider.id==="media-plugin"?r.provider.id:"plugin",channel:"plugin",channelId:g.value,provider:r.provider.id,transport:"plugin"};I.value=!0;const c=P===":id"?await Ee(l).catch(()=>{}):await Ne({...l,id:P}).catch(()=>{});I.value=!1,c.success&&(M("操作成功","success"),history.back(),window.onTabSaveSuccess&&(s=c.result)!=null&&s.id&&(window.onTabSaveSuccess(c),setTimeout(()=>window.close(),300)))}})};return pe(()=>{f.value===1&&g.value&&G(g.value,g.value!==r.data.channelId)}),_e(()=>{P!==":id"&&(u.name=r.data.name,u.description=r.data.description,u.configuration=r.data.configuration)}),A(),(t,s)=>{const l=he,c=we,_=ke,y=me("AIcon"),v=be,d=xe,S=Ce,L=Se,ne=je,se=Pe,R=Ie,ae=qe,T=Te,oe=Be,le=Ve,ie=$e,E=Ae;return i(),w("div",null,[o(c,{current:e(f)},{default:n(()=>[(i(),m(l,{disabled:"",key:0,title:"选择插件"})),(i(),m(l,{disabled:"",key:1,title:"完成"}))]),_:1},8,["current"]),p("div",Fe,[e(f)===0?(i(),w("div",Me,[p("div",He,[o(_,{allowClear:"",placeholder:"请输入",style:{width:"300px"},onSearch:Y}),e(J)?(i(),m(v,{key:0,type:"primary",onClick:Q,hasPermission:"link/plugin:add"},{icon:n(()=>[o(y,{type:"PlusOutlined"})]),default:n(()=>[k(" 新增 ")]),_:1})):b("",!0)]),o(se,{height:"480"},{default:n(()=>[e(C).length>0?(i(),m(L,{key:0,gutter:[24,24],style:{width:"100%"}},{default:n(()=>[(i(!0),w(B,null,D(e(C),a=>(i(),m(S,{span:8,key:a.id},{default:n(()=>[o(Ue,{onCheckedChange:K,checked:e(g),disabled:!e(J),data:{...a,type:"plugin"}},{other:n(()=>[p("div",Oe,[p("div",Xe,[Ze,p("div",ze,[o(d,null,{default:n(()=>[k(F(a.id),1)]),_:2},1024)])]),p("div",Ge,[Ye,p("div",Ke,[o(d,null,{default:n(()=>[k(F(a.version),1)]),_:2},1024)])])])]),_:2},1032,["checked","disabled","data"])]),_:2},1024))),128))]),_:1})):(i(),m(ne,{key:1,style:{"margin-top":"10%"},description:"暂无数据"}))]),_:1})])):e(f)===1?(i(),w("div",Qe,[p("div",{class:"card-last",style:fe(`max-height:${e(V)>900?750:e(V)*.7}px`)},[o(L,{gutter:[24,24]},{default:n(()=>[o(S,{span:16},{default:n(()=>[o(R,{data:"基本信息"}),o(ie,{ref_key:"formRef",ref:$,model:e(u),layout:"vertical"},{default:n(()=>[o(T,{label:"名称",rules:[{required:!0,message:"请输入名称",trigger:"blur"},{max:64,message:"最多可输入64个字符"}],name:"name"},{default:n(()=>[o(ae,{value:e(u).name,"onUpdate:value":s[0]||(s[0]=a=>e(u).name=a),allowClear:"",placeholder:"请输入名称"},null,8,["value"])]),_:1}),o(T,{label:"说明",rules:[{max:200,message:"最多可输入200个字符"}],name:"description"},{default:n(()=>[o(oe,{placeholder:"请输入说明",rows:4,value:e(u).description,"onUpdate:value":s[1]||(s[1]=a=>e(u).description=a),"show-count":"",maxlength:200},null,8,["value"])]),_:1}),e(q).length?(i(),w(B,{key:0},[o(R,{data:"通用配置"}),(i(!0),w(B,null,D(e(q),a=>{var N,U;return i(),m(T,{key:a.name,name:["configuration",a.name],label:a.label,rules:a.rules,required:!!((U=(N=a.type)==null?void 0:N.expands)!=null&&U.required)},{default:n(()=>[o(le,{modelValue:e(u).configuration[a.name],"onUpdate:modelValue":ce=>e(u).configuration[a.name]=ce,itemType:a.type},null,8,["modelValue","onUpdate:modelValue","itemType"])]),_:2},1032,["name","label","rules","required"])}),128))],64)):b("",!0)]),_:1},8,["model"])]),_:1})]),_:1})],4)])):b("",!0)]),p("div",We,[e(f)>0?(i(),m(E,{key:0,onClick:ee,style:{"margin-right":"8px"}},{default:n(()=>[k(" 上一步 ")]),_:1})):b("",!0),e(f)===1&&e(Z)==="false"?(i(),m(v,{key:1,type:"primary",style:{"margin-right":"8px"},onClick:te,hasPermission:`link/AccessConfig:${t.id===":id"?"add":"update"}`,loading:e(I)},{default:n(()=>[k(" 保存 ")]),_:1},8,["hasPermission","loading"])):b("",!0),e(f)===0?(i(),m(E,{key:2,type:"primary",onClick:W},{default:n(()=>[k(" 下一步 ")]),_:1})):b("",!0)])])}}});const rt=Je(tt,[["__scopeId","data-v-a03c36f3"]]);export{rt as default};
